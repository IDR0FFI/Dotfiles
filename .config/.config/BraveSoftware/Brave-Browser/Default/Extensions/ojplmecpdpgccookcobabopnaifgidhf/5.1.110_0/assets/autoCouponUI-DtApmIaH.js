import{B as ne,az as Ne,L as ce,aA as Ie,aB as Me,aC as Te,N as De,M as Oe,C as pe,q as me,t as He,aD as Re,c as A,aE as S,aF as Y,a as ie,aG as Fe,aH as Je}from"./utility_all2-BNXd1yEL.js";const g=e=>{ne(e),Ne(e),e||pe(!1)},se=e=>{ce(e)},ye=e=>{Ie(e)},lt=()=>{ke()},ot=()=>{$e(),ne(!1),pe(!0)},fe=e=>{Me(e)},Ue=e=>{Oe(e)},Pe=e=>{De(e)},Be=e=>{},dt=e=>{ge(e)},O=e=>{ne(!0),ce(!1),Te(e)};let m=1,T="",i={},G=0,j=0,L=-1,J="₹",E={},we="",ee=!1,te=0,q="",he="",w="",_e=!1,v="",M={},C={},F=0,H=-1,Se=!1,be=!1,Q=!1,X="",I="";function ke(e){_e=!0,Le(w)}function $e(){Q=!1,ve(w)}async function ge(e){try{if(!Se)return;i=await qe();let t=[],s=0,l="";if(w.interceptor_api!=""){if(await U(w),l=await Xe(w,e),m==1)return;l=JSON.parse(JSON.stringify(l).replaceAll("buyhatke",e.code)),w.lowercase&&(l=JSON.parse(JSON.stringify(l).toLowerCase()))}let n=0,u={msg:"",id:e.id,code:e.code,success:!1,savings:0};try{if(w.interceptor_api!=""){let o=l.url,y=-1;try{if(y=await fetch(o,l),!y.ok)try{y=await y.json(),u.msg=Z(w,"cpn_message",y)||"",y=-1}catch{u.msg=""}}catch{u.msg=""}if(y!=-1){y=await y.json();try{if(u.savings=Z(w,"discount",y)||0,w.operation)switch(w.operation.type){case"divide":u.savings/=w.operation.value;break;case"multiply":u.savings*=w.operation.value;break;case"add":u.savings+=w.operation.value;break;case"subtract":u.savings-=w.operation.value;break}}catch{u.savings=0}}}else if(w.hatke_AC&&w.total_price!=null){await U(w),await B(w,e.code);let o=await W(w);o.type==="totalprice"?u.savings=n-o.price:o.type==="discount"?u.savings=o.price:u.msg=o.msg}else if(w.sync!=null){await U(w),await B(w,e.code);let o=await W(w);o.type==="dis"?u.savings=o.dis:u.msg=o.msg}return u.success=u.savings>0,t.push(u),u.savings>0?(await P({type:"ACMonitor",data:{clubID:he,status:3,prevStatus:L}}),Ce({dis:u.savings,code:e.code},w),{success:!0,savings:u.savings,code:e.code}):(z(w),{success:!1,message:u.msg||"Coupon not applicable",code:e.code})}catch(o){return z(w),{success:!1,message:o.message,code:e.code}}}catch(t){return z(w),{success:!1,message:t.message,code:e.code}}}const R={getAllItems:()=>chrome.storage.local.get(),getItem:async e=>(await chrome.storage.local.get(e))[e],setItem:async(e,t)=>await chrome.storage.local.set({[e]:t}),removeItems:async e=>await chrome.storage.local.remove(e),removeItem:async e=>await chrome.storage.local.remove(e)};async function K(e){try{return await A(e)}catch{return}}async function ve(e){try{if(e.reload!=null&&(await R.removeItem("buyhatke"+T),i={}),m=1,G==1){if(M.abrubtly_closed=1,F){let t=Date.now();const s=await V(F,t);C.time_taken=s,C.event_type="abrubtly_closed",H&&H!=-1&&(C.id=H)}M.process_started!=null&&await K({type:"ACTSMonitor",data:{clubID:v,ACanalytics:M,ACAnalyticsValue:C}}),M={},C={},te>0&&L!=3&&L!=4?(await P({type:"ACMonitor",data:{clubID:v,status:8,prevStatus:L}}),E.pos=v,await A({type:"fireEvent",eventName:"ACUIclosedForcefullywithDis",params:E})):L!=4&&L!=3&&(await P({type:"ACMonitor",data:{clubID:v,status:5,prevStatus:L}}),E.pos=v,await A({type:"fireEvent",eventName:"AutoCouponUIclosedForcefully",params:E}))}L=5,e.reload!=null&&(i.prevStatus=L),be&&Ve(T);return}catch(t){throw new Error(t.message)}}async function Ve(e){try{return await A({type:"reloadTab",tabId:e})}catch{}}function Ce(e,t){Ue(e),Se=!0,t.discount_reload!=null&&(be=!0)}function z(e){try{j==0?Pe(!0):O(!1),j=0,ve(e)}catch(t){throw new Error(t.message)}}async function ae(e){try{return await A(e)}catch{return[]}}async function P(e){try{return await A(e)}catch{return}}async function Ke(e){try{return await A(e)}catch{return[]}}const qe=async()=>new Promise(async e=>{let t=await JSON.parse(await R.getItem("buyhatke"+T)==null?"{}":await R.getItem("buyhatke"+T));e(t||i)});function We(e){try{let t=e.split("?");if(t.length>1){let l=new URLSearchParams(t[1]).get("link");if(l){let n=decodeURIComponent(l);return new URL(n).hostname}}return new URL(e).hostname}catch{}}async function V(e,t){if(!Number.isInteger(e)||!Number.isInteger(t)||e<0||t<0||t<e)return 0;const s=t-e;return Math.min(s,99999999)}async function Ae(e){try{if(e.automatic.coupon_click.name!=null&&e.automatic.coupon_click.name!=""&&document.querySelector(e.automatic.coupon_click.name)||e.automatic.coupon_click.proxyname!=null&&e.automatic.coupon_click.proxyname!=""&&document.querySelector(e.automatic.coupon_click.proxyname)||e.automatic.coupon_value.name!=null&&e.automatic.coupon_value.name!=""&&document.querySelector(e.automatic.coupon_value.name)||e.automatic.apply_button.name!=null&&e.automatic.apply_button.name!=""&&document.querySelector(e.automatic.apply_button.name))return!0;if(e.automatic.multi_remove!=null&&e.automatic.multi_remove.length>0){for(let t=0;t<e.automatic.multi_remove.length;t++)if(e.automatic.multi_remove[t].name!=""&&document.querySelector(e.automatic.multi_remove[t].name))return!0}return!1}catch{throw new Error("Error in pagechecker")}}function ue(e,t){var s;for(let l=0;l<t.length;l++)if(new RegExp(t[l].url).test(e.url)&&!((s=t[l])!=null&&s.platform))return t[l];return null}async function le(){try{if(m=1,T="",i={},G=0,j=0,q=await me(),!q.url||q.url==""||q.url==null||q.url==null)throw new Error("Cannot get URL");let e=We(q.url);if(T=q.id,v=await He(),v==""||v==null||v==null)throw new Error("Cannot get ACpos");M={},C={},F=0,H=-1;let t=await Re();if(w=await Ke({type:"getConfig",pos:v,devicetype:t}),w==null||w==null||w.length==0)throw new Error("Cannot get config");let s=0;if(X=await A({type:"getCheckoutAnalytics"}),I=X==null?void 0:X.ACCheckPoints,w[0].hatke_AC){const l=ue(q,w);if(l){try{await A({type:"fireEvent",eventName:"analyticsCommonBh",params:{type:"error_pair_level",pos:v,config:I==null?void 0:I.events[0],name:I==null?void 0:I.name,tabId:T}})}catch{}w=l}if(!Array.isArray(w))for(;s==0;){if(await Ae(w)==!0){try{await A({type:"fireEvent",eventName:"analyticsCommonBh",params:{type:"error_pair_level",pos:v,config:I==null?void 0:I.events[1],name:I==null?void 0:I.name,tabId:T}})}catch{}s=1,ee=!0;break}await S(500)}}else{for(let n=0;n<w.length;n++){let u=w[n].selector;if(w[n].is_executable&&document.querySelector(u)){s=1;break}}const l=ue(q,w);if(l){try{await A({type:"fireEvent",eventName:"analyticsCommonBh",params:{type:"error_pair_level",pos:v,config:I==null?void 0:I.events[0],name:I==null?void 0:I.name,tabId:T}})}catch{}w=l}}if(Array.isArray(w)&&s==1){let l={hostname:e};l.pos=v,await A({type:"fireEvent",eventName:"ACCartUrlError",params:l})}if(!w.is_executable)return;if(w.discount2!=null&&w.id==1288&&document.querySelector("div.fareTypeWrap:nth-child(4) > div > div >span.fareHeader")!=null&&document.querySelector("div.fareTypeWrap:nth-child(4) > div > div >span.fareHeader").innerHTML=="Other Services"&&(w.discount=w.discount2),w.reload!=null&&(i=await qe(),i=i=="null"?{}:i),w.hide_couponlist,w.isGlobal&&(J="$"),Y(J),w.crncy&&(J=w.crncy),Y(J),i.crncySymbol&&(J=i.crncySymbol,Y(J)),!Array.isArray(w)){let l="";if(w.reload!=null&&i.couponList!=null)l=await JSON.parse(i.couponList);else if(w.cat!=null?l=await ae({type:"getCouponsList",pos:w.id,cat:w.cat}):l=await ae({type:"getCouponsList",pos:w.id}),l=l.filter(n=>!n.code.toUpperCase().includes("HONEY")),l.length==0){await P({type:"ACMonitor",data:{clubID:v,status:9}});return}}i.ACAnalytics&&i.ACAnalyticsValue&&(M=i.ACAnalytics,C=i.ACAnalyticsValue),i.startMS!=null&&i.processid!=null&&(F=i.startMS,H=i.processid),i.processing&&(Q=i.processing),i.globalPreMaxDis&&(te=i.globalPreMaxDis),await Ye(w)}catch{}}async function oe(e){for(;;){if(Q){await S(1e3);continue}let t=await me(),s=!1;if(new RegExp(e.url).test(t.url)&&!(e!=null&&e.platform)&&(s=!0),e.hatke_AC&&s){const n=await Ae(e);g(!!n)}else e.selector&&e.selector!=""&&document.querySelector(e.selector)||e.proxy_sel!=null&&document.querySelector(e.proxy_sel)?g(!0):g(!1);await S(1e3)}}function Le(e){try{if(_e&&(ee=!1,Q=!0,g(!1),se(!0),de(e)),i.couponList==null)ee=!0;else if(Object.keys(i).length!=0&&i.couponList!=null){de(e),se(!0),g(!1);let t=JSON.parse(i.couponList),s=JSON.parse(i.coupon_arr),l=t==null?void 0:t.map(o=>{const y=s==null?void 0:s.find(p=>p.code===o.code);return y?{...o,savings:(y==null?void 0:y.savings)||0,msg:(y==null?void 0:y.msg)||"",success:(y==null?void 0:y.success)||!1}:o});ye(l);let n=i==null?void 0:i.ACpos,u;n!==void 0&&s[n]?u=s[n]:u=s==null?void 0:s.reduce((o,y)=>{const p=parseFloat(y.saving||0),b=parseFloat(o.saving||0);return p>b?y:o},s[0]||{}),fe(u)}}catch{}}async function Ye(e){try{if(ee)g(!0),Le(e),oe(e);else{let t=0;for(;t==0;){if(document.querySelector(e.selector)||e.proxy_sel!=null&&document.querySelector(e.proxy_sel)){t=1,g(!0),oe(e);try{await A({type:"fireEvent",eventName:"analyticsCommonBh",params:{type:"error_pair_level",pos:v,config:I==null?void 0:I.events[1],name:I==null?void 0:I.name,tabId:T}})}catch{}e.reload!=null&&i.is_UIOpen&&ke(!0);break}await S(500)}}}catch{}}async function je(e){try{if(e.cpns_on_page==null)return!1;for(let t=0;t<e.cpns_on_page.length;t++)document.querySelector(e.cpns_on_page[t].name)&&document.querySelector(e.cpns_on_page[t].name).click(),await S(1e3);return!0}catch{return!1}}async function Ge(e,t){try{if(await je(t)){let l=await JSON.parse(await R.getItem("CPNS"+T+v)==null?"{}":await R.getItem("CPNS"+T+v));if(l.ONPAGE_CPNS!=null&&l.ONPAGE_CPNS.length!=0){let n=[...e];l.ONPAGE_CPNS.forEach(u=>{const o=n.find(y=>{var p;return((p=y.code)==null?void 0:p.toUpperCase())===u.code.toUpperCase()});o?(n=n.filter(y=>y.code.toUpperCase()!==u.code.toUpperCase()),n.unshift(o)):n.unshift(u)}),e=n,await R.removeItem("CPNS"+T+v)}}return e}catch{throw new Error}}async function de(e){var t;try{let s=document.getElementById("hk-ac-id-apply-button");if(typeof ie<"u"&&ie()!=""&&s!=null&&s!=null&&s!=""){let n=window.location.href;const u=new URL(n);Fe(47,"misplaced AutoCoupon",`${u.origin}${u.pathname}`)}if((e.reload==null||e.reload!=null&&Object.keys(i).length==0)&&await A({type:"getAffCouponsNew",data:{pos:v,url:q.url}}),e.loginCheck!=null&&e.loginCheck.name!=null&&e.loginCheck.name!=""&&document.querySelector(e.loginCheck.name)!=null&&document.querySelector(e.loginCheck.name).innerHTML.includes(e.loginCheck.text)){let n=q.url;n=n.split("//"),n=n[1],n=n.split("/"),n=n[0],O(!1);return}if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((t=document.querySelector(e.isLogin))==null?void 0:t.style.display)!="none"){let n=q.url;n=n.split("//"),n=n[1],n=n.split("/"),n=n[0],O(!1),Be(n);return}if(j=0,await S(1e3),m==0||G==1)return;e.reload!=null&&i.prevStatus!=null?L=i.prevStatus:(L=0,await P({type:"ACMonitor",data:{clubID:v,status:0}}),E={hostname:we},E.pos=v,await A({type:"fireEvent",eventName:"AutoCouponClicked",params:E})),e.reload!=null&&(i.prevStatus=L),m=0;let l="";try{if(e.reload!=null&&i.couponList!=null)l=await JSON.parse(i.couponList),i.startMS!=null&&i.processid!=null&&(H=i.processid,F=i.startMS);else{H=await K({type:"getACAnalyticsId",data:{pos:v}}),F=Date.now(),M.process_started=1,C.process_started=1,e.cat?l=await ae({type:"getCouponsList",pos:e.id,cat:e.cat}):l=await ae({type:"getCouponsList",pos:e.id}),l=l.filter(u=>!u.code.toUpperCase().includes("HONEY"));let n=l;if(e.cpns_on_page!=null)try{l=await Ge(l,e)}catch{l=n}ye(l),l.length>0&&(M.found_coupon=1),await P({type:"ACMonitor",data:{clubID:v,status:1,prevStatus:L}}),E.pos=v,await A({type:"fireEvent",eventName:"CouponListFetched",params:E}),L=1,e.reload!=null&&(i.prevStatus=L),await P({type:"ACMonitor",data:{clubID:v,status:2,prevStatus:L}}),E.pos=v,await A({type:"fireEvent",eventName:"ExecutionStarted",params:E}),L=2,e.reload!=null&&(i.prevStatus=L),e.reload!=null&&(i.couponList=JSON.stringify(l),i.startMS=F,i.processid=H,i.ACAnalytics=M,i.ACAnalyticsValue=C,i.processing=Q)}}catch{l=[]}if(m==1||(e.hide_couponlist,e.reload!=null&&(i.is_UIOpen=!0),G=1,await ze(l,e),G=0,m==1))return}catch{}}async function ze(e,t){var s,l;try{let n=t.reload!=null&&i.coupon_arr!=null?await JSON.parse(i.coupon_arr):[],u=0;t.default_dis&&(u=await rt(t),isNaN(u)?u=0:u=parseFloat(u));let o="";if(t.interceptor_api!=""){if(await U(t),o=await Qe(t),m==1)return;o=await JSON.parse(JSON.stringify(o).replaceAll("buyhatke","BUYHATKE"))}const y=new Map;let p=0;i.max!=null&&(p=i.max),(t.reload==null||i.iterator!=e.length)&&void 0,t.reload!=null&&i.iterator==e.length&&(i.iterator-1,void 0);let b=0;try{if(t.hatke_AC&&t.reload&&i.initial_price!=null&&t.total_price!=null)b=parseFloat(i.initial_price),J=i.crncySymbol,Y(J);else if(t.hatke_AC&&t.reload&&i.code=="BUYHATKE"&&i.initial_price==null&&t.total_price!=null){let a=await W(t);a.type=="totalprice"&&(b=a.price,J=a.cS,Y(J)),t.reload!=null&&(i.initial_price=b,i.crncySymbol=J,Y(J),await R.setItem("buyhatke"+T,JSON.stringify(i)))}else if(t.hatke_AC&&i.initial_price==null&&t.total_price!=null){await U(t),await S(1e3),t.reload!=null&&(i.code="BUYHATKE",await R.setItem("buyhatke"+T,JSON.stringify(i))),await B(t,"BUYHATKE"),await S(1e3);let a=await W(t);a.type=="totalprice"&&(b=a.price,b=parseFloat(b),J=a.cS,Y(J))}}catch(a){throw new Error(a.message)}let h=0;i.totaltime!=null&&(h=i.totaltime);for(let a=t.reload==null||i.iterator==null?0:parseInt(i.iterator);a<e.length&&m==0;a++){let d=Date.now();i.cpnstartMS!=null&&i.iterator!=null&&i.iterator==a&&i.canCheck!=null&&i.canCheck&&(d=i.cpnstartMS);let r=t.reload!=null&&i.my_obj!=null?await JSON.parse(i.my_obj):{msg:"",id:e[a].id,code:e[a].code,success:!1,savings:0},_=Math.floor(100*(a+1)/e.length),c=0;if(m==1)return;if(t.interceptor_api!=""){let f="",x="";f=a==0?"BUYHATKE":e[a-1].code,x=e[a].code,t.lowercase&&(f!="BUYHATKE"&&(f=f.toLowerCase()),x=x.toLowerCase()),o=await JSON.parse(JSON.stringify(o).replaceAll(f,x));let k=o.url,D=-1;try{if(m==1)return;if(D=await fetch(k,o),!D.ok)try{if(m==1)return;D=await D.json(),t.discount_arr!=null?(r.msg==null&&(r.msg=""),D=-1):(r.msg=Z(t,"cpn_message",D),r.msg==null&&(r.msg=""),D=-1)}catch{r.msg="",D=-1}}catch{r.msg="",D=-1}if(D!=-1){if(m==1)return;if(D=await D.json(),t.discount_arr!=null)try{c=await et(t.discount_arr[0],"discount",D,x)}catch{c=0}else try{c=Z(t,"discount",D),(isNaN(c)||c==null||c==null)&&(c=0)}catch{c=0}c!=0&&t.operation!=null&&(t.operation.type=="divide"&&(c/=t.operation.value),t.operation.type=="multiply"&&(c*=t.operation.value),t.operation.type=="add"&&(c+=t.operation.value),t.operation.type=="subtract"&&(c-=t.operation.value));let N="";if(c==0&&!t.discount_arr){try{N=Z(t,"cpn_message",D),N==null&&(N="")}catch{N=""}N=N.replace(/<[^>]+>/g,""),N=N.replace(/\s+/g," ").trim()}r.savings=0,r.msg="",c>0?(r.savings=c,r.msg=N,r.success=!0):r.msg=N||""}else c=0,r.savings=c}else if(t.hatke_AC&&t.reload&&t.total_price!=null)if(i.iterator!=null&&i.iterator==a&&i.canCheck!=null&&i.canCheck){let f=await W(t);if(m==1)return;let x="";if(f.type=="discount")c=f.price;else if(f.type=="cashback")c=f.price;else if(f.type=="totalprice"){let k=f.price;c=b-k}else f.type=="totalpricemsg"&&(x=f.msg,c=0);isNaN(c)&&(c=0),c=c.toFixed(2),c=parseFloat(c),r.savings=0,r.msg="",c>0&&(r.savings=c,r.msg=x,r.success=!0)}else i.iterator=a,i.my_obj=JSON.stringify(r),i.coupon_arr=JSON.stringify(n),await U(t),await S(1e3),i.canCheck=!0,await B(t,e[a].code),await S(1e3);else if(t.hatke_AC&&t.total_price!=null){if(await U(t),await S(1e3),m==1||(await B(t,e[a].code),m==1))return;await S(1e3);let f=await W(t);if(m==1)return;let x="";if(f.type=="discount")c=f.price;else if(f.type=="cashback")c=f.price;else if(f.type=="totalprice"){let k=f.price;c=b-k}else f.type=="totalpricemsg"&&(x=f.msg,c=0);isNaN(c)&&(c=0),c=c.toFixed(2),c=parseFloat(c),r.savings=0,r.msg="",c>0&&(r.savings=c,r.msg=x,r.success=!0)}else if(t.sync!=null){if(await U(t),m==1||(await B(t,e[a].code),m==1))return;let f=await W(t,e[a].code);if(m==1)return;let x="";f.type=="dis"?c=f.dis:(x=f.msg,c=0),isNaN(c)&&(c=0),c=parseFloat(c),r.savings=0,r.msg="",c>0&&(r.savings=c,r.msg=x,r.success=!0)}else if(t.reload!=null){if(i.iterator!=null&&i.iterator==a&&i.canCheck!=null&&i.canCheck){let f=await tt(t);if(m==1)return;let x="";f.type=="dis"?c=f.dis:(x=f.msg,c=0),isNaN(c)&&(c=0),c=parseFloat(c),r.savings=0,r.msg="",c>0&&(r.savings=c,r.msg=x,r.success=!0)}else if(i.iterator=a,i.my_obj=JSON.stringify(r),i.coupon_arr=JSON.stringify(n),await U(t),i.canCheck=!0,i.cpnstartMS=d,t.automatic.coupon_click_reload!=null&&(i.canCheck=!1),await B(t,e[a].code),t.success_reload&&document.querySelector(t.reload.cpn_message.name)!=null){let f=document.querySelector(t.reload.cpn_message.name).innerHTML;t.reload.cpn_message.selector&&(f=document.querySelector(t.reload.cpn_message.selector).innerHTML);let x=t.reload.cpn_message.split.length;for(let k=0;k<x;k++)if(f.split(t.reload.cpn_message.split[k].string)[t.reload.cpn_message.split[k].index]!=null)f=f.split(t.reload.cpn_message.split[k].string)[t.reload.cpn_message.split[k].index];else{f="";break}r.msg=f}}if(t.reload!=null&&i.cpnstartMS!=null&&(d=i.cpnstartMS),d){let f=Date.now();const x=await V(d,f);h=Number(h+x),t.reload!=null&&(i.totaltime=h)}if(m==1)return;if(y.has(parseFloat(c))||y.set(parseFloat(c),a),p<c&&(p=c,t.reload!=null&&(i.max=p,i.ACpos=a)),c>0&&(te=c,t.reload!=null&&(i.globalPreMaxDis=te)),m!=1&&void 0,n.push(r),n.length===0)return null;fe(n[n.length-1]),t.reload!=null&&(i.coupon_arr=JSON.stringify(n),i.my_obj=void 0)}if(h!=0&&e.length!=0&&(C.each_coupon_apply=Math.floor(h/e.length)),m==1)return;if(p==0&&u==0){if(t.initialstate&&await U(t),t.reload!=null&&(await R.removeItem("buyhatke"+T),i={}),M.process_success=1,F){let a=Date.now();const d=await V(F,a);C.time_taken=d,C.event_type="success"}H&&H!=-1&&(C.id=H,await K({type:"ACTSMonitor",data:{clubID:v,ACanalytics:M,ACAnalyticsValue:C}})),M={},C={},await P({type:"ACMonitor",data:{clubID:v,status:4,prevStatus:L}}),E.pos=v,await A({type:"fireEvent",eventName:"successWithoutDiscount",params:E}),L=4,t.reload!=null&&(i.prevStatus=L),z(t)}else{try{let c={PIDs:await Je(),pos:he,ts:Date.now(),discount:p,couponCode:t.reload==null?e[y.get(parseFloat(p))].code:e[i.ACpos].code,id:95};await A({type:"fireEvent",eventName:"StageEvents",ts:Date.now(),params:{...c}})}catch{}if(t.reload!=null&&i.iterator!=null&&i.iterator==e.length-1)i.iterator=e.length,await U(t),await B(t,t.reload==null?e[y.get(parseFloat(p))].code:e[i.ACpos].code);else if(t.reload==null)if(t.default_dis&&u>p){t.automatic.coupon_click.name!=""&&document.querySelector(t.automatic.coupon_click.name)!=null&&(document.querySelector(t.automatic.coupon_click.name).click(),t.automatic.coupon_click.wait&&await S(1e3));let _=document.querySelectorAll(".coupon-base-validCouponContainer .coupon-base-labelUnchecked");for(let c=0;c<_.length;c++)_[c].click();await S(1e3),document.querySelector("#applyCoupon")!=null&&(document.querySelector("#applyCoupon").click(),t.automatic.clear_button.wait&&await S(1e3))}else{if(await U(t),m==1)return;t.default_dis?await nt(t,t.reload==null?e[y.get(parseFloat(p))].code:e[i.ACpos].code):await B(t,t.reload==null?e[y.get(parseFloat(p))].code:e[i.ACpos].code)}if(M.process_success=1,M.best_applied=1,F){let _=Date.now();const c=await V(F,_);C.time_taken=c,C.event_type="success"}H&&H!=-1&&(C.id=H,await K({type:"ACTSMonitor",data:{clubID:v,ACanalytics:M,ACAnalyticsValue:C}})),M={},C={},await P({type:"ACMonitor",data:{clubID:v,status:3,prevStatus:L}}),E.pos=v,await A({type:"fireEvent",eventName:"successWithDiscount",params:E}),L=3,t.reload!=null&&(i.prevStatus=L),Ce({dis:p>=u?p:u,code:p>=u?t.reload==null?y.get(parseFloat(p)):e[i.ACpos].code:""},t),t.reload!=null&&(await R.removeItem("buyhatke"+T),i={}),i.ACsavings=p>=u?p:u,i.pos=t.id,i.ACpos=t.id,i.ts=Date.now(),await R.setItem("hatkeACsaving",i);let a=await R.getItem("ext_id"),d=await R.getItem("ext_auth"),r=p>=u?p:u;try{if(r>0){let _={pos:t.id,prod:"",pid:"",price:"",extId:a,extAuth:d,type:"autoCoupon",savings:r};await A({type:"postSavingsAlert",data:_})}}catch{}}(s=document.querySelector("#hk-autoCoupon > div.hk-c-modal.hk-c-modal--wide.hk-ext-animated > div.hk-l-flexColumns > div.hk-aCoup__main.hk-u-padding__15.hk-c-modal__wrapper--scrollable > div.hk-js-aCoup__contentWrap.hk-aCoup__contentWrap > div.hk-u-padding__v-05.hk-u-text__align--center > button"))==null||s.addEventListener("click",()=>{new hkSubmitCouponsClass().openModal(),m!=1}),(l=document.querySelector("#hk-autoCoupon > div.hk-c-modal.hk-c-modal--wide.hk-ext-animated > div.hk-l-flexColumns > div.hk-aCoup__main.hk-u-padding__15.hk-c-modal__wrapper--scrollable > div.hk-u-margin__v-15.hk-u-disp--flex.hk-js-aCoup__footerContent.hk-l-flex--allCenter > div.hk-c-links.hk-c-links--iconTri.hk-tri--right.hk-js-modal__open.hk-js-fdbkModal"))==null||l.addEventListener("click",()=>{fdb=new hkfeedbackClass,fdb.openModal(),m!=1}),await at({type:"updateCouponStatus",data:{pos:t.id,cpnStatus:n}})}catch(n){if(n.message=="Login Required"){if(j=1,M.not_loggedin=1,F){let u=Date.now();const o=await V(F,u);C.time_taken=o,C.event_type="not_loggedin"}H&&H!=-1&&(C.id=H,await K({type:"ACTSMonitor",data:{clubID:v,ACanalytics:M,ACAnalyticsValue:C}})),M={},C={},j==0&&m==0&&L==-1&&(await P({type:"ACMonitor",data:{clubID:v,status:6}}),E.pos=v,await A({type:"fireEvent",eventName:"AutoCouponError",params:E}))}else if(n.message=="ACReadTotalPriceError"){if(M.missing_price=1,F){let u=Date.now();const o=await V(F,u);C.time_taken=o,C.event_type="missing_price"}H&&H!=-1&&(C.id=H,await K({type:"ACTSMonitor",data:{clubID:v,ACanalytics:M,ACAnalyticsValue:C}})),M={},C={},await P({type:"ACMonitor",data:{clubID:v,status:7,prevStatus:L}}),E.pos=v,await A({type:"fireEvent",eventName:"ACReadTotalPriceError",params:E})}else{if(M.process_failed=1,F){let u=Date.now();const o=await V(F,u);C.time_taken=o,C.event_type="failed"}H&&H!=-1&&(C.id=H,await K({type:"ACTSMonitor",data:{clubID:v,ACanalytics:M,ACAnalyticsValue:C}})),M={},C={},await P({type:"ACMonitor",data:{clubID:v,status:6,prevStatus:L}}),E.pos=v,await A({type:"fireEvent",eventName:"AutoCouponError",params:E})}L=6,t.reload!=null&&(i.prevStatus=L);try{z(t)}catch(u){throw window.alert("Error : cannot run autocoupon try reloading the site"),new Error(u.message)}}}async function B(e,t){var s,l,n,u,o,y;try{let p=0;if(m==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((s=document.querySelector(e.isLogin))==null?void 0:s.style.display)!="none"){m=1;let a=q.url;throw a=a.split("//"),a=a[1],a=a.split("/"),a=a[0],O(!1),new Error("Login Required")}e.automatic.coupon_click_reload!=null&&await R.setItem("buyhatke"+T,JSON.stringify(i)),e.automatic.coupon_click_reload!=null&&document.querySelector(e.automatic.coupon_click_reload.name)!=null&&(document.querySelector(e.automatic.coupon_click_reload.name).click(),p=1,e.automatic.coupon_click_reload.wait&&await S(1e3)),e.automatic.coupon_click.name!=""&&document.querySelector(e.automatic.coupon_click.name)!=null&&p==0?(document.querySelector(e.automatic.coupon_click.name).click(),p=1,e.automatic.coupon_click.wait&&await S(1e3)):e.automatic.coupon_click.proxyname!=""&&document.querySelector(e.automatic.coupon_click.proxyname)!=null&&p==0&&(document.querySelector(e.automatic.coupon_click.proxyname).click(),p=1,e.automatic.coupon_click.wait&&await S(1e3));let b=0;for(;e.automatic.coupon_value.name!=""&&!document.querySelector(e.automatic.coupon_value.name);){if(e.automatic.coupon_click.name!=""&&document.querySelector(e.automatic.coupon_click.name)&&p==0?(document.querySelector(e.automatic.coupon_click.name).click(),p=1):e.automatic.coupon_click.name!=""&&document.querySelector(e.automatic.coupon_click.proxyname)&&p==0&&(document.querySelector(e.automatic.coupon_click.proxyname).click(),p=1),m==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((l=document.querySelector(e.isLogin))==null?void 0:l.style.display)!="none"){m=1;let a=q.url;throw a=a.split("//"),a=a[1],a=a.split("/"),a=a[0],O(!1),new Error("Login Required")}b++,b%4==0&&(p=0,b=0),await S(1e3)}if(m==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((n=document.querySelector(e.isLogin))==null?void 0:n.style.display)!="none"){m=1;let a=q.url;throw a=a.split("//"),a=a[1],a=a.split("/"),a=a[0],O(!1),new Error("Login Required")}e.automatic.coupon_click_reload!=null&&(i.canCheck=!0);let h=document.querySelector(e.automatic.coupon_value.name);if(h.focus(),!h)return;if(h.click(),h.focus(),h.select(),document.execCommand("insertText",!1,"")||(h.value=""),h.dispatchEvent(new Event("change",{bubbles:!0})),await xe(h,t,e),e.automatic.coupon_value.wait!=!1&&(e.automatic.coupon_value.wait==!0?await S(1e3):await S(e.automatic.coupon_value.wait)),e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((u=document.querySelector(e.isLogin))==null?void 0:u.style.display)!="none"){m=1;let a=q.url;throw a=a.split("//"),a=a[1],a=a.split("/"),a=a[0],O(!1),new Error("Login Required")}if(b=0,m==1)return;if(e.interceptor_api==""&&e.sync!=null)for(;e.automatic.apply_button.name!=""&&!document.querySelector(e.automatic.apply_button.name)||b<3;){if(e.automatic.apply_button.name!=""&&document.querySelector(e.automatic.apply_button.name)?b++:b=0,e.isLogin!=null&&document.querySelector(e.islogin)!=null&&document.querySelector(e.isLogin).style.display!="none"){m=1;let a=q.url;throw a=a.split("//"),a=a[1],a=a.split("/"),a=a[0],O(!1),new Error("Login Required")}if(m==1)return;await S(500)}else for(;e.automatic.apply_button.name!=""&&!document.querySelector(e.automatic.apply_button.name);){if(e.automatic.apply_button.name!=""&&document.querySelector(e.automatic.apply_button.name)?b++:b=0,e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((o=document.querySelector(e.isLogin))==null?void 0:o.style.display)!="none"){m=1;let a=q.url;throw a=a.split("//"),a=a[1],a=a.split("/"),a=a[0],O(!1),new Error("Login Required")}if(m==1)return;await S(500)}if(m==1)return;if(e.reload!=null&&await R.setItem("buyhatke"+T,JSON.stringify(i)),document.querySelector(e.automatic.apply_button.name).click(),e.automatic.apply_button.wait!=!1&&(e.automatic.apply_button.wait==!0?await S(1e3):await S(e.automatic.apply_button.wait)),e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((y=document.querySelector(e.isLogin))==null?void 0:y.style.display)!="none"){m=1;let a=q.url;throw a=a.split("//"),a=a[1],a=a.split("/"),a=a[0],O(!1),new Error("Login Required")}if(m==1||e.hatke_AC&&e.reload==null||e.sync!=null&&e.interceptor_api=="")return;if(e.reload!=null&&e.success_reload==null)for(;;)await S(1e4),e.reload!=null&&await R.setItem("buyhatke"+T,JSON.stringify(i)),document.querySelector(e.automatic.apply_button.name)&&document.querySelector(e.automatic.apply_button.name).click();if(m==1)return;e.automatic.clear_button.name!=""&&document.querySelector(e.automatic.clear_button.name)!=null&&document.querySelector(e.automatic.clear_button.name).click()}catch(p){throw new Error(p.message)}}function re(e){var t,s;try{const l=/((?:[A-Z]{3}(?=[₹$€£¥₩])?|Rs|[₹$€£¥₩])\s?[₹$€£¥₩]?)?\s?([0-9]+(?:[\s,][0-9]{3})*(?:\.[0-9]{1,2})?)\s?((?:[A-Z]{3}|Rs|[₹$€£¥₩])?)?/,n=e.replace(/\s+/g," ").trim(),u=n.match(l);if(!u||!u[2]){let h=Number(n);return isNaN(h)?null:{currencySymbol:"",price:h.toFixed(2)}}let o=((t=u[1])==null?void 0:t.trim())||"",y=((s=u[3])==null?void 0:s.trim())||"",p=parseFloat(u[2].replace(/,/g,"").replace(/\s/g,""));return{currencySymbol:o||y,price:p.toFixed(2)}}catch{return null}}function Ze(e){try{let t=["total","cashback","discount"];for(t=t.map(s=>s.toLowerCase());e.length;){let s=e.text().toLowerCase();for(let l of t)if(s.includes(l))return l;e=e.prev()}return"null"}catch{return"null"}}async function W(e,t){var s,l,n,u,o,y,p,b;try{E={hostname:we};let h=0;if(e.hatke_AC&&e.total_price!=null){if(e.waitforsel!=null){let a=0;for(;;){if(a++,a>=120)throw await A({type:"fireEvent",eventName:"WaitForSelError",params:E}),h=0,new Error("WaitForSelError");if(m==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((s=document.querySelector(e.isLogin))==null?void 0:s.style.display)!="none"){m=1;let d=q.url;throw d=d.split("//"),d=d[1],d=d.split("/"),d=d[0],O(!1),new Error("Login Required")}if(e.popup&&document.querySelector(e.popup.name)!=null&&((l=document.querySelector(e.popup.name))==null?void 0:l.style.display)!="none"){let d=document.querySelector(e.popup.selector);if(d&&(d.click(),!e.popup.continue))return{type:"msg",msg:"Not Applicable On Current Cart"}}if(e.waitforsel!=null){let d;for(let r=0;r<e.waitforsel.name.length&&(d=document.querySelector(e.waitforsel.name[r]),!d);r++);if(d)break}await S(500)}}for(;;){if(h++,h>=240)throw h=0,new Error("ACReadTotalPriceError");if(m==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((n=document.querySelector(e.isLogin))==null?void 0:n.style.display)!="none"){m=1;let a=q.url;throw a=a.split("//"),a=a[1],a=a.split("/"),a=a[0],O(!1),new Error("Login Required")}if(e.popup&&document.querySelector(e.popup.name)!=null&&((u=document.querySelector(e.popup.name))==null?void 0:u.style.display)!="none"){let a=document.querySelector(e.popup.selector);if(a&&(a.click(),!e.popup.continue))return{type:"msg",msg:"Not Applicable On Current Cart"}}if(e.total_price!=null){let a,d;for(let r=0;r<e.total_price.name.length;r++)try{if(a=document.querySelector(e.total_price.name[r]),a&&a.textContent!=null&&a.textContent!="")break}catch{if(d=$(e.total_price.name[r]),d&&d.length)break}if(a&&a.textContent!=null&&a.textContent!=""||d&&d.length>0)break}await S(500)}try{if(e.total_price!=null&&e.total_price.name.length>0){let a="",d=-1,r;for(let _=0;_<e.total_price.name.length;_++){try{if(document.querySelector(e.total_price.name[_])){let c=document.querySelector(e.total_price.name[_]);if(c){const f=re(c.textContent);a="totalprice",f.currencySymbol!=null?r=f.currencySymbol:r="",d=f.price}}}catch{const f=$(e.total_price.name[_]);let x=Ze(f);if(f.length){let k;if(f[0].textContent==null||f[0].textContent==""||f[0].textContent==null){let D=await f.text();const N=re(D);N&&(N.currencySymbol!=null?r=N.currencySymbol:r="",k=N.price)}else{const D=re(f[0].textContent);D&&(D.currencySymbol!=null?r=D.currencySymbol:r="",k=D.price)}x=="discount"?(a="discount",d=k):x=="cashback"?(a="cashback",d=k):(a="totalprice",d=k)}}if(_==e.total_price.name.length-1){if(d>=0)return{type:a,price:d,cS:r};throw new Error("ACReadTotalPriceError")}}}}catch(a){throw new Error(a.message)}}if(e.sync.syncwithcode!=null){let a=0,d=0,r=0;for(;;){if(r++,r>=120)throw await A({type:"fireEvent",eventName:"syncwithcodeErr",params:E}),r=0,new Error("WaitForSelError");if(e.sync.syncwithcode.name!=null&&e.sync.syncwithcode.name!=""&&e.sync.syncwithcode.errname!=null&&e.sync.syncwithcode.errname!=""){let _=document.querySelectorAll(e.sync.syncwithcode.name);for(let c=0;c<_.length;c++){let f=_[c].querySelector(e.sync.syncwithcode.codesel).innerHTML.trim(),x=e.sync.syncwithcode.codesplit.length;for(let k=0;k<x;k++)f.split(e.sync.syncwithcode.codesplit[k].string)[e.sync.syncwithcode.codesplit[k].index]!=null&&(f=f.split(e.sync.syncwithcode.codesplit[k].string)[e.sync.syncwithcode.codesplit[k].index]);if(f==t){a=1;break}}if(a==1||document.querySelector(e.sync.syncwithcode.errname))break}await S(500)}if(a==1)try{if(document.querySelector(e.sync.syncwithcode.name)!=null){let _=document.querySelectorAll(e.sync.syncwithcode.name);for(let c=0;c<_.length;c++){let f=_[c].querySelector(e.sync.syncwithcode.codesel).innerHTML.trim(),x=e.sync.syncwithcode.codesplit.length;for(let k=0;k<x;k++)if(f.split(e.sync.syncwithcode.codesplit[k].string)[e.sync.syncwithcode.codesplit[k].index]!=null)f=f.split(e.sync.syncwithcode.codesplit[k].string)[e.sync.syncwithcode.codesplit[k].index];else{d=1;break}if(f==t){let k=_[c].querySelector(e.sync.syncwithcode.discsel).innerHTML,D=e.sync.syncwithcode.discsplit.length;for(let N=0;N<D;N++)k.split(e.sync.syncwithcode.discsplit[N].string)[e.sync.syncwithcode.discsplit[N].index]!=null&&(k=k.split(e.sync.syncwithcode.discsplit[N].string)[e.sync.syncwithcode.discsplit[N].index]);k=k.replaceAll(",","");try{isNaN(k)&&(k=0),k=parseFloat(k)}catch{k=0}return e.sync.syncwithcode.discwait!=null&&await S(e.sync.syncwithcode.discwait),{type:"dis",dis:k}}}return{type:"msg",msg:""}}}catch{return{type:"msg",msg:""}}else return{type:"msg",msg:""}}for(;e.sync.cashback&&document.querySelector(e.sync.cashback.name)==null&&document.querySelector(e.sync.discount.name)==null&&(document.querySelector(e.sync.cpn_message.name)==null||((o=document.querySelector(e.sync.cpn_message.name))==null?void 0:o.innerHTML.length)==0)||e.sync.cashback==null&&document.querySelector(e.sync.discount.name)==null&&(document.querySelector(e.sync.cpn_message.name)==null||((y=document.querySelector(e.sync.cpn_message.name))==null?void 0:y.innerHTML.length)==0);){if(h++,h>=240)throw E.pos=v,await A({type:"fireEvent",eventName:"ACReadDiscountError",params:E}),h=0,new Error("Can Read Discount/Message");if(m==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((p=document.querySelector(e.isLogin))==null?void 0:p.style.display)!="none"){m=1;let a=q.url;throw a=a.split("//"),a=a[1],a=a.split("/"),a=a[0],O(!1),new Error("Login Required")}if(e.popup&&document.querySelector(e.popup.name)!=null&&((b=document.querySelector(e.popup.name))==null?void 0:b.style.display)!="none"){let a=document.querySelector(e.popup.selector);if(a&&(a.click(),!e.popup.continue))return{type:"msg",msg:"Not Applicable On Current Cart"}}await S(500)}if(await S(800),e.sync.dis_text!=null&&e.sync.dis_text.name!=null&&document.querySelector(e.sync.dis_text.name)!=null&&e.sync.dis_text.textSelector!=null&&document.querySelector(e.sync.dis_text.textSelector)!=null&&e.sync.dis_text.text!=null&&e.sync.dis_text.text!=""&&e.sync.dis_text.text!=null){if(document.querySelector(e.sync.dis_text.textSelector).innerHTML.includes(e.sync.dis_text.text)){if(document.querySelector(e.sync.discount.name)!=null){let d=document.querySelector(e.sync.discount.name).innerHTML;e.sync.discount.selector&&(d=document.querySelector(e.sync.discount.selector).innerHTML);let r=e.sync.discount.split.length;for(let _=0;_<r;_++)if(d.split(e.sync.discount.split[_].string)[e.sync.discount.split[_].index]!=null)d=d.split(e.sync.discount.split[_].string)[e.sync.discount.split[_].index];else{d="";break}d=d.replaceAll(",","");try{isNaN(d)&&(d=0),d=parseFloat(d)}catch{d=0}return{type:"dis",dis:d}}}else if(document.querySelector(e.sync.cpn_message.name)!=null){let d=document.querySelector(e.sync.cpn_message.name).innerHTML;e.sync.cpn_message.selector&&(d=document.querySelector(e.sync.cpn_message.selector).innerHTML);let r=e.sync.cpn_message.split.length;for(let _=0;_<r;_++)if(d.split(e.sync.cpn_message.split[_].string)[e.sync.cpn_message.split[_].index]!=null)d=d.split(e.sync.cpn_message.split[_].string)[e.sync.cpn_message.split[_].index];else{d="";break}return{type:"msg",msg:d}}}else if(e.sync.cpn_messagetext!=null&&e.sync.cpn_messagetext.name!=null&&document.querySelector(e.sync.cpn_messagetext.name)!=null&&e.sync.cpn_messagetext.textSelector!=null&&document.querySelector(e.sync.cpn_messagetext.textSelector)!=null){if(document.querySelector(e.sync.cpn_messagetext.textSelector).innerHTML.includes(t)){if(document.querySelector(e.sync.cpn_message.name)!=null){let d=document.querySelector(e.sync.cpn_message.name).innerHTML;e.sync.cpn_message.selector&&(d=document.querySelector(e.sync.cpn_message.selector).innerHTML);let r=e.sync.cpn_message.split.length;for(let _=0;_<r;_++)if(d.split(e.sync.cpn_message.split[_].string)[e.sync.cpn_message.split[_].index]!=null)d=d.split(e.sync.cpn_message.split[_].string)[e.sync.cpn_message.split[_].index];else{d="";break}return{type:"msg",msg:d}}}else if(document.querySelector(e.sync.discount.name)!=null){let d=document.querySelector(e.sync.discount.name).innerHTML;e.sync.discount.selector&&(d=document.querySelector(e.sync.discount.selector).innerHTML);let r=e.sync.discount.split.length;for(let _=0;_<r;_++)if(d.split(e.sync.discount.split[_].string)[e.sync.discount.split[_].index]!=null)d=d.split(e.sync.discount.split[_].string)[e.sync.discount.split[_].index];else{d="";break}d=d.replaceAll(",","");try{isNaN(d)&&(d=0),d=parseFloat(d)}catch{d=0}return{type:"dis",dis:d}}}else if(document.querySelector(e.sync.cpn_message.name)!=null){let a=document.querySelector(e.sync.cpn_message.name).innerHTML;e.sync.cpn_message.selector&&(a=document.querySelector(e.sync.cpn_message.selector).innerHTML);let d=e.sync.cpn_message.split.length;for(let r=0;r<d;r++)if(a.split(e.sync.cpn_message.split[r].string)[e.sync.cpn_message.split[r].index]!=null)a=a.split(e.sync.cpn_message.split[r].string)[e.sync.cpn_message.split[r].index];else{a="";break}return{type:"msg",msg:a}}else if(document.querySelector(e.sync.discount.name)!=null){let a=document.querySelector(e.sync.discount.name).innerHTML;e.sync.discount.selector&&(a=document.querySelector(e.sync.discount.selector).innerHTML);let d=e.sync.discount.split.length;for(let r=0;r<d;r++)if(a.split(e.sync.discount.split[r].string)[e.sync.discount.split[r].index]!=null)a=a.split(e.sync.discount.split[r].string)[e.sync.discount.split[r].index];else{a="";break}a=a.replaceAll(",","");try{isNaN(a)&&(a=0),a=parseFloat(a)}catch{a=0}return{type:"dis",dis:a}}else if(e.sync.cashback&&document.querySelector(e.sync.cashback.name)!=null){let a=document.querySelector(e.sync.cashback.name).innerHTML;e.sync.cashback.selector&&(a=document.querySelector(e.sync.cashback.selector).innerHTML);let d=e.sync.cashback.split.length;for(let r=0;r<d;r++)if(a.split(e.sync.cashback.split[r].string)[e.sync.cashback.split[r].index]!=null)a=a.split(e.sync.cashback.split[r].string)[e.sync.cashback.split[r].index];else{a="";break}a=a.replaceAll(",","");try{isNaN(a)&&(a=0),a=parseFloat(a)}catch{a=0}return{type:"dis",dis:a}}return{type:"msg",msg:"error"}}catch(h){throw new Error(h.message)}}async function Qe(e){try{let t="",s=A({type:"getRequest",api:e.interceptor_api});if(await S(500),await B(e,"BUYHATKE"),m==1)return;if(s=await s,t=s.headers,t.headers={},t.requestHeaders!=null){for(let l=0;l<t.requestHeaders.length;l++)t.headers[t.requestHeaders[l].name]=t.requestHeaders[l].value;delete t.requestHeaders}if(e.credentials&&(t.credentials=e.credentials),s.body!="NULL"&&(t.body=s.body,t.body.indexOf("formData")>-1)){t.headers["Content-Type"]!=null&&t.headers["Content-Type"].indexOf("multipart/form-data")>-1&&(t.headers["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8");let l=JSON.parse(t.body);l=l.formData;let n="";for(let u in l)n+=`${u}=${l[u][0]}&`;t.body=n}return t}catch(t){throw new Error(t.message)}}async function Xe(e,t){try{let s="",l=A({type:"getRequest",api:e.interceptor_api});if(await S(500),await B(e,t.code),m==1)return;if(l=await l,s=l.headers,s.headers={},s.requestHeaders!=null){for(let n=0;n<s.requestHeaders.length;n++)s.headers[s.requestHeaders[n].name]=s.requestHeaders[n].value;delete s.requestHeaders}if(e.credentials&&(s.credentials=e.credentials),l.body!="NULL"&&(s.body=l.body,s.body.indexOf("formData")>-1)){s.headers["Content-Type"]!=null&&s.headers["Content-Type"].indexOf("multipart/form-data")>-1&&(s.headers["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8");let n=JSON.parse(s.body);n=n.formData;let u="";for(let o in n)u+=`${o}=${n[o][0]}&`;s.body=u}return s}catch(s){throw new Error(s.message)}}async function xe(e,t,s){try{if(!e)return;if(e.click(),e.focus(),e.select(),document.execCommand("insertText",!1,t)||(e.value=t),e.dispatchEvent(new Event("change",{bubbles:!0})),s.enterKey){const l=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",which:13,keyCode:13});e.dispatchEvent(l)}}catch(l){throw new Error(l.message)}}async function U(e){var t,s,l;try{if(m==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((t=document.querySelector(e.isLogin))==null?void 0:t.style.display)!="none"){m=1;let n=q.url;throw n=n.split("//"),n=n[1],n=n.split("/"),n=n[0],O(!1),new Error("Login Required")}if(e.automatic.remove_button.name==""&&e.automatic.multi_remove!=null)for(let n=0;n<e.automatic.multi_remove.length;n++){if(m==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((s=document.querySelector(e.isLogin))==null?void 0:s.style.display)!="none"){m=1;let u=q.url;throw u=u.split("//"),u=u[1],u=u.split("/"),u=u[0],O(!1),new Error("Login Required")}if(document.querySelector(e.automatic.multi_remove[n].name)!=null){let u=document.querySelectorAll(e.automatic.multi_remove[n].name);for(let o=0;o<u.length;o++)if(e.reload!=null&&(i.canCheck=!1,await R.setItem(`buyhatke${T}`,JSON.stringify(i))),u[o].click(),e.automatic.multi_remove[n].wait!=!1&&(e.automatic.multi_remove[n].wait==!0?await S(1e3):await S(e.automatic.multi_remove[n].wait)),e.reload!=null&&n==e.automatic.multi_remove.length-1&&o==u.length-1)for(;;){await S(1e4);for(let y=0;y<u.length;y++)e.reload!=null&&(i.canCheck=!1,await R.setItem(`buyhatke${T}`,JSON.stringify(i))),u[y].click(),e.automatic.multi_remove[n].wait!="false"&&(e.automatic.multi_remove[n].wait=="true"?await S(1e3):await S(e.automatic.multi_remove[n].wait))}}}else if(e.automatic.remove_button.name!=""&&document.querySelector(e.automatic.remove_button.name)!=null){e.reload!=null&&(i.canCheck=!1,await R.setItem(`buyhatke${T}`,JSON.stringify(i)));let n=document.querySelectorAll(e.automatic.remove_button.name);for(let u=0;u<n.length;u++){if(n[u].click(),e.reload!=null&&u+1==n.length&&e.applyreload==null)for(;;)await S(1e4),document.querySelector(e.automatic.remove_button.name)!=null&&document.querySelector(e.automatic.remove_button.name).click();if(e.automatic.remove_button.wait!=!1&&(e.automatic.remove_button.wait==!0?await S(1e3):await S(e.automatic.remove_button.wait)),e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((l=document.querySelector(e.isLogin))==null?void 0:l.style.display)!="none"){m=1;let o=q.url;throw o=o.split("//"),o=o[1],o=o.split("/"),o=o[0],O(!1),new Error("Login Required")}}}}catch(n){throw new Error(n.message)}}function et(e,t,s,l){try{let n=0;if(e.typeid==1){let u=e.path.split("."),o=s,y=0;for(let p=0;p<u.length;p++)if(u[p]=="*"){let b=w.search_ele[y];if(b.type=="array"){for(let h=0;h<o.length;h++)if(JSON.stringify(o[h]).includes(b.string)){o=o[h];break}}y++}else o=o[u[p]];if(Array.isArray(o))for(let p=0;p<o.length;p++)o[p][e.select]==l&&(n=o[p][e.getvalue])}else if(e.typeid=2){let u=e.path.split("."),o=s,y=0;for(let p=0;p<u.length;p++)if(u[p]=="*"){let b=w.search_ele[y];if(b.type=="array"){for(let h=0;h<o.length;h++)if(JSON.stringify(o[h]).includes(b.string)){o=o[h];break}}y++}else o=o[u[p]];if(Array.isArray(o))for(let p=0;p<o.length;p++){let b=o[p];if(e.path2!=null&&b[e.path2]!=null&&(b=b[e.path2]),Array.isArray(b)&&b.length>0)for(let h=0;h<b.length;h++)if(e.notselectkey!=null&&b[h][e.notselectkey]!=null){if(b[h][e.notselectkey]!=null&&b[h][e.notselectkey]==e.notselectvalue)continue;n=n+b[h][e.getvalue]}else n=n+b[h][e.getvalue]}}return n==null&&(n=0),typeof n=="number"&&(n=Math.abs(n)),n}catch{return 0}}function Z(e,t,s){let l=e[t].split("."),n=s,u=0;for(let o=0;o<l.length;o++)if(l[o]=="*"){let y=e.search_ele[u];if(y.type=="array"){for(let p=0;p<n.length;p++)if(JSON.stringify(n[p]).includes(y.string)){n=n[p];break}}u++}else n=n[l[o]];if(e.responseType=="html/text"&&n!=null){let o=n;typeof o!="string"&&(o=JSON.stringify(o));let y=e.sync[t].split.length;for(let p=0;p<y;p++)if(o.split(e.sync[t].split[p].string)[e.sync[t].split[p].index]!=null)o=o.split(e.sync[t].split[p].string)[e.sync[t].split[p].index];else{o="";break}if(o=o.trim(),t!="cpn_message")try{o=o.replaceAll(",",""),isNaN(o)&&(o="0"),o=parseFloat(o)}catch{o=0}return o}return typeof n=="number"&&(n=Math.abs(n)),n}async function tt(e){var t;try{for(;document.querySelector(e.reload.discount.name)==null&&document.querySelector(e.reload.cpn_message.name)==null;){if(m==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((t=document.querySelector(e.isLogin))==null?void 0:t.style.display)!="none"){m=1;let s=q.url;throw s=s.split("//"),s=s[1],s=s.split("/"),s=s[0],O(!1),new Error("Login Required")}await S(500)}if(await S(800),document.querySelector(e.reload.discount.name)!=null){let s=document.querySelector(e.reload.discount.name).innerHTML,l=e.reload.discount.split.length;for(let n=0;n<l;n++)if(s.split(e.reload.discount.split[n].string)[e.reload.discount.split[n].index]!=null)s=s.split(e.reload.discount.split[n].string)[e.reload.discount.split[n].index];else{s="";break}s=s.replaceAll(",","");try{isNaN(s)&&(s=0),s=parseFloat(s)}catch{s=""}return{type:"dis",dis:s}}else if(document.querySelector(e.reload.cpn_message.name)!=null){let s=document.querySelector(e.reload.cpn_message.name).innerHTML,l=e.reload.cpn_message.split.length;for(let n=0;n<l;n++)if(s.split(e.reload.cpn_message.split[n].string)[e.reload.cpn_message.split[n].index]!=null)s=s.split(e.reload.cpn_message.split[n].string)[e.reload.cpn_message.split[n].index];else{s="";break}return{type:"msg",msg:s}}}catch(s){throw new Error(s.message)}}async function at(e){try{let t=await A(e);return""}catch{return""}}async function rt(e){try{document.querySelector(e.automatic.coupon_click.name).click(),await S(1e3);let t=0,s=document.querySelectorAll("div.coupon-base-validCouponContainer > div:not(.coupon-base-expiredCoupon) > div.coupon-base-infoContainer > div.coupon-base-benefit > span.coupon-base-amount");for(let l=0;l<s.length;l++)t+=parseFloat(s[l].innerText);return t}catch{return 0}}async function nt(e,t){var s,l,n,u,o,y,p;try{let b=0;if(m==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((s=document.querySelector(e.isLogin))==null?void 0:s.style.display)!="none"){m=1;let r=q.url;throw r=r.split("//"),r=r[1],r=r.split("/"),r=r[0],O(!1),new Error("Login Required")}e.automatic.coupon_click.name!=""&&document.querySelector(e.automatic.coupon_click.name)!=null&&b==0&&(document.querySelector(e.automatic.coupon_click.name).click(),b=1,e.automatic.coupon_click.wait&&await S(1e3));let h=0;for(;e.automatic.coupon_value.name!=""&&!document.querySelector(e.automatic.coupon_value.name);){if(e.automatic.coupon_click.name!=""&&document.querySelector(e.automatic.coupon_click.name)&&b==0&&(document.querySelector(e.automatic.coupon_click.name).click(),b=1),m==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((l=document.querySelector(e.isLogin))==null?void 0:l.style.display)!="none"){m=1;let r=q.url;throw r=r.split("//"),r=r[1],r=r.split("/"),r=r[0],O(!1),new Error("Login Required")}h++,h%4==0&&(b=0,h=0),await S(500)}if(m==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((n=document.querySelector(e.isLogin))==null?void 0:n.style.display)!="none"){m=1;let r=q.url;throw r=r.split("//"),r=r[1],r=r.split("/"),r=r[0],O(!1),new Error("Login Required")}let a=document.querySelector(e.automatic.coupon_value.name);if(a.focus(),!a)return;if(a.click(),a.focus(),a.select(),document.execCommand("insertText",!1,"")||(a.value="new text"),a.dispatchEvent(new Event("change",{bubbles:!0})),await xe(a,t,e),e.automatic.coupon_value.wait!=!1&&(e.automatic.coupon_value.wait==!0?await S(1e3):await S(e.automatic.coupon_value.wait)),e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((u=document.querySelector(e.isLogin))==null?void 0:u.style.display)!="none"){m=1;let r=q.url;throw r=r.split("//"),r=r[1],r=r.split("/"),r=r[0],O(!1),new Error("Login Required")}if(h=0,m==1)return;if(e.interceptor_api==""&&e.sync!=null)for(;e.automatic.apply_button.name!=""&&!document.querySelector(e.automatic.apply_button.name)||h<3;){if(e.automatic.apply_button.name!=""&&document.querySelector(e.automatic.apply_button.name)?h++:h=0,e.isLogin!=null&&document.querySelector(e.islogin)!=null&&document.querySelector(e.isLogin).style.display!="none"){m=1;let r=q.url;throw r=r.split("//"),r=r[1],r=r.split("/"),r=r[0],O(!1),new Error("Login Required")}if(m==1)return;await S(500)}else for(;e.automatic.apply_button.name!=""&&!document.querySelector(e.automatic.apply_button.name);){if(e.automatic.apply_button.name!=""&&document.querySelector(e.automatic.apply_button.name)?h++:h=0,e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((o=document.querySelector(e.isLogin))==null?void 0:o.style.display)!="none"){m=1;let r=q.url;throw r=r.split("//"),r=r[1],r=r.split("/"),r=r[0],O(!1),new Error("Login Required")}if(m==1)return;await S(500)}if(m==1)return;if(e.reload!=null&&await R.setItem("buyhatke"+T,JSON.stringify(i)),document.querySelector(e.automatic.apply_button.name).click(),e.automatic.apply_button.wait!=!1&&(e.automatic.apply_button.wait==!0?await S(1e3):await S(e.automatic.apply_button.wait)),e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((y=document.querySelector(e.isLogin))==null?void 0:y.style.display)!="none"){m=1;let r=q.url;throw r=r.split("//"),r=r[1],r=r.split("/"),r=r[0],O(!1),new Error("Login Required")}if(m==1||e.sync!=null&&e.interceptor_api=="")return;if(e.reload!=null)for(;;)await S(3e3),e.reload!=null&&await R.setItem("buyhatke"+T,JSON.stringify(i)),document.querySelector(e.automatic.apply_button.name)&&document.querySelector(e.automatic.apply_button.name).click();if(m==1)return;let d=document.querySelectorAll("div.coupon-base-validCouponContainer > div:not(.coupon-base-expiredCoupon) > div.coupon-base-checkBoxContainer > div.coupon-base-customCheckbox > span.coupon-base-labelUnchecked");for(let r=0;r<d.length;r++)d[r].click();await S(1e3),(p=document.querySelector("button#applyCoupon"))==null||p.click()}catch(b){throw new Error(b.message)}}function it(){(document.readyState==="interactive"||document.readyState==="complete")&&(clearInterval(st),window!=window.top,le())}const st=setInterval(it,500);export{R as a,lt as b,ot as c,$e as d,ge as e,dt as g,ke as i,i as l};
