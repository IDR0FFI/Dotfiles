import{t as b,g as C,c as x,q as A,v as N}from"./utility_all2-BNXd1yEL.js";import{l as y,a as j}from"./autoCouponUI-DtApmIaH.js";import"./index-ljv-RBOm.js";let p=[],m=[],d=0,w="",S="",u="",f="";function I(r,s){try{let o=s.descSelector;for(let i=0;i<o.length;i++)try{let l=r,t=r,e="",a="",n=o[i];for(let c=0;c<n.selector.length;c++)l=l.querySelector(n.selector[c]);if(n.hasOwnProperty("attribute"))e=l[n.attribute];else{let c=l.textContent;c==null||c==""||n.selector.length==0?e=l:e=c}if(n.hasOwnProperty("slice")){let c=n.slice[0];n.slice.length>1?end=n.slice[1]:end=e.length,e=e.slice(c,end)}if(n.hasOwnProperty("path")&&(e=accessPath(e,n.path)),n.hasOwnProperty("regex"))for(let c=0;c<n.regex.length;c++)try{let h=1;n.hasOwnProperty("match")&&(h=n.match);let g;if(n.hasOwnProperty("global")?g=e.match(new RegExp(n.regex[c],"g"))[h]:g=e.match(new RegExp(n.regex[c]))[h],g!=null&&g!=""){e=g;break}}catch{}if(e!=""&&e!=null)return e=e.replaceAll("&amp;","&"),e=e.replaceAll(`
`,""),e=e.replaceAll("❯",""),e.trim()}catch{}return""}catch{return""}}function J(){let r=N.url.split("//")[1];return r=r.split("/")[0],r}function v(r,s){try{let o=s.codeSelector;for(let i=0;i<o.length;i++)try{let l=r,t="",e=o[i];for(let a=0;a<e.selector.length;a++)l=l.querySelector(e.selector[a]);if(e.hasOwnProperty("attribute"))t=l[e.attribute];else{let a=l.textContent;a==null||a==""||e.selector.length==0?t=l:t=a}if(e.hasOwnProperty("path")&&(t=accessPath(t,e.path)),e.hasOwnProperty("regex")){let a=!1;for(let n=0;n<e.regex.length;n++)try{let c=1;e.hasOwnProperty("match")&&(c=e.match);let h;if(e.hasOwnProperty("global")?h=t.match(new RegExp(e.regex[n],"g"))[c]:h=t.match(new RegExp(e.regex[n]))[c],h!=null&&h!=""){a=!0,t=h;break}}catch{}a||(t="")}if(t!=""&&t!=null)return t=t.replaceAll("&amp;","&"),t=t.replaceAll(`
`,""),t=t.replaceAll("❯",""),t.trim()}catch{}return""}catch{return""}}function E(r,s){try{let o=s.expSelector;for(let i=0;i<o.length;i++)try{let l=r,t="",e=o[i];for(let a=0;a<e.selector.length;a++)l=l.querySelector(e.selector[a]);if(e.hasOwnProperty("attribute"))t=l[e.attribute];else{let a=l.textContent;a==null||a==""||e.selector.length==0?t=l:t=a}if(e.hasOwnProperty("slice")){let a=e.slice[0];e.slice.length>1?end=e.slice[1]:end=t.length,t=t.slice(a,end)}if(e.hasOwnProperty("path")&&(t=accessPath(t,e.path)),e.hasOwnProperty("regex"))for(let a=0;a<e.regex.length;a++)try{let n=1;e.hasOwnProperty("match")&&(n=e.match);let c;if(e.hasOwnProperty("global")?c=t.match(new RegExp(e.regex[a],"g"))[n]:c=t.match(new RegExp(e.regex[a]))[n],c!=null&&c!=""){t=c;break}}catch{}if(e.hasOwnProperty("format")&&(t=R(t)),t!=""&&t!=null)return t=t.replaceAll("&amp;","&"),t=t.replaceAll(`
`,""),t=t.replaceAll("❯",""),t.trim()}catch{}return""}catch{return""}}function O(r){try{return["January","February","March","April","May","June","July","August","September","October","November","December"].indexOf(r)}catch{}}function R(r){try{if(r.includes("th")){const s=/(\d{2}th \w+ \d{4})/g,o=r.match(s);if(o){const l=o[0].split(" "),t=parseInt(l[0].replace(/\D/g,"")).toString().padStart(2,"0"),e=(O(l[1].replace(/,/g,""))+1).toString().padStart(2,"0");return`${parseInt(l[2])}-${e}-${t} 00:00:00`}}else{const s=/(\d{2}st \w+ \d{4})/g,o=r.match(s);if(o){const l=o[0].split(" "),t=parseInt(l[0].replace(/\D/g,"")).toString().padStart(2,"0"),e=(O(l[1].replace(/,/g,""))+1).toString().padStart(2,"0");return`${parseInt(l[2])}-${e}-${t} 00:00:00`}}}catch{}}function k(r,s){return r.length!=s.length?!1:(r.sort((o,i)=>JSON.stringify(o)>JSON.stringify(i)?1:-1),s.sort((o,i)=>JSON.stringify(o)>JSON.stringify(i)?1:-1),JSON.stringify(r)==JSON.stringify(s))}async function $(){p=[];try{for(let r of u.prod){let s=r.classSelector;s=document.querySelectorAll(s);for(let i=0;i<s.length;i++){let l=s[i],t={code:v(l,r),url:J(l,r),desc:I(l,r),exp:E(l,r),pos:f};r.isCheckout&&(t.checkout=1),t.code&&t.code!=""&&!t.code.includes(" ")&&p.push(t)}}if(!k(p,m)&&p.length!=0){try{S=await A(),w=S.id,y.ONPAGE_CPNS=[];for(let r=0;r<p.length;r++)y.ONPAGE_CPNS.push({code:p[r].code,desc:p[r].desc});await j.setItem("CPNS"+w+f,JSON.stringify(y))}catch{}await x({type:"sendCouponScrap",data:p})}m=p}catch{}}async function q(){try{if(d==1)return;d=1,f==""&&(f=await b(),(f==""||f==null||f==null)&&(f=await C())),u==""&&(u=await x({type:"getCpnCollectionConfig",data:f}),(u==null||u==null||u=="")&&clearInterval(P)),await $(),d=0}catch{clearInterval(P)}}let P=setInterval(q,500);
