import"./sentry-BUYDRHpY.js";let Vs="BO8_Gm4O4tOivltbZImpbwXGFcI4GVM_48tP2_tSbn4kvjV-m21VZp6hnfG473o30NoYEpUlo568mOpq9bA7pnk",Ks=Ys(Vs);var ga={},Ma=[],Gs={},ta={},wa=[],Ws=chrome.runtime.getManifest(),Nr=Ws.version;function Sa(){var e=Math.floor(Math.random()*9007199254740992)+1;return e.toString()}function Ys(e){const t="=".repeat((4-e.length%4)%4),a=(e+t).replace(/-/g,"+").replace(/_/g,"/"),i=atob(a),s=new Uint8Array(i.length);for(let r=0;r<i.length;++r)s[r]=i.charCodeAt(r);return s}async function zs(e,t){try{let i=navigator.userAgent.match(/Chrome\/(\d+\.\d+\.\d+\.\d+)/);return i&&i[1].split(".").length==4?i[1]:""}catch(a){return t("getChromeFunction",a),await e("errorGettingChromeVerison"),""}}async function _n(e,t,a,i,s,r){try{r.tl=await s.getItem("tl"),(!r.tl||r.tl==""||Object.keys(r.tl).length==0)&&await s.setItem("tl",JSON.stringify({})),r.wlswji=await s.getItem("wlswji"),(!r.wlswji||r.wlswji==""||r.wlswji==null||Object.keys(r.wlswji).length==0)&&await s.setItem("wlswji",JSON.stringify({})),r.sourceSent=await s.getItem("sourceSent"),(r.sourceSent==""||typeof r.sourceSent>"u"||Object.keys(r.sourceSent).length==0)&&await s.setItem("sourceSent",0),r.version=await s.getItem("version"),(r.version!=Nr||Object.keys(r.version).length==0)&&(a("updated-version-"+Nr),await s.setItem("version",Nr));const f=[{key:"Price Comparison Top Bar",value:1,transKey:"priceComparison"},{key:"Price Graph History",value:1,transKey:"priceHistory"},{key:"Price Alert Button",value:1,transKey:"priceAlert"},{key:"Spend Lens Button",value:1,transKey:"spendLens"},{key:"Coupons and Deals Tab",value:1,transKey:"coupon"},{key:"Apply Coupons automatically",value:1,transKey:"autoCoupons"},{key:"Ditto Button",value:1,transKey:"ditto"}];r.featuresArray=await s.getItem("featuresArray");let p=[];try{p=r.featuresArray?JSON.parse(r.featuresArray):[]}catch{p=[]}(r.featuresArray==null||p.length==0||p.some(x=>!x.transKey))&&await s.setItem("featuresArray",JSON.stringify(f)),r.first=await s.getItem("first"),r.features_json=await s.getItem("features_json"),(r.features_json==null||Object.keys(r.features_json).length==0)&&await s.setItem("features_json","[0,0,0,0,0]"),r.subscribedFor=await s.getItem("subscribedFor"),(r.subscribedFor==null||Object.keys(r.subscribedFor).length==0)&&await s.setItem("subscribedFor",""),r.saleArray=await s.getItem("saleArray"),(r.saleArray==null||Object.keys(r.saleArray).length==0)&&await s.setItem("saleArray",""),r.saleFinished=await s.getItem("saleFinished"),(r.saleFinished==null||Object.keys(r.saleFinished).length==0)&&await s.setItem("saleFinished",0),r.saleStarted=await s.getItem("saleStarted"),(r.saleStarted==null||Object.keys(r.saleStarted).length==0)&&await s.setItem("saleStarted",0),r.refreshedYet=await s.getItem("refreshedYet"),(r.refreshedYet==null||Object.keys(r.refreshedYet).length==0)&&await s.setItem("refreshedYet",0),r.specialTab=await s.getItem("specialTab"),(r.specialTab==null||Object.keys(r.specialTab).length==0)&&await s.setItem("specialTab",""),r.mostSensitive=await s.getItem("mostSensitive"),(r.mostSensitive==null||Object.keys(r.mostSensitive).length==0)&&await s.setItem("mostSensitive",""),r.instructions=await s.getItem("instructions"),(r.instructions==null||Object.keys(r.instructions).length==0)&&await s.setItem("instructions",""),r.diffTime=await s.getItem("diffTime"),(r.diffTime==null||Object.keys(r.diffTime).length==0)&&await s.setItem("diffTime",0),r.activeSale=await s.getItem("activeSale"),(r.activeSale==null||Object.keys(r.activeSale).length==0)&&await s.setItem("activeSale",0),r.email_lucky=await s.getItem("email_lucky"),(r.email_lucky==null||Object.keys(r.email_lucky).length==0)&&await s.setItem("email_lucky",""),r.email_sent=await s.getItem("email_sent"),(r.email_sent==null||Object.keys(r.email_sent).length==0)&&await s.setItem("email_sent",0),r.phoneNo=await s.getItem("phoneNo"),(r.phoneNo==null||Object.keys(r.phoneNo).length==0)&&await s.setItem("phoneNo",""),r.myName=await s.getItem("myName"),(r.myName==null||Object.keys(r.myName).length==0)&&await s.setItem("myName",""),r.emailEbay=await s.getItem("emailEbay"),(r.emailEbay==null||Object.keys(r.emailEbay).length==0)&&await s.setItem("emailEbay",""),r.bankBox1=await s.getItem("bankBox1"),(r.bankBox1==null||Object.keys(r.bankBox1).length==0)&&await s.setItem("bankBox1",""),r.bankBox2=await s.getItem("bankBox2"),(r.bankBox2==null||Object.keys(r.bankBox2).length==0)&&await s.setItem("bankBox2",""),r.bankBox3=await s.getItem("bankBox3"),(r.bankBox3==null||Object.keys(r.bankBox3).length==0)&&await s.setItem("bankBox3",""),r.bankBox4=await s.getItem("bankBox4"),(r.bankBox4==null||Object.keys(r.bankBox4).length==0)&&await s.setItem("bankBox4",""),r.verifiedExt=await s.getItem("verifiedExt"),(r.verifiedExt==null||Object.keys(r.verifiedExt).length==0)&&await s.setItem("verifiedExt",0),r.listNotIDs=await s.getItem("listNotIDs"),(r.listNotIDs==null||Object.keys(r.listNotIDs).length==0)&&await s.setItem("listNotIDs",""),r.lastTime=await s.getItem("lastTime"),(r.lastTime===void 0||Object.keys(r.lastTime).length==0)&&await s.setItem("lastTime",0),r.blockList=await s.getItem("blockList"),(r.blockList===void 0||Object.keys(r.blockList).length==0)&&await s.setItem("blockList",""),r.mywishlist=await s.getItem("mywishlist"),(r.mywishlist==null||r.mywishlist.trim()==""||r.mywishlist.trim()=="[]"||Object.keys(r.mywishlist).length==0)&&await s.setItem("mywishlist",""),r.searchTesting=await s.getItem("searchTesting"),(typeof r.searchTesting>"u"||r.searchTesting==""||r.searchTesting=="[]"||Object.keys(r.searchTesting).length==0)&&await s.setItem("searchTesting",0),r.flashSale=await s.getItem("flashSale"),(r.flashSale==null||r.flashSale==""||Object.keys(r.flashSale).length==0)&&await s.setItem("flashSale",JSON.stringify([{key:"Mi5",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#MI5",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Gold",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Silver",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Dark Grey",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 32 GB, Gold",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Mi Powerbank",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#MIPOWER20000",startsAt:1464165e3},{key:"Redmi Note 3, 32 GB, Grey",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3}]));var c=await s.getItem("flashSale");c=JSON.parse(c);for(let x=0;x<c.length;x++)c[x].startsAt=1464165e3;await s.setItem("flashSale",JSON.stringify(c)),c=await s.getItem("flashSale"),c=JSON.parse(c);let w=c.length;var l={};w==6&&(l.key="Redmi Note 3, 32 GB, Grey",l.value=0,l.url="http://www.mi.com/in/hdindex/openbuy/#HM3A",l.startsAt=1464165e3,c.push(l)),r.tokenSent=await s.getItem("tokenSent"),(r.tokenSent==null||r.tokenSent==""||Object.keys(r.tokenSent).length==0)&&(await s.setItem("tokenSent",0),r.tokenSent=0),r.salesArray=await s.getItem("salesArray"),(r.salesArray==null||Object.keys(r.salesArray).length==0)&&await s.setItem("salesArray",JSON.stringify([{key:"Paytm Sale",value:0},{key:"American Swan Sale",value:0}])),r.promoPushArray=await s.getItem("promoPushArray"),(r.promoPushArray==null||r.promoPushArray==""||Object.keys(r.promoPushArray).length==0)&&await s.setItem("promoPushArray",JSON.stringify([{key:"SUBSCRIBE TO PROMOTIONAL PUSH MESSAGES:",value:1},{key:"10:00 AM - 09:00 PM",value:1},{key:"09:00 PM - 10:00 AM",value:1},{key:"Live Offer Updates (1st- 6th Oct)",value:1}])),r.promoPushArray=await s.getItem("promoPushArray");var d=r.promoPushArray;d=JSON.parse(d),d.length<4&&(d.push({key:"Live Offer Updates (1st- 6th Oct)",value:1}),d=JSON.stringify(d),await s.setItem("promoPushArray",d)),r.noIDs=await s.getItem("noIDs"),(r.noIDs==null||Object.keys(r.noIDs).length==0)&&await s.setItem("noIDs",0),await s.setItem("saleMonitor",0),await s.setItem("timeRemaining",1e11),r.checkedArray=await s.getItem("checkedArray"),(r.checkedArray==null||r.checkedArray==""||Object.keys(r.checkedArray).length==0)&&await s.setItem("checkedArray","{}"),r.openTimeHash=await s.getItem("openTimeHash"),(r.openTimeHash==null||r.openTimeHash==""||Object.keys(r.openTimeHash).length==0)&&await s.setItem("openTimeHash","{}"),r.flagBL=await s.getItem("flagBL"),(r.flagBL==null||r.flagBL==""||Object.keys(r.flagBL).length==0)&&await s.setItem("flagBL",0),await s.setItem("flagBL",0),r.tabAssignedHash=await s.getItem("tabAssignedHash"),(r.tabAssignedHash==null||r.tabAssignedHash==""||Object.keys(r.tabAssignedHash).length==0)&&await s.setItem("tabAssignedHash","{}"),r.ext_id=await s.getItem("ext_id"),r.actBL=await s.getItem("actBL"),r.ext_id&&parseInt(r.ext_id)>264e4?(r.actBL==""||typeof r.actBL>"u"||Object.keys(r.actBL).length==0)&&await s.setItem("actBL",0):await s.setItem("actBL",85),r.ext_auth=await s.getItem("ext_auth"),r.isVerified=await s.getItem("isVerified"),r.verifiedExt=await s.getItem("verifiedExt"),r.verifiedExt==1&&r.isVerified!=1?(r.isVerified=1,await s.setItem("isVerified",1)):r.isVerified==1&&r.verifiedExt!=1?(r.verifiedExt=1,await s.setItem("verifiedExt",1)):(typeof r.isVerified>"u"||Object.keys(r).length==0)&&(r.isVerified=0,await s.setItem("isVerified",0));var o=wa.length;setTimeout(async function(){await vn(i,t,s)},5e3),Array.isArray(wa)&&wa.length>0?(await s.setItem("noIDs",wa.length),chrome.gcm.register(wa,registerCallback)):await s.setItem("noIDs",0)}catch(f){e("initLocalStorage",_n),t("At initLocalStorage ",f)}}async function vn(e,t,a){try{let i=await self.registration.pushManager.getSubscription(),s=JSON.parse(await a.getItem("web_push_subscription")||"{}");if(s.subscription&&(s=s.subscription),!i||i&&s&&i.endpoint!=s.endpoint){let r=(await zs(e,t)).split(".")[0],c=!1;(r==""||r<=122)&&(c=!0);let l=await self.registration.pushManager.subscribe({userVisibleOnly:c,applicationServerKey:Ks});await a.setItem("web_push_subscription",JSON.stringify({subscription:l,userVisibleOnly:c})),await a.setItem("can_send_wp_subscription",1),await Zs(l,c,t,a)&&await a.setItem("can_send_wp_subscription",0)}}catch(i){t("Subscribe error: ",i)}}async function Zs(e,t,a,i){try{let s=await i.getItem("ext_id"),r=await i.getItem("ext_auth"),c=`https://ext1.buyhatke.com/extension-apis/updateSubscriptions?extId=${s}&extAuth=${r}`,l=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:e,userVisibleOnly:t})});return l=await l.json(),l.status==1}catch(s){return a("sendSubscriptionToServer",s),!1}}function Xs(e,t,a,i,s,r){try{if(e=="")e=chrome.runtime.getURL("logo_128x128.png");else var c={type:"basic",title:t,message:a,iconUrl:e,priority:100,requireInteraction:!0};var l=i,d=r;ga[d]=s,chrome.notifications.create(d,c,function(o){Ma.push({notfID:o,URL:i}),chrome.storage.local.get("paNotifsLinkArr",function(f){if(f.paNotifsLinkArr)f.paNotifsLinkArr.push({notfID:o,URL:i}),f.paNotifsLinkArr.length>50&&(f.paNotifsLinkArr=f.paNotifsLinkArr.slice(-50)),chrome.storage.local.set({paNotifsLinkArr:f.paNotifsLinkArr},function(){});else{let p=[{notfID:o,URL:i}];chrome.storage.local.set({paNotifsLinkArr:p},function(){})}})})}catch{}}function Qs(e,t,a,i,s){try{if(e=="")e=chrome.runtime.getURL("logo_128x128.png");else var r={type:"basic",title:t,message:a,iconUrl:e,priority:100,requireInteraction:!0};var c=i,l=Sa();ga[l]=s,chrome.notifications.create(l,r,function(d){Ma.push({notfID:d,URL:i}),chrome.storage.local.get("paNotifsLinkArr",function(o){if(o.paNotifsLinkArr)o.paNotifsLinkArr.push({notfID:d,URL:i}),o.paNotifsLinkArr.length>50&&(o.paNotifsLinkArr=o.paNotifsLinkArr.slice(-50)),chrome.storage.local.set({paNotifsLinkArr:o.paNotifsLinkArr},function(){});else{let f=[{notfID:d,URL:i}];chrome.storage.local.set({paNotifsLinkArr:f},function(){})}})})}catch{}}async function Vr(e,t,a,i,s,r,c){try{var l=await c.getItem("promoPushArray"),d=new Date,o=d.getHours();if(l=JSON.parse(l),l[0].value==0||l[1].value==0&&l[2].value==0)return;var f=0;if(!(l[1].value==1&&l[2].value==1)){if(l[1].value==1){if(!(o>=10&&o<21)){setTimeout(function(){Vr(e,t,a,i,s,r,c)},18e5);return}}else if(l[1].value==1&&!(o<10||o>=21)){setTimeout(function(){Vr(e,t,a,i,s,r,c)},18e5);return}}var p={type:"basic",title:e,message:t,iconUrl:chrome.runtime.getURL("logo_128x128.png"),priority:100,requireInteraction:!0},w=a,x=Sa();ga[x]=i,chrome.notifications.create(x,p,function(m){Ma.push({notfID:m,URL:a})})}catch(m){s("notify",m),r("Error in notify ",m)}}async function Kr(e,t,a,i,s,r,c,l,d){try{var o=await d.getItem("promoPushArray");if(o=JSON.parse(o),r=="")r="Claim Offer";else if(o[3].value==0)return;var f=new Date,p=f.getHours();if(p=Math.floor(p),o[0].value==0||o[1].value==0&&o[2].value==0)return;var w=0;if(!(o[1].value==1&&o[2].value==1)){if(o[1].value==1){if(!(p>=10&&p<21)){r=="Check Updated Offers"&&setTimeout(function(){Kr(e,t,a,i,s,r,c,l,d)},18e5);return}}else if(o[2].value==1&&!(p<10||p>=21)){r=="Check Updated Offers"&&setTimeout(function(){Kr(e,t,a,i,s,r,c,l,d)},18e5);return}}var x={type:"basic",title:t,message:a,buttons:[{title:r},{title:"Push Settings"}],iconUrl:e,priority:100,requireInteraction:!0},m=i,y=Sa();ga[y]=s,Gs[y]=i,chrome.notifications.create(y,x,function(b){Ma.push({notfID:b,URL:i})})}catch(b){c("notifyIcon",b),l("Error in notifyIcon ",b)}}async function Gr(e,t,a,i,s,r,c,l){try{var d=await l.getItem("promoPushArray"),o=new Date,f=o.getHours();if(d=JSON.parse(d),d[0].value==0||d[1].value==0&&d[2].value==0)return;var p=0;if(!(d[1].value==1&&d[2].value==1)){if(d[1].value==1){if(!(f>=10&&f<21)){setTimeout(function(){Gr(e,t,a,i,s,r,c,l)},18e5);return}}else if(d[1].value==1&&!(f<10||f>=21)){setTimeout(function(){Gr(e,t,a,i,s,r,c,l)},18e5);return}}var w={type:"image",title:t,imageUrl:e,message:a,iconUrl:chrome.runtime.getURL("logo_128x128.png"),priority:100},x=i,m=Sa();ga[m]=s,chrome.notifications.create(m,w,function(y){Ma.push({notfID:y,URL:i})})}catch(y){r("notifyImage",y),c("Error in notifyImage ",y)}}function On(e,t,a,i,s){a!==void 0||(a=""),a=Sa(),chrome.notifications.create(a,e,function(r){ta[r]!==void 0&&clearTimeout(ta[r].timer),ta[r]={listeners:t,timer:setTimeout(function(){An(r,function(c){c&&On(e,t,r)})},5e3)}})}function An(e,t){ta[e]!==void 0&&(clearTimeout(ta[e].timer),delete ta[e]),chrome.notifications.clear(e,function(a){t&&t(a)})}chrome&&chrome.contextMenus&&chrome.contextMenus.onClicked&&(chrome.runtime.onInstalled.addListener(async()=>{chrome.contextMenus.create({id:"bh-menu",title:"Compare prices on Buyhatke",type:"normal",contexts:["selection"]})}),chrome.contextMenus.onClicked.addListener((e,t)=>{e.menuItemId;const a=new URL("https://www.google.com/search?q=site%3Abuyhatke.com+"+encodeURIComponent(e.selectionText));chrome.tabs.create({url:a.href,index:t.index+1})}));const En=Object.freeze(Object.defineProperty({__proto__:null,createNotification:On,destroyNotification:An,initLocalStorage:_n,notify:Vr,notifyIcon:Kr,notifyImage:Gr,notifyPAImage:Qs,notifyPAOffers:Xs,subscribe:vn},Symbol.toStringTag,{value:"Module"}));var Cs=[],qs=chrome.runtime.getManifest(),Tr=qs.version;async function ec(e,t,a,i,s,r){try{r.tl=await s.getItem("tl"),(!r.tl||r.tl==""||r.tl==="undefined"||Object.keys(r.tl).length==0)&&await s.setItem("tl",JSON.stringify({})),r.wlswji=await s.getItem("wlswji"),(!r.wlswji||r.wlswji==""||r.wlswji==null||r.wlswji==="undefined"||Object.keys(r.wlswji).length==0)&&await s.setItem("wlswji",JSON.stringify({})),r.sourceSent=await s.getItem("sourceSent"),(r.sourceSent==""||typeof r.sourceSent>"u"||r.sourceSent==="undefined"||Object.keys(r.sourceSent).length==0)&&await s.setItem("sourceSent",0),r.version=await s.getItem("version"),(r.version!=Tr||Object.keys(r.version).length==0)&&(a("updated-version-"+Tr),await s.setItem("version",Tr)),r.featuresArray=await s.getItem("featuresArray"),(r.featuresArray==null||r.featuresArray==="undefined"||Object.keys(r.featuresArray).length==0)&&await s.setItem("featuresArray",JSON.stringify([{key:"Price Comparison Top Bar",value:1,transKey:"priceComparison"},{key:"Price Graph History",value:1,transKey:"priceHistory"},{key:"Price Alert Button",value:1,transKey:"priceAlert"},{key:"Spend Lens Button",value:1,transKey:"spendLens"},{key:"Coupons and Deals Tab",value:1,transKey:"coupon"},{key:"Apply Coupons automatically",value:1,transKey:"autoCoupons"},{key:"Ditto Button",value:1,transKey:"ditto"}])),r.first=await s.getItem("first"),r.features_json=await s.getItem("features_json"),(r.features_json==null||r.features_json==="undefined"||Object.keys(r.features_json).length==0)&&await s.setItem("features_json","[0,0,0,0,0]"),r.subscribedFor=await s.getItem("subscribedFor"),(r.subscribedFor==null||r.subscribedFor==="undefined"||Object.keys(r.subscribedFor).length==0)&&await s.setItem("subscribedFor",""),r.saleArray=await s.getItem("saleArray"),(r.saleArray==null||r.saleArray==="undefined"||Object.keys(r.saleArray).length==0)&&await s.setItem("saleArray",""),r.saleFinished=await s.getItem("saleFinished"),(r.saleFinished==null||r.saleFinished==="undefined"||Object.keys(r.saleFinished).length==0)&&await s.setItem("saleFinished",0),r.saleStarted=await s.getItem("saleStarted"),(r.saleStarted==null||r.saleStarted==="undefined"||Object.keys(r.saleStarted).length==0)&&await s.setItem("saleStarted",0),r.refreshedYet=await s.getItem("refreshedYet"),(r.refreshedYet==null||r.refreshedYet==="undefined"||Object.keys(r.refreshedYet).length==0)&&await s.setItem("refreshedYet",0),r.specialTab=await s.getItem("specialTab"),(r.specialTab==null||r.specialTab==="undefined"||Object.keys(r.specialTab).length==0)&&await s.setItem("specialTab",""),r.mostSensitive=await s.getItem("mostSensitive"),(r.mostSensitive==null||r.mostSensitive==="undefined"||Object.keys(r.mostSensitive).length==0)&&await s.setItem("mostSensitive",""),r.instructions=await s.getItem("instructions"),(r.instructions==null||r.instructions==="undefined"||Object.keys(r.instructions).length==0)&&await s.setItem("instructions",""),r.diffTime=await s.getItem("diffTime"),(r.diffTime==null||r.diffTime==="undefined"||Object.keys(r.diffTime).length==0)&&await s.setItem("diffTime",0),r.activeSale=await s.getItem("activeSale"),(r.activeSale==null||r.activeSale==="undefined"||Object.keys(r.activeSale).length==0)&&await s.setItem("activeSale",0),r.email_lucky=await s.getItem("email_lucky"),(r.email_lucky==null||r.email_lucky==="undefined"||Object.keys(r.email_lucky).length==0)&&await s.setItem("email_lucky",""),r.email_sent=await s.getItem("email_sent"),(r.email_sent==null||r.email_sent==="undefined"||Object.keys(r.email_sent).length==0)&&await s.setItem("email_sent",0),r.phoneNo=await s.getItem("phoneNo"),(r.phoneNo==null||r.phoneNo==="undefined"||Object.keys(r.phoneNo).length==0)&&await s.setItem("phoneNo",""),r.myName=await s.getItem("myName"),(r.myName==null||r.myName==="undefined"||Object.keys(r.myName).length==0)&&await s.setItem("myName",""),r.emailEbay=await s.getItem("emailEbay"),(r.emailEbay==null||r.emailEbay==="undefined"||Object.keys(r.emailEbay).length==0)&&await s.setItem("emailEbay",""),r.bankBox1=await s.getItem("bankBox1"),(r.bankBox1==null||r.bankBox1==="undefined"||Object.keys(r.bankBox1).length==0)&&await s.setItem("bankBox1",""),r.bankBox2=await s.getItem("bankBox2"),(r.bankBox2==null||r.bankBox2==="undefined"||Object.keys(r.bankBox2).length==0)&&await s.setItem("bankBox2",""),r.bankBox3=await s.getItem("bankBox3"),(r.bankBox3==null||r.bankBox3==="undefined"||Object.keys(r.bankBox3).length==0)&&await s.setItem("bankBox3",""),r.bankBox4=await s.getItem("bankBox4"),(r.bankBox4==null||r.bankBox4==="undefined"||Object.keys(r.bankBox4).length==0)&&await s.setItem("bankBox4",""),r.verifiedExt=await s.getItem("verifiedExt"),(r.verifiedExt==null||r.verifiedExt==="undefined"||Object.keys(r.verifiedExt).length==0)&&await s.setItem("verifiedExt",0),r.listNotIDs=await s.getItem("listNotIDs"),(r.listNotIDs==null||r.listNotIDs==="undefined"||Object.keys(r.listNotIDs).length==0)&&await s.setItem("listNotIDs",""),r.lastTime=await s.getItem("lastTime"),(r.lastTime===void 0||r.lastTime==="undefined"||Object.keys(r.lastTime).length==0)&&await s.setItem("lastTime",0),r.blockList=await s.getItem("blockList"),(r.blockList===void 0||r.blockList==="undefined"||Object.keys(r.blockList).length==0)&&await s.setItem("blockList",""),r.mywishlist=await s.getItem("mywishlist"),(r.mywishlist==null||r.mywishlist==="undefined"||r.mywishlist.trim()==""||r.mywishlist.trim()=="[]"||Object.keys(r.mywishlist).length==0)&&await s.setItem("mywishlist",""),r.searchTesting=await s.getItem("searchTesting"),(typeof r.searchTesting>"u"||r.searchTesting==="undefined"||r.searchTesting==""||r.searchTesting=="[]"||Object.keys(r.searchTesting).length==0)&&await s.setItem("searchTesting",0),r.flashSale=await s.getItem("flashSale"),(r.flashSale==null||r.flashSale==="undefined"||r.flashSale==""||Object.keys(r.flashSale).length==0)&&await s.setItem("flashSale",JSON.stringify([{key:"Mi5",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#MI5",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Gold",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Silver",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Dark Grey",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 32 GB, Gold",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Mi Powerbank",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#MIPOWER20000",startsAt:1464165e3},{key:"Redmi Note 3, 32 GB, Grey",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3}]));var c=await s.getItem("flashSale");c=JSON.parse(c);for(let p=0;p<c.length;p++)c[p].startsAt=1464165e3;await s.setItem("flashSale",JSON.stringify(c)),c=await s.getItem("flashSale"),c=JSON.parse(c);let f=c.length;var l={};f==6&&(l.key="Redmi Note 3, 32 GB, Grey",l.value=0,l.url="http://www.mi.com/in/hdindex/openbuy/#HM3A",l.startsAt=1464165e3,c.push(l)),r.tokenSent=await s.getItem("tokenSent"),(r.tokenSent==null||r.tokenSent==="undefined"||r.tokenSent==""||Object.keys(r.tokenSent).length==0)&&(await s.setItem("tokenSent",0),r.tokenSent=0),r.salesArray=await s.getItem("salesArray"),(r.salesArray==null||r.salesArray==="undefined"||Object.keys(r.salesArray).length==0)&&await s.setItem("salesArray",JSON.stringify([{key:"Paytm Sale",value:0},{key:"American Swan Sale",value:0}])),r.promoPushArray=await s.getItem("promoPushArray"),(r.promoPushArray==null||r.promoPushArray==="undefined"||r.promoPushArray==""||Object.keys(r.promoPushArray).length==0)&&await s.setItem("promoPushArray",JSON.stringify([{key:"SUBSCRIBE TO PROMOTIONAL PUSH MESSAGES:",value:1},{key:"10:00 AM - 09:00 PM",value:1},{key:"09:00 PM - 10:00 AM",value:1},{key:"Live Offer Updates (1st- 6th Oct)",value:1}])),r.promoPushArray=await s.getItem("promoPushArray");var d=r.promoPushArray;d=JSON.parse(d),d.length<4&&(d.push({key:"Live Offer Updates (1st- 6th Oct)",value:1}),d=JSON.stringify(d),await s.setItem("promoPushArray",d)),r.noIDs=await s.getItem("noIDs"),(r.noIDs==null||Object.keys(r.noIDs).length==0)&&await s.setItem("noIDs",0),await s.setItem("saleMonitor",0),await s.setItem("timeRemaining",1e11),r.checkedArray=await s.getItem("checkedArray"),(r.checkedArray==null||r.checkedArray=="undefined"||r.checkedArray==""||Object.keys(r.checkedArray).length==0)&&await s.setItem("checkedArray","{}"),r.openTimeHash=await s.getItem("openTimeHash"),(r.openTimeHash==null||r.openTimeHash=="undefined"||r.openTimeHash==""||Object.keys(r.openTimeHash).length==0)&&await s.setItem("openTimeHash","{}"),r.flagBL=await s.getItem("flagBL"),(r.flagBL==null||r.flagBL=="undefined"||r.flagBL==""||Object.keys(r.flagBL).length==0)&&await s.setItem("flagBL",0),await s.setItem("flagBL",0),r.tabAssignedHash=await s.getItem("tabAssignedHash"),(r.tabAssignedHash==null||r.tabAssignedHash=="undefined"||r.tabAssignedHash==""||Object.keys(r.tabAssignedHash).length==0)&&await s.setItem("tabAssignedHash","{}"),r.ext_id=await s.getItem("ext_id"),r.actBL=await s.getItem("actBL"),r.ext_id&&parseInt(r.ext_id)>264e4?(r.actBL==""||typeof r.actBL>"u"||Object.keys(r.actBL).length==0)&&await s.setItem("actBL",0):await s.setItem("actBL",85),r.ext_auth=await s.getItem("ext_auth"),r.isVerified=await s.getItem("isVerified"),r.verifiedExt=await s.getItem("verifiedExt"),r.verifiedExt==1&&r.isVerified!=1?(r.isVerified=1,await s.setItem("isVerified",1)):r.isVerified==1&&r.verifiedExt!=1?(r.verifiedExt=1,await s.setItem("verifiedExt",1)):(typeof r.isVerified>"u"||Object.keys(r).length==0)&&(r.isVerified=0,await s.setItem("isVerified",0));var o=Cs.length;setTimeout(async function(){await Dn()},5e3),await s.setItem("noIDs",o)}catch(f){e("initLocalStorage",f),t("At initLocalStorage ",f)}}async function Dn(e,t,a){}function tc(e,t,a,i,s,r){}function ac(e,t,a,i,s){}async function rc(e,t,a,i,s,r,c){}async function ic(e,t,a,i,s,r,c,l,d){}async function nc(e,t,a,i,s,r,c,l){}function sc(e,t,a,i,s){}function cc(e,t){}const lc=Object.freeze(Object.defineProperty({__proto__:null,createNotification:sc,destroyNotification:cc,initLocalStorage:ec,notify:rc,notifyIcon:ic,notifyImage:nc,notifyPAImage:ac,notifyPAOffers:tc,subscribe:Dn},Symbol.toStringTag,{value:"Module"}));let oc="BO8_Gm4O4tOivltbZImpbwXGFcI4GVM_48tP2_tSbn4kvjV-m21VZp6hnfG473o30NoYEpUlo568mOpq9bA7pnk",uc=fc(oc);var Fa={},Ja=[],dc={},aa={},Ya=[],hc=chrome.runtime.getManifest(),Lr=hc.version;function ja(){var e=Math.floor(Math.random()*9007199254740992)+1;return e.toString()}function fc(e){const t="=".repeat((4-e.length%4)%4),a=(e+t).replace(/-/g,"+").replace(/_/g,"/"),i=atob(a),s=new Uint8Array(i.length);for(let r=0;r<i.length;++r)s[r]=i.charCodeAt(r);return s}async function pc(e,t){try{let i=navigator.userAgent.match(/Chrome\/(\d+\.\d+\.\d+\.\d+)/);return i&&i[1].split(".").length==4?i[1]:""}catch(a){return t("getChromeFunction",a),await e("errorGettingChromeVerison"),""}}async function Nn(e,t,a,i,s,r){try{r.tl=await s.getItem("tl"),(!r.tl||r.tl==""||Object.keys(r.tl).length==0)&&await s.setItem("tl",JSON.stringify({})),r.wlswji=await s.getItem("wlswji"),(!r.wlswji||r.wlswji==""||r.wlswji==null||Object.keys(r.wlswji).length==0)&&await s.setItem("wlswji",JSON.stringify({})),r.sourceSent=await s.getItem("sourceSent"),(r.sourceSent==""||typeof r.sourceSent>"u"||Object.keys(r.sourceSent).length==0)&&await s.setItem("sourceSent",0),r.version=await s.getItem("version"),(r.version!=Lr||Object.keys(r.version).length==0)&&(a("updated-version-"+Lr),await s.setItem("version",Lr)),r.featuresArray=await s.getItem("featuresArray"),(r.featuresArray==null||Object.keys(r.featuresArray).length==0)&&await s.setItem("featuresArray",JSON.stringify([{key:"Price Comparison Top Bar",value:1,transKey:"priceComparison"},{key:"Price Graph History",value:1,transKey:"priceHistory"},{key:"Price Alert Button",value:1,transKey:"priceAlert"},{key:"Spend Lens Button",value:1,transKey:"spendLens"},{key:"Coupons and Deals Tab",value:1,transKey:"coupon"},{key:"Apply Coupons automatically",value:1,transKey:"autoCoupons"},{key:"Ditto Button",value:1,transKey:"ditto"}])),r.first=await s.getItem("first"),r.features_json=await s.getItem("features_json"),(r.features_json==null||Object.keys(r.features_json).length==0)&&await s.setItem("features_json","[0,0,0,0,0]"),r.subscribedFor=await s.getItem("subscribedFor"),(r.subscribedFor==null||Object.keys(r.subscribedFor).length==0)&&await s.setItem("subscribedFor",""),r.saleArray=await s.getItem("saleArray"),(r.saleArray==null||Object.keys(r.saleArray).length==0)&&await s.setItem("saleArray",""),r.saleFinished=await s.getItem("saleFinished"),(r.saleFinished==null||Object.keys(r.saleFinished).length==0)&&await s.setItem("saleFinished",0),r.saleStarted=await s.getItem("saleStarted"),(r.saleStarted==null||Object.keys(r.saleStarted).length==0)&&await s.setItem("saleStarted",0),r.refreshedYet=await s.getItem("refreshedYet"),(r.refreshedYet==null||Object.keys(r.refreshedYet).length==0)&&await s.setItem("refreshedYet",0),r.specialTab=await s.getItem("specialTab"),(r.specialTab==null||Object.keys(r.specialTab).length==0)&&await s.setItem("specialTab",""),r.mostSensitive=await s.getItem("mostSensitive"),(r.mostSensitive==null||Object.keys(r.mostSensitive).length==0)&&await s.setItem("mostSensitive",""),r.instructions=await s.getItem("instructions"),(r.instructions==null||Object.keys(r.instructions).length==0)&&await s.setItem("instructions",""),r.diffTime=await s.getItem("diffTime"),(r.diffTime==null||Object.keys(r.diffTime).length==0)&&await s.setItem("diffTime",0),r.activeSale=await s.getItem("activeSale"),(r.activeSale==null||Object.keys(r.activeSale).length==0)&&await s.setItem("activeSale",0),r.email_lucky=await s.getItem("email_lucky"),(r.email_lucky==null||Object.keys(r.email_lucky).length==0)&&await s.setItem("email_lucky",""),r.email_sent=await s.getItem("email_sent"),(r.email_sent==null||Object.keys(r.email_sent).length==0)&&await s.setItem("email_sent",0),r.phoneNo=await s.getItem("phoneNo"),(r.phoneNo==null||Object.keys(r.phoneNo).length==0)&&await s.setItem("phoneNo",""),r.myName=await s.getItem("myName"),(r.myName==null||Object.keys(r.myName).length==0)&&await s.setItem("myName",""),r.emailEbay=await s.getItem("emailEbay"),(r.emailEbay==null||Object.keys(r.emailEbay).length==0)&&await s.setItem("emailEbay",""),r.bankBox1=await s.getItem("bankBox1"),(r.bankBox1==null||Object.keys(r.bankBox1).length==0)&&await s.setItem("bankBox1",""),r.bankBox2=await s.getItem("bankBox2"),(r.bankBox2==null||Object.keys(r.bankBox2).length==0)&&await s.setItem("bankBox2",""),r.bankBox3=await s.getItem("bankBox3"),(r.bankBox3==null||Object.keys(r.bankBox3).length==0)&&await s.setItem("bankBox3",""),r.bankBox4=await s.getItem("bankBox4"),(r.bankBox4==null||Object.keys(r.bankBox4).length==0)&&await s.setItem("bankBox4",""),r.verifiedExt=await s.getItem("verifiedExt"),(r.verifiedExt==null||Object.keys(r.verifiedExt).length==0)&&await s.setItem("verifiedExt",0),r.listNotIDs=await s.getItem("listNotIDs"),(r.listNotIDs==null||Object.keys(r.listNotIDs).length==0)&&await s.setItem("listNotIDs",""),r.lastTime=await s.getItem("lastTime"),(r.lastTime===void 0||Object.keys(r.lastTime).length==0)&&await s.setItem("lastTime",0),r.blockList=await s.getItem("blockList"),(r.blockList===void 0||Object.keys(r.blockList).length==0)&&await s.setItem("blockList",""),r.mywishlist=await s.getItem("mywishlist"),(r.mywishlist==null||r.mywishlist.trim()==""||r.mywishlist.trim()=="[]"||Object.keys(r.mywishlist).length==0)&&await s.setItem("mywishlist",""),r.searchTesting=await s.getItem("searchTesting"),(typeof r.searchTesting>"u"||r.searchTesting==""||r.searchTesting=="[]"||Object.keys(r.searchTesting).length==0)&&await s.setItem("searchTesting",0),r.flashSale=await s.getItem("flashSale"),(r.flashSale==null||r.flashSale==""||Object.keys(r.flashSale).length==0)&&await s.setItem("flashSale",JSON.stringify([{key:"Mi5",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#MI5",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Gold",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Silver",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Dark Grey",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 32 GB, Gold",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Mi Powerbank",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#MIPOWER20000",startsAt:1464165e3},{key:"Redmi Note 3, 32 GB, Grey",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3}]));var c=await s.getItem("flashSale");c=JSON.parse(c);for(let p=0;p<c.length;p++)c[p].startsAt=1464165e3;await s.setItem("flashSale",JSON.stringify(c)),c=await s.getItem("flashSale"),c=JSON.parse(c);let f=c.length;var l={};f==6&&(l.key="Redmi Note 3, 32 GB, Grey",l.value=0,l.url="http://www.mi.com/in/hdindex/openbuy/#HM3A",l.startsAt=1464165e3,c.push(l)),r.tokenSent=await s.getItem("tokenSent"),(r.tokenSent==null||r.tokenSent==""||Object.keys(r.tokenSent).length==0)&&(await s.setItem("tokenSent",0),r.tokenSent=0),r.salesArray=await s.getItem("salesArray"),(r.salesArray==null||Object.keys(r.salesArray).length==0)&&await s.setItem("salesArray",JSON.stringify([{key:"Paytm Sale",value:0},{key:"American Swan Sale",value:0}])),r.promoPushArray=await s.getItem("promoPushArray"),(r.promoPushArray==null||r.promoPushArray==""||Object.keys(r.promoPushArray).length==0)&&await s.setItem("promoPushArray",JSON.stringify([{key:"SUBSCRIBE TO PROMOTIONAL PUSH MESSAGES:",value:1},{key:"10:00 AM - 09:00 PM",value:1},{key:"09:00 PM - 10:00 AM",value:1},{key:"Live Offer Updates (1st- 6th Oct)",value:1}])),r.promoPushArray=await s.getItem("promoPushArray");var d=r.promoPushArray;d=JSON.parse(d),d.length<4&&(d.push({key:"Live Offer Updates (1st- 6th Oct)",value:1}),d=JSON.stringify(d),await s.setItem("promoPushArray",d)),r.noIDs=await s.getItem("noIDs"),(r.noIDs==null||Object.keys(r.noIDs).length==0)&&await s.setItem("noIDs",0),await s.setItem("saleMonitor",0),await s.setItem("timeRemaining",1e11),r.checkedArray=await s.getItem("checkedArray"),(r.checkedArray==null||r.checkedArray==""||Object.keys(r.checkedArray).length==0)&&await s.setItem("checkedArray","{}"),r.openTimeHash=await s.getItem("openTimeHash"),(r.openTimeHash==null||r.openTimeHash==""||Object.keys(r.openTimeHash).length==0)&&await s.setItem("openTimeHash","{}"),r.flagBL=await s.getItem("flagBL"),(r.flagBL==null||r.flagBL==""||Object.keys(r.flagBL).length==0)&&await s.setItem("flagBL",0),await s.setItem("flagBL",0),r.tabAssignedHash=await s.getItem("tabAssignedHash"),(r.tabAssignedHash==null||r.tabAssignedHash==""||Object.keys(r.tabAssignedHash).length==0)&&await s.setItem("tabAssignedHash","{}"),r.ext_id=await s.getItem("ext_id"),r.actBL=await s.getItem("actBL"),r.ext_id&&parseInt(r.ext_id)>264e4?(r.actBL==""||typeof r.actBL>"u"||Object.keys(r.actBL).length==0)&&await s.setItem("actBL",0):await s.setItem("actBL",85),r.ext_auth=await s.getItem("ext_auth"),r.isVerified=await s.getItem("isVerified"),r.verifiedExt=await s.getItem("verifiedExt"),r.verifiedExt==1&&r.isVerified!=1?(r.isVerified=1,await s.setItem("isVerified",1)):r.isVerified==1&&r.verifiedExt!=1?(r.verifiedExt=1,await s.setItem("verifiedExt",1)):(typeof r.isVerified>"u"||Object.keys(r).length==0)&&(r.isVerified=0,await s.setItem("isVerified",0));var o=Ya.length;setTimeout(async function(){await Tn(i,t,s)},5e3),Array.isArray(Ya)&&Ya.length>0?await s.setItem("noIDs",Ya.length):await s.setItem("noIDs",0)}catch(f){e("initLocalStorage",Nn),t("At initLocalStorage ",f)}}async function Tn(e,t,a){try{let i=await self.registration.pushManager.getSubscription(),s=JSON.parse(await a.getItem("web_push_subscription")||"{}");if(s.subscription&&(s=s.subscription),!i||i&&s&&i.endpoint!=s.endpoint){let r=(await pc(e,t)).split(".")[0],c=!1;(r==""||r<=122)&&(c=!0);let l=await self.registration.pushManager.subscribe({userVisibleOnly:c,applicationServerKey:uc});await a.setItem("web_push_subscription",JSON.stringify({subscription:l,userVisibleOnly:c})),await a.setItem("can_send_wp_subscription",1),await yc(l,c,t,a)&&await a.setItem("can_send_wp_subscription",0)}}catch(i){t("Subscribe error: ",i)}}async function yc(e,t,a,i){try{let s=await i.getItem("ext_id"),r=await i.getItem("ext_auth"),c=`https://ext1.buyhatke.com/extension-apis/updateSubscriptions?extId=${s}&extAuth=${r}`,l=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:e,userVisibleOnly:t})});return l=await l.json(),l.status==1}catch(s){return a("sendSubscriptionToServer",s),!1}}function wc(e,t,a,i,s,r){try{if(e=="")e=chrome.runtime.getURL("logo_128x128.png");else var c={type:"basic",title:t,message:a,iconUrl:e,priority:100,requireInteraction:!0};var l=i,d=r;Fa[d]=s,chrome.notifications.create(d,c,function(o){Ja.push({notfID:o,URL:i}),chrome.storage.local.get("paNotifsLinkArr",function(f){if(f.paNotifsLinkArr)f.paNotifsLinkArr.push({notfID:o,URL:i}),f.paNotifsLinkArr.length>50&&(f.paNotifsLinkArr=f.paNotifsLinkArr.slice(-50)),chrome.storage.local.set({paNotifsLinkArr:f.paNotifsLinkArr},function(){});else{let p=[{notfID:o,URL:i}];chrome.storage.local.set({paNotifsLinkArr:p},function(){})}})})}catch{}}function mc(e,t,a,i,s){try{if(e=="")e=chrome.runtime.getURL("logo_128x128.png");else var r={type:"basic",title:t,message:a,iconUrl:e,priority:100,requireInteraction:!0};var c=i,l=ja();Fa[l]=s,chrome.notifications.create(l,r,function(d){Ja.push({notfID:d,URL:i}),chrome.storage.local.get("paNotifsLinkArr",function(o){if(o.paNotifsLinkArr)o.paNotifsLinkArr.push({notfID:d,URL:i}),o.paNotifsLinkArr.length>50&&(o.paNotifsLinkArr=o.paNotifsLinkArr.slice(-50)),chrome.storage.local.set({paNotifsLinkArr:o.paNotifsLinkArr},function(){});else{let f=[{notfID:d,URL:i}];chrome.storage.local.set({paNotifsLinkArr:f},function(){})}})})}catch{}}async function Wr(e,t,a,i,s,r,c){try{var l=await c.getItem("promoPushArray"),d=new Date,o=d.getHours();if(l=JSON.parse(l),l[0].value==0||l[1].value==0&&l[2].value==0)return;var f=0;if(!(l[1].value==1&&l[2].value==1)){if(l[1].value==1){if(!(o>=10&&o<21)){setTimeout(function(){Wr(e,t,a,i,s,r,c)},18e5);return}}else if(l[1].value==1&&!(o<10||o>=21)){setTimeout(function(){Wr(e,t,a,i,s,r,c)},18e5);return}}var p={type:"basic",title:e,message:t,iconUrl:chrome.runtime.getURL("logo_128x128.png"),priority:100,requireInteraction:!0},w=a,x=ja();Fa[x]=i,chrome.notifications.create(x,p,function(m){Ja.push({notfID:m,URL:a})})}catch(m){s("notify",m),r("Error in notify ",m)}}async function Yr(e,t,a,i,s,r,c,l,d){try{var o=await d.getItem("promoPushArray");if(o=JSON.parse(o),r=="")r="Claim Offer";else if(o[3].value==0)return;var f=new Date,p=f.getHours();if(p=Math.floor(p),o[0].value==0||o[1].value==0&&o[2].value==0)return;var w=0;if(!(o[1].value==1&&o[2].value==1)){if(o[1].value==1){if(!(p>=10&&p<21)){r=="Check Updated Offers"&&setTimeout(function(){Yr(e,t,a,i,s,r,c,l,d)},18e5);return}}else if(o[2].value==1&&!(p<10||p>=21)){r=="Check Updated Offers"&&setTimeout(function(){Yr(e,t,a,i,s,r,c,l,d)},18e5);return}}var x={type:"basic",title:t,message:a,buttons:[{title:r},{title:"Push Settings"}],iconUrl:e,priority:100,requireInteraction:!0},m=i,y=ja();Fa[y]=s,dc[y]=i,chrome.notifications.create(y,x,function(b){Ja.push({notfID:b,URL:i})})}catch(b){c("notifyIcon",b),l("Error in notifyIcon ",b)}}async function zr(e,t,a,i,s,r,c,l){try{var d=await l.getItem("promoPushArray"),o=new Date,f=o.getHours();if(d=JSON.parse(d),d[0].value==0||d[1].value==0&&d[2].value==0)return;var p=0;if(!(d[1].value==1&&d[2].value==1)){if(d[1].value==1){if(!(f>=10&&f<21)){setTimeout(function(){zr(e,t,a,i,s,r,c,l)},18e5);return}}else if(d[1].value==1&&!(f<10||f>=21)){setTimeout(function(){zr(e,t,a,i,s,r,c,l)},18e5);return}}var w={type:"image",title:t,imageUrl:e,message:a,iconUrl:chrome.runtime.getURL("logo_128x128.png"),priority:100},x=i,m=ja();Fa[m]=s,chrome.notifications.create(m,w,function(y){Ja.push({notfID:y,URL:i})})}catch(y){r("notifyImage",y),c("Error in notifyImage ",y)}}function Ln(e,t,a,i,s){a!==void 0||(a=""),a=ja(),chrome.notifications.create(a,e,function(r){aa[r]!==void 0&&clearTimeout(aa[r].timer),aa[r]={listeners:t,timer:setTimeout(function(){Pn(r,function(c){c&&Ln(e,t,r)})},5e3)}})}function Pn(e,t){aa[e]!==void 0&&(clearTimeout(aa[e].timer),delete aa[e]),chrome.notifications.clear(e,function(a){t&&t(a)})}const bc=Object.freeze(Object.defineProperty({__proto__:null,createNotification:Ln,destroyNotification:Pn,initLocalStorage:Nn,notify:Wr,notifyIcon:Yr,notifyImage:zr,notifyPAImage:mc,notifyPAOffers:wc,subscribe:Tn},Symbol.toStringTag,{value:"Module"})),Ic="/assets/ext_inactive-B-nkdQPw.png",xc="/assets/ext_active-C5sMckP4.png";addEventListener("unhandledrejection",async e=>{di(e.reason)});addEventListener("error",async e=>{di(e.message)});addEventListener("onError",async e=>{di(e.message)});self.addEventListener("error",e=>{console.error("Service worker error:",e.error)});self.addEventListener("unhandledrejection",e=>{console.error("Service worker unhandled rejection:",e.reason)});let Pr=chrome.runtime.id,ct=En;Pr.includes("Price-Tracker--Spend-Lens-Buyhatke")||Pr.includes("98B976E3G5")?ct=lc:Pr.includes("Price-Comparison@buyhatke.com")?ct=bc:ct=En;function kc(e){return new Promise(t=>{let a=setInterval(async()=>(clearInterval(a),t()),e)})}setInterval(function(){console.clear()},5*60*1e3);function _c(e,t){return!Number.isInteger(e)||!Number.isInteger(t)||e<0||t<0||t<e?0:t-e}let Ve={},qe={},Nt={};function ft(e,t,a,i=0){try{i?Ve[a][t]?Ve[a][t][e]?Ve[a][t][e]+=i:Ve[a][t][e]=i:(Ve[a][t]={},Ve[a][t][e]=i):Ve[a][t]?Ve[a][t][e]?Ve[a][t][e]+=1:Ve[a][t][e]=1:(Ve[a][t]={},Ve[a][t][e]=1)}catch{}}function Rr(e,t,a){try{qe[a][t]?qe[a][t][e]||(qe[a][t][e]=Date.now()):(qe[a][t]={},e=="start_ms"||e=="end_ms"?qe[a][t][e]=Date.now():qe[a][t][e]+=2*Date.now()-qe[a][t][e])}catch{}}let Zr={cartCheckPoints:{name:"checkoutPage",events:[{key:"thnksPage"},{TTL:10*60*1e3,key:"postUpdateDataNew",prev:"thnksPage"}],errorMessage:"errorCH"},ACCheckPoints:{name:"autoCouponPage",events:[{key:"acPage"},{TTL:15*60*1e3,key:"floatingBtn",prev:"acPage"}],errorMessage:"errorAC"}};var gr=[],ma=[],Ue=[],ba=[],er=[],pt={},Xe=[],hr={},vc=[],za=[],Za="",et=0,Hi={},Vi={},ra={},tr={},fr={},st={},Ki=0,Gi=0,Wi="",Oc=0,Xr="",mr=!1;let Ze="";var Xa="2";let Rt=null,Ia=0,Ac=10,nt=null;function E(...e){}Object.keys(Vi).length>100&&(Vi={});var Aa=function(e){var t=Ec(Nc(Tc(Dc(e),8*e.length)));return t.toLowerCase()};function Ec(e){for(var t,a="0123456789ABCDEF",i="",s=0;s<e.length;s++)t=e.charCodeAt(s),i+=a.charAt(t>>>4&15)+a.charAt(15&t);return i}function Dc(e){for(var t=Array(e.length>>2),a=0;a<t.length;a++)t[a]=0;for(a=0;a<8*e.length;a+=8)t[a>>5]|=(255&e.charCodeAt(a/8))<<a%32;return t}function Nc(e){for(var t="",a=0;a<32*e.length;a+=8)t+=String.fromCharCode(e[a>>5]>>>a%32&255);return t}function Tc(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var a=1732584193,i=-271733879,s=-1732584194,r=271733878,c=0;c<e.length;c+=16){var l=a,d=i,o=s,f=r;i=it(i=it(i=it(i=it(i=rt(i=rt(i=rt(i=rt(i=at(i=at(i=at(i=at(i=tt(i=tt(i=tt(i=tt(i,s=tt(s,r=tt(r,a=tt(a,i,s,r,e[c+0],7,-680876936),i,s,e[c+1],12,-389564586),a,i,e[c+2],17,606105819),r,a,e[c+3],22,-1044525330),s=tt(s,r=tt(r,a=tt(a,i,s,r,e[c+4],7,-176418897),i,s,e[c+5],12,1200080426),a,i,e[c+6],17,-1473231341),r,a,e[c+7],22,-45705983),s=tt(s,r=tt(r,a=tt(a,i,s,r,e[c+8],7,1770035416),i,s,e[c+9],12,-1958414417),a,i,e[c+10],17,-42063),r,a,e[c+11],22,-1990404162),s=tt(s,r=tt(r,a=tt(a,i,s,r,e[c+12],7,1804603682),i,s,e[c+13],12,-40341101),a,i,e[c+14],17,-1502002290),r,a,e[c+15],22,1236535329),s=at(s,r=at(r,a=at(a,i,s,r,e[c+1],5,-165796510),i,s,e[c+6],9,-1069501632),a,i,e[c+11],14,643717713),r,a,e[c+0],20,-373897302),s=at(s,r=at(r,a=at(a,i,s,r,e[c+5],5,-701558691),i,s,e[c+10],9,38016083),a,i,e[c+15],14,-660478335),r,a,e[c+4],20,-405537848),s=at(s,r=at(r,a=at(a,i,s,r,e[c+9],5,568446438),i,s,e[c+14],9,-1019803690),a,i,e[c+3],14,-187363961),r,a,e[c+8],20,1163531501),s=at(s,r=at(r,a=at(a,i,s,r,e[c+13],5,-1444681467),i,s,e[c+2],9,-51403784),a,i,e[c+7],14,1735328473),r,a,e[c+12],20,-1926607734),s=rt(s,r=rt(r,a=rt(a,i,s,r,e[c+5],4,-378558),i,s,e[c+8],11,-2022574463),a,i,e[c+11],16,1839030562),r,a,e[c+14],23,-35309556),s=rt(s,r=rt(r,a=rt(a,i,s,r,e[c+1],4,-1530992060),i,s,e[c+4],11,1272893353),a,i,e[c+7],16,-155497632),r,a,e[c+10],23,-1094730640),s=rt(s,r=rt(r,a=rt(a,i,s,r,e[c+13],4,681279174),i,s,e[c+0],11,-358537222),a,i,e[c+3],16,-722521979),r,a,e[c+6],23,76029189),s=rt(s,r=rt(r,a=rt(a,i,s,r,e[c+9],4,-640364487),i,s,e[c+12],11,-421815835),a,i,e[c+15],16,530742520),r,a,e[c+2],23,-995338651),s=it(s,r=it(r,a=it(a,i,s,r,e[c+0],6,-198630844),i,s,e[c+7],10,1126891415),a,i,e[c+14],15,-1416354905),r,a,e[c+5],21,-57434055),s=it(s,r=it(r,a=it(a,i,s,r,e[c+12],6,1700485571),i,s,e[c+3],10,-1894986606),a,i,e[c+10],15,-1051523),r,a,e[c+1],21,-2054922799),s=it(s,r=it(r,a=it(a,i,s,r,e[c+8],6,1873313359),i,s,e[c+15],10,-30611744),a,i,e[c+6],15,-1560198380),r,a,e[c+13],21,1309151649),s=it(s,r=it(r,a=it(a,i,s,r,e[c+4],6,-145523070),i,s,e[c+11],10,-1120210379),a,i,e[c+2],15,718787259),r,a,e[c+9],21,-343485551),a=St(a,l),i=St(i,d),s=St(s,o),r=St(r,f)}return Array(a,i,s,r)}function br(e,t,a,i,s,r){return St(Lc(St(St(t,e),St(i,r)),s),a)}function tt(e,t,a,i,s,r,c){return br(t&a|~t&i,e,t,s,r,c)}function at(e,t,a,i,s,r,c){return br(t&i|a&~i,e,t,s,r,c)}function rt(e,t,a,i,s,r,c){return br(t^a^i,e,t,s,r,c)}function it(e,t,a,i,s,r,c){return br(a^(t|~i),e,t,s,r,c)}function St(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}function Lc(e,t){return e<<t|e>>>32-t}async function di(e,t={}){return t.errMsg=e,Fe("extension_error",{...e,...t})}var ar={},rr=[],ia={},na={},sa={},Gt={},ca={},Tt={};let ir=null;var u={};const h={getAllItems:()=>chrome.storage.local.get(),getItem:async e=>(await chrome.storage.local.get(e))[e],setItem:(e,t)=>new Promise(a=>{const i=t??"";chrome.storage.local.set({[e]:i},()=>{u[e]=i,a()})}),removeItem:e=>{chrome.storage.local.remove(e),u[e]&&delete u[e]}};async function Pc(e){var t;try{let a=typeof e=="string",i=a?JSON.parse(e):e,s;return(t=i==null?void 0:i.data)!=null&&t.adsList&&Array.isArray(i.data.adsList)?s=i.data.adsList:Array.isArray(i.data)?s=i.data:Array.isArray(i)&&(s=i),!s||!Array.isArray(s)?i:(await Promise.all(s.map(async r=>{let c=["image","site_image","imageUrl","site_logo","logo","creativeUrl"];await Promise.all(c.map(async l=>{if(r[l])try{const d=await Rc(r[l]);d&&(r[l]=d)}catch{}}))})),a?JSON.stringify(i):i)}catch(a){throw a}}async function Rc(e){try{e.split("ompare.buyhatke.com/images/").length>1&&e.split("ompare.buyhatke.com/images/site_icons_m").length==1&&(e=e.split("ompare.buyhatke.com/images/").join("ompare.buyhatke.com/images/site_icons_m/"));const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const a=await t.blob();return new Promise((i,s)=>{const r=new FileReader;r.onloadend=()=>i(r.result),r.onerror=c=>s("Error reading the image: "+c),r.readAsDataURL(a)})}catch{return null}}async function gc(e,t){try{let a={},i=await os(t),s=Nt[e].orderAPIArr;for(let r in s)try{let c=s[r],l=await La(e,{action:"changeDomFromSW",data:{eachOrderSel:c,siteConfig:i}});a[r]=l==null?void 0:l.finalRes,await new Promise(d=>setTimeout(d,7e3))}catch{await new Promise(o=>setTimeout(o,7e3));let l=s[r],d=await La(e,{action:"changeDomFromSW",data:{eachOrderSel:l,siteConfig:i}});a[r]=d==null?void 0:d.finalRes}return a}catch{}}async function Ba(e){try{return await Pc(e)}catch{}}let Wt={},Lt={};const Mc="CT_Internal_port_alive";var Ct=null;const Rn=1e3;var Yi=!0,Qr=4*Rn,zi=setInterval(gn,Qr);async function gn(){Ct==null&&(Ct=chrome.runtime.connect({name:Mc}),Ct.onDisconnect.addListener(e=>{chrome.runtime.lastError,Ct=null})),Ct&&(Ct.postMessage({content:"ping"}),chrome.runtime.lastError),Yi&&(Yi=!1,clearInterval(zi),Qr=270*Rn,zi=setInterval(gn,Qr))}let Zi=!1;const Sc="https://www.google-analytics.com/mp/collect",Fc="https://www.google-analytics.com/debug/mp/collect",Jc="G-QH3G6YCPV0",jc="i6Ays3ubRDuAv9WVfLYjkg",Bc=100,Uc=30;async function $c(){try{let{sessionData:e}=await chrome.storage.session.get("sessionData");const t=Date.now();return e&&e.timestamp&&((t-e.timestamp)/6e4>Uc?e=null:(e.timestamp=t,await chrome.storage.session.set({sessionData:e}))),e||(e={session_id:t.toString(),timestamp:t.toString()},await chrome.storage.session.set({sessionData:e})),e.session_id}catch{}}async function Xi(){try{let t=(await chrome.storage.local.get("ext_id")).ext_id;return t||(t=self.crypto.randomUUID()),t}catch{}}async function Mn(){try{let e="Chrome",t=navigator.userAgent||navigator.vendor||window.opera;/android/i.test(t)?e="Android":/iPad|iPhone|iPod/.test(t)&&!window.MSStream?e="iOS":chrome.runtime.id=="gdgnlfdenkmjcfgjpnookbglpndleahm"?e="Edge":chrome.runtime.id.includes("Price-Tracker--Spend-Lens-Buyhatke")?e="Safari":chrome.runtime.id=="Price-Comparison@buyhatke.com"&&(e="Firefox"),await h.setItem("userPlatform",e);let a="";try{a=await(await fetch("https://checkip.amazonaws.com/")).text(),a=a.split(`
`).join("")}catch{a=await(await fetch("https://api.ipify.org/")).text(),a=a.split(`
`).join("")}let s=await(await fetch("https://ipapi.co/"+a+"/json/")).json(),r=s.city,c=s.country_name;r&&c&&(await h.setItem("userCity",r),await h.setItem("userCountry",c))}catch{}}Mn();setInterval(function(){Mn()},24*3600*1e3);let Qi=0,Ea=[];async function Fe(e,t={},a=""){try{Qi++,t.session_id||(t.session_id=await $c()),t.engagement_time_msec||(t.engagement_time_msec=Bc);try{if(t.version?t.version="NA":t.version=await h.getItem("version"),t.ext_id?t.ext_id="NA":t.ext_id=await h.getItem("ext_id"),!t.source){let d=await h.getItem("referralDataSource");d?(t.utm_source=d.source,t.cs=d.source):(t.utm_source="NA",t.cs="NA")}let i="NA",s="NA",r="NA";i=await h.getItem("userCountry"),r=await h.getItem("userPlatform"),s=await h.getItem("userCity"),t.country=i,t.city=s,t.platform=r;let c="";if((t==null?void 0:t.type)=="error_pair_level"){await xo(t==null?void 0:t.config,t==null?void 0:t.pos,t==null?void 0:t.name,(t==null?void 0:t.tabId)||a,t==null?void 0:t.orderId);return}if(e=="StageEvents")Ea.push({name:e,params:t});else if(e!="AnalyticsSent")Ea.push({name:e,params:t});else return;e!="page_view"&&(e=e+"NewUI"),c=JSON.stringify({client_id:await Xi(),events:[{name:e,params:t}]}),Qi%1e3==5&&(c=JSON.stringify({client_id:await Xi(),user_properties:{country:{value:i},city:{value:s},source:{value:t.cs.toUpperCase()},platform:{value:r},version:{value:t.version}},events:[{name:e,params:t}]}));const l=await fetch(`${Zi?Fc:Sc}?measurement_id=${Jc}&api_secret=${jc}`,{method:"POST",body:c});if(!Zi)return}catch{}}catch{}}function Hc(e){chrome.tabs.reload(parseInt(e))}async function Vc(e){try{let t=await h.getItem("ext_id"),a=await h.getItem("ext_auth"),i={};i.data=e,i=JSON.stringify(i);let r=await(await fetch(`https://settings.buyhatke.com/extension-settings/updateGA?ext_id=${t}&ext_auth=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:i})).json();return""}catch(t){return v("referralData",t),E(t),""}}setInterval(function(){Ea.length>0&&(Vc(Ea),Ea=[])},5*60*1e3);async function Kc(e,t,a={}){try{return Fe(e,{page_title:t,page_location:t,...a})}catch{}}let vt={};async function lt(e,t,a){const i=await fetch(t,a);if(i.status>=400){if(ft("third_party_api_error",e),vt[e]=vt[e]||{},vt[e][i.status]=vt[e][i.status]||{},vt[e][i.status][t]=vt[e][i.status][t]||0,vt[e][i.status][t]++,i.status==406&&e==2)return i;await Fe("SpendCalcExtractMissing",{pos:e,missing_keys_report:"API_ERROR",url:t}),await ha({eventID:77,errorSource:"fetchSpend",errorDetails:{pos:e,missing_keys_report:"API_ERROR",url:t}})}return i}async function Gc(){try{if(Object.keys(vt).length>0){u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");const e=Object.assign(vt);if(vt={},(await(await fetch(`https://ext1.buyhatke.com/spend-apis/spend-calc/logFailedApis?extId=${u.ext_id}&extAuth=${u.ext_auth}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()).status!=1)throw new Error("logging failed !")}}catch(e){v("sendAndClearSpendApiLogs",e)}}async function Wc(e){try{if(Object.keys(e).length>0&&(u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth"),(await(await fetch(`https://ext1.buyhatke.com/spend-apis/spend-calc/logFailedApis?extId=${u.ext_id}&extAuth=${u.ext_auth}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()).status!=1))throw new Error("logging failed !")}catch(t){v("sendAndClearSpendApiLogsViaCS",t)}}setInterval(()=>{for(var e in ia){var t=Date.now();t-ia[e].time>60*60*1e3&&delete ia[e]}for(var e in na){var t=Date.now();t-na[e].time>60*60*1e3&&delete na[e]}for(var e in sa){var t=Date.now();t-sa[e].time>60*60*1e3&&delete sa[e]}for(var e in Gt){var t=Date.now();t-Gt[e].time>60*60*1e3&&delete Gt[e]}for(var e in Tt){var t=Date.now();t-Tt[e].time>60*60*1e3&&delete Tt[e]}for(var e in ca){var t=Date.now();t-ca[e].time>60*60*1e3&&delete ca[e]}},60*60*1e3);function Yc(e){var t={};t.time=Date.now(),t.configData=e,ia[JSON.parse(e)[0].id]=t}function zc(e){var t={};t.time=Date.now(),t.configData=e,na[JSON.parse(e).id]=t}function Zc(e,t){var a={};a.time=Date.now(),a.status=e,sa[t]=a}function Xc(e,t){var a={};a.time=Date.now(),a.config=e,Gt[t]=a,E("status",Gt[t])}function Qc(e){var t={};t.time=Date.now(),t.domains=e,Tt=t}function Cc(e,t){var a={};a.time=Date.now(),a.status=e,ca[t]=a}var Hn="";let Ci="";function Sn(e){Ci=e.requestId;let t="";e.hasOwnProperty("requestBody")&&(e.requestBody.hasOwnProperty("raw")?t=String.fromCharCode.apply(null,new Uint8Array(e.requestBody.raw[0].bytes)):t=JSON.stringify(e.requestBody)),ar[Ci]=t}function Fn(e){Jt=e.requestHeaders,chrome.tabs.query({active:!0,currentWindow:!0},function(t){let a=!1,i=[!1,!1,!1];e.method=="OPTIONS"||(JSON.stringify(ar[e.requestId]).search(new RegExp("couponBuyhatke","i"))>-1&&(a=!0,i[0]=!0),JSON.stringify(Jt).search(new RegExp("couponBuyhatke","i"))>-1&&(a=!0,i[1]=!0),e.url.search(new RegExp("couponBuyhatke","i"))>-1&&(a=!0,i[2]=!0)),a&&(e.tabId==-1&&(e.tabId=t[0].id),chrome.tabs.sendMessage(e.tabId,{requestBody:ar[e.requestId],headers:Jt,url:e.url,method:e.method,replace:i},function(s){}),rr=[],ar={},chrome.webRequest.onBeforeRequest.removeListener(Sn),chrome.webRequest.onBeforeSendHeaders.removeListener(Fn))})}function qc(e){var t;return new Promise(function(a,i){chrome.webRequest.onBeforeSendHeaders.addListener(function(s){t=s.requestHeaders,a(t)},{urls:[e]},["blocking","requestHeaders"])})}function el(e){return new Promise(function(t,a){chrome.webRequest.onBeforeSendHeaders.addListener(function(i){const s=i.requestHeaders.reduce((r,c)=>(r[c.name.toLowerCase()]=c.value,r),{});t(s)},{urls:[e]},["requestHeaders"])})}function tl(e){var t;return new Promise(function(a,i){chrome.webRequest.onBeforeRequest.addListener(function(s){t=decodeURIComponent(String.fromCharCode.apply(null,new Uint8Array(s.requestBody.raw[0].bytes))),a(t)},{urls:[e]},["blocking","requestBody"])})}var qi=["cr","ic","ket"],Mr={},en={},Cr=new Array,al=[];for(var Sr=0;Sr<100;Sr++)Cr[Sr]=0;function rl(e,t,a){try{chrome.cookies.get({url:e,name:t},function(i){if(chrome.runtime.lastError){a&&a(null);return}a&&a(i?i.value:null)})}catch{}}rl("https://amazon.in/","session_id",function(e){});var il=chrome.runtime.getManifest();il.version;function nl(e){const t="=".repeat((4-e.length%4)%4),a=(e+t).replace(/-/g,"+").replace(/_/g,"/"),i=atob(a),s=new Uint8Array(i.length);for(let r=0;r<i.length;++r)s[r]=i.charCodeAt(r);return s}const sl="BO8_Gm4O4tOivltbZImpbwXGFcI4GVM_48tP2_tSbn4kvjV-m21VZp6hnfG473o30NoYEpUlo568mOpq9bA7pnk";nl(sl);async function cl(e,t){try{let a=`https://ext1.buyhatke.com/extension-apis/updateSubscriptions?extId=${u.ext_id}&extAuth=${u.ext_auth}`,i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:e,userVisibleOnly:t})});return i=await i.json(),i.status==1}catch(a){return E("sendSubscriptionToServer",a),!1}}setInterval(async()=>{try{if((await h.getItem("can_send_wp_subscription")||0)!=1)return;let t=JSON.parse(await h.getItem("web_push_subscription")||"{}");if(Object.keys(t).length>0){let a=t.subscription,i=t.userVisibleOnly;await cl(a,i)&&await h.setItem("can_send_wp_subscription",0)}}catch(e){E("sending sub",e)}},1e3*60*60);ct.initLocalStorage(v,E,ht,Fe,h,u);async function Jn(){let e=await h.getItem("ext_auth"),t=await h.getItem("ext_id");t&&e?chrome.runtime.setUninstallURL("https://compare.buyhatke.com/uninstall.php?ext_id="+t+"&auth_val="+e):setTimeout(function(){Jn()},5e3)}Jn();async function tn(e){try{var t=await h.getItem("tl");t?t=JSON.parse(t):t={};var a=0;if(t[e]){var i=parseInt(t[e]),s=Math.floor(Date.now()/1e3);s-i>1800&&(a=1,t[e]=s)}else{var s=Math.floor(Date.now()/1e3);t[e]=s,a=1}h.setItem("tl",JSON.stringify(t)),a==1&&ll(e)}catch(r){v("repostSome",r),E("Error in reportSome ",r)}}async function ll(e){try{u.ext_id=await h.getItem("ext_id"),fetch("http://geoip.hmageo.com/ip/").then(function(t){return t.text()}).then(function(t){fetch("https://utility.buyhatke.com/bli.php?ip="+t+"&domain="+e+"&ext_id="+u.ext_id)})}catch(t){v("someVal",t),E("Error in someVal ",t)}}function jn(e){try{var e=new URL(e);return e.hostname}catch{return""}}async function ol(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime(),a=await fetch("https://utility.buyhatke.com/whl.json?rand="+t);if(a.status>=400&&a.status<=599)throw new Error("status: "+a.status);await h.setItem("whl",await a.text())}catch(e){v("getWHL",e),E("Error in getWHL() ",e)}}ol();async function qt(e){try{u.ext_id=await h.getItem("ext_id");let t=await fetch("http://geoip.hmageo.com/ip/");if(t.status>=400&&t.status<=599)throw new Error("status: "+t.status);if(t=await t.text(),t){let a=await fetch("https://utility.buyhatke.com/bl.php?ip="+text+"&domain="+e+"&ext_id="+u.ext_id);if(a.status>=400&&a.status<=599)throw new Error("status: "+a.status)}}catch(t){v("sessVal",t),E("Error sessVal ",t)}}var Bn="amazon",Fr=["backend.pricedekho.com","cmsprod.coupondunia.in","fapp1.coupondunia.in","app.coupondunia.in","staging.cashkaro.com","email.mysmartprice.com","email.desidime.com","data.flipshope.com","u.flipshope.com","upld.smartprix.com","backend.pricedekho.com","pddb-admin.pricedekho.com","dashboard.grabon.in","admin.grabon.in","email.91mobiles.com","webmanager.pennyful.in","xsso.indiafreestuff.in","ww31.indiafreestuff.in"];async function ul(e){try{if(Un(e),u.whl=await h.getItem("whl"),u.whl==null||u.whl=="")return 1;var t=await JSON.parse(u.whl);e=jn(e);for(var a=e,i=0,s=0;s<Fr.length;s++)if(Fr[s]==a||a.split(Fr[s]).length>1){i=1,tn(a);var r=await h.getItem("hashBL");r==null||r==""?(r={},r[a]=1,qt(a)):(r=JSON.parse(r),typeof r[a]>"u"?(r[a]=1,qt(a)):r[a]++),await h.setItem("hashBL",JSON.stringify(r));return}for(var c=0;c<t.length;c++)if(t[c].site==e||e.split(t[c].site).length>1)return 0;if(e=e.split(Bn),e[0]=="www."||e[0]=="")return 0;if(e.length==1)return 0;tn(a);var r=await h.getItem("hashBL");r==null||r==""?(r={},r[a]=1,qt(a)):(r=JSON.parse(r),typeof r[a]>"u"?(r[a]=1,qt(a)):r[a]++),await h.setItem("hashBL",JSON.stringify(r))}catch(l){v("checkMainFunc",l),E("Error in checkMainFunc ",l)}}var kt="mlaiogloeg",an=[Bn,"backend.pricedekho.com","cmsprod.coupondunia.in","fapp1.coupondunia.in","app.coupondunia.in","staging.cashkaro.com","email.mysmartprice.com","click.mysmartprice.com","email.desidime.com","data.flipshope.com","u.flipshope.com","upld.smartprix.com","backend.pricedekho.com","pddb-admin.pricedekho.com","dashboard.grabon.in","admin.grabon.in","email.91mobiles.com","webmanager.pennyful.in","xsso.indiafreestuff.in","ww31.indiafreestuff.in","smartprix.slack.com","new.smartprix.com","et3.smartprix.com","todo.91mobiles.com","mailer.91mobiles.com","click.mysmartprice.com"],Jr=["pricedekho","coupondunia","cashkaro","mysmartprice","desidime","flipshope","smartprix","grabon","91mobiles","pennyful","indiafreestuff","flipkart","makkhichoose","kernelinsights"];async function Un(e){try{if(e=="")return;for(var t=0;t<Jr.length;t++){e.split("://").length==1&&(e="http://"+e),e=jn(e);var a=e;if(e.split(Jr[t]).length>1){if(e=e.split("://"),e.length>1?e=e[1]:e=e[0],e=e.split(Jr[t]),!((e[1]==".com"||e[1]==".in")&&(e[0]=="www."||e[0]==""))){u.wlswji=await h.getItem("wlswji");var i=u.wlswji;typeof i>"u"||i==""?(i={},i[a]=1,qt(a),await h.setItem("wlswji",JSON.stringify(i))):(i=JSON.parse(i),i[a]||(i[a]=1,qt(a),await h.setItem("wlswji",JSON.stringify(i))))}break}}}catch(s){v("checkSomeDomain",s),E("Error in ",s)}}async function $n(){const e="lastUrl_",t=[],a=await chrome.storage.local.get(null);for(const i in a)if(i.startsWith(e)){const s=i.substring(e.length),r=parseInt(s);if(!isNaN(r))try{await chrome.tabs.get(r)}catch{t.push(i)}}t.length>0&&await chrome.storage.local.remove(t)}setInterval(async function(){await $n()},10*60*1e3);setTimeout(async function(){await $n()},100);function dl(e){for(var t=0;t<an.length;t++)if(e.split(an[t]).length>1)return!0;return!1}async function hl(e){e.split("webstore/detail").length>1&&(e.split("ggdlnemgdnagmpkchejgmgpbidihmali").length>1||e.split("iiinclagpealgnaglbmkdbfbgchjjbpg").length>1)&&await fl()}async function fl(){try{if(u.sourceSent=await h.getItem("sourceSent"),u.ext_id=await h.getItem("ext_id"),parseInt(u.sourceSent)==1)return;var e="https://compare.buyhatke.com/extension/scstore.php",t="ext_id="+u.ext_id+"&auth_val="+u.ext_auth,a=new getXMLHTTPRequest;a.open("POST",e,!0),await oe(e,"POST",t,"formData")&&await h.setItem("sourceSent",1)}catch(i){v("makeHTTPRequest",i),E("Issue with makeHTTPRequest ",i)}}async function pl(){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth"),fetch("https://utility.buyhatke.com/updateVersion.php?ext_id="+u.ext_id+"&ext_auth="+u.ext_auth+"&version="+chrome.runtime.getManifest().version).then(function(e){if(e.status>=400&&e.status<=599)throw new Error("status: "+e.status);return e.json()}).then(function(e){e.success==!0&&e.ext_id==u.ext_id&&fetch(e.url).then(function(t){return t.text()}).then(function(t){})}).catch(e=>{v("uodateExtensionManifestAnalytics",e)})}catch(e){v("uodateExtensionManifestAnalytics",e),E("Issue with makeHTTPRequest ",e)}}setInterval(function(){pl()},2*3600*1e3);function hi(){var e=kt[0]+kt[2]+kt[3]+kt[1]+"."+kt[9]+kt[4]+kt[7]+kt[9]+kt[6]+kt[8];chrome.tabs.query({},function(t){for(var a=0;a<t.length;a++)Un(t[a].url),dl(t[a].url)?ul(t[a].url):t[a].url.split("myntra").length>1||t[a].url.split(e).length>1||hl(t[a].url)})}hi();chrome.tabs.onCreated.addListener(function(e){hi()});chrome.tabs.onUpdated.addListener(function(e){hi()});var Hn="";async function yl(e,t){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var a="https://compare.buyhatke.com/extension/getCoupons.php",i="ext_id="+u.ext_id+"&auth_val="+u.ext_auth+"&pos="+e,s=await oe(a,"POST",i,"formData");s&&chrome.tabs.sendMessage(t,{coupons:s})}catch(r){v("getCoupons",r),E("Error getCoupons ",r)}}async function wl(e,t){try{let r=e.split("~*~*");switch(e=r[0],r[1]){case"0":var a="https://compare.buyhatke.com/dealsAPI/pidToList.php";break;case"1":var a="https://compare.buyhatke.com/dealsAPI/pidToListAmaz.php";break;case"2":var a="https://compare.buyhatke.com/dealsAPI/pidToListSnap.php";break;case"3":var a="https://compare.buyhatke.com/dealsAPI/pidToListMyn.php";break;case"4":var a="https://compare.buyhatke.com/dealsAPI/pidToListJab.php";break;default:var a="https://compare.buyhatke.com/dealsAPI/pidToList.php";break}u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var i="ext_id="+u.ext_id+"&auth_val="+u.ext_auth+"&pid="+e,s=await oe(a,"POST",i,"formData");s&&chrome.tabs.sendMessage(t,{deals:s})}catch(r){v("getDeals",r),E("Error getDeals ",r)}}async function Da(){await da()}Da();setTimeout(async()=>{await Da()},1e3*10800);async function Vn(){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var e="https://t.buyhatke.com/dynamicExt/offersNew.txt?rand="+Math.floor(Math.random()*1e4+1),t="ext_id="+u.ext_id+"&auth_val="+u.ext_auth,a=await oe(e,"GET",t,"formData");a!=""&&(vc=JSON.parse(a))}catch(i){v("checkStatusPushDeals",i),E("Error checkStatusPushDeals ",i)}}Vn();setTimeout(async()=>{await Vn()},1e3*1200);async function ml(){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var e="https://t.buyhatke.com/dynamicExt/offers.txt?rand="+Math.floor(Math.random()*1e4+1),t="ext_id="+u.ext_id+"&auth_val="+u.ext_auth,a=await oe(e,"GET",t,"formData");a!=""&&(er=JSON.parse(a))}catch(i){v("checkStatusURLDeals",i),E("Error checkStatusURLDeals ",i)}}setTimeout(async()=>{await ml()},1e3*1200);function bl(){let t=parseInt(new Date().getTime()/1e3);return t-t%900}async function Kn(){try{hr={};var e="https://search-new.bitbns.com/extension/configs-ext/prod/OC_newest.json?rand="+bl(),t=await oe(e,"GET",{},"formData");if(t!==""){Xe=JSON.parse(t);let a=Object.keys(Xe),i=Math.floor(Date.now()/1e3);for(let s=0;s<a.length;s++){let r=a[s],c=Xe[r];for(let l=0;l<c.length;l++){let d=c[l];if(d.start-i<900&&d.end>i){hr[r]=1;break}}}}}catch(a){v("checkOffersLiveURL",a),E("Error checkOffersLiveURL ",a)}}Kn();setInterval(async()=>{await Kn()},1e3*900);async function Il(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var t="https://compare.buyhatke.com/wishlist3/api/fetchWLData.php",a="ext_id="+u.ext_id+"&auth_val="+u.ext_auth,i=await oe(t,"GET",a,"formData");i!=""&&await h.setItem("mywishlist",i)}catch(s){v("callWishList",s),E("Error callWishList ",ee)}}setTimeout(async()=>{},1e3*3600*24);let rn={};function qr(e){const t={},a=e.split("?")[1];if(a){const i=a.split("&");for(const s of i){const[r,c]=s.split("=");t[r]=c}}return t}async function xl(){let e="";try{u.ext_id=await h.getItem("ext_id");let a="";if(typeof u.ext_id>"u"||u.ext_id=="undefined"||u.ext_id==""||parseFloat(u.ext_id)==0||u.ext_id==0||isNaN(parseInt(u.ext_id))||Object.keys(u.ext_id).length==0){if(typeof u.ext_id>"u"||parseFloat(u.ext_id)==0||isNaN(parseInt(u.ext_id))||u.ext_id==0||Object.keys(u.ext_id).length==0){var t="https://compare.buyhatke.com/extensionRegister.php?isNew=3";a="ExtensionInstalled"}else{var t="https://compare.buyhatke.com/extensionRegister.php?isNew=0";a="ExtensionInstalled"}let i=await fetch(t);if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);if(i=await i.text(),e=i.split("~"),e.length>1&&!isNaN(parseInt(e[0]))&&!isNaN(parseInt(e[1]))){await h.setItem("ext_id",e[0]),await h.setItem("ext_auth",e[1]);try{a&&await Fe(a,{})}catch{}nn=0;let s=0;chrome.windows.getAll({populate:!0},function(r){r.forEach(async function(c){c.tabs.forEach(async function(l){let d=l.url.toString();if(d.split("chromewebstore.google.com").length>1||d.includes("chrome.google.com")&&d.includes("ojplmecpdpgccookcobabopnaifgidhf")||d.includes("gdgnlfdenkmjcfgjpnookbglpndleahm")||d.includes("id6476868488")){let o=qr(d),f=o.utm_source,p=o.utm_medium;await Qa(f,p),s=1}})})}),s==0&&Qa("","",s)}}else if(u.ext_id&&u.ext_id.toString().length>15){var t="https://compare.buyhatke.com/extensionRegister.php?isNew=3";a="ExtensionIDUpdated";let s=await fetch(t);if(s.status>=400&&s.status<=599)throw new Error("status: "+s.status);if(s=await s.text(),e=s.split("~"),e.length>1&&!isNaN(parseInt(e[0]))&&!isNaN(parseInt(e[1]))){await h.setItem("ext_id",e[0]),await h.setItem("ext_auth",e[1]);try{a&&await Fe(a,{})}catch{}nn=0;let r=0;chrome.windows.getAll({populate:!0},function(c){c.forEach(async function(l){l.tabs.forEach(async function(d){let o=d.url.toString();if(o.split("chromewebstore.google.com").length>1||o.split("chrome.google.com").length>1&&o.split("ojplmecpdpgccookcobabopnaifgidhf").length>1||o.includes("gdgnlfdenkmjcfgjpnookbglpndleahm")||o.includes("id6476868488")){let f=qr(o),p=f.utm_source,w=f.utm_medium;await Qa(p,w),r=1}})})}),r==0&&Qa("","",r)}}}catch(a){v("getExtId",a),E("Error in getExtId ",a)}}async function kl(){try{let e=await chrome.storage.sync.get("contextId");if(e=e.contextId,!e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let a="";for(let i=0;i<10;i++){const s=Math.floor(Math.random()*t.length);a+=t[s]}chrome.storage.sync.set({contextId:a})}}catch{}}chrome.runtime.onInstalled.addListener(async e=>{if(E({details:e}),!(e.reason!=="install"&&e.reason!=="update")){if(await xl(),e&&e.reason=="update"&&e.previousVersion){let t=chrome.runtime.getManifest().version;if(t&&t.trim()!=e.previousVersion.trim())try{await Fe("ExtensionUpdate",{})}catch{}}if(kl(),u.first=await h.getItem("first"),(!u.first||Object.keys(u.first).length==0)&&e.reason==="install")try{chrome.tabs.query({},async t=>{let a="";for(const s of t){const r=s.url||"";if(r.includes("ojplmecpdpgccookcobabopnaifgidhf")||r.includes("gdgnlfdenkmjcfgjpnookbglpndleahm")||r.includes("id6476868488")){const c=qr(r);c&&c.utm_source&&(a=c.utm_source);break}}let i="https://buyhatke.com/getting-started";if(a)try{const r=await(await fetch(`https://search-new.bitbns.com/buyhatke/gettingStarted?source=${encodeURIComponent(a)}`)).json();r&&r.url&&(i=r.url)}catch(s){E(s)}chrome.tabs.create({url:i,active:!0}),await h.setItem("first","true")})}catch(t){E(t)}}});var nn=0,nr=[];async function Gn(){try{let e=await h.getItem("paNotifsLinkArr");const t=Array.isArray(e)?e:[];nr.push(...t)}catch(e){E(e)}}Gn();async function _l(e){try{return new Promise(t=>{chrome.tabs.create({url:e,active:!0},function(a){chrome.windows.update(a.windowId,{focused:!0},function(){t()})})})}catch(t){E(t)}}async function vl(e){try{await Gn();for(let a=0;a<nr.length;a++)nr[a].notfID==e&&await _l(nr[a].URL);if(ua[e]!==void 0){var t=ua[e].listeners.onClicked;ct.destroyNotification(e,t())}chrome.notifications.clear(e,function(){}),await Fe("pushNotiClicked")}catch(a){E(a)}}async function sn(e,t,a,i,s,r){u.pushNotStore=await h.getItem("pushNotStore"),u.pushNotStore!=null&&u.pushNotStore!=""&&(za=JSON.parse(u.pushNotStore)),za.push({notfID:s,URL:i,image:e,title:t,detail:a,type:r}),Za=JSON.stringify(za),u.pushNotStore=Za,await h.setItem("pushNotStore",Za),za=[],Za=""}var ua={};async function fi(){try{let e=await h.getItem("verifiedExt"),t=await h.getItem("ext_email");if(u.saleMonitor=await h.getItem("saleMonitor"),u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth"),e==1)return nt&&(clearInterval(nt),nt=null),!0;if(t&&e==0){let a=await h.getItem("timeEmailAdded"),i=parseInt(new Date().getTime()/1e3);if(!a||a==""||typeof a=="object"||i-a>3600){await h.setItem("ext_email",""),nt&&(clearInterval(nt),nt=null);return}const s="https://compare.buyhatke.com/extension/checkEmailVerified.php",r="ext_id="+u.ext_id+"&auth_val="+u.ext_auth,c=await oe(s,"POST",r,"formData");if(c)return await h.setItem("ext_email",c),await h.setItem("verifiedExt",1),await h.setItem("isVerified",1),da(),nt&&(clearInterval(nt),nt=null),!0}return!1}catch(e){return v("checkEmailVerified",e),E("Error checkEmailVerified ",e),!1}}fi();nt=setInterval(async()=>{await fi()&&nt&&(clearInterval(nt),nt=null)},1e3*60*5);async function Ol(){Ia=0,Rt&&(clearInterval(Rt),Rt=null),Rt=setInterval(async()=>{if(Ia++,await fi()){clearInterval(Rt),Rt=null,Ia=0,nt&&(clearInterval(nt),nt=null);return}Ia>=Ac&&(clearInterval(Rt),Rt=null,Ia=0)},1e3*60)}async function Al(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var t="https://compare.buyhatke.com/extension/addSavings.php",a="ext_id="+u.ext_id+"&auth_val="+u.ext_auth+"&savings="+e;await oe(t,"POST",a,"formData")}catch(i){v("sendSavings",i),E("Error sendSavings ",i)}}async function El(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var e="https://api.buyhatke.com/compare/extension/getLink4.php",t="ext_id="+u.ext_id+"&auth_val="+u.ext_auth;if(await oe(e,"POST",t,"formData")){let s=await oe(e,"GET",t)}}catch(a){v("openLink",a),E("Error openLink ",a)}}async function Dl(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var t="https://compare.buyhatke.com/options/listHere.php";if(e!=""&&typeof e<"u"){var a="ext_id="+u.ext_id+"&auth_val="+u.ext_auth+"&fullList="+e;await oe(t,"POST",a,"formData")}}catch(i){v("sendToServerList",i),E("Error sendToServerList ",i)}}async function Wn(e){try{u.listNotIDs=await h.getItem("listNotIDs");var t=e;if(typeof t[0].nothing!=null&&typeof t[0].nothing<"u"&&t[0].nothing!=null&&t[0].nothing!="null"){a=0;return}else if(typeof t[0].verifiedExt!=null&&typeof t[0].verifiedExt<"u")await h.setItem("verifiedExt",t[0].verifiedExt),da();else if(typeof t[0].prod!=null&&typeof t[0].prod<"u"){var a=1;if(typeof t[0].notID!=null&&(u.listNotIDs&&typeof u.listNotIDs=="string"&&u.listNotIDs.split(t[0].notID).length>1?a=0:(typeof t[0].notID<"u"&&await h.setItem("listNotIDs",u.listNotIDs+"-"+t[0].notID),a=1)),a==1){let i="Rs.";t[0].pos&&(t[0].pos==6326||t[0].pos==6304||t[0].pos==6514||t[0].pos==6306||t[0].pos==1321||t[0].pos==6305||t[0].pos==8958||t[0].pos==6103||t[0].pos==8959||t[0].pos==6307||t[0].pos==8960||t[0].pos==8961||t[0].pos==8962||t[0].pos==8970||t[0].pos==8968||t[0].pos==8971||t[0].pos==6310||t[0].pos==8967||t[0].pos==8969||t[0].pos==8963||t[0].pos==8980)?i="$":t[0].pos&&t[0].pos==8965?i="":t[0].pos&&t[0].pos==8976?i="AED":t[0].currSymbol&&(i=t[0].currSymbol),await Fe("priceAlertNotiReceived"),ct.notifyPAImage(t[0].image,t[0].prod+" Price Drop Alert","Price dropped by "+i+" "+t[0].diff+". It is now available at "+i+" "+t[0].cur_price+". Click me to grab the DEAL !",t[0].link,"priceAlertPush"),await sn(t[0].image,t[0].prod+"Price Drop Alert","Price dropped by "+i+" "+t[0].diff+". It is now available at "+i+" "+t[0].cur_price+". Click me to grab the DEAL !",t[0].link,t[0].notID,1)}}else{var a=1;if(typeof t[0].notID!=null&&(u.listNotIDs&&typeof u.listNotIDs=="string"&&u.listNotIDs.split(t[0].notID).length>1?a=0:(typeof t[0].notID<"u"&&await h.setItem("listNotIDs",u.listNotIDs+"-"+t[0].notID),a=1)),a==1){if(typeof t[0].luckyWinner!=null&&typeof t[0].luckyWinner<"u")if(!t[0].expiry||t[0].expiry>Math.floor(Date.now()/1e3)){ht("pushLucky"+t[0].notID),ct.notifyPAImage(t[0].smallIcon,t[0].title,t[0].desc,t[0].link,"pushLucky"+t[0].notID);return}else ht("pushLucky-Expired"+t[0].notID);else t[0].smallIcon!=null&&t[0].smallIcon!=""?!t[0].expiry||t[0].expiry>Math.floor(Date.now()/1e3)?(ht("pushImageIcon"+t[0].notID),ct.notifyIcon(t[0].smallIcon,t[0].title,t[0].desc,t[0].link,"pushImage"+t[0].notID,"",v,E,h)):ht("pushImageIcon-Expired"+t[0].notID):t[0].image!=null&&t[0].image!=""?!t[0].expiry||t[0].expiry>Math.floor(Date.now()/1e3)?(ht("pushImage"+t[0].notID),ct.notifyImage(t[0].image,t[0].title,t[0].desc,t[0].link,"pushImage"+t[0].notID,v,E,h)):ht("pushImage-Expired"+t[0].notID):(ht("pushNormal"+t[0].notID),ct.notify(t[0].title,t[0].desc,t[0].link,"pushNormal"+t[0].notID,v,E,h));await sn(t[0].image,t[0].title,t[0].desc,t[0].link,t[0].notID,0)}}}catch(i){v("messageRecieved",i),E("Error messageReceived ",i)}}chrome&&chrome.gcm&&chrome.gcm.onMessage.addListener(Wn);self.addEventListener("push",async function(e){try{await Fe("pushNotiReceived");let t=await e.data.json();await Wn(t)}catch(t){E("push event",t)}});self.addEventListener("pushsubscriptionchange",async function(){try{await ct.subscribe()}catch(e){E("pushsubscriptionchange",e)}});async function Nl(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let i=e,s=u.ext_id;var t="https://api.buyhatke.com/paapi/removeStockAlert",a="alert_id="+i+"&ext_id="+s+"&auth_val="+u.ext_auth;let r=await oe(t,"POST",a,"formData");try{await Fe("OOSAlertRemoved",{})}catch{}return r}catch(i){v("removeOOSAlert",i),E("error removeOOSAlert ",i)}}async function Tl(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let i=e,s=u.ext_id;var t="https://api.buyhatke.com/paapi/removeAlert",a="link_id="+i+"&ext_id="+s+"&auth_val="+u.ext_auth;let r=await oe(t,"POST",a,"formData");try{await Fe("PriceAlertRemoved",{})}catch{}return r}catch(i){v("removeWatch",i),E("error removeWatch ",i)}}function jr(e){chrome.tabs.onUpdated.addListener(function(t,a){E("here11 ",a),a.status=="complete"})}async function Ll(e,t,a,i){try{if(u.setTagType=await h.getItem("setTagType"),u.sourceInstall=await h.getItem("sourceInstall"),u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth"),e==18){let s="https://t.buyhatke.com/Navigation/?tagType="+u.setTagType+"&pos=63&source="+u.sourceInstall+"&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("http://www.amazon.in/");chrome.tabs.create({url:s},function(r){var c=r.id;jr(c)})}else if(a=="nothing"){let s="https://t.buyhatke.com/Navigation/?pos="+e+"&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("https://"+t);chrome.tabs.create({url:s},function(r){var c=r.id;jr(c)})}else{let s="https://t.buyhatke.com/Navigation/?pos="+e+"&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent(t)+"&flag="+a;chrome.tabs.create({url:s},function(r){var c=r.id;jr(c)})}chrome.tabs.update(parseInt(i),{selected:!0}),Pl(e)}catch(s){v("getAffCoupons",s),E("Error ",s)}}async function Pl(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var t="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/getAutoCoupons.php",a="ext_id="+u.ext_id+"&auth_val="+u.ext_auth+"&flag=1&pos="+e;await oe(t,"POST",a,"formData")}catch(i){v("getAddCouponsData",i),E("error getAddCouponsData ",i)}}async function Yn(){try{await h.setItem("refreshedYetServer",0)}catch(e){v("getRefresh",e),E("Error in getRefresh ",e)}}Yn();setTimeout(async()=>{await Yn()},1e3*900);function Rl(){ct.notifyPAImage("https://s3-ap-southeast-1.amazonaws.com/push-images/autocoupons-winner-notify.png","You have done it ","Yippeee!! Congrats! you have successfully booked your new phone at Amazon Flash Sale via Buyhatke. Tap to rate us and share your review","http://bit.ly/2sjz41k","pushLucky30012319926"),ht("pushImageIconFlashSaleDyn-63")}let gl=56,ze;try{ze=browser}catch{ze=chrome}let Ft=0,Jt="",ea="",Vt=0;async function Ml(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let t=`https://search-new.bitbns.com/autocoupon-apis/getCoupons?siteId=${e.pos}`;e.cat&&(t+=`&category=${e.cat}`);let a=await fetch(t);if(a.status>=400&&a.status<=599)throw new Error("status: "+a.status);let i=await a.json();if(i.status==0)throw new Error("cannot get coupons");return i.data}catch(t){return v("getCouponsList",t),[]}}async function Sl(e){try{const t=await h.getItem("ext_id");if(!t)throw new Error("ext_id not found in chromeStorage");const a="https://ext1.buyhatke.com/extension-apis/analytics/track/Auto_Coupon/logs",i={ext_id:t,pos:e.pos,stage:"process_started"},s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(s.status>=400&&s.status<=599)throw new Error(`HTTP error: ${s.status}`);const r=await s.json();if(r.status===0)throw new Error(r.error||"Failed to get process_started id");return r.id}catch(t){return v("getACAnalyticsId",t),null}}async function Fl(e,t){try{t=="iOS"||t=="Android"?t="mobile":t="extension";let a=new Date,i=new Date(a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()).getTime(),r=`https://search-new.bitbns.com/buyhatke/get-config?version=${await h.getItem("version")}&type=configs-coupons&pos=${e}&deviceType=${t}&&rand=${i}`,c=await fetch(r);return c.status>=400&&c.status<599?[]:(c=await c.json(),c)}catch(a){return v("getConfig",a),[]}}async function Jl(){try{let e=new Date,a=`https://search-new.bitbns.com/extension/configs-coupons/prod/bankPosConfig.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(a);return i.status>=400&&i.status<599?[]:(i=await i.json(),i)}catch(e){return v("getConfig",e),[]}}async function jl(){try{let e=new Date,a=`https://search-new.bitbns.com/extension/configs-coupons/prod/turkFlagCurrencies.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(a);return i.status>=400&&i.status<599?[]:(i=await i.json(),i)}catch(e){return v("getConfig",e),[]}}async function Bl(e){try{if(tr[e])return tr[e];let t=new Date,a=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()).getTime(),i=`https://search-new.bitbns.com/extension/savings-config/prod/${e}.json?rand=${a}`,s=await fetch(i);return s.status>=400&&s.status<599?"":(s=await s.json(),tr[e]=s,s)}catch(t){return v("getCartConfig",t),""}}async function zn(){try{let e=new Date,a=`https://search-new.bitbns.com/extension/savings-config/prodSiteList/savingSites.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(a);if(i.status>=400&&i.status<599)return!1;i=await i.json();let s=Object.keys(i);for(let r=0;r<s.length;r++)fr[s[r]]=i[s[r]]}catch(e){return v("checkCartConfigExistence",e),!1}}zn();setInterval(function(){tr={},fr={},zn()},8*3600*1e3);async function cn(e){try{return fr[e]!==void 0?fr[e]:!1}catch(t){return v("checkSavingSites",t),!1}}async function Ul(e){try{let t=new Date,a=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()).getTime(),i=`https://search-new.bitbns.com/extension/configs-ext/prod/${e}.json?rand=${a}`,s=await fetch(i);return s.status>=400&&s.status<599?"":(s=await s.json(),s)}catch(t){return v("getScrapConfig",t),""}}let sr={};async function pi(){try{let e=new Date,a=`https://search-new.bitbns.com/extension/configs-ext/prod/spidyGlobalCountries.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(a);if(i.status>=400&&i.status<599)return"";i=await i.json(),sr=i}catch(e){return v("getScrapConfig",e),""}}pi();setInterval(async()=>{await pi},6*60*60*1e3);let Br=new Map;async function $l(e){try{if(![63,111,2,2191].includes(e))return"";if(Br.has(e))return Br.get(e);let t=new Date,a=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()).getTime(),i=`https://search-new.bitbns.com/extension/config-t/${e}.json?rand=${a}`,s=await fetch(i);return s.status>=400&&s.status<599?"":(s=await s.json(),Br.set(e,s),s)}catch(t){return v("getScrapConfig",t),""}}async function Hl(e){try{let t=e;t=t.split("?")[0];for(let a in Zn)if(new RegExp(a).test(t))return 1;return 0}catch{return 0}}let Zn={};async function Xn(){try{let e=new Date,a=`https://search-new.bitbns.com/extension/configs-coupons/prod/untrustedList.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}&r=12`,i=await fetch(a);if(i.status>=400&&i.status<599)return"";Zn=await i.json()}catch(e){return v("getUntrustedConfig",e),""}}Xn();setInterval(()=>{Xn()},12*60*60*1e3);async function Vl(e){var t;try{const a=`flightToken:${e.link}`,i=30*60*1e3,r=(await chrome.storage.local.get(a))[a];if(r){if(Date.now()-r.timestamp<i)return r.token;await chrome.storage.local.remove(a)}let l=await fetch("https://ext1.buyhatke.com/extension-apis-test/travel-apis/create-generic",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});if(!l.ok)return"";const d=await l.json();if((t=d.data)!=null&&t.sessionToken){const o={token:d.data.sessionToken,timestamp:Date.now()};return await chrome.storage.local.set({[a]:o}),d.data.sessionToken}return""}catch{return""}}async function Kl(e){try{let i=await fetch("https://ext1.buyhatke.com/extension-apis-test/travel-apis/poll-ext",{method:"POST",body:JSON.stringify({sessionToken:e}),headers:{"Content-Type":"application/json"}});if(i.status>=400&&i.status<599)return"";return i=await i.json(),i.data;return""}catch{return""}}async function Gl(){try{let e=new Date,a=`https://search-new.bitbns.com/extension/configs-ext/prod/turkCountries.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(a);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(e){return v("getScrapConfig",e),""}}async function Wl(){try{let e=new Date,a=`https://search-new.bitbns.com/extension/configs-ext/prod/electronicCategories.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(a);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(e){return v("getElectronicProduct",e),""}}async function Yl(){try{let e=new Date,a=`https://search-new.bitbns.com/extension/configs-ext/prod/electronicList.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(a);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(e){return v("getElectronicProduct",e),""}}let _a=[];async function yi(){try{if(_a.length)return _a;let e=new Date,a=`https://search-new.bitbns.com/extension/configs-ext/prod/posForSearchPids.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(a);return i.status>=400&&i.status<599?[]:(_a=await i.json(),_a)}catch(e){return v("getSkuForSearch",e),[]}}setInterval(()=>{_a=[],yi()},24*60*60*1e3);yi();async function Qn(){try{let e=new Date,a=`https://search-new.bitbns.com/extension/configs-ext/prod/countryInfo.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(a);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(e){return v("getScrapConfig",e),""}}let Ua={};async function Cn(){try{let e=new Date,a=`https://search-new.bitbns.com/extension/configs-ext/prod/grocerystoreAPIs.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}&1`,i=await fetch(a);if(i.status>=400&&i.status<599)return"";i=await i.json(),Ua=i}catch(e){return v("getGroceryStoreMap",e),""}}Cn();async function ln(e,t){try{let a=`https://search-new.bitbns.com/buyhatke/getDittoSearchNew?pos=${t}&pid=${e}`,i=await fetch(a);return i.status>=400&&i.status<599?"":(i=await i.json(),i=await Ba(i),i)}catch(a){return v("getDittoSearchData",a),""}}async function zl(e,t){try{let a=`https://search-new.bitbns.com/buyhatke/comparePrice?PID=${e}&pos=${t}&trst=1`,i=await fetch(a);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(a){return v("getDittoSearchData",a),""}}let ot="",Ir="",xr="",kr="",ei=[],pr="",ti="",ai="",qn="",es="",ts="",as=0,rs=[],is=[];async function fa(){try{let e=new Date,a=`https://search-new.bitbns.com/extension/configs-ext/prod/sd.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(a);return i.status>=400&&i.status<599?"":(i=await i.json(),ot=i.d,Ir=i.c,xr=i.h,kr=i.g,ei=i.r,pr=i.a,ti=i.e,ai=i.f,qn=i.j,es=i.k,ts=i.i,as=i.l,rs=i.m||[],is=i.n||[],i)}catch{return""}}async function Zl(e,t){try{let a=`https://search-new.bitbns.com/buyhatke/getDittoSearchNewGlobal?pos=${t}&pid=${e}`,i=await fetch(a);return i.status>=400&&i.status<599?"":(i=await i.json(),i=await Ba(i),i)}catch(a){return v("getDittoSearchNewGlobal",a),""}}function k(e,t,a=!1){let i=e;if(typeof t=="object"){for(let s of t){let r=i;try{let c=s.split(".");a&&(c=s.split("~"));for(let l of c)r=r[l];if(r)return r}catch{}}throw new Error("Couldn't extract path !!")}else{let s=t.split(".");a&&(s=t.split("~"));for(let r of s)i=i[r];return i}}async function Xl(e){var t;try{let a;if(ir)a=ir;else{let f=new Date,w=`https://search-new.bitbns.com/extension/configs-spendCalc/prodNew/liveSpendConfig.json?rand=${new Date(f.getFullYear()+"/"+(f.getMonth()+1)+"/"+f.getDate()).getTime()}`;if(a=await fetch(w),a.status>=400&&a.status<599)return"";a=await a.json(),ir=a}let i=a.spendPanelURL||"",s=a.currencyMap[e]||"",r=a.liveSites[e]||[],c=a.mobileLiveSites[e]||[],l=!!(a.autoSyncEnabled&&a.autoSyncEnabled[e]),d=(((t=a==null?void 0:a.multiPos)==null?void 0:t[e])||[]).map(f=>{var p;return{pos:f,currency:((p=a==null?void 0:a.currencyMap)==null?void 0:p[f])||""}}),o=(a==null?void 0:a.amazonLivesites)||[];return{spendLiveURLArr:r,spendPanelURL:i,spendCurrency:s,autoSyncEnabled:l,amazonLivesites:o,multiPos:d,mobileSpendLiveURLArr:c}}catch(a){v("checkIfSpendLive",a)}return{spendLiveURLArr:[],spendPanelURL:"",spendCurrency:"",autoSyncEnabled:!1}}function bt(e){const t=new Date(e),a=t.getFullYear(),i=t.getMonth(),s=Math.floor(i/3);return`${a}_${s}`}async function La(e,t){return new Promise((a,i)=>{chrome.tabs.sendMessage(e,t,s=>{chrome.runtime.lastError?i(new Error(chrome.runtime.lastError.message)):a(s)})})}function la(e,t,a,i){var p;let s={},r={},c;if(!e.addressDetails)return s;const l=(w,x)=>{try{const m=x.split(".");let y=w;for(let b=0;b<m.length-1;b++){if(!y[m[b]])return;y=y[m[b]]}delete y[m[m.length-1]]}catch{g("ERROR_DELTEPATH_FORMATADDDETAILS",i)}};function d(w){try{let x="";w!=null&&w.flatNo&&(x+=(w==null?void 0:w.flatNo)+", ",delete w.flatNo),w!=null&&w.addressLine1&&(x+=(w==null?void 0:w.addressLine1)+", ",delete w.addressLine1),w!=null&&w.addressLine2&&(x+=(w==null?void 0:w.addressLine2)+", ",delete w.addressLine2),w!=null&&w.addressLine3&&(x+=(w==null?void 0:w.addressLine3)+", ",delete w.addressLine3),x=x.replace(/, $/,""),w.addressLine=x}catch{g("ERROR_PROCESSADDLINES_FORMATADDDETAILS",i)}}function o(w){let x="";w.firstName&&(x+=w.firstName+" ",delete w.firstName),w.lastName&&(x+=w.lastName,delete w.lastName),w.name=x}try{for(let w of e.addressDetails){let x=k(t,w.value);if(e.addressPath){c=k(t,e.addressPath)||[];for(let m of c)m.types.includes(w.value)&&(x=m[e.addPathList[w.value]])}x!=null&&x!==""&&(s[w.key]=x,l(t,w.value))}(s.addressLine1||s.addressLine2||s.addressLine3)&&d(s),(s.firstName||s.lastName)&&o(s)}catch(w){g(`ERROR_${JSON.stringify(w)}_ADDDETAILS_FORMATADDDETAILS`,i)}if(e.addressJSON)try{for(let w of e.addressJSON){let x=k(t,w.value);x!=null&&x!==""&&(r[w.key]=x)}}catch(w){g(`ERROR_${JSON.stringify(w)}_ADDJSON_FORMATADDDETAILS`,i)}return!Object.keys(r).length&&(e!=null&&e.addressDetails)&&((p=e==null?void 0:e.addressDetails)==null?void 0:p.empty)==="empty"&&(r.address=t),{addressJSON:r,...s}}async function on(e,t,a,i,s,r,c={},l,d){var o,f,p,w,x,m,y,b,I,O,L,F;try{let j,D=t.dataExtractor.orderApi,R=D.url,$=Object.assign({},D.options)||{};if(t.localStorageKeys)for(let _ in t.localStorageKeys){let S=s[_];S&&($.headers=JSON.parse(JSON.stringify($.headers).replace(t.localStorageKeys[_],S)))}if(D!=null&&D.useCookie){let _;typeof(D==null?void 0:D.useCookie)=="object"?_=l.split("; ").filter(S=>S.startsWith(`${D.useCookie.mainKey}=`))[0].split("=")[1]:_=l.split("; ").filter(S=>S.startsWith(`${D.useCookie}=`))[0].split("=")[1];try{_=decodeURIComponent(_)}catch{_=_}try{let S=JSON.parse(_);_=k(S,(o=D==null?void 0:D.useCookie)==null?void 0:o.jsonPath)}catch{_=_}$.headers=($==null?void 0:$.headers)&&JSON.parse(JSON.stringify($.headers).replace("PLACEHOLDER2",_))}if($.body)for(let _ in a)$.body=$.body.replace(_,a[_]);if(t.dataFromDom)for(let _ in t.dataFromDom)try{let S=d[_];S&&($.headers=JSON.parse(JSON.stringify($.headers).replace(t.dataFromDom[_].placeholder,S)),R=R.replace(t.dataFromDom[_].placeholder,S))}catch{}if(a)for(let _ in a)a[_]&&((p=(f=t==null?void 0:t.dataExtractor)==null?void 0:f.orderApi)!=null&&p.ParamEncode)&&(a[_]=encodeURIComponent(a[_])),R=R.replace(_,a[_]);let Y;try{if(Y=await lt(e,R,$),Y.status>=300)throw new Error("Some error in API")}catch{}let M=await Y.text(),N=(w=D==null?void 0:D.script)!=null&&w.splitForJSON?M.split(D.script.splitForJSON)[1]:M,B;try{B=(x=D==null?void 0:D.script)!=null&&x.splitForJSON?JSON.parse(N.split("};")[0]+"}"):JSON.parse(M)}catch{try{let S=0,U=-1;for(let re in N){re=parseInt(re);let ue=N[re];if(ue=="{")S++;else if(ue=="}"&&(S--,S==0)){U=re+1;break}}U==-1&&(U=N.length),N=N.substring(N.indexOf("{"),U),N=JSON.parse(N),D!=null&&D.checkVal&&(B=k(N,D==null?void 0:D.checkVal))}catch{}}j=D!=null&&D.orderStatus?k(B,D==null?void 0:D.orderStatus):j;let W=(m=D==null?void 0:D.script)!=null&&m.jsonPath?k(B,(y=D==null?void 0:D.script)==null?void 0:y.jsonPath):(b=D==null?void 0:D.pidAttributes)!=null&&b.pidList?k(B,(I=D==null?void 0:D.pidAttributes)==null?void 0:I.pidList):B,se=((O=D==null?void 0:D.script)==null?void 0:O.discountPath)&&k(B,D.script.discountPath);if(D!=null&&D.pidPath){let _=k(B,D.pidPath)||B;if(_&&typeof _=="object")for(let S in _)try{c[S]=_[S]}catch{g(`ERROR_${S}_ORDERSCRIPT_ORDERDETAILS`,e)}}if(D!=null&&D.orderDetails)for(let _ of D.orderDetails)try{r[_.key]=k(B,_.value)}catch{g(`ERROR_${_==null?void 0:_.key}_ORDERSCRIPT_ORDERDETAILS`,e)}let fe=0;try{for(let _ in W)try{for(let S of D.pidAttributes.itemDetails){let U=S!=="same"?k(W[_],S):W[_],re={},ue=D.pidAttributes.itemAtt;for(let q in ue)try{for(let le in U){if(q=="price"){let Oe=Array.isArray(U)?parseFloat(k(U[le],ue[q]).replace(",","")):parseFloat(typeof k(U,ue[q])=="string"?k(U,ue[q]).replace(",",""):k(U,ue[q]));S!=="returnRequests"&&S!=="same"&&(fe+=Oe),re[q]=Oe}if(q=="pid")if(typeof ue[q]!="string")for(let Oe of ue[q])try{let ce=Array.isArray(U)?k(U[le],Oe):k(U,Oe);if(ce){re[q]=ce;break}}catch{g(`ERROR_${Oe}_ORDERSCRIPT_PIDARR`,e)}else re[q]=Array.isArray(U)?k(U[le],ue[q]):k(U,ue[q]);else re[q]=Array.isArray(U)?k(U[le],ue[q]):k(U,ue[q])}}catch{g(`ERROR_${q}_ORDERSCRIPT_PIDARR`,e)}i.push(re)}}catch{g("ERROR_ORDERSCRIPTPIDARR",e)}if((L=D==null?void 0:D.pidAttributes)!=null&&L.discounts)for(let _ of(F=D==null?void 0:D.pidAttributes)==null?void 0:F.discounts)try{fe-=k(se,_)}catch{g("ERROR_ORDERSCRIPT_DISCOUNTS",e)}}catch{g("ERROR_PIDARR",e)}return{orderTotal:(fe<0?0:fe)||0,orderStatus:j}}catch(j){return g(JSON.stringify(j),e),{orderTotal:0,orderStatus:""}}}function Ql(e,t,a){try{let i=[],s={};for(let c in e){let l=e[c],d=null;try{for(let o=0;o<a.length;o++){let f=a[o];if(f&&l){let p;try{p=k(f,l)}catch{p=void 0}if(p!=null){d=p;break}}}s[c]=d}catch{g(`ERROR_${c}_EXTANDGRPATTR`,sitePos)}}let r=s?Math.max(...Object.values(s).map(c=>c?c.length:0)):0;for(let c=0;c<r;c++){let l={};try{for(let d in t){let o=t[d],f=Object.keys(e).find(p=>e[p]===e[d]);s[f]&&s[f][c]?l[d]=k(s[f][c],o):l[d]=void 0}i.push(l)}catch{g("ERROR_MAXLEN_EXTANDGRPATTR",sitePos)}}return i}catch(i){g(`ERROR_${JSON.stringify(i)}_EXTANDGRPATTR`,sitePos)}}function Cl(e,t,a,i){try{let s=new RegExp(t.slice(1,-1)),r=e.match(s);if(r){let[,c,l,d]=r;a!=null&&a.dateOrder&&([,l,c,d]=r);let o={"01":"01","02":"02","03":"03","04":"04","05":"05","06":"06","07":"07","08":"08","09":"09",10:"10",11:"11",12:"12",Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12",Ocak:"01",ubat:"02",Mart:"03",Nisan:"04",Mays:"05",Haziran:"06",Temmuz:"07",Austos:"08",Eyll:"09",Ekim:"10",Kasm:"11",Aralk:"12"};return a!=null&&a.isYearFirstInDate&&([,d,l,c]=r),l.length<2&&(l=l.padStart(2,"0")),c.length<2?`${d}-${o[l]}-${c.padStart(2,"0")}`:`${d}-${o[l]}-${c}`}else return null}catch(s){return g(`${JSON.stringify(s)}_FORMATDATE`,i),null}}async function ql(e,t,a,i){var s,r,c,l,d,o,f,p,w,x,m;try{let y=[],b={moreOrdersAvailable:k(t,(s=a==null?void 0:a.paginationFields)==null?void 0:s.moreOrdersAvailable),pageOffset:k(t,(r=a==null?void 0:a.paginationFields)==null?void 0:r.pageOffset),prevOrders:k(t,(c=a==null?void 0:a.paginationFields)==null?void 0:c.prevOrders),nextPageUrl:k(t,(l=a==null?void 0:a.paginationFields)==null?void 0:l.nextPageUrl)};const I=R=>{let $=R==null?void 0:R.match(/\/detail\/(\d+)\//);return $?$[1]:null},O=R=>typeof R=="string"?R.replace(/[^0-9.]/g,""):R,L=R=>{let $=R==null?void 0:R.match(/\.v=([^&]+)/);return $?$[1]:null},F=R=>{var $,Y,M;for(let N in R)if(N.startsWith("order-")){let B=R[N],W=[],se=Object.values(B).find(_=>{var S;return(S=_==null?void 0:_.d)==null?void 0:S.orderDetailUrl}),fe=I(($=se==null?void 0:se.d)==null?void 0:$.orderDetailUrl);B!=null&&B.c&&Array.isArray(B==null?void 0:B.c)&&((Y=B==null?void 0:B.c)==null||Y.forEach(_=>{var S,U,re,ue,q,le,Oe;try{if((S=B[_])!=null&&S.d){let ce=(U=B[_])==null?void 0:U.d,K=L((re=ce==null?void 0:ce.imageData)==null?void 0:re.src);W.push({itemId:_||"",productName:k(ce,(ue=a==null?void 0:a.processOrdersFields)==null?void 0:ue.productName)||"",quantity:k(ce,(q=a==null?void 0:a.processOrdersFields)==null?void 0:q.quantity)||0,price:O(ce==null?void 0:ce.totalPrice)||0,imageUrl:k(ce,(le=a==null?void 0:a.processOrdersFields)==null?void 0:le.imageUrl)||"",imageVersion:K||"",orderDetailUrl:k(ce,(Oe=a==null?void 0:a.processOrdersFields)==null?void 0:Oe.orderDetailUrl)||"",orderNumber:fe||""})}}catch{g(`ERROR_${_}_FORMATORDERLIST`,i)}})),y.push({orderId:((M=B==null?void 0:B.d)==null?void 0:M.webOrderNumber)||"",orderNumber:fe||"",items:W||[]})}};t!=null&&t.orderList&&F(t==null?void 0:t.orderList);let j=a==null?void 0:a.maxIterations,D=0;for(;D<j&&(b!=null&&b.moreOrdersAvailable);)try{let R=await lt(e,b==null?void 0:b.nextPageUrl,{method:"POST",headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded",modelversion:"v2",syntax:"graviton","x-aos-model-page":"OrdersPage","x-aos-stk":(d=t==null?void 0:t.meta)==null?void 0:d.h["x-aos-stk"],"x-requested-with":"Fetch"},body:new URLSearchParams({"orderList.pageOffset":(b==null?void 0:b.pageOffset)+1,"orderList.prevOrders":b==null?void 0:b.prevOrders,"orderList.lastOrder":(f=(o=t==null?void 0:t.orderList)==null?void 0:o.d)==null?void 0:f.lastOrder}),credentials:"include"});if(!R.ok)break;let $=await R.json();D++,b.moreOrdersAvailable=k($,(p=a==null?void 0:a.nextPaginationFields)==null?void 0:p.moreOrdersAvailable),b.pageOffset=k($,(w=a==null?void 0:a.nextPaginationFields)==null?void 0:w.pageOffset),b.prevOrders=k($,(x=a==null?void 0:a.nextPaginationFields)==null?void 0:x.prevOrders),F((m=$==null?void 0:$.body)==null?void 0:m.orderList)}catch{break}return{orders:y,pagination:b}}catch(y){g(`ERROR_${JSON.stringify(y)}_FORMATORDERLIST`,i)}}function eo(e,t,a){var i,s,r,c,l,d,o,f,p,w,x,m,y,b,I,O,L,F,j,D,R,$;try{let Y=e==null?void 0:e.orderDetail,M=[];try{const N=S=>{var U;if(typeof S=="string"){let re=((U=S.match(/[^0-9.,\s]/))==null?void 0:U[0])||"",ue=parseFloat(S.replace(/[^0-9.]/g,""));return{currencySymbol:re,numericValue:isNaN(ue)?0:ue}}return{currencySymbol:"",numericValue:isNaN(S)?0:S}},B=S=>{let U={January:"01",February:"02",March:"03",April:"04",May:"05",June:"06",July:"07",August:"08",September:"09",October:"10",November:"11",December:"12"};if(!S)return null;let re=S==null?void 0:S.match(/^(\w+)\s+(\d{1,2}),\s+(\d{4})$/),ue=S==null?void 0:S.match(/^(\d{1,2})\s+(\w+)\s+(\d{4})$/);if(re){let[,q,le,Oe]=re,ce=le==null?void 0:le.padStart(2,"0"),K=U[q]||"00";return`${Oe}-${K}-${ce}`}else if(ue){let[,q,le,Oe]=ue,ce=q.padStart(2,"0"),K=U[le]||"00";return`${Oe}-${K}-${ce}`}return S};let W=S=>{let U=S==null?void 0:S.match(/\.v=([^&]+)/);return U?U[1]:null};for(let S in Y==null?void 0:Y.orderItems)if(S.startsWith("orderItem-")){let U=Y==null?void 0:Y.orderItems[S],re=k(U,(i=t==null?void 0:t.orderItemsFields)==null?void 0:i.status)||null,ue=k(U,(s=t==null?void 0:t.orderItemsFields)==null?void 0:s.status2)||null,q=S.replace("orderItem-",""),le=((c=(r=U.shippingInfo)==null?void 0:r["shipping-address"])==null?void 0:c.d)||null,Oe=W(k(U,(l=t==null?void 0:t.orderItemsFields)==null?void 0:l.imageVersion)),ce=N(k(U,(d=t==null?void 0:t.orderItemsFields)==null?void 0:d.priceDetails));M.push({itemId:q,productName:((f=(o=U.orderItemDetails)==null?void 0:o.d)==null?void 0:f.productName)||"",quantity:((w=(p=U.orderItemDetails)==null?void 0:p.d)==null?void 0:w.quantity)||0,price:ce.numericValue||0,currency:ce.currencySymbol||"",image:((y=(m=(x=U.orderItemDetails)==null?void 0:x.d)==null?void 0:m.imageData)==null?void 0:y.src)||"",imageVersion:Oe||"",status:ue||re||"",...le&&{shippingAddress:le}})}let se=N((I=(b=Y==null?void 0:Y.pricingSummary)==null?void 0:b.d)==null?void 0:I.orderTotal),fe=se==null?void 0:se.numericValue;(O=M[0])!=null&&O.status&&(t!=null&&t.invalidStatus.includes((L=M[0])==null?void 0:L.status.trim().toLowerCase()))&&(fe=0);let _=((j=(F=Y.billingInfo)==null?void 0:F["billing-contact-info"])==null?void 0:j.d)||null;return{orderId:k(Y,(D=t==null?void 0:t.orderDetailsFields)==null?void 0:D.orderId)||"",orderDate:B(k(Y,(R=t==null?void 0:t.orderDetailsFields)==null?void 0:R.orderDate,a))||"",orderTotal:fe||0,currency:se.currencySymbol||"",orderStatus:(($=M[0])==null?void 0:$.status)||null,items:M||[],billingInfo:_||null}}catch{return null}}catch(Y){return g(`ERROR_${JSON.stringify(Y)}_FORMATORDERDETAILS`,a),null}}function to(e,t){try{let a=e.indexOf(t);if(a===-1)return null;let i=e.indexOf("{",a);if(i===-1)return null;let s=0,r=i;for(;r<e.length&&(e[r]==="{"?s++:e[r]==="}"&&s--,s!==0);r++);if(s!==0)return null;let c=e.slice(i,r+1);try{return JSON.parse(c)}catch{return{}}}catch{return{}}}async function ao(e,t,a,i,s,r,c,l,d,o=0,f={},p){var w,x,m,y,b,I,O,L,F,j,D,R,$,Y,M,N,B,W,se,fe;try{let _=t.dataExtractor.pidAttributes.pidApi,S=_.url,U,re=Object.assign({},_.options),ue=!1;if(t.localStorageKeys)for(let P in t.localStorageKeys){let A=s[P];if(A){let J=typeof t.localStorageKeys[P]=="object"?(w=t.localStorageKeys[P])==null?void 0:w.value:t.localStorageKeys[P];re.headers=JSON.parse(JSON.stringify(re.headers).replaceAll(J,A)),re.body&&(re.body=JSON.parse(JSON.stringify(re.body).replaceAll(J,A)))}}if(_.useCookie){let P=Array.isArray(_.useCookie)?_.useCookie:[_.useCookie];for(let A of P){let J;if(typeof A=="object")try{A.getHttpSecureCookie?J=await ki(A.getHttpSecureCookie.url,A.getHttpSecureCookie.value):J=f.split("; ").filter(te=>te.startsWith(`${A.mainKey}=`))[0].split("=")[1]}catch{}else J=f.split("; ").filter(te=>te.startsWith(`${A}=`))[0].split("=")[1];try{J=decodeURIComponent(J)}catch{J=J}if(typeof A=="object"&&A.jsonPath)try{let te=JSON.parse(J);J=k(te,A.jsonPath)}catch{J=J}J||g("MISSING_COOKIE",e),typeof A=="object"&&A.replaceWith?re.headers=JSON.parse(JSON.stringify(re.headers).replaceAll(A.replaceWith,J)):re.headers=JSON.parse(JSON.stringify(re.headers).replaceAll("PLACEHOLDER2",J))}}if(a){t.dataExtractor.commonAttributes.condRepl&&t.dataExtractor.commonAttributes.condRepl.group_Id&&(k(a,(x=_==null?void 0:_.checkVal)==null?void 0:x.key)===((m=_==null?void 0:_.checkVal)==null?void 0:m.value)?S=S.replace(_==null?void 0:_.toReplace,_==null?void 0:_.replaceWith[0]):S=S.replace(_==null?void 0:_.toReplace,_==null?void 0:_.replaceWith[1]));for(let P in a)a[P]&&((I=(b=(y=t==null?void 0:t.dataExtractor)==null?void 0:y.pidAttributes)==null?void 0:b.pidApi)!=null&&I.ParamEncode)&&(a[P]=encodeURIComponent(a[P])),S=S.replace(P,a[P])}if(re.body)if(_.replaceAllParams)for(let P in a){const A=new RegExp(P,"g");re.body=re.body.replace(A,a[P])}else for(let P in a)if(P==="APOLLOBILLNUMBER"){let A=a[P]===null?"null":`"${a[P]}"`;re.body=re.body.replace(`"${P}"`,A)}else re.body=re.body.replace(P,a[P]);if(t.dataFromDom)for(let P in t.dataFromDom)try{let A=p[P];A&&(re.headers=JSON.parse(JSON.stringify(re.headers).replace(t.dataFromDom[P].placeholder,A)),S=S.replace(t.dataFromDom[P].placeholder,A))}catch{g("ERROR_SPECPID_DATAFROMDOM",e)}let q;try{if(t.domAPI){let P=await La(o,{action:"callAPIFromDOM",data:{eachUrl:S,eachOptions:re}});if(q=P==null?void 0:P.result,_!=null&&_.script&&((O=_==null?void 0:_.script)!=null&&O.startMarker)&&((L=_==null?void 0:_.script)==null?void 0:L.jsonIndex)!==void 0){q=q==null?void 0:q.result;let A=q.split(`
`),J=A&&A.find(te=>te.trim().startsWith(_.script.startMarker));try{if(J){let te=J.trim().substring(_.script.startMarker.length).trim();U=JSON.parse(te)[_.script.jsonIndex].pidApi.script.jsonData}}catch{g("ERROR_SPECPID_DOMAPI_TGTLINE",e)}}else q=JSON.parse(q==null?void 0:q.result),q!=null&&q.data&&(q=q==null?void 0:q.data),U=q||{}}else{q=await lt(e,S,re);let P=q.headers&&q.headers.get("content-type");if((F=t==null?void 0:t.script)!=null&&F.name&&P&&P.includes("text/html")){let A=await q.text(),J=new RegExp(`<script id="${(j=t==null?void 0:t.script)==null?void 0:j.name}"[^>]*>([\\s\\S]*?)<\\/script>`,"i"),te=A.match(J);if(te&&te[1])try{const H=JSON.parse(te[1]);U=eo(H,t,st,e)}catch{g("ERROR_SCRIPTREG_SPECPID",e)}}else if(_!=null&&_.addressRegex)try{U=await q.text()}catch{g("ERROR_ADDRESSREG_SPECPID",e)}else if(t!=null&&t.getSpecificJSONfromDomScript){let A=await q.text(),J=(R=(D=t==null?void 0:t.getSpecificJSONfromDomScript)==null?void 0:D.script)!=null&&R.splitForJSON?A.split(t==null?void 0:t.getSpecificJSONfromDomScript.script.splitForJSON)[1]:A;try{U=(Y=($=t==null?void 0:t.getSpecificJSONfromDomScript)==null?void 0:$.script)!=null&&Y.splitForJSON?JSON.parse(J.split("};")[0]+"}"):JSON.parse(A)}catch{try{let H=0,Je=-1;for(let Ie in J){Ie=parseInt(Ie);let Se=J[Ie];if(Se=="{")H++;else if(Se=="}"&&(H--,H==0)){Je=Ie+1;break}}Je==-1&&(Je=J.length),J=J.substring(J.indexOf("{"),Je),J=JSON.parse(J),(M=t==null?void 0:t.getSpecificJSONfromDomScript)!=null&&M.checkVal&&(U=k(J,(N=t==null?void 0:t.getSpecificJSONfromDomScript)==null?void 0:N.checkVal))}catch{}}}else U=await q.json()}if(q.status>=300)throw new Error("Some error in API")}catch{g("ERROR_SPECPID_DOMAPI",e)}let le=0,Oe="",ce="",K=_==null?void 0:_.pidApiAttributes,ge=[],Me="",de={},be=0,Ke=0,Pe=0,Qe;if(K!=null&&K.outerItemList)try{let P=k(U,K.outerItemList);for(let A of P)try{t!=null&&t.commonStatus&&(Qe=k(A,t.commonStatus));let J=k(A,K.itemDetails);if(t!=null&&t.commonStatus)for(let te of J)ge.push({...te,commonStatus:Qe});else for(let te of J)ge.push(te)}catch{g(`ERROR_SPECPID_${A}_OUTERITEMLIST`,e)}}catch{g("ERROR_SPECPID_OUTERITEMLIST",e)}else if(K!=null&&K.itemDetails)ge=k(U,K.itemDetails);else if(_!=null&&_.addressRegex)try{d.addressJSON=to(U,_==null?void 0:_.addressRegex)}catch{}if(K!=null&&K.orderDetails)for(let P in K==null?void 0:K.orderDetails)try{let A=K==null?void 0:K.orderDetails[P];if(typeof A=="object"&&A!==null&&!Array.isArray(A)){if(A!=null&&A.sel&&Array.isArray(A==null?void 0:A.sel)){let J;for(let H of A==null?void 0:A.sel)try{if(J=k(U,H),J)break}catch{g(`ERROR_${H}_SPECPIDORDERLIST`,e)}let te=!1;if(A!=null&&A.toCheck&&Array.isArray(A==null?void 0:A.toCheck))for(let H of J)for(let Je of A==null?void 0:A.toCheck)try{let Ie=k(H,Je);if(te)break;if(Ie&&Ie.trim().toLowerCase().includes(A==null?void 0:A.shouldInclude)&&Array.isArray(A==null?void 0:A.extractValue))for(let Se of A==null?void 0:A.extractValue)try{A=k(H,Se),A&&(d[P]=typeof A=="string"?A.trim():A,te=!0)}catch{g("ERROR_EXTRACTVAL_SPECPID",e)}}catch{g("ERROR_TOCHECK_SPECPID",e)}if(te)continue}d[P]={};for(let J in A)d[P][J]=k(U,A[J])}else d[P]=k(U,K==null?void 0:K.orderDetails[P])}catch{g(`ERROR_${P}_SPECPIDORDERLIST`,e)}for(let P in K)try{if(P=="orderTotal")le=k(U,K[P]);else if(P==="orderTotal2")try{let te=k(U,K[P]).replace(/|,/g,"").split("-").map(Je=>parseFloat(Je.trim()));Ke=Math.max(...te)}catch{g("ERROR_ORDERTOTAL2_SPECPID",e)}else if(P=="orderStatus")ce=k(U,K[P]);else if(P=="orderUrl"){Oe=K.orderUrl;for(let A in a)Oe=Oe.replace(A,a[A])}else if(P=="orderDate"){const A=await k(U,K[P]);Me=(B=A==null?void 0:A.match(/^\d{4}-\d{2}-\d{2}/))==null?void 0:B[0]}else if(P=="orderDiscount")be=k(U,K[P]),be=parseFloat(be);else if(P=="variousCharges")try{let A=k(U,K[P]);for(let J of A){let te;typeof(J==null?void 0:J.value)=="string"?te=parseFloat(J==null?void 0:J.value.replace(/[^0-9.-]+/g,"")):typeof(J==null?void 0:J.value)=="number"&&(te=J==null?void 0:J.value),isNaN(te)||(Pe+=te)}}catch{g("ERROR_VARIOUSCHANGES_SPECPID",e)}else if(P=="itemAtt"){let A=K[P];if(_!=null&&_.isMul)try{let J=_!=null&&_.pidArrPath?Ql(_==null?void 0:_.pidArrPath,K==null?void 0:K.itemAtt,U,e):ge;for(let te of J)try{let H={},Je=_!=null&&_.pidArrPath?te:A;for(let Ie in Je)if(Ie=="image"&&K.imagePrefix)H[Ie]=K.imagePrefix+k(te,Je[Ie]);else if(Ie=="price"&&K.priceRegex){const Se=new RegExp(K.priceRegex);let G=k(te,Je[Ie]).match(Se);H[Ie]=G?G[0]:null}else if(Ie=="addressJSON"){let Se=k(te,Je[Ie]);Se&&(H[Ie]=Se)}else H[Ie]=_!=null&&_.pidArrPath?k(Je,Ie):k(te,Je[Ie]);if(H.price&&(H.price=parseFloat(H.price*(H.quantity||1)),H.status&&(t!=null&&t.invalidStatus.includes(H.status.toLowerCase()))&&(H.price=0),H.price&&Pe&&Pe>0&&(le+=parseFloat(H.price+Pe)),t.pidPriceConvert&&(H.price=H.price*t.pidPriceConvert)),H!=null&&H.addressJSON)try{let Ie=la(t,H==null?void 0:H.addressJSON,st,e);if(Ie&&(Object.keys(Ie).length>1||Object.keys(Ie).length===1&&((W=Object.keys(Ie==null?void 0:Ie.addressJSON))==null?void 0:W.length)>0)){let Se;if(H!=null&&H.addID)Se=H==null?void 0:H.addID;else{let It=JSON.stringify(Ie);It=It.replace(/[^a-zA-Z0-9]/g,""),Se=Aa(It)}l[Se]?JSON.stringify(l[Se]).length<JSON.stringify(Ie).length&&(l[Se]=Object.assign({},JSON.parse(JSON.stringify(Ie)))):l[Se]=Ie,H.addID=Se,H==null||delete H.addressJSON}}catch{g("ERROR_ADDJSON_SPECPID",e)}i.push(H)}catch{g(`ERROR_${te}_SPECPID`,e)}}catch{g("ERROR_ISMUL_SPECPID",e)}else for(let J of ge){let te={};for(let H in A)te[H]=k(J,A[H]);i.push(te)}}else de[P]=k(U,K[P])}catch{g("ERROR_SPECPIDPIDATT",e)}if(de!=null&&de.addressJSON)try{let P=la(t,de==null?void 0:de.addressJSON,st,e);if(P&&(Object.keys(P).length>1||Object.keys(P).length===1&&((se=Object.keys(P==null?void 0:P.addressJSON))==null?void 0:se.length)>0)){let A;if(de!=null&&de.addID)A=de==null?void 0:de.addID;else{let J=JSON.stringify(P);J=J.replace(/[^a-zA-Z0-9]/g,""),A=Aa(J)}l[A]?JSON.stringify(l[A]).length<JSON.stringify(P).length&&(l[A]=Object.assign({},JSON.parse(JSON.stringify(P)))):l[A]=P,de.addID=A,de==null||delete de.addressJSON}}catch{g("ERROR_SPECPIDADDRESSJSON",e)}if(d!=null&&d.addressJSON)try{let P=la(t,d==null?void 0:d.addressJSON,st,e);if(P&&(Object.keys(P).length>1||Object.keys(P).length===1&&((fe=Object.keys(P==null?void 0:P.addressJSON))==null?void 0:fe.length)>0)){let A;if(d!=null&&d.addID)A=d==null?void 0:d.addID;else{let J=JSON.stringify(P);J=J.replace(/[^a-zA-Z0-9]/g,""),A=Aa(J)}l[A]?JSON.stringify(l[A]).length<JSON.stringify(P).length&&(l[A]=Object.assign({},JSON.parse(JSON.stringify(P)))):l[A]=P,d.addID=A,d==null||delete d.addressJSON}}catch{g("ERROR_SPECPIDADDRESSJSON",e)}return Object.keys(de).length>0&&i.push(de),t.priceRegex&&typeof le=="string"&&(le=le==null?void 0:le.match(new RegExp(t.priceRegex.reg))[t.priceRegex.ind]),typeof le=="string"&&(le=le.replaceAll(",","")),K.orderDiscount&&K.variousCharges&&(Qe&&t.invalidStatus.includes(Qe.toLowerCase())?(le=0,le-=parseFloat(Pe)):le=le-be+Pe),le=parseFloat(le),Me&&(Ze=bt(Me),Ze<r&&(ue=!0),c[Ze]=c[Ze]||{details:[],totalSpent:0}),ce.toLowerCase()!=="cancelled"&&!le&&(le=Ke),{orderTotal:le,orderStatus:ce,orderUrl:Oe,quarterCrossed:ue,orderJSON:c,orderDate:Me,orderDiscount:be,totalExtraCharges:Pe}}catch{g("ERROR_SPECPIDADDRESSJSON",e)}}function g(e,t){try{st[t]?st[t][e]?st[t][e]+=1:st[t][e]=1:(st[t]={},st[t][e]=1)}catch{}}function ro(e){try{let t={},a={};for(let i in e){let{details:s}=e[i];for(let r of s){let{orderDate:c,orderDetails:l,orderId:d,orderTotal:o=0}=r,{itemDetails:f,storeOrderId:p,totalExtraCharge:w=0}=l;t[p]=t[p]||{},t[p].orderDate=c,t[p].orderId=p,t[p].orderTotal=t[p].orderTotal?t[p].orderTotal+o:o,t[p].totalExtraCharge=w,t[p].orderDetails=t[p].orderDetails||{},t[p].orderDetails.storeOrderId=p,Array.isArray(f)&&f.length>0&&(t[p].orderDetails.itemDetails?t[p].orderDetails.itemDetails.push(...f):t[p].orderDetails.itemDetails=[...f])}}for(let i in t)a[bt(t[i].orderDate)]=a[bt(t[i].orderDate)]||{},a[bt(t[i].orderDate)].totalSpent=a[bt(t[i].orderDate)].totalSpent?a[bt(t[i].orderDate)].totalSpent+t[i].orderTotal+t[i].totalExtraCharge:t[i].orderTotal+t[i].totalExtraCharge,a[bt(t[i].orderDate)].details=a[bt(t[i].orderDate)].details||[],a[bt(t[i].orderDate)].details.push({orderDate:t[i].orderDate,orderId:t[i].orderId,orderTotal:t[i].orderTotal>0?t[i].orderTotal+t[i].totalExtraCharge:t[i].orderTotal,orderDetails:t[i].orderDetails});return a}catch{return e}}async function ns(e,t,a,i,s,r,c,l=null,d=!1){try{let{orderJSON:o,orderCount:f,curr:p={domCurr:null,curArr:[]},quarterWiseCur:w={},addressMap:x={}}=await fo(e,t,a,i,s,r,c,l,d);if(e.fixOrderJSON&&(o=ro(o)),d)return{orderJSON:o,addressMap:x};await Gc();let m=[],y=0;for(let b in o){let I=o[b].totalSpent;e.multiCurr&&(p!=null&&p.domCurr)&&Object.keys(w).length&&(I=w[b][p==null?void 0:p.domCurr]),y+=I,m.push({quarter:b,tot_spent:I,details:JSON.stringify(o[b].details)})}return{data:m,additionalSpend:y,additionalOrders:f,curArr:p,addressMap:x}}catch(o){return ft("spend_failed",t,c),g(JSON.stringify(o),t),v("getQuarterWiseData",o),{data:[],additionalSpend:0}}}async function io(e,t,a,i=0,s,r={}){var c,l;try{let d={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},o,f=k(t,a.dataExtractor.commonAttributes.date);if(f){let m=f.match("([A-Za-z]{3})\\s+(\\d{1,2}),\\s+(\\d{4})");if(m){let y=d[m[1]],b=m[2].padStart(2,"0");o=`${m[3]}-${y}-${b}`}}let p=(l=(c=a==null?void 0:a.dataExtractor)==null?void 0:c.commonAttributes)==null?void 0:l.date1,w={};if(o)s=!0;else{s=!1;let m=k(t,p==null?void 0:p.url),y=await lt(e,m,p==null?void 0:p.options);y=await y.text();let b=y.match(p==null?void 0:p.regex);if(p!=null&&p.priceRegex){let F=y.match(p.priceRegex);i=F&&F[1]&&!isNaN(parseFloat(F[1].replace(/,/g,"")))?parseFloat(F[1].replace(/,/g,"")):0}let[I,O,L]=b[1].split("-");if(o=`${L}-${I}-${O}`,p&&(p!=null&&p.deliveryAddress))try{const F=y==null?void 0:y.match(p.deliveryAddress);if(F&&F[1]){let j=F[1];j.endsWith("}")||(j+="}");const D=JSON.parse(j);w.deliveryAddress=D}}catch{g("ERROR_DELIVERYADD_DATEFROMAPI",e)}if(p&&(p!=null&&p.countryCode)){const F=y==null?void 0:y.match(p.countryCode);F&&F[1]&&(w.countryCode=F[1])}r.addressJSON=w}let x={date:o,needSpec:s,orderDetails:r};return i&&(x.orderTotal=isNaN(i)?0:i),x}catch(d){g(`${JSON.stringify(d)}_DATEFROMAPI`,e)}}function ss(e,t,a,i){try{const s=new Map;return e==null||e.forEach(r=>{const c=t.map(d=>r[d]).join("|");if(!s.has(c)){const d={};t.forEach(o=>d[o]=r[o]),d.items=[],s.set(c,d)}const l={};a==null||a.forEach(d=>{r.hasOwnProperty(d)&&(l[d]=r[d])}),s.get(c).items.push(l)}),Array.from(s.values())}catch(s){g(`ERROR_${JSON.stringify(s)}_GRPORDERITEMS`,i)}}async function no(e,t){var a;try{let i={};for(let s of t==null?void 0:t.url)try{let r=t==null?void 0:t.options,c,l;try{if(c=await lt(e,s,r),c.status>=300)throw new Error("Some error in API")}catch{}if(c.ok){if(t!=null&&t.isScript)try{if(c=await c.text(),c){let d=c.split(t==null?void 0:t.split1)[1],o=d&&JSON.parse(d.split(t==null?void 0:t.split2)[0]);l=k(o,t==null?void 0:t.addressList)}}catch{g("ERROR_ISSCRIPT_FETCHADDRESS",e)}else c=await c.json(),l=k(c,t==null?void 0:t.addressList);for(let d in l)try{let o;if(t!=null&&t.addID){if(o=k(l[d],t==null?void 0:t.addID),i[o])continue;i[o]={}}for(let p of t==null?void 0:t.addressAttributes)try{i[o][p.key]=k(l[d],p.value)}catch{g("ERROR_ADDRESSATT_FETCHADDRESS",e)}let f=la(t,i[o],e);f&&(Object.keys(f).length>1||Object.keys(f).length===1&&((a=Object.keys(f==null?void 0:f.addressJSON))==null?void 0:a.length)>0)&&(i[o]=f)}catch{g(`ERROR_${d}_ADDLIST_FETCHADDRESS`,e)}}}catch{g(`ERROR_${s}_FETCHADDRESS`,e)}return i}catch(i){return g(`ERROR_${JSON.stringify(i)}_FETCHADDRESS`,e),{}}}function jt(){const e=new Date,t=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),i=e.getFullYear();return`${a}-${t}-${i}`}function so(e,t){return Array.from({length:Math.ceil(e.length/t)},(a,i)=>e.slice(i*t,i*t+t))}function co(e){try{let t=0,a=-1;for(let i in e){i=parseInt(i);let s=e[i];if(s=="{")t++;else if(s=="}"&&(t--,t==0)){a=i+1;break}}return a==-1&&(a=e.length),e=e.substring(e.indexOf("{"),a),e=JSON.parse(e),e}catch{return{}}}async function lo(e,t,a,i,s){var r,c,l,d,o,f,p,w,x,m,y,b,I,O,L;try{let F=a==null?void 0:a.details,j=0;for(let D=0;D<F.length;D++)try{let R=F[D],$=t==null?void 0:t.url;if(s[`${R==null?void 0:R.date}~${R==null?void 0:R.movieId}~${R==null?void 0:R.profileId}`])continue;s[`${R==null?void 0:R.date}~${R==null?void 0:R.movieId}~${R==null?void 0:R.profileId}`]=!0,R!=null&&R.href&&($=$+(R==null?void 0:R.href));let Y=Object.assign({},t.options)||{},M=await lt(e,$,Y);if(M.status>=300)throw new Error("Wrong with API");if(t!=null&&t.isContent){if(M=await M.text(),(r=t==null?void 0:t.isContent)!=null&&r.regex){let B=new RegExp((c=t==null?void 0:t.isContent)==null?void 0:c.regex,"g"),W=[...M.matchAll(B)];for(let se of W)try{M=JSON.parse(se[1].trim())}catch{}}}else M=await M.json();let N={};for(let B in(l=t==null?void 0:t.dataExtractor)==null?void 0:l.commonAttributes)try{let W=(d=t==null?void 0:t.dataExtractor)==null?void 0:d.commonAttributes[B];Array.isArray(W)?W=W.map(se=>se.replaceAll("MOVIE_ID",R==null?void 0:R.movieId)):W=W.replaceAll("MOVIE_ID",R==null?void 0:R.movieId),N[B]=k(M,W,i==null?void 0:i.tildaSep)}catch{}if((N==null?void 0:N.watchStatus)=="FeatureNotStarted"?N.timeWatched=0:(N==null?void 0:N.watchStatus)=="FeatureFinished"&&(N.timeWatched=(N==null?void 0:N.totalTime)||0),!Object.keys(N).length||!(N!=null&&N.timeWatched)||!(N!=null&&N.totalTime))try{if((R==null?void 0:R.watchType)=="movie"){let B=k(M,(o=t==null?void 0:t.dataExtractor)==null?void 0:o.movieDetails,i==null?void 0:i.tildaSep);for(let W in B)try{let se=W;for(let fe in(f=t==null?void 0:t.dataExtractor)==null?void 0:f.commonAttributes)try{let _=(p=t==null?void 0:t.dataExtractor)==null?void 0:p.commonAttributes[fe];Array.isArray(_)?_=_.map(S=>S.replaceAll("MOVIE_ID",se)):_=_.replaceAll("MOVIE_ID",se),N[fe]=k(M,_,i==null?void 0:i.tildaSep)}catch{}if((N==null?void 0:N.watchStatus)=="FeatureNotStarted"?N.timeWatched=0:(N==null?void 0:N.watchStatus)=="FeatureFinished"&&(N.timeWatched=(N==null?void 0:N.totalTime)||0),!Object.keys(N).length||!(N!=null&&N.timeWatched)||!(N!=null&&N.totalTime))for(let fe in(w=t==null?void 0:t.dataExtractor)==null?void 0:w.extraAttributes)try{let _=(x=t==null?void 0:t.dataExtractor)==null?void 0:x.extraAttributes[fe];N[fe]=k(B[W],_,i==null?void 0:i.tildaSep)}catch{}}catch{g("ERROR_IN_DETAILS_MOVIE",e)}}else{let B=k(M,(m=t==null?void 0:t.dataExtractor)==null?void 0:m.seriesDetails,i==null?void 0:i.tildaSep);for(let W in B)try{let se=R==null?void 0:R.title,fe=new RegExp("Episode\\s+(\\d+)");if(se&&(se=se.match(fe)?se.match(fe)[1]:0),((y=B[W])==null?void 0:y.episodeNumber)==se){let _=W;for(let S in(b=t==null?void 0:t.dataExtractor)==null?void 0:b.commonAttributes)try{let U=(I=t==null?void 0:t.dataExtractor)==null?void 0:I.commonAttributes[S];Array.isArray(U)?U=U.map(re=>re.replaceAll("MOVIE_ID",_)):U=U.replaceAll("MOVIE_ID",_),N[S]=k(M,U,i==null?void 0:i.tildaSep)}catch{}if((N==null?void 0:N.watchStatus)=="FeatureNotStarted"?N.timeWatched=0:(N==null?void 0:N.watchStatus)=="FeatureFinished"&&(N.timeWatched=(N==null?void 0:N.totalTime)||0),!Object.keys(N).length||!(N!=null&&N.timeWatched)||!(N!=null&&N.totalTime))for(let S in(O=t==null?void 0:t.dataExtractor)==null?void 0:O.extraAttributes)try{let U=(L=t==null?void 0:t.dataExtractor)==null?void 0:L.extraAttributes[S];N[S]=k(B[W],U,i==null?void 0:i.tildaSep)}catch{}}}catch{g("ERROR_IN_DETAILS_EPISODE",e)}}}catch{g("ERROR_IN_TEMP_OBJ",e)}j+=(N==null?void 0:N.timeWatched)||0,F[D]={...R,...N}}catch{g("ERROR_IN_TRAVERSE_SPEC_TIME",e)}a.totalSpent+=j}catch{g("ERROR_IN_SPEC_API_TIME",e)}}function un(e,t,a,i,s,r,c,l){var d,o,f,p,w,x;try{for(let m in e)try{let y=e[m],b=[];if((d=t==null?void 0:t.dataExtractor)!=null&&d.childrenArr){let I=[];try{I=k(y,(o=t==null?void 0:t.dataExtractor)==null?void 0:o.childrenArr)}catch{g("ERROR_IN_EXTRACT_CHILDLIST",l)}I.length||(I=Array.isArray(y)?y:[y]);for(let O of I){let L={};for(let F in(f=t==null?void 0:t.dataExtractor)==null?void 0:f.commonAttributes){let j;try{j=k(O,(p=t==null?void 0:t.dataExtractor)==null?void 0:p.commonAttributes[F])}catch{}j&&(L[F]=j)}b.push(L)}}else{let I={};for(let O in(w=t==null?void 0:t.dataExtractor)==null?void 0:w.commonAttributes){let L;try{L=k(y,(x=t==null?void 0:t.dataExtractor)==null?void 0:x.commonAttributes[O])}catch{}L&&(I[O]=L)}b.push(I)}for(let I of b)try{if(I!=null&&I.date){let O=I.date;O=new Date(O).toISOString().slice(0,10);let L=bt(O);if(L<r){c.val=!0;break}a[L]||(a[L]={totalSpent:0,details:[]}),I.profileId=i,I.date=O,Wt[s]++,(I!=null&&I.image&&(I!=null&&I.movieId)||I!=null&&I.videoId)&&Lt[s].push({prod:(I==null?void 0:I.movieId)||(I==null?void 0:I.videoId),image:I==null?void 0:I.image}),a[L].details.push({...I})}}catch{g("ERROR_IN_MOVIE_DATA_ARR",l)}}catch{g("ERROR_IN_ORDER_LIST",l)}}catch{g("ERROR_IN_CALC_ORDER_TIME",l)}}async function oo(e,t,a,i,s,r,c,l){var d,o,f,p,w,x,m,y,b,I,O,L,F,j,D,R,$,Y,M,N,B,W,se,fe,_,S,U,re,ue,q,le,Oe,ce,K,ge,Me,de,be,Ke,Pe,Qe,P,A,J,te,H,Je,Ie,Se,It,G,z,Z,X,ne,xe,Be,ut;try{let zt=[],$a={};if(e!=null&&e.profiles)try{let $e=(d=e==null?void 0:e.profiles)==null?void 0:d.url,xt=(o=e==null?void 0:e.profiles)==null?void 0:o.options,Ne=await lt(t,$e,xt);if(Ne.status>=300)throw new Error("Some error in API");if((f=e==null?void 0:e.profiles)!=null&&f.isContent){if(Ne=await Ne.text(),(w=(p=e==null?void 0:e.profiles)==null?void 0:p.isContent)!=null&&w.splitForJSON){let Ee=Ne==null?void 0:Ne.split((m=(x=e==null?void 0:e.profiles)==null?void 0:x.isContent)==null?void 0:m.splitForJSON)[1];Ne=co(Ee)}}else Ne=await Ne.json();let ve=k(Ne,(y=e==null?void 0:e.profiles)==null?void 0:y.profileList);if(Array.isArray(ve)||(ve=[ve]),(b=e==null?void 0:e.profiles)!=null&&b.profileListArr){let Ee=k(Ne,(O=(I=e==null?void 0:e.profiles)==null?void 0:I.profileListArr)==null?void 0:O.path);for(let Ae of Ee)try{ve.push(k(Ae,(F=(L=e==null?void 0:e.profiles)==null?void 0:L.profileListArr)==null?void 0:F.jsonPath))}catch{}}for(let Ee of ve)try{let Ae=!0,He={};(j=e==null?void 0:e.profiles)!=null&&j.toPushCond&&k(Ee,(R=(D=e==null?void 0:e.profiles)==null?void 0:D.toPushCond)==null?void 0:R.key)!=((Y=($=e==null?void 0:e.profiles)==null?void 0:$.toPushCond)==null?void 0:Y.val)&&(Ae=!1);for(let Ge in(M=e==null?void 0:e.profiles)==null?void 0:M.profileAttribute)He[Ge]=k(Ee,(N=e==null?void 0:e.profiles)==null?void 0:N.profileAttribute[Ge]);Ae&&zt.push(He)}catch{g("ERROR_IN_PROFILE_LIST",t)}}catch{g("ERROR_IN_PROFILES",t)}for(let $e of zt)try{if((B=e==null?void 0:e.profiles)!=null&&B.switchProfile)try{let Ne=(se=(W=e==null?void 0:e.profiles)==null?void 0:W.switchProfile)==null?void 0:se.url,ve=Object.assign({},(_=(fe=e==null?void 0:e.profiles)==null?void 0:fe.switchProfile)==null?void 0:_.options),Ee={};if((U=(S=e==null?void 0:e.profiles)==null?void 0:S.switchProfile)!=null&&U.formBodyKeys){if((ue=(re=e==null?void 0:e.profiles)==null?void 0:re.switchProfile)!=null&&ue.formBodyKeys)for(let Ae in(le=(q=e==null?void 0:e.profiles)==null?void 0:q.switchProfile)==null?void 0:le.formBodyKeys)try{let He=(ce=(Oe=e==null?void 0:e.profiles)==null?void 0:Oe.switchProfile)==null?void 0:ce.formBodyKeys[Ae],Ge=$e[Ae];Ee[He]=Ge}catch{}Ee=new URLSearchParams(Ee).toString()}if((ge=(K=e==null?void 0:e.profiles)==null?void 0:K.switchProfile)!=null&&ge.profileKeys)for(let Ae in(de=(Me=e==null?void 0:e.profiles)==null?void 0:Me.switchProfile)==null?void 0:de.profileKeys)try{let He=(Ke=(be=e==null?void 0:e.profiles)==null?void 0:be.switchProfile)==null?void 0:Ke.profileKeys[Ae],Ge=$e[Ae];Ne=Ne.replaceAll(He,Ge),ve!=null&&ve.headers&&(ve.headers=JSON.parse(JSON.stringify(ve.headers).replaceAll(He,Ge))),ve!=null&&ve.body&&(ve.body=ve.body.replaceAll(He,Ge))}catch{}typeof Ee=="string"&&(ve.body=ve.body.replaceAll("FORM_BODY",Ee));try{await lt(t,Ne,ve)}catch{}}catch{g("ERROR_SWITCH_PROFILE",t)}let xt="";for(let Ne=e==null?void 0:e.pageStart;Ne<=(e==null?void 0:e.pageEnd);Ne++)try{let ve;for(let Ee of e.url){let Ae=Object.assign({},e.options);if(e.maxYear&&(Ee=Ee.replace("PLACEHOLDER_YEAR",(e==null?void 0:e.maxYear)-outerLoop)),e.yearStartEnd&&(Ee=Ee.replace("PLACEHOLDER_YEAR",jt().split("-")[0]+"-"+jt().split("-")[1]+"-"+(new Date().getFullYear()-outerLoop-1)).replace("PLACEHOLDER_YEAR",jt().split("-")[0]+"-"+jt().split("-")[1]+"-"+(new Date().getFullYear()-outerLoop))),Ee=Ee.replace("PLACEHOLDER0",Ne),Ee=Ee.replace("timestamp",Date.now()),e!=null&&e.queryParams&&xt){let ke=JSON.parse(JSON.stringify(e==null?void 0:e.queryParams).replaceAll("NEXT_TOKEN",xt));ke=new URLSearchParams({widgetArgs:JSON.stringify(ke)}),Ee=Ee.replaceAll("PLACEHODLER_QUERY",ke)}if(Ae.body){Ae.body=e.innerLoopMul?Ae.body.replace("PLACEHOLDER0",Ne*e.innerLoopMul):Ae.body.replace("PLACEHOLDER0",Ne);try{Ae.body=(Pe=Ae==null?void 0:Ae.body)==null?void 0:Pe.replace("PLACEHOLDER_PROFILEID",$e==null?void 0:$e.profileId)}catch{}}if(e.useCookie){let ke;if(e!=null&&e.useCookieDirectly)try{let Te=`${e.useCookieDirectly.mainKey}="([^"]+)"`;ke=a.match(Te)[e.useCookieDirectly.index]}catch{}else typeof e.useCookie=="object"?ke=a.split("; ").filter(Te=>Te.startsWith(`${e.useCookie.mainKey}=`))[0].split("=")[1]:ke=a.split("; ").filter(Te=>Te.startsWith(`${e.useCookie}=`))[0].split("=")[1];try{ke=decodeURIComponent(ke)}catch{ke=ke}try{let Te=JSON.parse(ke);ke=k(Te,e.useCookie.jsonPath)}catch{ke=ke}Ae.headers=JSON.parse(JSON.stringify(Ae.headers).replace("PLACEHOLDER2",ke)),Ee=Ee.replace("PLACHOLDER_COOKIE",ke)}if(e.localStorageKeys)for(let ke in e.localStorageKeys){let Te=i[ke],yt=typeof e.localStorageKeys[ke]=="object"?(Qe=e.localStorageKeys[ke])==null?void 0:Qe.value:e.localStorageKeys[ke];Te&&(Ae.headers=JSON.parse(JSON.stringify(Ae.headers).replaceAll(yt,Te)),Ee=Ee.replaceAll(yt,Te),Ae.body&&(Ae.body=JSON.parse(JSON.stringify(Ae.body).replaceAll(yt,Te))))}let He;try{if(He=await lt(t,Ee,Ae),He.status>=300)throw new Error("Some error in API")}catch{}ve=await He.json();let Ge="";if((P=e==null?void 0:e.dataExtractor)!=null&&P.nextPageKey&&(Ge=k(ve,(A=e==null?void 0:e.dataExtractor)==null?void 0:A.nextPageKey)),Ge==xt&&((J=e==null?void 0:e.dataExtractor)!=null&&J.nextPageKey))break;xt=Ge;let dt={val:!1};if((te=e==null?void 0:e.dataExtractor)!=null&&te.outerOrderList){let ke=k(ve,e.dataExtractor.outerOrderList);for(let Te in ke){let yt=ke[Te],wt=k(yt,e.dataExtractor.orderList);dt!=null&&dt.val||un(wt,e,c,$e==null?void 0:$e.profileId,r,l,dt,t)}}else{let ke=k(ve,e.dataExtractor.orderList)||ve;(H=e==null?void 0:e.dataExtractor)!=null&&H.groupOrders&&(ke=ss(ke,e==null?void 0:e.groupKeys,e==null?void 0:e.itemKeys,t)),dt!=null&&dt.val||un(ke,e,c,$e==null?void 0:$e.profileId,r,l,dt,t)}}if(e.pageEndCheck&&k(ve,e.pageEndCheck.jsonPath)==e.pageEndCheck.equalTo)break}catch{g("ERROR_IN_PARSING",t)}for(let Ne in c)try{if((Je=e==null?void 0:e.timeCalc)!=null&&Je.specAPI)await lo(t,e==null?void 0:e.timeCalc,c[Ne],e,$a);else{let ve=0,He=(((Ie=c[Ne])==null?void 0:Ie.details)||[]).filter(Te=>Te.movieId!==void 0&&Te.profileId===($e==null?void 0:$e.profileId)).map(Te=>Te.movieId).map(Te=>`Video:${Te}`),Ge=so(He,100),dt=(Se=e==null?void 0:e.timeCalc)==null?void 0:Se.url,ke=Object.assign({},(It=e==null?void 0:e.timeCalc)==null?void 0:It.options);for(let Te of Ge)try{let yt=JSON.stringify(Te),wt={...ke};wt!=null&&wt.body&&(wt.body=wt.body.replace("PLACEHOLDER_MOVIEARR",yt));let Bt;try{if(Bt=await lt(t,dt,wt),Bt.status>=300)throw new Error("error in API")}catch{continue}Bt=await Bt.json();let De=[];try{De=k(Bt,(z=(G=e==null?void 0:e.timeCalc)==null?void 0:G.dataExtractor)==null?void 0:z.orderList)}catch{De=[]}if(!De.length)continue;for(let Ut of De)try{let pe={};for(let $t in(X=(Z=e==null?void 0:e.timeCalc)==null?void 0:Z.dataExtractor)==null?void 0:X.commonAttributes){let Zt;try{Zt=k(Ut,(xe=(ne=e==null?void 0:e.timeCalc)==null?void 0:ne.dataExtractor)==null?void 0:xe.commonAttributes[$t])}catch{}Zt&&(pe[$t]=Zt)}pe!=null&&pe.timeWatched&&(ve+=isNaN(parseFloat(pe==null?void 0:pe.timeWatched))?0:parseFloat(pe==null?void 0:pe.timeWatched));let he=(ut=(Be=c[Ne])==null?void 0:Be.details)==null?void 0:ut.find($t=>$t.movieId===pe.movieId);he?Object.assign(he,pe):c[Ne].details.push(pe),(pe!=null&&pe.image&&(pe!=null&&pe.movieId)||pe!=null&&pe.videoId)&&Lt[r].push({prod:(pe==null?void 0:pe.movieId)||(pe==null?void 0:pe.videoId),image:pe==null?void 0:pe.image})}catch{}}catch{g("ERROR_IN_BATCHES",t)}c[Ne].totalSpent+=ve||0}}catch{g("ERROR_IN_TIMESPEND_OBJ",t)}}catch{g("ERROR_IN_PROFILE_ARR",t)}}catch{g("ERROR_IN_CALCULATE_TIME",t)}}function uo(e){try{const t={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};let a;if(/^\d{10,13}$/.test(e)){const i=parseInt(e);a=new Date(i<1e13?i*1e3:i)}else if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(e))a=new Date(e);else if(/Placed on/.test(e)){let i=e.match(/(\d{1,2})\s([a-z]{3})'?(\d{2})?,\s(\d{1,2}):(\d{2})\s?(am|pm)/i);if(i){let s=parseInt(i[1],10),r=t[i[2].toLowerCase()],c=parseInt("20"+(i[3]||new Date().getFullYear().toString().slice(-2)),10),l=parseInt(i[4],10),d=parseInt(i[5],10);i[6].toLowerCase()==="pm"&&l!==12&&(l+=12),i[6].toLowerCase()==="am"&&l===12&&(l=0),a=new Date(c,r,s,l,d)}}else if(/^\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}/.test(e))a=new Date(e.replace(" ","T"));else if(/^\w+\s\d{1,2},\s\d{4}\sat\s\d{1,2}:\d{2}\s?(AM|PM)/i.test(e)){let i=e.match(/([a-zA-Z]+) (\d{1,2}), (\d{4}) at (\d{1,2}):(\d{2})\s?(AM|PM)/i);if(i){let s=t[i[1].toLowerCase().slice(0,3)],r=parseInt(i[2],10),c=parseInt(i[3],10),l=parseInt(i[4],10),d=parseInt(i[5],10),o=i[6].toLowerCase();o==="pm"&&l!==12&&(l+=12),o==="am"&&l===12&&(l=0),a=new Date(c,s,r,l,d)}}return!a||isNaN(a.getTime())?e:a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return e}}async function ho(e,t,a,i){var s,r,c,l,d,o,f,p,w,x;try{let m={},y=t==null?void 0:t.url,b=Object.assign({},t==null?void 0:t.options);if(t!=null&&t.localStorageKeys)try{for(let O in t==null?void 0:t.localStorageKeys){let L=a[O],F=typeof t.localStorageKeys[O]=="object"?(s=t.localStorageKeys[O])==null?void 0:s.value:t.localStorageKeys[O];L&&(b.headers=JSON.parse(JSON.stringify(b.headers).replaceAll(F,L)),y=y.replaceAll(F,L),b.body&&(b.body=JSON.parse(JSON.stringify(b.body).replaceAll(F,L))))}}catch{g("ERROR_LOCALSTORAGEKEYS",e)}if(t!=null&&t.dataFromDom)try{for(let O in t==null?void 0:t.dataFromDom){let L=i[O];L&&(b.headers=JSON.parse(JSON.stringify(b.headers).replace(t.dataFromDom[O].placeholder,L)),y=y.replace(t.dataFromDom[O].placeholder,L))}}catch{g("ERROR_DATAFROMDOM",e)}let I;try{I=await lt(e,y,b),I=await I.json()}catch{}if(t!=null&&t.extractDetails){let O=t==null?void 0:t.extractDetails;if(O!=null&&O.outerData)for(let L in O==null?void 0:O.outerData)try{m[L]=k(I,O==null?void 0:O.outerData[L])}catch{}if(O!=null&&O.details){m.details=[];let L=[];if((r=O==null?void 0:O.details)!=null&&r.outerList&&((c=O==null?void 0:O.details)!=null&&c.list)){let F=k(I,(l=O==null?void 0:O.details)==null?void 0:l.outerList);for(let j of F)try{let D=k(j,(d=O==null?void 0:O.details)==null?void 0:d.list);for(let R of D)L.push(R)}catch{}}else if((o=O==null?void 0:O.details)!=null&&o.list)try{let F=k(I,(f=O==null?void 0:O.details)==null?void 0:f.list);Array.isArray(F)&&(L=F)}catch{}if((p=O==null?void 0:O.details)!=null&&p.data)for(let F of L)try{let j={};for(let D in(w=O==null?void 0:O.details)==null?void 0:w.data)j[D]=k(F,(x=O==null?void 0:O.details)==null?void 0:x.data[D]);m.details.push(j)}catch{}}}return m}catch{}}async function dn(e,t,a,i,s){try{s.domAPI||(t=await t.json());let r={},c=k(t,a==null?void 0:a.url),l=await lt(e,c,a==null?void 0:a.options);if((l==null?void 0:l.status)>300)return;l=await l.text();let d={};if(a!=null&&a.extractData)for(let o in a==null?void 0:a.extractData)try{let f=a==null?void 0:a.extractData[o].splitArr,p=l;for(let w of f)try{p=p.split(w==null?void 0:w.key)[w==null?void 0:w.index]}catch{g("ERROR_UPDATE_DATA_FROM_SPEC_URL",e)}d[o]=p}catch{}if(a!=null&&a.nextUrl){let o=a==null?void 0:a.nextUrl,f=Object.assign({},a==null?void 0:a.nextOptions);i&&(a!=null&&a.nextPageKeyParams&&(o=o+(a==null?void 0:a.nextPageKeyParams)),o=o.replaceAll("PLACEHOLDER4",i));for(let w in d)try{o&&(o=o.replaceAll(w,d[w])),f!=null&&f.headers&&(f.headers=JSON.parse(JSON.stringify(f==null?void 0:f.headers).replaceAll(w,d[w]))),f!=null&&f.body&&(f.body=JSON.parse(JSON.stringify(f==null?void 0:f.body).replaceAll(w,d[w])))}catch{}let p=await lt(e,o,f);if((p==null?void 0:p.status)>300)return;p=await p.json(),p&&Object.keys(p).length&&(r=p)}return r}catch{g("ERROR_UPDATE_DATA_FROM_SPEC_URL",e)}}async function fo(e,t,a,i,s,r,c,l=null,d=!1){var L,F,j,D,R,$,Y,M,N,B,W,se,fe,_,S,U,re,ue,q,le,Oe,ce,K,ge;let o={},f={},p={},w=new Map,x=[],m,y=!1,b=0,I={},O=1;Wt[c]=0,Lt[c]=[];try{if(!e)throw ft("config_missing",t,c),g("No_Config",t),Rr("end_ms",t,c),new Error("Config Not Found !");let Me={},de="",be={},Ke={},Pe=!1,Qe=((L=e==null?void 0:e.nextCallTokens)==null?void 0:L.initval)||null;e.isAddress&&(f=await no(t,e==null?void 0:e.isAddress)),e!=null&&e.priorDetails&&(I=await ho(t,e==null?void 0:e.priorDetails,s,r),O=(I==null?void 0:I.details.length)-1||1);for(let P=0;P<=((e==null?void 0:e.outerLoopUpto)??O);P++)try{if(I!=null&&I.details&&(I!=null&&I.details.length))Me=I==null?void 0:I.details[0],I.details.shift();else if(I!=null&&I.details&&!(I!=null&&I.details.length))break;let A,J=Math.floor(Date.now()/1e3);for(let te=e.pageStart;te<=e.pageEnd;te+=e!=null&&e.rangeDiff?e==null?void 0:e.rangeDiff:1)try{Rr("page_start",t,c);let H,Je=!1;for(let G of e.url){G||g("NO_EACHURL",t);let z=Object.assign({},e.options);if(e.maxYear&&(G=G.replace("PLACEHOLDER_YEAR",(e==null?void 0:e.maxYear)-P)),e.yearStartEnd&&(G=G.replace("PLACEHOLDER_YEAR",jt().split("-")[0]+"-"+jt().split("-")[1]+"-"+(new Date().getFullYear()-P-1)).replace("PLACEHOLDER_YEAR",jt().split("-")[0]+"-"+jt().split("-")[1]+"-"+(new Date().getFullYear()-P))),G=G.replace("PLACEHOLDER0",te),G=G.replace("timestamp",Date.now()),G=G.replace("PLACEHOLDER4",de),G=e.innerLoopMul?G.replace("PLACEHOLDER_OFFSET",te*e.innerLoopMul):G.replace("PLACEHOLDER_OFFSET",te),e!=null&&e.initVal&&((F=e==null?void 0:e.initVal)!=null&&F.length))if(y)G=G.replace(e==null?void 0:e.initReplace,de);else for(let Z of e==null?void 0:e.initVal)try{let X;(Z==null?void 0:Z.value)=="curTimestamp"&&(X=Date.now()),G=G.replace(Z==null?void 0:Z.key,X),y=!0}catch{g("ERROR_CALCSPEND_INIT_VAL",t)}if(G=G.replace("CURRYEAR",new Date().getFullYear()+P),z.headers&&(z.headers=JSON.parse(JSON.stringify(z.headers).replace("CURRYEAR",new Date().getFullYear()+P))),z.body&&(z.body=JSON.parse(JSON.stringify(z.body).replace("CURRYEAR",new Date().getFullYear()+P))),e.outerLoopArr&&(G=G.replace("PLACEHOLDER_OUTER",e.outerLoopArr[P]),z.body=z.body?z.body.replace("PLACEHOLDER_OUTER",e.outerLoopArr[P]):z.body),(D=(j=e==null?void 0:e.priorDetails)==null?void 0:j.extractDetails)!=null&&D.outerData)for(let Z in I)try{z.headers&&(z.headers=JSON.parse(JSON.stringify(z.headers).replace(Z,I[Z]))),z.body&&(z.body=JSON.parse(JSON.stringify(z.body).replace(Z,I[Z])))}catch{}if(Me)for(let Z in Me)G=G.replace(Z,Me[Z]),z.headers&&(z.headers=JSON.parse(JSON.stringify(z.headers).replace(Z,Me[Z]))),z.body&&(z.body=JSON.parse(JSON.stringify(z.body).replace(Z,Me[Z])));if(e!=null&&e.rangeDiff)try{let Z=Math.min(te,J),X=Math.min(te+(e==null?void 0:e.rangeDiff)-1,J);if(Z>=J){Je=!0;break}G=G.replaceAll("PLACEHOLDER_START",Z),G=G.replaceAll("PLACEHOLDER_END",X)}catch{}if(Object.keys(be).length>0)for(let Z in be)G.includes("?")?G+=`&${Z}=${be[Z]}`:G+=`?${Z}=${be[Z]}`;if(z.body&&(z.body=e.innerLoopMul?z.body.replace("PLACEHOLDER0",te*e.innerLoopMul):z.body.replace("PLACEHOLDER0",te)),z.body&&(e!=null&&e.nextCallTokens)&&(Qe?z.body=z.body.replace("PLACEHOLDER_NEXTCALLTOKEN",Qe):z.body=z.body.replace('"PLACEHOLDER_NEXTCALLTOKEN"',Qe)),e.useCookie){let Z=Array.isArray(e.useCookie)?e.useCookie:[e.useCookie];for(let X of Z){let ne;if(e!=null&&e.useCookieDirectly)try{let xe=`${e.useCookieDirectly.mainKey}="([^"]+)"`;ne=i.match(xe)[e.useCookieDirectly.index]}catch{g("ERROR_CALCSPEND_COOKIE_DIRECTLY",t)}else if(typeof X=="object")try{X.getHttpSecureCookie?ne=await ki(X.getHttpSecureCookie.url,X.getHttpSecureCookie.value):ne=i.split("; ").filter(xe=>xe.startsWith(`${X.mainKey}=`))[0].split("=")[1]}catch{}else ne=i.split("; ").filter(xe=>xe.startsWith(`${X}=`))[0].split("=")[1];try{ne=decodeURIComponent(ne)}catch{ne=ne}if(typeof X=="object"&&X.jsonPath)try{let xe=JSON.parse(ne);ne=k(xe,X.jsonPath)}catch{ne=ne}ne||g("MISSING_COOKIE",t),typeof X=="object"&&X.replaceWith?(z.headers=JSON.parse(JSON.stringify(z.headers).replaceAll(X.replaceWith,ne)),G=G.replaceAll(X.replaceWith,ne)):(z.headers=JSON.parse(JSON.stringify(z.headers).replace("PLACEHOLDER2",ne)),G=G.replace("PLACHOLDER_COOKIE",ne))}}if(e.localStorageKeys)try{for(let Z in e.localStorageKeys){let X=s[Z],ne=typeof e.localStorageKeys[Z]=="object"?(R=e.localStorageKeys[Z])==null?void 0:R.value:e.localStorageKeys[Z];X&&(z.headers=JSON.parse(JSON.stringify(z.headers).replaceAll(ne,X)),G=G.replaceAll(ne,X),z.body&&(z.body=JSON.parse(JSON.stringify(z.body).replaceAll(ne,X))))}}catch{g("ERROR_LOCALSTORAGEKEYS",t)}if(e.dataFromDom)try{for(let Z in e.dataFromDom){let X=r[Z];X&&(z.headers=JSON.parse(JSON.stringify(z.headers).replace(e.dataFromDom[Z].placeholder,X)),G=G.replace(e.dataFromDom[Z].placeholder,X))}}catch{g("ERROR_DATAFROMDOM",t)}try{if(e.keysFromAPI){let Z=e.keysFromAPI.url,X=e.keysFromAPI.options;if(e.keysFromAPI.localStorageKeys)for(let xe in e.keysFromAPI.localStorageKeys)try{let Be=s[xe],ut=typeof e.keysFromAPI.localStorageKeys[xe]=="object"?($=e.keysFromAPI.localStorageKeys[xe])==null?void 0:$.value:e.keysFromAPI.localStorageKeys[xe];Be&&(X.headers=JSON.parse(JSON.stringify(X.headers).replace(ut,Be)),X.body=JSON.parse(JSON.stringify(X.body).replace(ut,Be)),Z=Z.replace(ut,Be))}catch{g("ERROR_CALCSPEND_LOCALST_KEYS",t)}let ne;try{let xe=await La(c,{action:"callAPIFromDOM",data:{eachUrl:Z,eachOptions:X}});ne=xe==null?void 0:xe.result,ne=JSON.parse(ne==null?void 0:ne.result),ne!=null&&ne.data&&(ne=ne==null?void 0:ne.data)}catch{g("ERROR_CALCSPEND_SENDMSG_CONTENT",t)}for(let xe of e.keysFromAPI.requiredKeys){let Be=k(ne,xe.value),ut=xe.key;s[ut]=Be,Be&&(z.headers=JSON.parse(JSON.stringify(z.headers).replace(ut,Be)),G=G.replace(ut,Be))}}}catch{g("ERROR_KEYSFROMAPI",t)}if(t===2191){let Z=P===0?"CURRENT_YEAR":`CURRENT_YEAR-${P}`;G=G.replace("PLACEHOLDER1",Z)}try{if(e.domAPI){let Z=await La(c,{action:"callAPIFromDOM",data:{eachUrl:G,eachOptions:z}});H=Z==null?void 0:Z.result,H=JSON.parse(H==null?void 0:H.result),H!=null&&H.data&&(H=H==null?void 0:H.data)}else H=await lt(t,G,z);if(H.status>=300)throw new Error("Some error in API");break}catch{g("ERROR_CALCSPEND_DOMAPI",t)}}if(Je)break;if(H.status>=300)throw new Error("Some error in API");if(e.domAPI)A=H,e!=null&&e.specUrl&&(A=await dn(t,H,e==null?void 0:e.specUrl,de,e));else if(e!=null&&e.specUrl)A=await dn(t,H,e==null?void 0:e.specUrl,de,e);else if(e!=null&&e.getJSONfromDomScript){let G=await H.text(),z=(M=(Y=e==null?void 0:e.getJSONfromDomScript)==null?void 0:Y.script)!=null&&M.splitForJSON?G.split(e==null?void 0:e.getJSONfromDomScript.script.splitForJSON)[1]:G;try{A=(B=(N=e==null?void 0:e.getJSONfromDomScript)==null?void 0:N.script)!=null&&B.splitForJSON?JSON.parse(z.split("};")[0]+"}"):JSON.parse(G)}catch{try{let X=0,ne=-1;for(let xe in z){xe=parseInt(xe);let Be=z[xe];if(Be=="{")X++;else if(Be=="}"&&(X--,X==0)){ne=xe+1;break}}ne==-1&&(ne=z.length),z=z.substring(z.indexOf("{"),ne),z=JSON.parse(z),(W=e==null?void 0:e.getJSONfromDomScript)!=null&&W.checkVal&&(A=k(z,(se=e==null?void 0:e.getJSONfromDomScript)==null?void 0:se.checkVal))}catch(X){console.log(X)}}}else{let G=H.headers&&H.headers.get("content-type");if((fe=e==null?void 0:e.script)!=null&&fe.name&&G&&(G!=null&&G.includes("text/html"))){let z=await H.text(),Z=new RegExp(`<script id="${(_=e==null?void 0:e.script)==null?void 0:_.name}"[^>]*>([\\s\\S]*?)<\\/script>`,"i"),X=z==null?void 0:z.match(Z);if(X&&X[1])try{let ne=JSON.parse(X[1]);A=await ql(t,ne,e,t)}catch{}}else if(G!=null&&G.includes("text/html")&&((S=e==null?void 0:e.script)!=null&&S.splitForJSON)){let z=await H.text();for(let Z=0;Z<((U=e==null?void 0:e.script)==null?void 0:U.splitForJSON.length);Z++)try{if(z=z.split((re=e==null?void 0:e.script)==null?void 0:re.splitForJSON[Z])[(ue=e==null?void 0:e.script)==null?void 0:ue.index[Z]],(q=e==null?void 0:e.script)!=null&&q.replace){let X=(le=e==null?void 0:e.script)==null?void 0:le.replace;try{if(X!=null&&X.toReplace&&(X!=null&&X.replaceWith)&&typeof X.toReplace[Z]=="string"&&typeof X.replaceWith[Z]=="string"){let ne=new RegExp(X==null?void 0:X.toReplace[Z],"g"),xe=X==null?void 0:X.replaceWith[Z];try{z=z.replaceAll(ne,xe)}catch{}}}catch{}}}catch{}try{A=JSON.parse(z)}catch{}}else A=await H.json()}if((!A||!Object.keys(A).length)&&g("MISSING_RESPONSEJSON",t),e.nextCallParams)for(let G in e.nextCallParams){let z=G.split("~")[0],Z;if(Array.isArray(e.nextCallParams[G])&&e.nextCallParams[G].length>1?Z=Math.min(k(A,e.nextCallParams[G][0]),k(A,e.nextCallParams[G][1])):Z=k(A,e.nextCallParams[G]),e.nextCallParamsRegex)try{const X=Z.match(new RegExp(e.nextCallParamsRegex[G].str))[e.nextCallParamsRegex[G].ind];X&&(Z=X)}catch{g("ERROR_NEXTPAGEREGEX",t)}be[z]!=Z&&(be[z]=Z)}e!=null&&e.nextCallTokens&&(Qe=k(A,(Oe=e==null?void 0:e.nextCallTokens)==null?void 0:Oe.path)||null);let Ie=0;async function Se(G){var z,Z,X,ne,xe,Be,ut,zt,$a,$e,xt,Ne,ve,Ee,Ae,He,Ge,dt,ke,Te,yt,wt;for(let Bt in G){try{let De=G[Bt],Ut=!0,pe;if(e.dataExtractor.commonAttributes.orderId.includes("~")){let T=e.dataExtractor.commonAttributes.orderId.split("~");for(let V of T)try{pe?pe=pe+"~"+k(De,V):pe=k(De,V)}catch{}}else pe=k(De,e.dataExtractor.commonAttributes.orderId);if(de=pe,e.dataExtractor.nextPageKey)try{de=k(A,e.dataExtractor.nextPageKey),de||(de=k(De,e.dataExtractor.nextPageKey))}catch{}if(Ke[pe])continue;Ke[pe]=!0,Ie++;let he,$t=0,Zt=0,Ar=1,ae={};try{if(e.apiForPid){let T={};if(e.dataExtractor.commonAttributes.selectors)try{for(let Ce in e.dataExtractor.commonAttributes.selectors){let Qt=k(De,e.dataExtractor.commonAttributes.selectors[Ce]);T={...T,[Ce]:Qt}}}catch{}let V={};await on(t,e,T,[],s,ae,V,i,r),(z=e.dataExtractor.orderApi)!=null&&z.pidPath&&(De[e.dataExtractor.orderApi.pidPath]=V)}}catch{g("ERROR_SPENDCALC_APIFORPID",t)}let We="";if(e.dataExtractor.commonAttributes.date||e!=null&&e.siteConfigdateAlt){if(We=e!=null&&e.siteConfigdateAlt?await io(t,De,e,Ut,ae).then(V=>(Ut=V==null?void 0:V.needSpec,he=isNaN(V==null?void 0:V.orderTotal)?0:parseFloat(V==null?void 0:V.orderTotal),ae=(V==null?void 0:V.orderDetails)??ae,V==null?void 0:V.date)):k(De,e.dataExtractor.commonAttributes.date),We||g("ERROR_SPENDCALC_ORDERDATE",t),e.dateRegex){const[V,Le,Ce]=We.match(new RegExp(e.dateRegex));We=`${Le} ${Ce}`}e.dateFormatRegex&&(We=Cl(We,e.dateFormatRegex,e,t)),isNaN(We)||(We=parseInt(We));let T=Math.floor(Date.now()/1e3);if(We<T&&(We=We*1e3),We=new Date(We).toISOString().slice(0,10),Ze=bt(We),Ze<a){Pe=!0;continue}o[Ze]=o[Ze]||{details:[],totalSpent:0},p[Ze]||(p[Ze]=new Map)}let Ha={};if(e.dataExtractor.commonAttributes.selectors)try{for(let T in e.dataExtractor.commonAttributes.selectors){let V=k(De,e.dataExtractor.commonAttributes.selectors[T]);Ha={...Ha,[T]:V}}}catch{g("ERROR_SPENDCALC_SELECTORS",t)}b++,Wt[c]=b;let Pt=0,Xt;he=he||(e.dataExtractor.commonAttributes.totalAmount?k(De,e.dataExtractor.commonAttributes.totalAmount):0),e.priceRegex&&typeof he=="string"&&(he=he.match(new RegExp(e.priceRegex.reg))[e.priceRegex.ind]),e.priceReplace&&typeof he=="string"&&(he=he.replace(new RegExp(e.priceReplace,"g"),T=>T.replace(/\./g,"_").replace(/,/,".").replace(/_/g,","))),typeof he=="string"&&(he=he.replaceAll(",","")),he=parseFloat(he);let pa=0;try{pa=(X=(Z=e==null?void 0:e.dataExtractor)==null?void 0:Z.commonAttributes)!=null&&X.totalRefund?parseFloat(k(De,(xe=(ne=e==null?void 0:e.dataExtractor)==null?void 0:ne.commonAttributes)==null?void 0:xe.totalRefund)):0}catch{pa=0}let Re=e.dataExtractor.commonAttributes.orderStatus?k(De,e.dataExtractor.commonAttributes.orderStatus):null;if((zt=(ut=(Be=e==null?void 0:e.dataExtractor)==null?void 0:Be.commonAttributes)==null?void 0:ut.orderStatusArr)!=null&&zt.selector)try{const T=k(De,e.dataExtractor.commonAttributes.orderStatusArr.selector);if(Array.isArray(T)&&T.length>0){const V=(xt=($e=($a=e==null?void 0:e.dataExtractor)==null?void 0:$a.commonAttributes)==null?void 0:$e.orderStatusArr)==null?void 0:xt.index;if(Re=V!==void 0&&Number.isInteger(V)&&V<T.length?T[V]:T[T.length-1],(Ee=(ve=(Ne=e==null?void 0:e.dataExtractor)==null?void 0:Ne.commonAttributes)==null?void 0:ve.orderStatusArr)!=null&&Ee.jsonPath)try{Re=k(Re,e.dataExtractor.commonAttributes.orderStatusArr.jsonPath)}catch{}}}catch{Re=null}e!=null&&e.orderStatusRegex&&typeof Re=="string"&&(Re=Re.match(new RegExp(e.orderStatusRegex.regex))[e.orderStatusRegex.index]);let Er=[];if(e.dataExtractor.orderApi&&!e.apiForPid){let T=await on(t,e,Ha,Er,s,ae,i,r);he=T!=null&&T.orderTotal&&!isNaN(T==null?void 0:T.orderTotal)&&(T==null?void 0:T.orderTotal)>0?T==null?void 0:T.orderTotal:he,Re=T!=null&&T.orderStatus&&(T==null?void 0:T.orderStatus.trim())!==""?T==null?void 0:T.orderStatus:Re}if(e.orderDetails)for(let T of e.orderDetails)try{if(T.key=="image"&&e.dataExtractor.imagePrefix)ae[T.key]=e.dataExtractor.imagePrefix+k(De,T.value);else if(T.key=="curr"){if(ae[T.key]=k(De,T.value),e!=null&&e.curRegex){let V=new RegExp((Ae=e==null?void 0:e.curRegex)==null?void 0:Ae.reg),Le=(He=ae[T==null?void 0:T.key])==null?void 0:He.match(V);Le&&(ae[T==null?void 0:T.key]=Le[e==null?void 0:e.curRegex.ind])}e.multiCurr&&ae[T.key]&&(w[ae[T.key]]?w[ae[T.key]]+=1:w[ae[T.key]]=1)}else if(typeof T.value=="object"){let V=T.value;ae[T.key]={};for(let Le in V)try{ae[T.key][Le]=k(De,V[Le])}catch{g(`ERROR_SPENDCALC_${Le}`,t)}}else if(T!=null&&T.extract){let V=k(De,T==null?void 0:T.extract);try{V=JSON.parse(V)}catch{V=V}ae[T.key]=k(V,T==null?void 0:T.value)}else if((T==null?void 0:T.key)=="orderTime")try{let V=k(De,T==null?void 0:T.value);V=uo(V),ae[T==null?void 0:T.key]=V}catch{}else ae[T.key]=k(De,T.value)}catch{g(`ERROR_SPENDCALC_${T}_ORDERDETAILS`,t)}if(ae.prod&&ae.image&&Lt[c].push({prod:ae.prod,image:ae.image}),e.dataExtractor.pidList){ae.itemDetails=[];async function T(V){var Qt,ya,Ht,_i,vi,Oi,Ai,Ei,Di,Ni,Ti,Li,Pi,Ri,gi,Mi,Si,Fi,Ji,ji,Bi;let Le=[];if(Array.isArray(e.dataExtractor.pidList))for(let ie of e.dataExtractor.pidList)Le.push(ie);else Le.push(e.dataExtractor.pidList);let Ce=[];if(e.dataExtractor.pidAttributes.pidApi)try{if(Pe!==void 0&&Pe)return;let ie;Ut==!0&&(ie=await ao(t,e,Ha,Ce,s,a,o,f,ae,c,i,r)),$t=(ie==null?void 0:ie.orderDiscount)||0,Zt=(ie==null?void 0:ie.totalExtraCharges)||0,he=ie!=null&&ie.orderTotal&&!isNaN(he)&&(ie==null?void 0:ie.orderTotal)>0?ie==null?void 0:ie.orderTotal:he,Re=ie!=null&&ie.orderStatus&&ie.orderStatus.trim()!==""?ie==null?void 0:ie.orderStatus:Re,Xt=ie!=null&&ie.orderUrl&&ie.orderUrl.trim()!==""?ie==null?void 0:ie.orderUrl:Xt,Pe=ie!=null&&ie.quarterCrossed?ie==null?void 0:ie.quarterCrossed:Pe,o=ie!=null&&ie.orderJSON&&Object.keys(o).length>0?ie==null?void 0:ie.orderJSON:o,We=ie!=null&&ie.orderDate&&ie.orderDate.trim()!==""?ie==null?void 0:ie.orderDate:We}catch{g("ERROR_SPENDCALC_PIDAPI",t)}for(let ie of Le)try{let Va;e!=null&&e.commonStatus&&(Va=k(V,e.commonStatus));let mt;ie?mt=k(V,ie):mt=[V],typeof mt=="string"&&(mt=JSON.parse(mt),(Qt=e==null?void 0:e.dataExtractor)!=null&&Qt.pidListPath&&(mt=k(mt,(ya=e==null?void 0:e.dataExtractor)==null?void 0:ya.pidListPath)));for(let Ka in mt){let Ga=[];if(e.dataExtractor.checkIfPidArr)try{let At=k(mt[Ka],e.dataExtractor.checkIfPidArr);for(let we of At)Ga.push(we)}catch{Ga.push(mt[Ka])}else Ga.push(mt[Ka]);for(let At of Ga){let we={},Ui=!1,Et=e.dataExtractor.pidAttributes.price?parseFloat(k(At,e.dataExtractor.pidAttributes.price)):0;if(Et&&e.pidPriceConvert&&(Et=Et*e.pidPriceConvert),e.dataExtractor.returnCheck)try{for(let ye of e.dataExtractor.returnCheck)try{k(At,ye)&&(Ui=!0)}catch{}}catch{g("ERROR_SPENDCALC_RETURNCHECK",t)}for(let ye in e.dataExtractor.pidAttributes)try{if(ye=="quantity"){let _e=k(At,e.dataExtractor.pidAttributes[ye]);Ar=isNaN(_e)?1:parseInt(_e),Pt=Pt*Ar}if(ye!="price"){let _e=k(At,e.dataExtractor.pidAttributes[ye]);if(we[ye]=_e,ye=="status"){if(Ui&&(_e="Returned",we[ye]="Returned"),e!=null&&e.commonStatus&&(we[ye]=Va,e!=null&&e.commonStatus&&(e!=null&&e.invalidStatus.includes(Va.trim().toLowerCase()))?Et=0:Pt+=Et),_e&&Et>0&&!e.invalidStatus.includes(_e.trim().toLowerCase())){if(e.dataExtractor.extraDiscount)for(let je of e.dataExtractor.extraDiscount)try{let Ye=parseFloat(k(At,je));isNaN(Ye)||(Et-=Ye*e.pidPriceConvert)}catch{g("ERROR_XTRADISCOUNT_SCRAPEPID",t)}Pt+=Et}}else if(ye=="addID"&&(e==null?void 0:e.addIDregex)!=null&&(e==null?void 0:e.addID)!="")try{const je=new RegExp(e==null?void 0:e.addIDregex,"g"),Ye=_e==null?void 0:_e.match(je);we[ye]=Ye?Ye[0]:null}catch{g("ERROR_ADDREG_SCRAPEPID",t),we[ye]=null}else if(ye=="image"){if(e.dataExtractor.imagePrefix&&(we[ye]=e.dataExtractor.imagePrefix+_e),e.dataExtractor.imageReplacements){let je=e.dataExtractor.imageReplacements;je&&(je.forEach(({key:Ye,value:Wa})=>{_e=_e.replace(`{${Ye}}`,Wa)}),we[ye]=_e)}if((Ht=e==null?void 0:e.dataExtractor)!=null&&Ht.parseImage)try{let je=_e&&JSON.parse(_e),Ye=je&&k(je,(vi=(_i=e==null?void 0:e.dataExtractor)==null?void 0:_i.parseImage)==null?void 0:vi.jsonPath);Ye&&!Ye.startsWith((Ai=(Oi=e==null?void 0:e.dataExtractor)==null?void 0:Oi.parseImage)==null?void 0:Ai.imagePrefix)&&(Ye=((Di=(Ei=e==null?void 0:e.dataExtractor)==null?void 0:Ei.parseImage)==null?void 0:Di.imagePrefix)+Ye),Ye&&(we[ye]=Ye)}catch{g("ERROR_PARSEIMAGE_SCRAPEPID",t)}if((Ni=e==null?void 0:e.dataExtractor)!=null&&Ni.constructImageUrlParams)try{let je=[];for(let Hs of((Li=(Ti=e==null?void 0:e.dataExtractor)==null?void 0:Ti.constructImageUrlParams)==null?void 0:Li.params)??[])try{let Dr=k(At,Hs);Dr&&je.push(Dr)}catch{}let Ye=((Ri=(Pi=e==null?void 0:e.dataExtractor)==null?void 0:Pi.constructImageUrlParams)==null?void 0:Ri.separator)??"",Wa=((Mi=(gi=e==null?void 0:e.dataExtractor)==null?void 0:gi.constructImageUrlParams)==null?void 0:Mi.fixedValue)??"",$i=(Fi=(Si=e==null?void 0:e.dataExtractor)==null?void 0:Si.constructImageUrlParams)==null?void 0:Fi.extension,Dt=je.length>0?je.join(Ye):"";Dt&&Wa&&(Dt+=Ye+Wa),Dt&&$i&&(Dt+="."+$i),Dt&&((Ji=e==null?void 0:e.dataExtractor)!=null&&Ji.imagePrefix)&&(Dt=((ji=e==null?void 0:e.dataExtractor)==null?void 0:ji.imagePrefix)+Dt),Dt&&(we[ye]=Dt)}catch{}}}else we[ye]=Et}catch{g(`ERROR_${ye}_PIDATTRIBUTES`,t)}for(let ye in e.dataExtractor.extraPidAttributes)try{let _e=e.dataExtractor.extraPidAttributes[ye];_e=_e.replace("PLACEHOLDER_PID",we.pid);let je=k(V,_e);we[ye]=je}catch{g("ERROR_SPENDCALC_XTRAPIDATTRIBUTES",t)}if(Ce.length>0){const ye=Ce.find(_e=>_e.pid==we.pid);ye&&(we={...we,...ye})}if(Er.length){const ye=Er.find(_e=>_e.pid===we.pid);ye&&(we={...we,...ye})}if(we!=null&&we.addressJSON)try{let ye=la(e,we==null?void 0:we.addressJSON,t);if(ye&&(Object.keys(ye).length>1||Object.keys(ye).length===1&&((Bi=Object.keys(ye==null?void 0:ye.addressJSON))==null?void 0:Bi.length)>0)){let _e;if(we!=null&&we.addID)_e=we==null?void 0:we.addID;else{let je=JSON.stringify(ye);je=je.replace(/[^a-zA-Z0-9]/g,""),_e=Aa(je)}f[_e]?JSON.stringify(f[_e]).length<JSON.stringify(ye).length&&(f[_e]=Object.assign({},JSON.parse(JSON.stringify(ye)))):f[_e]=ye,we.addID=_e,we==null||delete we.addressJSON}}catch{g("ERROR_SPENDCALC_ADDRESSJSON",t)}Object.keys(we).length>0&&(ae.itemDetails.push(we),Lt[c].push({prod:we.prod,image:we.image}),Xt&&(ae.url=Xt))}}if(e.dataExtractor.pidList=="same")try{Ce.length&&(ae.itemDetails.push({...Ce[0]}),Lt[c].push({prod:Ce[0].prod,image:Ce[0].image}),Xt&&(ae.url=Xt))}catch{g("ERROR_SAMEPIDLIST_SCRAPEPID",t)}}catch{g("ERROR_SPENDCALC_PIDLIST",t)}}if(e.dataExtractor.outerPidList){let V=[];if(Array.isArray(e.dataExtractor.outerPidList))for(let Le of e.dataExtractor.outerPidList)V.push(Le);else V.push(e.dataExtractor.outerPidList);for(let Le of V){let Ce=k(De,Le);for(let Qt in Ce){let ya=Ce[Qt];if(e.dataExtractor.commonAttributes.outerPidRefundAmt)try{let Ht=k(ya,e.dataExtractor.commonAttributes.outerPidRefundAmt);Ht&&(pa+=parseFloat(isNaN(Ht)?0:Ht))}catch{}await T(ya)}}}else await T(De)}if(he==0&&((Te=(ke=(dt=(Ge=e==null?void 0:e.dataExtractor)==null?void 0:Ge.pidAttributes)==null?void 0:dt.pidApi)==null?void 0:ke.pidApiAttributes)!=null&&Te.variousCharges&&Pt!=0&&(Pt=Pt-$t+Zt),he=Pt),isNaN(pa)||(he-=pa),he&&e.orderPriceConvert&&(he=he*e.orderPriceConvert),e.dataExtractor.extraChargesPerOrder){let T=0;for(let V of e.dataExtractor.extraChargesPerOrder)try{let Le=parseFloat(k(De,V));isNaN(Le)||(T+=Le)}catch{g("ERROR_SPENDCALC_XTRACHARGES",t)}T&&T>0&&(ae.totalExtraCharge=T)}if(ae!=null&&ae.addressJSON)try{let T=la(e,ae==null?void 0:ae.addressJSON,t);if(T&&(Object.keys(T).length>1||Object.keys(T).length===1&&((yt=Object.keys(T==null?void 0:T.addressJSON))==null?void 0:yt.length)>0)){let V;if(ae!=null&&ae.addID)V=ae==null?void 0:ae.addID;else{let Le=JSON.stringify(T);Le=Le.replace(/[^a-zA-Z0-9]/g,""),V=Aa(Le)}f[V]?JSON.stringify(f[V]).length<JSON.stringify(T).length&&(f[V]=Object.assign({},JSON.parse(JSON.stringify(T)))):f[V]=T,ae.addID=V,ae==null||delete ae.addressJSON}}catch{g("ERROR_SPENDCALC_ADDRESSJSON",t)}if(Re&&typeof Re=="number"&&(Re=e.statusMapping?e.statusMapping[Re]:Re),e!=null&&e.updateOrderTotalAtLastWhenZero&&he===0){for(let T of(wt=e.updateOrderTotalAtLastWhenZero)==null?void 0:wt.add)try{let V=k(De,T);typeof V=="string"&&(V=V.replace(",","")),V=parseFloat(V),!isNaN(V)&&V>0&&(he+=V)}catch{g("ERROR_SPENDCALC_ADD",t)}for(let T of e.updateOrderTotalAtLastWhenZero.subtract)try{let V=k(De,T);typeof V=="string"&&(V=V.replace(",","")),V=parseFloat(V),!isNaN(V)&&V>0&&(he-=V)}catch{g("ERROR_SPENDCALC_SUB",t)}}if(e.updateStatusAtLast){if(he!=0){try{he=parseFloat(k(De,e.updateStatusAtLast.totalAmount)),he*=e.pidPriceConvert}catch{g("ERROR_SPENDCALC_STATATLAST",t)}for(let T of ae.itemDetails)T.status="DELIVERED"}else if(he===0)if(Re==="CANCELLED")for(let T of ae.itemDetails)T.status="CANCELLED";else Re="RETURNED"}if(Re&&e.invalidStatus.includes(Re.trim().toLowerCase())&&(he=0),Re=Re?{orderStatus:Re}:{},typeof Re=="string"&&!e.invalidStatus.includes(Re.trim().toLowerCase())&&(he||g("ERROR_ORDERTOTAL",t)),he=he<0?0:he,e.multiCurr&&(ae!=null&&ae.curr)&&(p[Ze][ae==null?void 0:ae.curr]?p[Ze][ae==null?void 0:ae.curr]+=he:p[Ze][ae==null?void 0:ae.curr]=he),o[Ze].totalSpent+=he,o[Ze].details.push({orderId:pe,orderDate:We,orderTotal:he,orderDetails:ae,...Re}),d&&Ze<=a)return{orderJSON:o,orderCount:b,curr:{domCurr:m,curArr:x},quarterWiseCur:p,addressMap:f}}catch(De){g(JSON.stringify(De),t)}e!=null&&e.orderDelay&&await kc((e==null?void 0:e.orderDelay)||1500)}}try{if(e.dataExtractor.outerOrderList){let G=k(A,e.dataExtractor.outerOrderList);for(let z in G){let Z=G[z],X=k(Z,e.dataExtractor.orderList),ne=await Se(X);if(d&&Object.keys(o).length&&Ze<=a)return ne}}else{let G=k(A,e.dataExtractor.orderList)||A;e.dataExtractor.groupOrders&&(G=ss(G,e==null?void 0:e.groupKeys,e==null?void 0:e.itemKeys,t));let z=await Se(G);if(d&&Object.keys(o).length&&Ze<=a)return z}}catch{g("ERROR_SPENDCALC_ORDERLIST",t)}Rr("page_end",t,c);let It=_c((ce=qe[c][t])==null?void 0:ce.page_start,(K=qe[c][t])==null?void 0:K.page_end);if(ft("per_page_call",t,c,parseFloat(It)),ft("page_per_count",t,c),!e.ignoreZeroOrders&&Ie==0||e.pageEndCheck&&k(A,e.pageEndCheck.jsonPath)==e.pageEndCheck.equalTo||Pe)break}catch{ft("spend_failed",t,c);break}if(!e.dontBreakOuter&&Pe)break}catch{ft("spend_failed",t,c);break}e.multiCurr&&(x=Object.keys(w),m=l||((ge=Object.entries(w||{}).reduce((P,A)=>(A==null?void 0:A[1])>((P==null?void 0:P[1])||0)?A:P,[null,0]))==null?void 0:ge[0])),e!=null&&e.timeSpend&&(await oo(e==null?void 0:e.timeSpend,t,i,s,r,c,o,a),b=Wt[c])}catch(Me){ft("spend_failed",t,c),v("calculateSpend",Me),Bs(t,Me.message)}return{orderJSON:o,orderCount:b,curr:{domCurr:m,curArr:x},quarterWiseCur:p,addressMap:f}}async function cs(e,t,a,i,s){try{let r=i,c=new Set;e.length||c.add("No_Data");for(let l of e)try{let d=JSON.parse(l==null?void 0:l.details);if(!Array.isArray(d)||d.length===0)c.add(`No_Spend_${l==null?void 0:l.quarter}`);else for(let o of d){let f=Array.isArray(r==null?void 0:r.orderLevel)?r==null?void 0:r.orderLevel.filter(m=>!o.hasOwnProperty(m)||!o[m]):[];for(let m of f)c.add(m);let p=o==null?void 0:o.orderDetails;(!p||!Object.keys(p).length&&r.orderDetails)&&c.add("orderDetails");let w=Array.isArray(r==null?void 0:r.orderDetails)?r==null?void 0:r.orderDetails.filter(m=>!p.hasOwnProperty(m)||!p[m]):[];for(let m of w)c.add(m);let x=p==null?void 0:p.itemDetails;if(!x||!Array.isArray(x)||x.length===0&&r.itemLevel)c.add("itemDetails");else for(let m of x){let y=Array.isArray(r==null?void 0:r.itemLevel)?r==null?void 0:r.itemLevel.filter(b=>!m.hasOwnProperty(b)||!m[b]):[];for(let b of y)c.add(b)}}}catch{}for(let l of c){let d={pos:t,spend_id:a,missing_keys_report:`${l}_${t}`};ft("spend_missing_key",t,s),await Fe("SpendCalcExtractMissing",d),await ha({eventID:77,errorSource:"spendMonitoring",errorDetails:d})}try{for(let l of st[t]){let d={pos:t,spend_id:a,missing_keys_report:`${l}_${t}`,[`${l}_${t}_count`]:st[t][l]};ft("spend_missing_key",t,s),await Fe("SpendCalcExtractMissing",d),await ha({eventID:77,errorSource:"spendMonitoring",errorDetails:d})}}catch{}st[t]={}}catch{}}async function ls(e,t,a){try{let s={ext_id:await h.getItem("ext_id"),stage:"spend_clicked",spendId:e,pos:t},r=await fetch("https://ext1.buyhatke.com/extension-apis/analytics/track/Spend_Lens/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(r=await r.json(),r!=null&&r.id){let c=r==null?void 0:r.id;ft(`${e}~${c}~APILOGS`,t,a)}return{}}catch{}}async function po(e,t,a,i,s,r,c,l=!1,d=""){try{let o=await us(e,a,t);if(o.redirectUrl)return o;let{totalSpent:f,lastQuarter:p,spendId:w,totalOrders:x,domCurr:m}=o;if(d&&(p=d),!w||isNaN(w))return ft("spend_id_not_found",e,c),0;await ls(w,e,c),st[e]||(st[e]={});let{additionalSpend:y,data:b,additionalOrders:I,curArr:O=[],addressMap:L={}}=await ns(t,e,p,i,s,r,c,m,l);return t!=null&&t.missingConfig&&await cs(b,e,w,t==null?void 0:t.missingConfig,c),await hs(w,b,O,L),delete Wt[c],delete Lt[c],{totalSpent:f+y,totalOrders:I+x,domCurr:m}}catch(o){return ft("spend_failed",e,c),v("spendCalculate",o),delete Wt[c],delete Lt[c],0}}function yo(e){return Wt[e]||0}function wo(e){return Lt[e]||[]}async function mo(){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let e=`https://ext1.buyhatke.com/spend-apis/spend-calc/updateAutoSync?extId=${u.ext_id}&extAuth=${u.ext_auth}`,a=await(await fetch(e)).json();return a.status==1?a.data:{}}catch(e){return v("updateAutoSync",e),{}}}async function bo(e,t){try{return await(await fetch(e,t)).text()}catch{}}const Io=15,xa={};async function xo(e,t,a,i,s=""){try{const r=String(i),c=`${r}_${t}`;if(xa[c])return;xa[c]=!0;let l=await h.getItem(a)||{};l[r]||(l[r]={}),l[r][t]||(l[r][t]=[]);const d=l[r][t];if(e!=null&&e.prev&&!(d.findIndex(x=>x.key===e.prev)!==-1)){delete xa[c];return}const o=Date.now(),f=s?`${s}~${o}`:o,p=d.findIndex(w=>w.key===(e==null?void 0:e.key));p!==-1?d[p].ts=f:(d.push({key:e==null?void 0:e.key,ts:f}),d.length>Io&&d.shift()),l[r][t]=d,await h.setItem(a,l),delete xa[c]}catch{delete xa[`${i}_${t}`]}}async function os(e){try{let t=new Date,a=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()).getTime(),i=`https://search-new.bitbns.com/extension/configs-spendCalc/prodNew/${e}.json?rand=${a}`,s=await fetch(i);return s.status>=400&&s.status<599?null:(s=await s.json(),s)}catch(t){return v("getSpendConfig",t),null}}async function us(e,t,a){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");const i={pos:e,usernameObj:t};let s=`https://ext1.buyhatke.com/spend-apis/spend-calc/getQuarters?extId=${u.ext_id}&extAuth=${u.ext_auth}`,c=await(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).json(),l=a.defaultQuarter?a.defaultQuarter:"2000_0";if(c.status==0){if(c.redirectUrl)return{redirectUrl:c.redirectUrl};throw new Error("Something went wrong")}let{spendId:d,lastQuarter:o,totalSpent:f,totalOrders:p,domCurr:w}=c.data;return o=o?o.endsWith("_3")?`${parseInt(o.split("_")[0])+1}_0`:`${o.split("_")[0]}_${parseInt(o.split("_")[1])+1}`:l,{lastQuarter:o,spendId:d,totalSpent:f,totalOrders:p,domCurr:w}}catch(i){return v("getSpendSummary",i),{}}}async function ds(e,t){const a=new TextEncoder,i=a.encode(t),s=await crypto.subtle.importKey("raw",i,{name:"PBKDF2"},!1,["deriveKey"]),r=crypto.getRandomValues(new Uint8Array(16)),c=await crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!1,["encrypt"]),l=a.encode(e),d=crypto.getRandomValues(new Uint8Array(12)),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:d},c,l),f=new Uint8Array(r.byteLength+d.byteLength+o.byteLength);return f.set(r,0),f.set(d,r.byteLength),f.set(new Uint8Array(o),r.byteLength+d.byteLength),btoa(Array.from(f).map(p=>String.fromCharCode(p)).join(""))}async function hs(e,t,a={},i={},s=!1){try{let{keyEnc:r,keyTime:c}=await chrome.storage.local.get(["keyEnc","keyTime"]);(!r||!c)&&await Or();let l=await chrome.storage.local.get(["keyEnc","keyTime"]);if(r=l.keyEnc,c=l.keyTime,t){let d=`https://ext1.buyhatke.com/spend-apis/spend-calc/orderHistory/v2?extId=${u.ext_id}&extAuth=${u.ext_auth}&time=${c}`,o={spendId:e,data:t};a&&(o.currency=a),i&&(o.addressDetails=i),s&&(o.isBusiness=s);const f=await ds(JSON.stringify(o),r);let p=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({raw:f})});return!0}}catch(r){v("pushSpendData",r)}return!1}async function ko(){try{let e=new Date,a=`https://search-new.bitbns.com/extension/configs-ext/prod/DittoScrapConfig.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(a);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(e){return v("getDittoScrapConfig",e),""}}async function _o(e,t){try{if(e)return Us(e,t)}catch(a){return v("getSearchHTML",a),""}}async function vo(e,t){try{let a="https://search-new.bitbns.com/buyhatke/sendDittoSearchGlobal",i={"Content-Type":"application/json"};if(t.pid&&t.pos&&e){let r=await fetch(a,{method:"POST",headers:i,body:JSON.stringify({data:e,currData:t})});if(r.status>=400&&r.status<=599)throw new Error("status: "+r.status);return r=await r.json(),r;E(await r.json())}return""}catch(a){return v("sendDittoSearchData",a),""}}async function Oo(e,t,a,i,s,r,c){try{let l="https://search-new.bitbns.com/buyhatke/sendExactData",d={"Content-Type":"application/json"};if(a&&t&&e){let f=await fetch(l,{method:"POST",headers:d,body:JSON.stringify({exactData:e,pos:t,pid:a,prod:i,price:s,image:r,src:c})});if(f.status>=400&&f.status<=599)throw new Error("status: "+f.status);f=await f.json(),E(await f.json())}return""}catch(l){return v("sendDittoSearchData",l),""}}async function Ao(e){try{let{pid:t,pos:a,prod:i,price:s}=e,r=`https://search-new.bitbns.com/buyhatke/getProductCategorization?pid=${t}&pos=${a}&prod=${i}&price=${s}`,c=await fetch(r);return c.status>=400&&c.status<599?"":(c=await c.json(),c)}catch(t){return v("sendDittoSearchData",t),""}}function gt(e){if(e.method=="POST"||e.method=="GET"||e.method=="PUT"){if(JSON.stringify(e).indexOf("BUYHATKE")>-1||JSON.stringify(e).indexOf("buyhatke")>-1)Ft=1;else if(pt&&Object.keys(pt).length)try{for(let t in pt)if(pt.hasOwnProperty(t))try{let a=t.split("~")[0],i=t.split("~")[1],s=a.replace(/\*/g,".*").replace(/\//g,"\\/");new RegExp(s).test(e.url)&&e.tabId==i&&(Ft=1)}catch{}}catch{}Vt++,Jt=e}}async function Mt(e){if(e.method=="POST"||e.method=="PUT"||e.method=="GET")if(e.requestBody!=null){let t="";if(e.requestBody.hasOwnProperty("raw")?t=String.fromCharCode.apply(null,new Uint8Array(e.requestBody.raw[0].bytes)):t=JSON.stringify(e.requestBody),t.indexOf("BUYHATKE")>-1||t.indexOf("buyhatke")>-1)Ft=1;else if(pt&&Object.keys(pt).length)try{for(let a in pt)if(pt.hasOwnProperty(a))try{let i=a.split("~")[0],s=a.split("~")[1],r=i.replace(/\*/g,".*").replace(/\//g,"\\/");new RegExp(r).test(e.url)&&e.tabId==s&&(Ft=1)}catch{}}catch{}Vt++,ea=t}else Vt++,ea="NULL"}var cr={};async function wi(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();cr=await(await fetch("https://search-new.bitbns.com/extension/configs-coupons/prod/ALL_CONFIG_COUPON.json?rand="+t)).json()}catch(e){v("getACSiteDetails",e),E("Error in getACSiteDetails ",e)}}wi();setInterval(()=>{wi()},12*60*60*1e3);var lr={},mi={},va={};let ri={};async function bi(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();lr=await(await fetch("https://search-new.bitbns.com/extension/configs-coupons/prod/ALL_CONFIG.json?rand="+t)).json()}catch(e){v("getSiteDetails",e),E("Error in getSiteDetails ",e)}}async function Eo(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();va=await(await fetch("https://search-new.bitbns.com/extension/configs-coupons/prod/REGION_CONFIG.json?rand="+t)).json()}catch(e){v("getMultiRegionConfig",e),E("Error in getMultiRegionConfig ",e)}}async function Do(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();ri=await(await fetch("https://search-new.bitbns.com/extension/configs-ext/prod/shortenedUrlConfig.json?rand="+t)).json()}catch(e){v("getShortenedUrlConfig",e),E("Error in getShortenedUrlConfig ",e)}}async function Ii(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();mi=await(await fetch("https://search-new.bitbns.com/extension/configs-ext/prod/blockUI.json?rand="+t)).json()}catch(e){v("getBlockUISiteDetails",e),E("Error in getBlockUISiteDetails ",e)}}bi();Ii();setInterval(()=>{bi(),Ii()},12*60*60*1e3);async function fs(){try{for(let e in Zr){let{name:t,events:a,errorMessage:i}=Zr[e],s=await h.getItem(t)||{};for(let r in s){let c=s[r];for(let l in c){let d={message:i,pos:parseInt(l)},o=c[l]||[];o.sort((b,I)=>{let O=typeof b.ts=="string"&&b.ts.includes("~")?Number(b.ts.split("~")[1]):b.ts,L=typeof I.ts=="string"&&I.ts.includes("~")?Number(I.ts.split("~")[1]):I.ts;return O-L});let f=Date.now(),p=!1,w=[],x={},m={};for(let b of o)if(typeof b.ts=="string"&&b.ts.includes("~")){const[I,O]=b.ts.split("~");x[b.key]=Number(O),m[b.key]=I}else x[b.key]=b.ts;let y=a[0].key;if(m[y]&&(d.orderId=m[y]),!x[y]){p=!0;continue}for(let b=1;b<a.length;b++){let I=a[b],O=a.find(j=>j.key===I.prev);if(!O)continue;let L=x[O.key],F=x[I.key];if(m[O.key]&&(d.orderId=m[O.key]),F&&L)if(F-L<=I.TTL){p=!0;break}else{await Fe(`${t}Error`,d),p=!0;break}else if(L&&!F)if(f-L>I.TTL){await Fe(`${t}Error`,d),p=!0;break}else w=o}p?delete c[l]:c[l]=w}Object.keys(c).length===0?delete s[r]:s[r]=c}await h.setItem(t,s)}}catch{}}fs();setInterval(async()=>{await fs()},60*1e3);async function ps(){var e;try{let t=await h.getItem("ext_id"),a=await h.getItem("SCMonitorData"),i=JSON.parse(a??"{}");for(let s of Object.keys(i))try{let r=i[s];for(let c of r)try{let l={[s]:{stages:[]}},d=[],o={},f={};for(let p of c)try{if(typeof(p==null?void 0:p.stage)=="string"&&((e=p==null?void 0:p.stage)!=null&&e.includes("APILOGS")))try{let w=p==null?void 0:p.stage.split("~");f.spendId=parseInt(w[0]),f.id=parseInt(w[1]),f.ext_id=t,f.pos=parseInt(s)}catch{}else((p==null?void 0:p.stage)=="per_page_call"||(p==null?void 0:p.stage)=="time_taken")&&(o[p==null?void 0:p.stage]=parseFloat(p==null?void 0:p.count)),d.push(p)}catch{}f.stages=o,l[s].stages=d,l.ext_id=t,await fetch("https://ext1.buyhatke.com/extension-apis/analytics/track/Spend_Lens",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),Object.keys(f.stages).length>1&&await fetch("https://ext1.buyhatke.com/extension-apis/analytics/track/Spend_Lens/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})}catch{}}catch{}await h.removeItem("SCMonitorData")}catch{}}ps();setInterval(async()=>{await ps()},25*60*1e3);var Yt={};async function _r(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();Yt=await(await fetch("https://search-new.bitbns.com/extension/configs-coupons/prod/REJECT_SITES.json?rand="+t)).json()}catch(e){v("rejectSiteDetails",e),E("Error in rejectSiteDetails ",e)}}_r();setInterval(()=>{_r()},12*60*60*1e3);let yr=new Map,Na=[],hn=Date.now();async function ys(){const e=Date.now();if(!(e-hn<5*60*1e3||Na.length===0))try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth"),await fetch(`https://ext1.buyhatke.com/extension-apis/logMismatchedPos?extId=${u.ext_id}&extAuth=${u.ext_auth}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mismatches:Na})}),hn=e,Na=[]}catch{}}async function No(e){var t;try{let a=e,i=(t=new URL(a))==null?void 0:t.hostname;a=a.split("?")[0],Object.keys(cr).length==0&&await wi(),Object.keys(Yt).length==0&&await _r();for(let s=0;s<Yt.length;s++){const r=Yt[s];if(e.startsWith(r))return""}for(let s in cr){const r=cr[s];for(let c of r.url)if(new RegExp(c.replace(/\./g,"\\.")).test(a)){if(r.notmatch&&r.notmatch.some(f=>new RegExp(f.replace(/\./g,"\\.")).test(a)))continue;let d=a.split("https://");if(d.length>1&&(a=d[1]),!a.startsWith(c))try{yr.has(i)||(yr.set(i,!0),Na.push({hostname:i,ACpos:s}),ys())}catch{}return parseInt(s)}}return""}catch(a){return v("getACPOS",a),""}}async function fn(e,t){var a;try{let i=e,s=(a=new URL(i))==null?void 0:a.hostname;i=i.split("?")[0],Object.keys(lr).length==0&&await bi(),Object.keys(va).length==0&&await Eo(),Object.keys(mi).length==0&&await Ii(),Object.keys(Yt).length==0&&await _r();for(let r=0;r<Yt.length;r++){const c=Yt[r];if(e.startsWith(c))return""}for(let r in lr)if(new RegExp(r).test(i)){let l=lr[r],d=i.split("https://");if(d.length>1&&(i=d[1]),!i.startsWith(r))try{yr.has(s)||(yr.set(s,!0),Na.push({hostname:s,pos:l}),ys())}catch{}if(va.hasOwnProperty(`${l}`)){try{const o=await chrome.tabs.sendMessage(t,{action:"getRegion",config:va[`${l}`]});if(o&&o.region){let f=va[`${l}`].options;for(let p in f)if(o.region===p)return l=f[p],l}}catch{}return""}return l}return""}catch(i){return v("getPos",i),""}}let Ur={};async function To(e){try{if(isNaN(e)||e==0)return{status:1,data:{}};if(Ur[e])return Ur[e];let t=`https://search-new.bitbns.com/buyhatke/getPosDetails?pos=${e}`,a=await fetch(t);return a.status>=400&&a.status<599?"":(a=await a.json(),Ur[e]=a,a)}catch(t){return v("getSiteLogo",t),""}}async function Lo(e){try{let t=mi.sitesToBlock||{};return t.hasOwnProperty(e.toString())&&t[e]}catch(t){return console.log(t),!1}}async function Po(e){try{let t=await h.getItem("ext_id"),a=await h.getItem("ext_auth"),i=`https://ext1.buyhatke.com/spend-apis/extSavings/extSavings?extId=${t}&extAuth=${a}`;return(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).status===200?200:400}catch(t){v("savings POST failure",t)}}async function Ro(e){try{const a=Array.isArray(e)?JSON.stringify(e):String(e||"[]");u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var t=`https://ext1.buyhatke.com/extension-apis/sendSpecsApple?extId=${u.ext_id}&extAuth=${u.ext_auth}`;const i="varArr="+encodeURIComponent(a);await oe(t,"POST",i,"formData")}catch{}}async function go(e,t){try{let a=e?e[Object.keys(e)[0]]:void 0;if(a===void 0||typeof a!="object"||a===null||Object.keys(a).length===0)return"";let c=await fetch("https://ext1.buyhatke.com/extension-apis/general/sendFilters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pos:t,details:e})});return""}catch{}}async function Mo(e){try{let{keyEnc:t,keyTime:a}=await chrome.storage.local.get(["keyEnc","keyTime"]);(!t||!a)&&await Or();let i=await chrome.storage.local.get(["keyEnc","keyTime"]);t=i.keyEnc,a=i.keyTime;let s=`https://ext1.buyhatke.com/extension-apis/postUpdateNew?extId=${u.ext_id}&extAuth=${u.ext_auth}&time=${a}`;const r=await ds(JSON.stringify(e),t);return(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({raw:r})})).status===200?200:400}catch(t){v("cart POST failure",t)}}async function ws(e,t,a){try{let i=e.replace("PLACEHOLDER_FLIP_ENDPOINT",Xa),s=await fetch(i,t);s.status>300&&(Xa=Xa==="1"?"2":"1",i=e.replace("PLACEHOLDER_FLIP_ENDPOINT",Xa),s=await fetch(i,t));let r={status:s.status,ok:s.ok};return a?r.body=await s.text():r.body=await s.json(),r}catch{}}async function So(e,t,a){try{let i=JSON.stringify(a.options);i=i.replace("PLACEHOLDER0",e),i=i.replace("PLACEHOLDER1",t),i=JSON.parse(i);let r=(await ws(a.url,i,!1)).body,c=a.priceDataListKey,l=k(r,c),d=1e15;for(let o of l){let f=a.innerPriceDataKey,p=k(o,f);p=parseFloat(p),isNaN(d)||(d=Math.min(p,d))}return d<=0||d>=1e15?0:d}catch{return-1}}async function Fo(e){try{let i=await fetch("https://utility.buyhatke.com/extension-savings/postLiveData",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);return""}catch{}}async function Jo(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let t=`https://api.buyhatke.com/autocoupon-apis/updateCouponStatus?extId=${u.ext_id}&extAuth=${u.ext_auth}`,i=await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);return""}catch(t){return v("updateCouponStatus",t),""}}async function jo(e){try{return await pd(e),""}catch(t){return v("ACTSMonitor",t),""}}async function Bo(e){try{return e.eventID=16,await Ss(e),""}catch(t){return v("AcMonitor",t),""}}async function Uo(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let t=`https://api.buyhatke.com/autocoupon-apis/checkoutScrap?extId=${u.ext_id}&extAuth=${u.ext_auth}`;e.ext_id=u.ext_id;let a=JSON.stringify(e),s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:a});if(s.status>=400&&s.status<=599)throw new Error("status: "+s.status);return""}catch(t){return v("sendCheckoutScrap",t),""}}async function $o(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let t=`https://api.buyhatke.com/autocoupon-apis/voucherScrap?extId=${u.ext_id}&extAuth=${u.ext_auth}`,a=JSON.stringify(e),s=await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:a});if(s.status>=400&&s.status<=599)throw new Error("status: "+s.status);return""}catch(t){return v("sendVoucherScrap",t),""}}const Ho=(e,t,a=!1)=>{const i=a?(26-t)%26:t,s=i>0?i:26+i%26;return[...e].map((r,c)=>{const l=e.charCodeAt(c);return l>=65&&l<=90?String.fromCharCode((l-65+s)%26+65):l>=97&&l<=122?String.fromCharCode((l-97+s)%26+97):r}).join("")};async function Vo(e){try{let t=Ho(e,gl),a=await(h.getItem("popHash")||JSON.parse(h.getItem("popHash")==null)?{}:await h.getItem("popHash"));a[t]!=null?a[t]++:a[t]=1,await h.setItem("popHash",JSON.stringify(a))}catch(t){v("incPopCounter",t),E(t)}}async function ms(){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let e=await JSON.parse(h.getItem("popHash")==null?"{}":h.getItem("popHash"));if(Object.keys(e).length==0)return"";let t=`https://ext1.buyhatke.com/extension-apis/popcount?extId=${u.ext_id}&extAuth=${u.ext_auth}`,i=await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);return i.ok&&(i=await i.json(),i.status==1&&await h.removeItem("popHash")),""}catch{return""}}ms();setInterval(ms,15*60*1e3);async function Ko(){try{E("I am here");let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();return await(await fetch("https://search-new.bitbns.com/extension/configs-coupons/prod/scrapSiteDetails.json?rand="+t)).json()}catch(e){return v("getHTMLScrapSites",e),""}}async function Go(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let t=`https://api.buyhatke.com/autocoupon-apis/htmlscrap?extId=${u.ext_id}&extAuth=${u.ext_auth}`,i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);return""}catch(t){return v("sendScrapHTML",t),""}}async function Wo(e){try{let t=new Date,a=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()).getTime(),i=`https://search-new.bitbns.com/extension/configs-coupons/prod/category_${e}.json?rand=${a}`,s=await fetch(i);return s.status>=400&&s.status<599?[]:(s=await s.json(),s)}catch(t){return v("getCategoryConfig",t),[]}}async function Yo(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let t=`https://ext1.buyhatke.com/extension-apis/specsCrawl?extId=${u.ext_id}&extAuth=${u.ext_auth}`,i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);return E(await i.json()),""}catch(t){return v("sendCategoryCrawl",t),""}}async function zo(){try{let e=await h.getItem("referralDataSource"),t=parseInt(Math.random()*100);if(e&&e.source)return;if(t>5)return;let a=await h.getItem("ext_id"),i=await h.getItem("ext_auth"),r=await(await fetch(`https://settings.buyhatke.com/extension-settings/fetchSource?ext_id=${a}&ext_auth=${i}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json();if(r.success==!0){let c={source:r.source,uniqcode:""};await h.setItem("referralDataSource",c)}else throw new Error("logging failed !");return""}catch(e){return v("referralData",e),E(e),""}}zo();async function Qa(e,t,a){try{let i=navigator.userAgent||navigator.vendor||window.opera;/android/i.test(i)?a=0:a==0?a=1:a=0,u.ext_id=await h.getItem("ext_id"),u.referralDataSource=await h.getItem("referralDataSource");let s={source:e,uniqcode:t};u.referralDataSource||(await h.setItem("referralDataSource",s),u.referralDataSource=s);let r=`https://compare.buyhatke.com/extension_referral/getdata?extID=${u.ext_id}&extAuth=`+u.ext_auth,l=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,fromMobile:a})});if(l.status>=400&&l.status<=599)throw new Error("status: "+l.status);return E(await l.json()),""}catch(i){return v("referralData",i),E(i),""}}async function Zo(e){try{u.ext_id=await h.getItem("ext_id");let t=e.url.split("//")[1];return t=t.split("/")[0],""}catch(t){return v("getAffCouponsNew",t),""}}let pn=[];async function Xo(e){try{if(!e||pn.includes(e))return"";let t=new Date,a=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()).getTime(),i=`https://search-new.bitbns.com/extension/configs-coupons/prod/couponScrap_${e}.json?rand=${a}`,s=await fetch(i);return s.status===404&&pn.push(e),s.status>=400&&s.status<599?"":(s=await s.json(),s)}catch{return""}}async function Qo(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let t=`https://api.buyhatke.com/autocoupon-apis/updateCouponScrap?extId=${u.ext_id}&extAuth=${u.ext_auth}`,i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);return""}catch(t){return v("sendCouponScrap",t),""}}async function Co(e){try{let t=`https://search-new.bitbns.com/buyhatke/deals?prod=${encodeURIComponent(e.prod)}&brand=${encodeURIComponent(e.brand)}&price=${e.price}&category=${encodeURIComponent(e.category)}&pid=${encodeURIComponent(e.pid)}&pos=${encodeURIComponent(e.pos)}`,a=await fetch(t);if(a.status>=400&&a.status<=599)throw new Error("status: "+a.status);return a=await a.json(),a}catch(t){return v("getFeeds",t),""}}function ii(e){try{ra={};for(let t=0;t<e.length;t++){let a=e[t].pid,i=e[t].position,s=`${a}*~*${i}`;ra[s]=1}}catch(t){v("updateWatchListMap",t)}}async function bs(){try{let e=await h.getItem("autoAlert");const t=Date.now();e?t-e>=864e5&&(await h.setItem("autoAlert",t),await Ra(!0),await yn(Ue)):(await h.setItem("autoAlert",t),await Ra(!0),await yn(Ue))}catch(e){v("Error checking autoAlertScrape",e)}}async function yn(e){var t,a,i,s,r;try{for(let c=0;c<e.length;c++){let l=(t=e[c])==null?void 0:t.pid,d=(a=e[c])==null?void 0:a.position,o=(i=e[c])==null?void 0:i.link_id,f=(s=e[c])==null?void 0:s.entry_id,p=(r=e[c])==null?void 0:r.link,w=u.ext_id,x=u.ext_auth;if(!(!p&&d))try{let m=await fetch(p);if(!m.ok)throw new Error(`Error fetching product at ${p}: ${m.statusText}`);if(m.status>=400&&m.status<=599)throw new Error(`Product at ${p} returned error status: ${m.status}`);m=await m.text();const y={productID:l,productPOS:d,productLinkID:o,productEntryID:f,productLink:p,clientExtId:w,clientExtAuth:x,fetchedHTML:m};ci||await Ra(!0);let b=ci+"/spidy/watchPriceResponse";await qo(y,b),await new Promise(I=>setTimeout(I,3e3))}catch(m){v("error in fetching HTML : ",m);continue}}}catch(c){v("error in autoAlert_feedData:",c)}}async function qo(e,t){let i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok)throw new Error(`Error during POST request to ${t}: ${i.statusText}`)}async function eu(e){try{let t=new Date,a=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()).getTime(),i=`https://search-new.bitbns.com/extension/configs-coupons/prod/wishlist_${e}.json?rand=${a}`,s=await fetch(i);return s.status>=400&&s.status<599?"":(s=await s.json(),s)}catch(t){return v("getScrapConfigWishlist",t),""}}async function tu(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let t=[];for(let r=0;r<e.length;r++){e[r].extid=u.ext_id,e[r].extauth=u.ext_auth;let c=e[r].pid,l=e[r].pos,d=`${c}*~*${l}`;ra[d]||t.push(e[r])}if(t.length==0)return"";let s=await fetch("https://api.buyhatke.com/paapi/priceAlertWishlist",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"data="+encodeURIComponent(JSON.stringify(t))});if(s.status>=400&&s.status<=599)throw new Error("status: "+s.status);return s.status==200&&(t.length>20?setTimeout(da,2e4):da()),""}catch(t){return v("sendWishListData",t),""}}var Is={};function au(e){var t=e.split("#~#"),a=t[2],i=t[1],s=t[0],r={};r.bread=i,r.pos=a,Is[s]=r}function ru(e){var t=e.split("#~#"),a=t[2],i=t[1],s=t[0],r=Is[s];if(r){var c=r.bread,l=r.pos;(a!=l||i!=c)&&i!=""&&c!=""&&a!=0&&l!=0&&iu(i,a,c,l)}}async function iu(e,t,a,i){try{var s="https://compare.buyhatke.com/extension/scm.php",r=s;myRand=parseInt(Math.random()*999999999999999);var c=r+"?rand="+myRand+"&bread="+encodeURIComponent(e)+"&pos="+t+"&bread_act="+encodeURIComponent(a)+"&pos_act="+i,l=await oe(r,"GET",null)}catch(d){v("sendMatchFound",d),E("Error sendMatchFound ",d)}}async function nu(e){try{u.existingSales=await h.getItem("existingSales");var t=u.existingSales;t=JSON.parse(t);for(var a=0;a<t.length;a++)for(var i=0;i<t[a].length;i++)if(t[a][i].code==e)return t[a][i].time}catch(s){v("getStartTime",s),E("Error getStartTime ",s)}return 0}async function su(e){try{u.checkedArray=await h.getItem("checkedArray");var t=u.checkedArray;return t=JSON.parse(t),t[e]===!0?1:0}catch(a){v("getSubsStatus",a),E("Error getSubsStatus ",a)}}async function cu(e){try{let t=rn||[],a={};for(let i=0;i<t.length;i++){let s=t[i],r=0,c=s.offer_id?s.offer_id:"",l=s.frequency?s.frequency:12;if(l=l*60*60*1e3,!c)continue;if((s.posToShow?s.posToShow:[]).includes(e.pos)){if(a=await h.getItem("goodiesInStore"),a)if(a=JSON.parse(a),a[c]){let o=new Date().getTime();a[c]+l<=o&&(r=1)}else r=1;else r=1,a={};if(r&&(s.bread_arr||s.url_reg_arr||s.price_range)&&(r=lu(s,e)),s.toShow=r,a!=null&&a[c]||(a[c]=0),r==1)return a[c]=new Date().getTime(),await h.setItem("goodiesInStore",JSON.stringify(a)),s}}return{}}catch{return{}}}function lu(e,t){try{if(!e.bread_arr&&!e.url_reg_arr&&!e.price_range)return 1;let{pos:a,url:i,bread:s,price:r}=vr(t);s&&(s=s.trim()),r&&parseFloat(r)>0&&!isNaN(parseFloat(r))?r=parseFloat(r):r=0;let c=e!=null&&e.url_reg_arr?e==null?void 0:e.url_reg_arr:[],l=e!=null&&e.bread_arr?e==null?void 0:e.bread_arr:[],d=e!=null&&e.price_range?e==null?void 0:e.price_range:{},o=0,f=0;if(d.min&&d.max&&(o=parseFloat(d.min),f=parseFloat(d.max)),l.length>0&&l.includes(s)){if(d.min&&d.max&&(r<o||r>f))return 0}else if(l.length>0){let p=!1;for(const w of l)if(s.startsWith(w)){p=!0;break}if(p){if(d.min&&d.max&&(r<o||r>f))return 0}else return 0}else{if(l.length>0&&!l.includes(s))return 0;if(c.length>0)for(let p=0;p<c.length;p++){let w=new RegExp(c[p]);if(i&&!w.test(i))return 0}}return 1}catch{return 1}}function ou(e){let t=[],a=Object.keys(Xe);for(let i=0;i<a.length;i++)a[i]==e&&(t=Xe[e]);return t}function xs(e={}){var d,o,f,p,w,x;let{pos:t,url:a,bread:i,price:s}=vr(e),r=t,c=[],l=Object.keys(Xe);i&&(i=i.trim()),s&&parseFloat(s)>0&&!isNaN(parseFloat(s))?s=parseFloat(s):s=0;for(let m=0;m<l.length;m++)if(l[m]==r)for(let y=0;y<Xe[r].length;y++){let b=Xe[r][y].offer_id?Xe[r][y].offer_id:0,I=(d=Xe[r][y])!=null&&d.url_reg_arr?(o=Xe[r][y])==null?void 0:o.url_reg_arr:[],O=(f=Xe[r][y])!=null&&f.bread_arr?(p=Xe[r][y])==null?void 0:p.bread_arr:[],L=(w=Xe[r][y])!=null&&w.price_range?(x=Xe[r][y])==null?void 0:x.price_range:{},F=0,j=0;if(L.min&&L.max&&(F=parseFloat(L.min),j=parseFloat(L.max)),O.length>0&&O.includes(i))L.min&&L.max&&s>=F&&s<=j&&(Ta(r+"~"+b),or(r+"~"+b,e)==1&&(c=Xe[r][y]));else if(O.length>0){let D=!1;for(const R of O)if(i.startsWith(R)){D=!0;break}D&&L.min&&L.max&&s>=F&&s<=j&&(Ta(r+"~"+b),or(r+"~"+b,e)==1&&(c=Xe[r][y]))}else if(I.length>0)for(let D=0;D<I.length;D++){let R=new RegExp(I[D]);I[D]&&R&&R.test(a)&&(Ta(r+"~"+b),or(r+"~"+b,e)==1&&(c=Xe[r][y]))}}return c}function vr(e){let t=e.pos?e.pos:-1,a=e.url?e.url:"",i=e.bread?e.bread:"",s=e.price?e.price:0;return{pos:t,url:a,bread:i,price:s}}function uu(e={}){let{pos:t}=vr(e),a=t,i=xs(a),s=parseInt(new Date().getTime()/1e3);i&&i.start&&i.end&&i.url&&i.title&&i.image&&i.text&&i.start<=s&&i.end>=s&&ct.notifyPAOffers(i.image,i.title,i.text,i.url,"offerNotification-"+a,"offerNotification-"+a)}function or(e,t={}){var a=new Date;vr(t),a=a.getDate();let i=0,s=0;Oa[e]&&(s=Oa[e]);let r=Math.floor(Date.now()/1e3);if(r-s>86400){let d=e+"vis";var c=Math.floor(Ot[d]);if(d.split("vis").length>1){d=d.split("vis")[0];let o=d+"push";var l=Math.floor(Ot[o]);r-l>1800&&r-s>86400&&c-r<240&&c-r>-100&&(Oa[e]=r,Ot[o]=r,i=1,uu(t),h.setItem("visitedDet",JSON.stringify(Ot)),h.setItem("globalPushDet",JSON.stringify(Oa)))}}return i}function wn(e){var t="/legacy/assets/1.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){du(e)},100)}function du(e){var t="2.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){hu(e)},100)}function hu(e){var t="3.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){fu(e)},100)}function fu(e){var t="4.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){pu(e)},100)}function pu(e){var t="5.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){yu(e)},100)}function yu(e){var t="6.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){wu(e)},100)}function wu(e){var t="7.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){mu(e)},100)}function mu(e){var t="8.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){bu(e)},100)}function bu(e){var t="9.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){Iu(e)},100)}function Iu(e){var t="10.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){xu(e)},100)}function xu(e){var t="11.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){ku(e)},100)}function ku(e){var t="12.png";chrome.action.setIcon({tabId:e,path:t})}async function _u(e,t,a,i,s,r,c){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth"),u.flagBL=await h.getItem("flagBL"),u.actBL=await h.getItem("actBL");var l,d,o,f=http[2*a],p=http[2*a+1],w=i;if(r.split("isbn=").length>1){d=r.split("isbn=")[1],d=d.split("~*~*")[0];var x="search="+encodeURIComponent(e)+"&isbn="+encodeURIComponent(d),m="https://compare.buyhatke.com/example_ext.php";l=1,o=0}else if(r.split("isapparel=").length>1){d=r.split("isapparel=")[1];var x="search="+encodeURIComponent(e),m="https://compare.buyhatke.com/apparelsSearch.php";o=1,l=0}else{o=0;var x="search="+encodeURIComponent(e)+"&data="+encodeURIComponent(r),m="https://compare.buyhatke.com/exampleNewExt.php";l=0,d=0}if(e!="")var y=s.split("/")[2];var b=await oe(m,"POST",x,"formData");if(I){if((t==NaN||t=="NaN")&&(t=0),l==0&&o==0){var m="https://compare.buyhatke.com/updates10.php?searchText="+encodeURIComponent(e)+"&price="+t+"&ext_id="+u.ext_id+"&auth_val="+u.ext_auth+"&pos="+c;u.flagBL==1&&c==63?m+="&mainFL=1&ext_id="+u.ext_id:u.actBL<10&&c==63&&(m+="&mainFL=1")}else if(o==1)var m="https://compare.buyhatke.com/updates_app.php?searchText="+encodeURIComponent(e)+"&price="+t+"&ext_id="+u.ext_id+"&auth_val="+u.ext_auth;else{var m="https://compare.buyhatke.com/updates_ext.php?searchText="+encodeURIComponent(e)+"&isbn="+d+"&ext_id="+u.ext_id+"&auth_val="+u.ext_auth;(u.flagBL==1&&c==63||u.actBL<10&&c==63)&&(m+="&mainFL=1")}var I=await oe(m,"GET",null)}}catch(O){v("handleQueries",O),E("Error in handleQueries ",O)}}var Ot={},Oa={};async function vu(){let e=await h.getItem("visitedDet"),t=await h.getItem("globalPushDet");e&&(Ot=JSON.parse(e)),t&&(Oa=JSON.parse(t))}vu();function Ta(e){var t=e+"vis",a=e+"push";Ot[t]||(Ot[t]=0,Ot[a]=0),Ot[t]=Math.floor(Date.now()/1e3),h.setItem("visitedDet",JSON.stringify(Ot))}async function Ou(e){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var t="https://compare.buyhatke.com/extension/registerEnd.php",a="ext_id="+u.ext_id+"&auth_val="+u.ext_auth+"&website="+e,i=await oe(t,"POST",a,"formData");i&&El(i)}catch(s){v("registerEND",s),E("Error registerEND ",s)}}function ni(e){switch(e){case 2:return{pairPos:0,currPos:0};case 7:return{pairPos:31,currPos:31};case 900:return{pairPos:26,currPos:26};case 22:return{pairPos:13,currPos:13};case 1:return{pairPos:-1,currPos:-1};case 422:return{pairPos:15,currPos:15};case 425:return{pairPos:12,currPos:12};case 1e3:return{pairPos:20,currPos:20};case 333:return{pairPos:19,currPos:19};case 71:return{pairPos:9,currPos:9};case 291:return{pairPos:32,currPos:32};case 1037:return{pairPos:35,currPos:35};case 401:return{pairPos:14,currPos:14};case 921:return{pairPos:17,currPos:17};case 37:return{pairPos:21,currPos:21};case 429:return{pairPos:18,currPos:18};case 57:return{pairPos:23,currPos:23};case 1005:return{pairPos:27,currPos:27};case 67:return{pairPos:22,currPos:22};case 428:return{pairPos:28,currPos:28};case 469:return{pairPos:16,currPos:16};case 431:return{pairPos:24,currPos:24};case 902:return{pairPos:30,currPos:30};case 45:return{pairPos:29,currPos:29};case 62:return{pairPos:33,currPos:33};case 441:return{pairPos:36,currPos:36};case 901:return{pairPos:25,currPos:25};case 471:return{pairPos:34,currPos:34};case 929:return{pairPos:51,currPos:51};case 1578:return{pairPos:44,currPos:44};case 63:return{pairPos:1,currPos:3};case 111:return{pairPos:2,currPos:5};case 1556:return{pairPos:40,currPos:40};case 50:return{pairPos:3,currPos:4};case 31:return{pairPos:311,currPos:311};case 129:return{pairPos:4,currPos:1};case 421:return{pairPos:5,currPos:2};case 4:return{pairPos:6,currPos:6};case 99:return{pairPos:7,currPos:7};case 13:return{pairPos:10,currPos:10};case 98:return{pairPos:11,currPos:11};case 1331:return{pairPos:38,currPos:38};default:return{pairPos:e,currPos:e}}}const $r=new Map,Au=6e5;async function ks(e,t){try{$r.has(t)||$r.set(t,new Map);const a=$r.get(t);let i=e.filter(r=>{const c=a.get(r);return c?Date.now()-c.ts>Au?(a.delete(r),!0):!1:!0});if(i.length>0){let r=await fetch("https://ext1.buyhatke.com/extension-apis/thunder/getPidData",{headers:{"Content-Type":"application/json"},body:JSON.stringify({pos:t,pids:i}),method:"POST"});if(r=await r.json(),!r.status)return[];r=r.data,Object.entries(r).forEach(([c,l])=>{c=c.split(":")[1];try{l=JSON.parse(l)}catch{}c&&a.set(c,{data:l,ts:Date.now()})})}return e.map(r=>{const c=a.get(r);return c?{pid:r,...c.data}:null}).filter(Boolean)}catch{return[]}}const ur=new Map;async function Eu(){if(ur.size===0)return;const e=Array.from(ur.values()),a={extId:await h.getItem("ext_id"),dealScores:e,platform:0};try{const i=await fetch("https://ext1.buyhatke.com/extension-apis/dealsBurst/sendDeals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});let s;try{s=await i.json()}catch(r){console.error("Failed to parse response JSON:",r,"Response status:",i.status);return}i.ok&&s.status===1&&ur.clear()}catch{}}setInterval(Eu,3e5);const Du=[2,63,111,2191,1830,6068,900,902,2265,6326,6607,7376,8977];async function Nu(e,t,a,i){try{let s=await ks(e,t);if(!s||s.length===0)return{};s=s[0];let r=s==null?void 0:s.avg,c=s==null?void 0:s.avg1mon,l=s==null?void 0:s.avgbbd,d=s==null?void 0:s.min,o=s==null?void 0:s.min6,f=[r,c,l,d,o];(!r||r===0)&&(r=c||0),(!o||o===0)&&(o=d||0);let p,w,x,m,y;const b=30,I=25,O=20,L=15,F=10;let j=0,D=0;for(let K=0;K<f.length;K++)f[K]&&f[K]!=0&&(j+=f[K],D++);let R=0;D>=1&&(R=(j/D).toFixed(2));let $=2;for(let K=0;K<f.length;K++)if(f[K]&&f[K]!=0&&R!=0&&(f[K]>1.01*R||f[K]<.9*R)){$=1;break}!l||l===0?(p=0,w=36,x=29,m=21,y=14):a<=1.05*l&&a>r?(p=30,w=0,x=31,m=23,y=16):(p=b,w=I,x=O,m=L,y=F);const Y=l>0?Math.max(0,(a-l)/l*100):10,M=Math.max(0,1-Y/10),N=r>0?Math.max(0,(c-r)/r*100):20,B=Math.max(0,1-N/20),W=d>0?Math.max(0,(a-d)/d*100):10,se=Math.max(0,1-W/10),fe=o>0?Math.max(0,(a-o)/o*100):10,_=Math.max(0,1-fe/10),S=r>0?Math.max(0,(r-a)/r*100):0,U=Math.min(1,S/30),re=Math.floor(p*M/$),ue=Math.floor(w*B/$),q=Math.floor(x*se/$),le=Math.floor(m*_/$),Oe=Math.floor(y*U/$),ce=re+ue+q+le+Oe;if(e&&e.length>0&&ce>0&&Du.includes(t)){const K=e[0],ge=`${t}:${K}`;ur.set(ge,{pid:K,pos:t,totalScore:ce,price:a,oos:i})}return{saleScore:re,pumpScore:ue,allTimeLowScore:q,sixMonthLowScore:le,threeMonthAvgScore:Oe,totalScore:parseFloat(ce.toFixed(0))}}catch{return{}}}let Pa=new Map;function Tu(e,t){try{JSON.parse(e).forEach(i=>{let s=Pa.get(t);s||(s=new Map,Pa.set(Number(t),s));const r=s.get(i.pid),c={prod:i.prod,image:i.image,price:i.price,timestamp:Date.now()};let l=!1;r?(r.timestamp=Date.now(),r.prod!==i.prod&&(r.prod=i.prod),r.image!==i.image&&(r.image=i.image),r.price!==i.price&&(r.price=i.price)):s.set(i.pid,{prod:i.prod,image:i.image,price:i.price,timestamp:Date.now()})})}catch{}}function Lu(e=30){const a=Date.now()-e*60*1e3;for(const[i,s]of Pa.entries()){for(const[r,c]of s.entries())c.timestamp<a&&s.delete(r);s.size===0&&Pa.delete(i)}}function Pu(e,t){t=ni(t).pairPos;const i=Pa.get(Number(t));return i&&i.get(e)||null}setInterval(async()=>{try{Lu()}catch{}},10*60*1e3);async function Q(e,t){try{Tu(e,t),u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var a="https://ext1.buyhatke.com/extTest/sendPair",i="pids="+encodeURIComponent(e)+"&pos="+t+"&ext_id="+u.ext_id+"&ext_auth="+u.ext_auth;await oe(a,"POST",i,"formData")}catch(s){v("sendPairs",s),E("error in sendPairs ",s)}}async function C(e,t){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var a="https://ext1.buyhatke.com/extTest/sendCurrent",i="details="+encodeURIComponent(e)+"&pids="+encodeURIComponent("[]")+"&pos="+t+"&ext_id="+u.ext_id+"&ext_auth="+u.ext_auth;await oe(a,"POST",i,"formData")}catch(s){v("sendCurrent",s),E("error in sendCurrent ",s)}}async function Ru(e){try{await oe("https://search-new.bitbns.com/buyhatke/amazVariants","POST",{variants:e},"json")}catch{}}async function ht(e){try{let t="";if(u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth"),e.length>1e3)return;e.split("~*").length>1?(e=e.split("~*"),t=e[1],e=e[0]):t=u.ext_id,await Fe("AnalyticsSent",{cid:u.ext_id,uid:u.ext_id,cs:encodeURIComponent(t),tid:"UA-21447924-6",dp:e,cm:"apnese"})}catch(t){v("sendAnalyticsData",t),E("Error sendAnalyticsData",t)}}async function _t(e,t,a,i,s,r){try{u.flagBL=await h.getItem("flagBL"),u.flagBL==1&&s==63&&(e==58||e==61);var c="https://api.buyhatke.com/monitor/",l="";t==5?l="&club_id="+s+"&success="+a+"&msg="+i:t==2?l="&club_id="+s+"&msg="+i:t==4?l="&club_id="+s+"&success="+a+"&msg="+i+"&start="+r:t==3&&(l="&club_id="+s+"&success="+a+"&msg="+i);var d="event_id="+e+"&event_type="+t+l;let o=await oe(c,"POST",d,"formData");E("Resp sendAnalyticsData ",o)}catch(o){v("sendMonitorReqBG",o),E("Error sendMonitorReqBG",o)}}async function oe(e,t,a,i="requestPayload"){try{let r=Date.now();if(t=="POST")var s=await fetch(e,{method:"POST",headers:{"Content-Type":i=="formData"?"application/x-www-form-urlencoded":i==="json"?"application/json":"application/text"},body:a&&typeof a!="string"&&Object.keys(a).length>0?JSON.stringify(a):a});else var s=await fetch(e);s.status>=400&&s.status<=599&&typeof s.url=="string"&&(s.url=s.url.split("?")[0]);let c=await s.text(),l=Date.now()-r;return parseFloat(l/1e3)>2&&await md({eventID:15,responseTime:l,url:e}),c}catch(r){return typeof e=="string"&&(e=e.split("?")[0]),E("error makePostFetch ",{url:e,parameters:a,error:r}),""}}async function da(){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let e="ext_id="+u.ext_id+"&auth_val="+u.ext_auth,t=await oe("https://api.buyhatke.com/paapi/showAlerts","POST",e,"formData");return t&&(Ue=JSON.parse(t),await Ba(Ue),ii(Ue)),Ue}catch(e){return v("checkStatus2",e),E("error checkStatus2 ",e),""}}function Ca(e,t){var a=e.length;if(a)for(;a--;){var i=e[a];i.tabID==t&&e.splice(a,1)}}async function gu(e){try{u.saleStarted=await h.getItem("saleStarted"),u.specialTab=await h.getItem("specialTab"),u.saleStarted==1&&e==u.specialTab&&(await h.setItem("specialTab",""),await wr())}catch(t){v("checkSpeciaTab",t),E("Error checkSpecialTab ",t)}}async function Mu(){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var e=await h.getItem("bankBox1"),t=await h.getItem("bankBox2"),a=await h.getItem("bankBox3"),i=await h.getItem("bankBox4");if(e!=""||t!=""||a!=""||i!="")var s="https://api.buyhatke.com/extension/saveBankExt.php",r="ext_id="+u.ext_id+"&auth_val="+u.ext_auth,c=await oe(s,"POST",r,"formData")}catch(l){v("saveBankUsers",l),E("Error saveBankUsers ",l)}}Mu();async function wr(){try{if(u.timeRemaining=await h.getItem("timeRemaining"),u.flashSale=await h.getItem("flashSale"),u.saleStarted=await h.getItem("saleStarted"),u.timeRemaining<12e4&&u.timeRemaining>-12e4)var e=2e3;else var e=4e4;setTimeout(wr,e);var t=new Array,a=u.flashSale?JSON.parse(u.flashSale):[];if(a.length){for(let i=0;i<a.length;i++)a[i].value==1&&(newURL=a[i].url);u.saleStarted==1&&chrome.tabs.query({},async function(i){for(var s=0,r=0;r<i.length;r++){var c=i[r].url,l=newURL;s==0&&c.split(l).length>1&&(s=1,await h.setItem("specialTab",i[r].id))}s==0&&(await h.setItem("specialTab",""),wr())})}}catch(i){v("getSpecia",i),E("Error getSpecial ",i)}}wr();qi=qi.join("");async function Kt(e,t){try{let a={method:e.method};if(e.headers&&e.headers!==""&&e.headers!=="{}"&&(a.headers=e.headers),e.method==="POST"){if(e.reqType===2)a.body=JSON.stringify(e.postFields);else if(e.reqType===1)try{a={...a,...JSON.parse(e.postFields)}}catch{a={...a,...e.postFields}}}const i=await fetch(t,a);if(e.reqType&&e.reqType==11||e.reqType&&e.reqType==11)return i.url;if(i.status>=400&&i.status<=599)throw new Error(`HTTP error! status: ${i.status}`);return await i.text()}catch{return""}}function Su(e){return e.trim().replace(/\s+/g,"+").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/,/g,"%2C")}function qa(e,t,a){return new Promise(function(i,s){if(e.compareShoppingFlag){let d=t.placeholders[0];d=Su(d),t.placeholders[0]=d}let r=JSON.stringify(e);for(var c=0;c<=a.length;c++){var l="PLACEHOLDER"+c;r=r.replace(l,a[c])}i(JSON.parse(r))})}async function Fu(e){return new Promise(async function(t,a){var o;if(typeof e.dontFetch<"u"&&e.dontFetch==!0){if(typeof e.isJSON<"u"&&e.isJSON==!0||parseInt(e.isJSON)==1)var i=!0;else var i=!1;let f={job_id:e.job_id,method:e.method||"GET",base_url:e.url,postFields:e.postFields||"",headers:e.headers||"",reqType:e.reqType||0,isJSON:i,countPH:((o=e.placeholders)==null?void 0:o.length)||0,secondRequestFlag:!!(e!=null&&e.secondRequestFlag),url2:e.url2||"",placeholders2:e.placeholders2||"",responseIndex:e.responseIndex||0,compareShoppingFlag:e.compareShoppingFlag||0},p=e.placeholders||[],w=e.placeholders2||[];qa(f,e,p).then(x=>{if(f.responseIndex>0)return qa(x,x,w).then(m=>{t(m)});t(x)}).catch(function(x){v("changePlaceHolder",x)})}else{if(typeof e.jobIDOrig<"u"&&e.jobIDOrig.trim()!="")var s=e.jobIDOrig;else var s=e.job_id;var r="dcc"+s,c=await h.getItem(r);if(Cu(),c==""||c==null||c=="{}"||Object.keys(c).length==0){var l="http://s3-ap-southeast-1.amazonaws.com/jobdet/"+s+".txt";let f=await oe(l,"GET",null);f&&(f=JSON.parse(f),await h.setItem(r,JSON.stringify(f)),qa(f,e).then(function(p){t(p)}).catch(function(p){v("changePlaceHolder",p)}))}else{var d=await h.getItem(r);d=JSON.parse(d),qa(d,e).then(function(f){t(f)}).catch(function(f){v("changePlaceHolder",f)})}}})}async function Ju(e){try{ot||(ot=await fa());let t=e.split('role="list"');if(t.length<2)return"";let s=t[1].split('jsname="QdNh2e"')[0];const r=new RegExp(rs.join("|"),"i"),c=s.match(r);if(!c)return"";const d=s.slice(0,c.index).match(/search[^\s"]+/g),o=d?d[d.length-1]:null;return o?`${ot}/${o}`.replaceAll(";","&"):""}catch{return""}}async function _s(e){try{ot||(ot=await fa());const t=e.split('role="list"');if(t.length<2)return"";const s=t[1].split('jsname="QdNh2e"')[0],r=new RegExp(is.join("|"),"i"),c=s.match(r);if(!c)return"";const d=s.slice(0,c.index).match(/search[^\s"]+/g),o=d?d[d.length-1]:null;return o?`${ot}/${o}`.replaceAll(";","&"):""}catch{return""}}async function ka(e,t,a){try{const i=new URLSearchParams(t).toString(),s=`${e}${i}`;let r=await fetch(s,{method:"GET",redirect:"follow"});r=await r.text();let l=r.split(")]}'")[1];if(l=JSON.parse(l),l=l.ProductDetailsResult,a)return l;let d=l[34][0][0],o=l[81];o=o[0][0];for(let f=0;f<o.length;f++)d&&(o[f][22][2]=d);return o}catch{}}const me=(e,t,a=0,i="")=>{if(!e||typeof e!="string")return i;try{const s=e.split(t);return s&&s.length>a?s[a].trim():i}catch{return i}};async function ju(e,t){try{let a=e.split('jsname="uVFeEd"');if(a.length>0)for(let i=0;i<a.length;i++)a[i].includes("& more")&&(t[i]=!0)}catch{}}async function Bu(e,t){var a;try{let i={};await ju(e,i);let s=e.match(/value="([^"]+)"\s+name="ei"/),r=s?s[1]:"",c=me(e,'</li></div><div class="Ez5pwe"',0,"");c=me(c,'class="I8iMf"',1,"");const l=me(me(e,";opi=",1,""),'">'),d=me(me(e,"sca_esv=",1,""),"&"),o=me(me(e,'data-pvo="',1,""),'"'),f=me(me(e,'data-mid="',1,""),'"'),p=me(me(e,"udm=",1,""),"&");let w=0,x={},m=[];for(let Y in i)m.push(parseInt(Y));for(let Y=0;Y<3&&Y<m.length;Y++){let M=m[Y],N=me(me(e,'data-gid="',M+1,""),'" data-iid');const B=me(me(e,'data-rds="',M+1,""),'" data-sico'),W=me(me(e,'data-laoid="',M+1,""),'" data-mid');let se=me(me(e,"/shopping/product/",M+1,""),"/reviews?");se||(se=me(me(e,'data-cid="',M+1,""),'" data-fnhc'));const fe=me(me(e,'data-iid="',M+2,""),'" data-iis'),_=me(me(e,'data-oid="',M+1,""),'"');x[w]={gpcid:N,data_rds:B,data_laoid:W,catalogId:se,imageDocid:fe,headlineOfferDocid:_},w++}if(m.length>3){let M=m.slice(3).sort(()=>Math.random()-.5).slice(0,3);for(let N of M){let B=me(me(e,'data-gid="',N+1,""),'" data-iid');const W=me(me(e,'data-rds="',N+1,""),'" data-sico'),se=me(me(e,'data-laoid="',N+1,""),'" data-mid');let fe=me(me(e,"/shopping/product/",N+1,""),"/reviews?");fe||(fe=me(me(e,'data-cid="',N+1,""),'" data-fnhc'));const _=me(me(e,'data-iid="',N+2,""),'" data-iis'),S=me(me(e,'data-oid="',N+1,""),'"');if(x[w]={gpcid:B,data_rds:W,data_laoid:se,catalogId:fe,imageDocid:_,headlineOfferDocid:S},w++,w>=5)break}}const y="EgsItqvzARDGqeXhAw",b=!0,I=0,O=((a=t==null?void 0:t.placeholders)==null?void 0:a[0])||"",L=O,F="jspb";let j=0;const D=10;ot||(ot=await fa());const R=`${ot}/async/oapv?`,$={};for(const Y in x)try{let M=x[Y];$[Y]={},j=0;let{gpcid:N,data_rds:B,data_laoid:W,catalogId:se,imageDocid:fe,headlineOfferDocid:_}=M,S=`catalogid:${se},gpcid:${N},headlineOfferDocid:${_},rds:${B},imageDocid:${fe},pvo:${o},isp:${b},localAnnotatedOfferId:${W},sori:${j},mno:${D},query:${L},gl:${I},mid:${f},pvt:hg,_fmt:${F},pvf:${y}`,U={ei:r,hl:"en",opi:l,sca_esv:d,udm:p,yv:"3",q:O,async_context:"MORE_STORES",cs:"1",async:S};const re=await ka(R,U,!0);if(!re||re.length===0)break;let ue=re[71],q=[],le={};ue&&ue.length>1&&(q=ue[1][1]);const Oe=(ce,K,ge,Me)=>{for(const de of ce){if(de[0].includes(ge))continue;let be=de[2],Ke=de[0],Pe=de[4];Me=="size"&&!be||Pe&&Ke&&(K[Ke]=Pe)}};Oe(q,le,"Any","color");for(const ce in le){j=0;let K={},ge=[];$[Y].tv||($[Y].tv={}),$[Y].tv[ce]||($[Y].tv[ce]={});let Me=le[ce],de={...U},be=de.async;be=be.replace("pvf:EgsItqvzARDGqeXhAw",`pvf:${Me}`),be=be+",isVariantOrFilterChange:true",de.async_context="VARIANT_OR_FILTER_CHANGE",de.async=be,ge=(await ka(R,de,!0))[71][0][1],Oe(ge,K,"Any Size","size");for(const Qe in K){j=0;let P=K[Qe];$[Y].tv[ce][Qe]||($[Y].tv[ce][Qe]={});let A={...U},J=A.async;J=J.replace("pvf:EgsItqvzARDGqeXhAw",`pvf:${P}`),J=J+",isVariantOrFilterChange:true",A.async_context="VARIANT_OR_FILTER_CHANGE",A.async=J;for(let te=0;te<=2;te++)try{J=J.replace(",pvt:hg",",pvt:a"),j===0&&(J=J.replace(",sori:0,mno:10","")),!J.includes("sori")&&j>0&&(J=J+`,sori:${j},mno:${D}`),J=J.replace(/sori:\d+/,`sori:${j}`).replace(/mno:\d+/,`mno:${D}`),A.async=J;const H=await ka(R,A,!1);if(!H||H.length===0)break;$[Y].tv[ce][Qe][te]=H,te===0&&(j+=3),te===1&&(j+=10)}catch{}}}if(ue=="null"||ue==null){$[Y].nv||($[Y].nv={});for(let ce=0;ce<=2;ce++)try{S=`catalogid:${se},gpcid:${N},headlineOfferDocid:${_},rds:${B},imageDocid:${fe},pvo:${o},isp:${b},localAnnotatedOfferId:${W},sori:${j},mno:${D},query:${L},gl:${I},mid:${f},pvt:hg,_fmt:${F}`,j===0&&(S=S.replace(",sori:0,mno:10","")),U.async=S;const K=await ka(R,U,!1);if(!K||K.length===0)break;$[Y].nv[ce]=K,ce==0&&(j+=3),ce==1&&(j+=10)}catch{}}if(ue&&ue.length==1){let ce=ue[0][1],K={};Oe(ce,K,"Any","");for(const ge in K){j=0;let Me=K[ge];$[Y].ov||($[Y].ov={}),$[Y].ov[ge]||($[Y].ov[ge]={});let de={...U},be=de.async;be=be.replace("pvf:EgsItqvzARDGqeXhAw",`pvf:${Me}`),be=be+",isVariantOrFilterChange:true",de.async_context="VARIANT_OR_FILTER_CHANGE",de.async=be;for(let Ke=0;Ke<=2;Ke++)try{be=be.replace(",pvt:hg",",pvt:a"),j===0&&(be=be.replace(",sori:0,mno:10","")),!be.includes("sori")&&j>0&&(be=be+`,sori:${j},mno:${D}`),be=be.replace(/sori:\d+/,`sori:${j}`).replace(/mno:\d+/,`mno:${D}`),de.async=be;const Pe=await ka(R,de,!1);if(!Pe||Pe.length===0)break;$[Y].ov[ge][Ke]=Pe,Ke===0&&(j+=3),Ke===1&&(j+=10)}catch{}}}}catch{}return JSON.stringify($)||""}catch(i){throw i}}async function mn(e,t=0){try{let a=e.split('class="iXEZD" data-sh-gr="line"');if(a.length<=t+1)return"";let s=a[t+1].split(">Compare prices from");if(s.length<1)return"";let c=s[0].split('href="')[1];if(!c)return"";c=ot+c;let l=c.replaceAll(";","&");if(!l)return"";let d=await fetch(l,{method:"GET",redirect:"follow"});return d=await d.text(),d}catch{return""}}let si=0,Hr=0;var ci="";let bn=1;async function Ra(e=!1){try{Object.keys(sr).length==0&&await pi(),Hr=await h.getItem("userCountry"),sr.hasOwnProperty(Hr)&&(si=sr[Hr]);let c=await h.getItem("ext_id"),l=await h.getItem("ext_auth"),d=await h.getItem("version"),o="isReadyExt";e&&(o="isReadyAlert");let f="https://utility.buyhatke.com/spidy/"+o+"?rand="+parseInt(Math.random()*999999999999999)+"&ext_id="+c+"&ext_auth="+l+"&version="+d,w=await fetch(f,{method:"GET",headers:{"Content-Type":"application/json","client-id":"2378",uid:"1"}});if(w.status>=400&&w.status<=599)throw new Error("status: "+w.status);if(w=await w.json(),w&&w.success&&!e){var t=w.user_id,a=w.callResp,i=w.callDist,s=w.schedule_id,r=w.ipAvail;r&&s!=0&&i!=""&&a!=""&&(Zu(i,a,t,s,si),bn==1&&(bn=0,await Rs()),await Ds())}else w&&w.success&&e&&(ci=w.callResp)}catch(c){E("Error in cmm ",c)}}async function Uu(e,t){var l,d;const a=crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2,15),i=(t==null?void 0:t.data)||{};let s=((l=i==null?void 0:i.gtm_details)==null?void 0:l.alternate_id)||"",r=((d=i==null?void 0:i.gtm_details)==null?void 0:d.category)||"",c=(i==null?void 0:i.tenant_ids)||[];return r&&typeof r=="string"&&r.includes("/")&&(r=r.split("/")[0].toUpperCase()),{...e,method:"POST",postFields:{identifier:a,to_pincode:"400020",customer_details:{},articles:[{article_id:s,vertical:r,lookup_inventory:!0,tenant_ids:c,merchant_id:null,package_dimension:{}}]},headers:{"x-application-token":"qO2p_wQkq","x-oms-application-id":"5ea6821b3425bb07c82a25c1"},reqType:2}}async function $u(e){try{let t=await fetch(e);if(t=await t.text(),t=t.split(")]}'"),t.length>0){let a=t[1];a=JSON.parse(a),a=a[0];for(let i=0;i<a.length;i++){let s=a[i];if(s.length>3&&(s=s[3],s.du)){let r=s.du;r=ot+r,await fetch(r)}}}}catch{}}function oa(e,t){var a;return(a=new RegExp(`"${e}":"([^"]+)"`).exec(t))==null?void 0:a[1]}async function vs(){let e=await(await fetch(Ir)).text(),t=oa("SNlM0e",e),a=oa("cfb2h",e);if(!oa("oPEP7c",e).includes("@gmail.com"))return await chrome.storage.local.set({chEn:!0}),!1;if(!t||!a)throw"BARD_EMPTY_RESPONSE";return{atValue:t,blValue:a}}async function Hu(){return{accept:"text/event-stream","accept-language":"en-GB,en-US;q=0.9,en;q=0.8","content-type":"application/json","user-agent":navigator.userAgent}}async function Vu(){let e=await(await fetch(pr)).text(),t=oa("SNlM0e",e),a=oa("cfb2h",e);if(oa("oPEP7c",e),!t||!a)throw"BARD_EMPTY_RESPONSE";return{atValue:t,blValue:a}}function In(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():""}function Os(e,t={},a=!0){let i=Object.keys(t);if(i.length===0)return e;let s=e;/:[a-zA-Z]/.test(e)&&e.split("/").forEach(r=>{if(r.startsWith(":")){let c=r.slice(1);s=s.replace(r,t[c]),delete t[c]}}),s+="?";for(let r of i){let c=t[r];c&&(c=a?encodeURIComponent(c):c,s+=`${r}=${c}&`)}return s.slice(0,-1)}function As(){return Math.floor(Math.random()*9e5)+1e5}function Ku(e){let t=JSON.parse(e.split(`
`)[3]),a=JSON.parse(t[0][2]);if(!a)throw"BARD_EMPTY_RESPONSE";let i=a[4][0][1][0],s=a[4][0][4]||[];for(let r of s){let[c,l,d]=r;i=i.replace(d,`[![${c[4]}](${c[0][0]})](${l[0][0]})`)}return{text:i,ids:[...a[1],a[4][0][0]]}}async function Es(e){try{let t=e;t.requestParams||(t.requestParams=await vs());let{requestParams:a,contextIds:i}=t,s="GzXR5e",r=Os(xr,{rpcids:s,"source-path":"/",bl:a.blValue,_reqid:As().toString(),rt:"c"}),c=[i[0]],l=[[[s,JSON.stringify(c),null,"generic"]]],d=await fetch(r,{method:"POST",body:new URLSearchParams({at:a.atValue,"f.req":JSON.stringify(l)})})}catch{}}setInterval(async()=>{try{const{chCO:e}=await chrome.storage.local.get("chCO");if(Array.isArray(e)&&e.length>0){for(let t of e)await Es(t);await chrome.storage.local.remove("chCO")}}catch{}},30*1e3);function Gu(e,t){return[[[e,`[[null,null,null,null,null,null,null,["bard"]],["${t}"]]`,null,"generic"]]]}async function Ds(){try{(!Ir||!xr||!kr||!pr||!ei||!ti)&&await fa();let e=await fetch(pr);e=await e.text();let t=e;e=e.split('class="ds:4"')[1].split(");<\/script>")[0],e=e.split("AF_initDataCallback(")[1],e=e.split("]]]]]")[0],e=e.split("data:[[[")[1],e="[[["+e+"]]]]]]",e=JSON.parse(e),e=e[0];let i="TmdDAd";for(const s of e)try{let r=s[9][0];if(!ei.some(y=>r.includes(y)))continue;let l=s[5],d={};d.requestParams=await Vu();let{requestParams:o,contextIds:f}=d;l=Gu(i,l);let x="f.req%3D%5B%5B%5B%22TmdDAd%22%2C%22%5B%5Bnull%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%2C%5B%22bard%22%5D%5D%2C%5B%22%3CplaceHolder%3E%22%5D%5D%22%2Cnull%2C%22generic%22%5D%5D%5D%26at%placeHolder2%3A1752069513611%26".replace("%3CplaceHolder%3E",encodeURIComponent(l)).replace("placeHolder2",encodeURIComponent(o.atValue));const m=`f.req=${encodeURIComponent(JSON.stringify(l))}&at=${encodeURIComponent(o.atValue)}&`;await fetch(`${ti}?rpcids=TmdDAd&source-path=%2Fproduct%2Fgemini&f.sid=-1498784379978768824&bl=boq_footprintsmyactivityuiserver_20250706.11_p0&hl=en&soc-app=712&soc-platform=1&soc-device=1&_reqid=269324&rt=c`,{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9,hi;q=0.8","content-type":"application/x-www-form-urlencoded;charset=UTF-8","x-same-domain":"1"},body:m,method:"POST",mode:"cors",credentials:"include"})}catch{}await chrome.storage.local.set({cpHC:0})}catch{}}function li(e){return e.replace(/(\d+\.)/g,`
$1`)}function oi(e){return e.replace(/\*\*(.*?)\*\*/g,"**$1**")}async function xn(e){try{let t=null;t||(t=In());let a={};a.requestParams=await vs(),a.requestParams&&await chrome.storage.local.set({chEn:!1});let i=(await chrome.storage.local.get("chEn")).chEn;if((await chrome.storage.local.get("chEn")).chEn)return;let s,{requestParams:r}=a,c=null;c||(c={contextIds:[],previousResponses:[]}),c.contextIds.length===0&&(c.contextIds=[In()]);let l=JSON.stringify(c.contextIds),o=`Our previous conversation:
---
${c.previousResponses.map((F,j)=>`[user]: ${F.prompt}
[bard]: ${F.response}`).join(`
`)}
---
[user]: ${e}`,f=Os(kr,{bl:r.blValue,__reqid:As().toString(),rt:"c"}),p=[null,JSON.stringify([[o,0,l,s?[[[s,1],n.image.name]]:[]],null,["","",""]])],{cpHC:w=0}=await chrome.storage.local.get("cpHC");await chrome.storage.local.set({cpHC:w+1}),await chrome.storage.local.set({chFs:Date.now(),chRC:!1});let x=await(await fetch(f,{method:"POST",body:new URLSearchParams({at:r.atValue,"f.req":JSON.stringify(p)})})).text(),{text:m,ids:y}=Ku(x);a.contextIds=y;let b=(await chrome.storage.local.get("chCO")).chCO||[];b.push(a),await chrome.storage.local.set({chCO:b}),c.contextIds=y,c.previousResponses.push({userPrompt:e,response:m});const I=JSON.parse(x.split(`
`)[3]),L=JSON.parse(I[0][2])[4][0][4]||[];for(let F of L){let[j,D,R]=F;const $=j[0][0],Y=D[0][0],M=R;m=m.replace(M,`<img src="${$}" alt="${M}" /><a href="${Y}">Source</a>`)}return setTimeout(async()=>{await Es(a);let{cpHC:F=1}=await chrome.storage.local.get("cpHC");F=Math.max(0,F-1),await chrome.storage.local.set({cpHC:F}),F===0&&await chrome.storage.local.set({chRC:!0})},1e3),m=li(m),m=oi(m),await chrome.storage.local.set({chEn:!1}),m}catch{return{loginError:!0}}}async function Wu(e){try{ai||await fa();let t=Array.isArray(e)?e[0]:e;typeof t!="string"&&(t=String(t));let a=await Hu();const i=await fetch(ai,{method:"POST",headers:a,body:JSON.stringify({params:{language:"en-US",timezone:"Asia/Calcutta",search_focus:"internet",sources:["web"],mode:es,model_preference:ts,prompt_source:"user",query_source:"home",is_incognito:!0,dsl_query:t,skip_search_enabled:!0,version:qn},query_str:t})});if(!i.ok)throw new Error(`error: ${i.status}`);return await Yu(i)}catch(t){throw t}}async function Yu(e){let t;try{const a=e.body.getReader(),i=new TextDecoder("utf-8");let s="",r=!1,c=null,l=[],d=!1,o=!1;const f=y=>typeof y=="string"?y:y&&typeof y.text=="string"?y.text:"",p=y=>{if(!(!y||!y.op)&&(y.op==="add"||y.op==="replace")&&typeof y.path=="string"){if(y.path==="/answer"&&typeof y.value=="string")c=y.value;else if(y.path.startsWith("/chunks/")){const b=Number(y.path.slice(8));Number.isNaN(b)||(l[b]=f(y.value))}}},w=y=>{const b=y.replace(/\r\n/g,`
`).split(`
`).filter(O=>O&&O[0]!==":"&&O.startsWith("data:")).map(O=>O.slice(5).trimStart()).join(`
`);if(!b)return;if(b==="[DONE]"){o=!0;return}let I;try{I=JSON.parse(b)}catch{return}if(Array.isArray(I.blocks))for(const O of I.blocks){const L=O.markdown_block;if(L){if(Array.isArray(L.chunks)){const j=Number(L.chunk_starting_offset);Number.isFinite(j)?L.chunks.forEach((D,R)=>{l[j+R]=f(D)}):L.progress==="DONE"?l=L.chunks.map(f):L.chunks.forEach(D=>l.push(f(D)))}typeof L.answer=="string"&&(c=L.answer),L.progress==="DONE"&&(d=!0)}const F=O.diff_block;if(F&&Array.isArray(F.patches))for(const j of F.patches)p(j)}typeof I.output_text=="string"&&!c&&l.push(I.output_text),(I.final_sse_message===!0||I.final===!0)&&(o=!0)},x=()=>{clearTimeout(t),t=setTimeout(async()=>{try{await a.cancel()}catch{}throw new Error("Stream timeout")},4e4)};for(x();!r;){const{value:y,done:b}=await a.read();if(r=b,y){x(),s+=i.decode(y,{stream:!0}).replace(/\r\n/g,`
`);let I;for(;(I=s.indexOf(`

`))!==-1;){const O=s.slice(0,I);s=s.slice(I+2),w(O)}if((d||o)&&(c||l.some(O=>O!=null)))break}}if(s+=i.decode(),s){s=s.replace(/\r\n/g,`
`);let y,b=!1;for(;(y=s.indexOf(`

`))!==-1;){const I=s.slice(0,y);s=s.slice(y+2),b=!0,w(I)}!b&&s.trim()&&w(s)}let m=d&&c?c:l.filter(Boolean).join("")||c||"";return m=m.replace(/\[\d+\]/g,""),typeof li=="function"&&(m=li(m)),typeof oi=="function"&&(m=oi(m)),clearTimeout(t),m}catch{return t&&clearTimeout(t),""}}function zu(e){try{let t=e.replace(/\\x([0-9A-Fa-f]{2})/g,(a,i)=>String.fromCharCode(parseInt(i,16)));return decodeURIComponent(t.replace(/\+/g," "))}catch{return e}}setInterval(async()=>{try{const{chFs:e,chRC:t}=await chrome.storage.local.get(["chFs","chRC"]);!t&&e&&Date.now()-e>30*1e3&&(await Ds(),await chrome.storage.local.set({chRC:!0}))}catch(e){console.warn("Interval hide check failed:",e)}},20*1e3);async function Zu(e,t,a,i,s){var c;try{let l="";if(s?l=await oe(e+"/spidyDistGlob","POST","user_id="+a+"&schedule_id="+i+"&country="+s,"formData"):l=await oe(e+"/spidyDist","POST","user_id="+a+"&schedule_id="+i,"formData"),l){try{l=JSON.parse(l)}catch{return}if(!l.success)return;var r=l.data;let d=JSON.parse(JSON.stringify(r));const o=await Fu(r);let f=await Kt(o,o.base_url),p=f;if((o.job_id=="CBKLT_272"||o.job_id=="PD17E_340")&&f.includes("No image at the URL."))try{let b=o.base_url.split("url=")[1];b=b.split("?")[0];let I=`https://search-new.bitbns.com/buyhatke/proxyImg?url=${b}`;o.base_url=o.base_url.replace(/(url=)[^&]+/,`$1${encodeURIComponent(I)}`),f=await Kt(o,o.base_url)}catch{}let w="";if(o.compareShoppingFlag){let b=(c=p==null?void 0:p.toLowerCase())==null?void 0:c.includes("compare prices"),I;if(b)try{let j=10,D=f,R=D.split('class="iXEZD" data-sh-gr="line"'),$;f="";for(let Y=0;Y<3;Y++)Y<R.length-1&&($=await mn(D,Y),Y===0?f+=$+`****CompareUiFlag=${b}#####`:f+=$+"****nextResponse***");for(let Y=3;Y<j;Y++)if(R.length>1){let M=Math.floor(Math.random()*(R.length-1))+3;M<R.length&&($=await mn(D,M),f+=$+"****nextResponse***")}}catch{}else I=await Bu(f,d),f=I+`****CompareUiFlag=${b}***`;let O="";const L=/<input\s+value="([^"]+)"\s+name="ei"/i,F=p.match(L);if(F&&F[1]&&(O=F[1]),O){let j=ot+`/complete/search?q&cp=0&client=products-cc&xssi=t&gs_pcrt=2&ds=sh&hl=en-IN&authuser=0&pq=redmi&psi=${O}&dpr=2`;await $u(j)}}else if(o!=null&&o.secondRequestFlag){let b=await _s(f),I=await Ju(f);b&&(w=await dr(b)),I&&(f=await dr(I))}else if(o!=null&&o.responseIndex&&o.responseIndex>0&&o.job_id=="O1WGQ_144")try{let b=JSON.parse(f),I=await Uu(o,b),O=await Kt(I,I.url2);f=f+"***Second-Response***"+O}catch{}else if(o!=null&&o.responseIndex&&o.responseIndex>0){let b=await Kt(o,o.url2);o.responseIndex==2?f=b:o.responseIndex==3&&(f+="***Second-Response***"+b)}else if((o==null?void 0:o.job_id)=="PD17E_340"){let F=f.split("(function(){var p={astyp:'folsrch'")[1].split(",wfpe:false,wfve:false}")[0].split("url:")[1].split("'")[1].split("'")[0];F=zu(F);let j=ot+F;f=await dr(j)}let x=(o==null?void 0:o.responseIndex)||0;x==0?f+=`spidy-scrapping-url=>${o.base_url}`:x>0&&(f+=`spidy-scrapping-url=>${o.url2}`);for(let b=0;b<r.placeholders.length;b++)f+="**UrlParam"+b+"**"+r.placeholders[b];w&&(f+=`**exact-html=>${w}`);let m="job_id="+r.job_id+"&entry_id="+r.entry_id+"&batch="+r.batch+"&response="+encodeURIComponent(f)+"&user_id="+a+"&schedule_id="+i;typeof o.isJSON<"u"&&o.isJSON==!0?m+="&isJSON=true":m+="&isJSON=false",m+="&hash="+r.hash,(o.compareShoppingFlag||r.job_id=="CBKLT_272"||r.job_id=="FD8EQ_330"||r.job_id=="MIIXY_329"||r.job_id=="IFUDF_327"||r.job_id=="RV9TN_328"||r.job_id=="VW3HB_326")&&(t="https://ext1.buyhatke.com");const y=t+"/spidy/response";await oe(y,"POST",m,"formData")}else E("data ",l," type ",l.success)}catch(l){v("distributor",l),E("Error in distributor ",l)}}let Ns=5*45e3;si&&(Ns=2*5e4);Ra();setInterval(async function(){await Ra()},Ns);setInterval(async function(){try{await bs()}catch(e){v("Error in interval function",e)}},2*60*60*1e3);setTimeout(async function(){try{await bs()}catch(e){v("Error in interval function",e)}},60*1e3);async function Ts(){try{if(u.timeRemaining=await h.getItem("timeRemaining"),u.timeRemaining<6e4&&u.timeRemaining>-12e4)var e=5e3;else var e=3e4;setTimeout(Ts,e),u.mostSensitive=await h.getItem("mostSensitive"),u.specialTab=await h.getItem("specialTab"),u.mostSensitive==1&&u.specialTab!=""&&chrome.tabs.update(parseInt(u.specialTab),{selected:!0})}catch(t){v("checkMonitorSensitive",t),E("Error in checkMonitoeSensitive ",t)}}Ts();async function Xu(e){try{u.blockList=await h.getItem("blockList");var t=u.blockList;if(t.trim()!="")t=JSON.parse(t),t.push(e),await h.setItem("blockList",JSON.stringify(t));else{var a=[];a.push(e),await h.setItem("blockList",JSON.stringify(a))}}catch(i){v("addToBlockList",i),E("Error addToBlockList ",i)}}async function Qu(e){try{u.blockList=await h.getItem("blockList");var t=u.blockList;if(t.trim()!=""){t=JSON.parse(t);for(var a=[],i=0;i<t.length;i++)t[i]==e||a.push(t[i])}await h.setItem("blockList",JSON.stringify(a))}catch(s){v("removeFromBlockList",s),E("Error removeFromBlockList ",s)}}async function Cu(){try{let c=await h.getAllItems();var e=0,t,a;for(a in c)c.hasOwnProperty(a)&&(t=c[a]?(c[a].length+a.length)*2:0,e+=t);var i=(e/1024).toFixed(2);if(parseFloat(i)>4500)for(var s=Object.keys(c),r=0;r<s.length;r++)s[r].startsWith("dcc")&&(delete c[s[r]],E("Deleting ",s[r]),await h.removeItem(s[r]))}catch(c){v("deleteLocalS",c),E("Error in deleteLocalS ",c)}}async function qu(e,t,a){try{let i=await lt(e,t,a);return await(i==null?void 0:i.text())}catch{}}let ui={};function ed(e){const t={imageUrl:"image",pid:"PID",prodUrl:"link",pos:"position",site_logo:"site_image"};return e.map(a=>{const i={};for(let[s,r]of Object.entries(a)){const c=t[s]||s;i[c]=r}return i})}setInterval(function(){ui={}},15*60*1e3);async function td(){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth"),E("ext_id",u.ext_id),E("ext_auth",u.ext_auth),chrome.runtime.onConnect.addListener(async function(e){if(E("Starting for port ",e.name),e.name=="searchPayloadDataNew"+e.sender.tab.id)e.onMessage.addListener(async function(t){if(E("here14",t),t.messageData!=""){u.flagBL=await h.getItem("flagBL"),u.actBL=await h.getItem("actBL");var a=JSON.parse(t.messageData),i="query="+encodeURIComponent(a.query)+"&price="+a.price+"&ext_id="+u.ext_id+"&pos="+a.pos+"&ext_auth="+u.ext_auth+"&original="+a.original+"&PID="+a.PID;(u.flagBL==1&&a.pos==63||u.actBL<10&&a.pos==63)&&(i+="&mainFL=1");var s=parseInt(a.category),r="",c="";switch(s){case 0:r="https://compare.buyhatke.com/mobFrontEnd.php",c="https://compare.buyhatke.com/updates10.php";break;case 1:r="https://compare.buyhatke.com/exampleExtCat.php",c="https://compare.buyhatke.com/updatesNew.php";break}var t=await oe(r,"POST",i);t=t.trim();var l=t;if(t!=""&&s==0&&(t=JSON.parse(t)),s!=0||t.length>0&&t[0].error&&t[0].error==1){var r=c+"?searchText="+encodeURIComponent(a.original)+"&price="+a.price+"&ext_id="+u.ext_id+"&auth_val="+u.ext_auth+"&pos="+a.pos+"&PID="+a.PID;(u.flagBL==1&&a.pos==63||u.actBL<10&&a.pos==63)&&(r+="&mainFL=1");var t=await oe(r,"GET",null);try{e.postMessage({dataBack:t})}catch{}}else try{e.postMessage({dataBack:l})}catch{}}});else if(e.name=="searchPayloadDataTest"+e.sender.tab.id)e.onMessage.addListener(async function(t){if(E("here15",t),t.messageData!=""){let s=t.messageData.split("~*~*"),r=s[0],c=s[1],l=s[2],d=s[3],o=s[5],f=s[6];var a;a="PID="+d+"&pos="+l,E(a);let p="https://search-new.bitbns.com/buyhatke/comparePrice?"+a;var i=await oe(p,"GET",a);let w=new URLSearchParams(a),x=w.get("PID"),m=w.get("pos");if(i){if(i=i.trim(),i=await Ba(i),!JSON.parse(i).data.length&&u.ext_id%100<=as){let b=await ln(x,m),I=ed(b.data);b.data=I,b.dittoPromoteFlag=!0,i=JSON.stringify(b)}try{e.postMessage({dataBack:i})}catch{}}else try{e.postMessage({dataBack:""})}catch{}}});else if(e.name=="searchPayloadData"+e.sender.tab.id){e.onMessage.addListener(async function(t){try{E("here16",t),e.postMessage({dataBack:null});return}catch{}if(t.messageData!=""){u.flagBL=await h.getItem("flagBL"),u.actBL=await h.getItem("actBL"),name=t.messageData;var c=name.split("~*~*"),a=parseInt(c[2]),i=c[3],s="",r=c[0];name.split("moreData=").length>1&&(s=name.split("moreData=")[1],name=name.split("moreData=")[0]);var c=name.split("~*~*"),l=parseFloat(c[1]);name=c[0];var d=name.split("-");name=d.join(" ");var o=0,f,p,w,x=name.trim(),m=l;newSearchOn=0,myID=e.sender.tab.id,tabId=e.sender.tab.id,tabID=e.sender.tab.id,urlMerchant=e.sender.tab.url;var y=0;if(s.split("isapparel=").length>1){p=s.split("isapparel=")[1];var b="search="+encodeURIComponent(x),I="https://compare.buyhatke.com/apparelsSearch.php";w=1,f=0}else{u.sourceInstall=await h.getItem("sourceInstall"),w=0,y=1;var b="search="+encodeURIComponent(x)+"&data="+encodeURIComponent(s),b="query="+encodeURIComponent(x)+"&price="+m+"&PID="+i+"&pos="+a+"&source="+u.sourceInstall;u.flagBL==1&&a==63?b+="&mainFL=1&ext_id="+u.ext_id:u.actBL<10&&a==63&&(b+="&mainFL=1");var I="https://graph.bitbns.com/searchTest5.php?"+b;f=0,newSearchOn=1,p=0}if(y==1)var t=await oe(I,"GET",b);else var t=await oe(I,"POST",b);if((t.trim()==""||t.trim().length<100||t.trim==null)&&_t(61,2,0,"product comparison  error for pid "+i+" and website position "+a,a,0),a!=1&&newSearchOn==0){u.flagBL=await h.getItem("flagBL"),u.actBL=await h.getItem("actBL"),u.sourceInstall=await h.getItem("sourceInstall");var t=req.responseText;if((m==NaN||m=="NaN")&&(m=0),f==0&&w==0){var I="https://compare.buyhatke.com/updates10.php?searchText="+encodeURIComponent(x)+"&price="+m+"&ext_id="+u.ext_id+"&auth_val="+u.ext_auth+"&pos="+a+"&PID="+i+"&source="+u.sourceInstall;(u.flagBL==1&&a==63||u.actBL<10&&a==63)&&(I+="&mainFL=1")}else if(w==1)var I="https://compare.buyhatke.com/updates_app.php?searchText="+encodeURIComponent(x)+"&price="+m+"&ext_id="+u.ext_id+"&auth_val="+u.ext_auth+"&PID="+i+"&source="+u.sourceInstall;else{var I="https://compare.buyhatke.com/updates_ext.php?searchText="+encodeURIComponent(x)+"&isbn="+p+"&ext_id="+u.ext_id+"&auth_val="+u.ext_auth+"&PID="+i+"&source="+u.sourceInstall;(u.flagBL==1&&a==63||u.actBL<10&&a==63)&&(I+="&mainFL=1")}var t=await oe(I,"GET",b);if(w==1){wn(myID);try{e.postMessage({dataBack:t})}catch{}}else{var O=JSON.parse(t),L;O!=null?(L=O.length,O=O.sort(function(j,D){return j.price-D.price})):L=0,wn(myID);try{e.postMessage({dataBack:t})}catch{}}}else try{e.postMessage({dataBack:t})}catch{}}});return}else e.name=="getAPIdetails"+e.sender.tab.id?e.onMessage.addListener(async function(t){if(E("here17",t),t.messageData!=""){var a=t.messageData.split("~*"),s=a[0],i=a[1];i=parseInt(i);var s=JSON.parse(s)}qc(s[0].api).then(function(r){var c=r;tl(s[0].api).then(function(l){try{e.postMessage({header:c,postData:l})}catch{}})})}):e.name=="othersPayloadData"+e.sender.tab.id?e.onMessage.addListener(async function(t){if(E("Msg got ",t),t.messageData!=""){var a=t.messageData.split("~*");E("MSG",t.messageData),a[1]==43&&E("pehle arr",ba);var i=a[0],s=a[1];if(s=parseInt(s),E("command got ",s),s==43&&E("OOSDATA",t),s==11){try{e.postMessage({dataBack:""})}catch{}return}try{i=JSON.parse(i)}catch{}if(s==101){if(E("Trying to fetch if offer is applicable for this website",a,i),i.length>0&&i[0].pos&&hr[i[0].pos])if(Ta(i[0].pos),or(i[0].pos)==1){let se=ou(i[0].pos);e.postMessage({dataBack:se})}else e.postMessage({dataBack:[]});else e.postMessage({dataBack:[]});return}if(s==102){if(E("Trying to fetch if offer is applicable for this website",a,i),i.length>0&&i[0].pos&&hr[i[0].pos]){let W=xs(i[0]);W?e.postMessage({dataBack:W}):e.postMessage({dataBack:[]})}else e.postMessage({dataBack:[]});return}if(s==103){if(i.length>0&&i[0].pos){let W=await cu(i[0]);W&&Object.keys(W).length>0?e.postMessage({dataBack:W}):e.postMessage({dataBack:{}})}else e.postMessage({dataBack:{}});return}switch(s){case 1:var y="https://graph.bitbns.com/getPredictedData.php";break;case 2:var y="https://compare.buyhatke.com/dealsAPI/pidToList.php";break;case 3:var y="https://api.buyhatke.com/dealsAPI/pidToListAmaz.php";break;case 4:var y="https://compare.buyhatke.com/dealsAPI/pidToListSnap.php";break;case 5:var y="https://compare.buyhatke.com/dealsAPI/pidToListMyn.php";break;case 6:var y="https://compare.buyhatke.com/dealsAPI/pidToListJab.php";break;case 7:var y="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/getAutoCoupons.php";break;case 8:var y="https://ext1.buyhatke.com/amazon/sendPIDs.php";return;case 9:var y="https://api.buyhatke.com/compare/extension/userLog.php";break;case 10:var y="https://api.buyhatke.com/couponConfig/saveExtCoupons";break;case 11:var y="https://compare.buyhatke.com/pushRaw.php";break;case 12:var y="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/extCpnStatusTest.php";break;case 13:var y="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/bestCpnLike.php";break;case 14:var y="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/pickExtCoupons.php";break;case 15:var y="https://api.buyhatke.com/couponConfig/saveExtCoupons";break;case 16:var y="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/savePepperBread.php";break;case 17:var y="https://compare.buyhatke.com/wishlist3/api/scrapWishList.php";break;case 18:var y="https://compare.buyhatke.com/dealAPICat.php";break;case 19:var y="https://compare.buyhatke.com/reviewBack/submitMobile.php";break;case 20:E("Entered command 20");var y="http://54.179.157.216/api/count/update";return;case 21:var y="https://ext1.buyhatke.com/amazon/lightDeals.php";break;case 22:var y="https://ext1.buyhatke.com/php/counter.php";break;case 23:var y="https://ext1.buyhatke.com/dump-1";if(u.register=await h.getItem("register"),u.register!=1){try{e.postMessage({dataBack:""})}catch{}return}break;case 24:var y="https://t.buyhatke.com/referr/f2.php";break;case 25:var y="http://extmain.buyhatke.com/checkout";break;case 26:var c=i[0].siteid,y="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/v1/configs/"+c+".json";break;case 31:var c=i[0].siteid,y="https://api.buyhatke.com/coupons/PickCoupon/FreshC/v1/configs/"+c+".json";break;case 27:var r=i[0].host,y="https://api.buyhatke.com/couponConfig/checkConfig?domain="+r;break;case 41:var c=i[0].siteid,y="https://api.buyhatke.com/couponConfig/checkCOConfig/?pos="+c;break;case 28:var y="https://t.buyhatke.com/universalLog/";try{await Fe("UniversalLog",i[0])}catch{}return;case 29:var y="https://compare.buyhatke.com/logger/bread.php";break;case 30:var y="https://graph.bitbns.com/extAPIs/getDropDetails";break;case 32:var y="https://search-new.bitbns.com/autocoupon-apis/getSideBarCoupons";break;case 33:var y="http://supercrawler.buyhatke.com/recommendation/fetchAPICopy.php";break;case 34:var y="https://api.buyhatke.com/paapi/updatePriceAlert";break;case 35:var y="https://api.buyhatke.com/couponsAPI/likeDislike";break;case 36:var y="https://compare.buyhatke.com/extension/pushBrand.php";break;case 37:var y="https://compare.buyhatke.com/extension/feedbacks.php";break;case 38:var y="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/saveAppliedCoupons.php";break;case 39:var y="https://api.buyhatke.com/couponsAPI/add_cpn";break;case 40:var y="https://t.buyhatke.com/thankyou.php";break;case 43:var y="https://api.buyhatke.com/paapi/showStockAlerts";break;case 44:var y="https://api.buyhatke.com/paapi/stockAlert";break;case 46:var c=i[0].site_id,y="https://compare.buyhatke.com/extension/configs/oosAlert/"+c+".json";break;case 47:var y="https://compare.buyhatke.com/unwantedDomains.json?rand="+parseInt(Math.random()*99999);break;case 50:var y="https://graph.bitbns.com/getPopular.php";break;case 51:var y="https://graph.bitbns.com/getMin.php";break;case 1234:var y="https://ext1.buyhatke.com/fcheck-1";break;case 1235:var y="https://ext1.buyhatke.com/buscheck-1";break;case 1236:var y="https://ext1.buyhatke.com/hotelscheck-1";break;case 1237:var y="https://ext1.buyhatke.com/moviescheck-1";break;case 1701:var y="https://ext1.buyhatke.com/couponTracking-1";break;case 1240:var y="https://compare.buyhatke.com/autocoupon-contest/check_winner.php";break;case 100:et=0,await h.setItem("ext_email",i[0].email),await h.setItem("verifiedExt",0),await h.setItem("timeEmailAdded",parseInt(new Date().getTime()/1e3));var y="https://compare.buyhatke.com/extension/addEmailExt.php";break;case 200:et=0;var y="https://compare.buyhatke.com/wishlist3/api/createWishList.php";break;case 400:et=0;var y="https://compare.buyhatke.com/wishlist3/api/deleteWL.php";break;case 500:et=0;var y="https://compare.buyhatke.com/wishlist3/api/delFromWish.php";break;case 600:et=0;var y="https://compare.buyhatke.com/wishlist3/api/addProd2Wish.php";break;case 700:et=0;var y="https://compare.buyhatke.com/wishlist3/api/modifyTags.php";break;case 800:et=0;var y="https://compare.buyhatke.com/wishlist3/api/editWL.php";break;case 900:et=0;var y="https://compare.buyhatke.com/wishlist3/api/scrapWishList.php";break;case 1e3:if(et=1,i[0].selectSiteWish){var l=i[0].selectSiteWish.trim();if(l!=""&&l.split("flipkart.com/wishlist").length>1)flipWishListURL(l).then(function(W){try{e.postMessage({dataBack:W})}catch{}Da()});else if(l!=""&&l.split("snapdeal.com/mywishlist").length>1||l!=""&&l.split("snapdeal.com/wishlist").length>1)snapWishList(l).then(function(W){try{e.postMessage({dataBack:W})}catch{}Da()});else if(l!=""&&l.split("amazon.in").length>1&&l.split("wishlist/").length>1||l.split("amzn.in/").length>1){l.split("/ref=").length>1&&(l=l.split("/ref="),l=l[0].trim()),l.split("?").length>1&&(l=l.split("?"),l=l[0].trim()),l.split("#").length>1&&(l=l.split("#"),l=l[0].trim()),l.split("&").length>1&&(l=l.split("&"),l=l[0].trim());var d=l.length-1;l.substr(d,1)=="/"&&(l=l.substring(0,d)),amazWishList(l).then(function(W){try{e.postMessage({dataBack:W})}catch{}Da()})}else try{e.postMessage({dataBack:""})}catch{}return}break;case 1100:if(et=1,i[0].setMinAlertURL){try{var L=`ext_id=${u.ext_id}&auth_val=${u.ext_auth}&link_id=${i[0].link_id}&platform=${i[0].platform}&price_not=${i[0].price_not}`,o=await oe(i[0].setMinAlertURL.trim(),"POST",L,"formData");o&&e.postMessage({dataBack:o})}catch{}return}break;case 1200:if(et=1,i[0].removePriceAlert){var f=i[0].removePriceAlert.trim(),p=i[0].showAlert.trim(),w=i[0].link_id,x=parseInt(Math.random()*999999999999999),L=`ext_id=${u.ext_id}&auth_val=${u.ext_auth}&link_id=${w}`,m=await oe(f+"?rand="+x,"POST",L,"formData");if(m){var o=await oe(p+"?rand="+x,"POST",`ext_id=${u.ext_id}&auth_val=${u.ext_auth}`,"formData");if(o){o==null|o=="null"&&(o="[]");try{Ue=await JSON.parse(o),ii(Ue)}catch{Ue=o,ii(Ue)}try{e.postMessage({dataBack:JSON.stringify(Ue)})}catch{}}}return}break;case 1300:et=1,submitDataEBAY(i,"submitData.php").then(async function(W){await h.setItem("bankBox1",i[0].Bank),await h.setItem("bankBox2",i[1].Acc),await h.setItem("bankBox3",i[2].Branch),await h.setItem("bankBox4",i[3].IFSC);try{e.postMessage({dataBack:W})}catch{}});return;case 1400:et=1,submitDataEBAY(i,"submitData.php").then(async function(W){submitEbay=i,await h("myName",i[0].Name),await h("phoneNo",i[1].Phone),await h("emailEbay",i[2].email);try{e.postMessage({dataBack:W})}catch{}});return;case 1500:et=1,submitDataEBAY(i,"submitPP.php").then(async function(W){await h("submittedPaisa",i[0].PP);try{e.postMessage({dataBack:W})}catch{}});return;case 1600:et=1;try{u.mywishlist=await h.getItem("mywishlist"),e.postMessage({dataBack:u.mywishlist})}catch{}return;case 1700:et=0;var y="https://compare.buyhatke.com/wishlist3/api/wlCoverPic.php";break;case 1800:try{e.postMessage({dataBack:Xr})}catch{}return}var b,I;u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth"),b=u.ext_id,I=u.ext_auth;var O=i,L="";s!=28&&s!=1&&s!=51&&s!=50&&s!=32?L="ext_id="+b+"&auth_val="+I:s!=1&&(L="type=log&indexName=interest_centers&logName=info");for(var F=O.length,j=0,D=0;D<F;D++){var R=O[D];for(var $ in R){var Y=$,M=O[D][$];Y=="pos"&&(j=M),Y=="cpnData"||Y=="interests"||Y=="variants"||s==40?L+="&"+Y+"="+encodeURIComponent(JSON.stringify(M)):L+="&"+Y+"="+M}}u.flagBL=await h.getItem("flagBL"),u.actBL=await h.getItem("actBL"),s==1&&u.flagBL==1&&j==63?L+="&mainFL=1":s==1&&u.actBL<10&&j==63&&(await h.setItem("actBL",parseInt(u.actBL)+1),L+="&mainFL=1"),s==7&&Ll(O[0].pos,O[0].site_url,O[0].affiliate_name,e.sender.tab.id);let B="";if(s==1||s==51||s==50||s==32?(y=y+"?"+L,B=await oe(y,"GET",L)):s==27||s==26||s==31||s==41||s==46||s==47?B=await oe(y,"GET",L):(E("mai yaha hu"),E("parameters",L),s==43&&E("url",y),B=await oe(y,"POST",L,"formData"),s==43&&(Xr=B)),E(s," => req text",B),B){E("mat aaa idhar");try{e.postMessage({dataBack:B})}catch(W){E("err",W)}s==26&&Yc(B),s==31&&zc(B),s==41&&Cc(B,i[0].siteid),s==27&&Zc(B,i[0].host),s==46&&Xc(B,i[0].site_id),s==47&&(Qc(B),B=JSON.stringify(B)),s==24&&(B=B.trim(),B=parseInt(B),isNaN(B)||rd(B))}if(s==43||s==44){if(s==43)try{var N=JSON.parse(B);N.status==1&&typeof N.data<"u"&&(E("dataWatchOOS",N),ba=N.data,E("HERERRERERERER ",ba))}catch(W){E("Error in command 43 ",W)}try{E("sending back ",B),e.postMessage({dataBack:B})}catch(W){E("Error in command 43 port  ",W)}}else try{e.postMessage({dataBack:""})}catch{}}}):e.name=="couponsPayloadData"?e.onMessage.addListener(async function(t){if(E("here18",t),t.couponsPayloadData!=""){var a=t.couponsPayloadData.split("~*"),r=a[0],i=a[1],s=a[2],r=JSON.parse(r),c,l;c=u.ext_id,l=u.ext_auth;for(var d="https://api.buyhatke.com/coupons/cpnSideBar/"+s,o=r,f="ext_id="+c+"&auth_val="+l+"&webID="+i,p=o.length,w=0;w<p;w++){var x=o[w];for(var m in x){var y=m,b=o[w][m];f+="&"+y+"="+b}}if(mytext=await oe(d,"POST",f,"formData"),mytext)try{e.postMessage({dataBack:mytext})}catch{}}}):e.name.indexOf("buyhatke")>-1?e.onMessage.addListener(async function(t){var i,s;E("here19",t);let a="";switch(t.type){case"keepActive":e.postMessage({type:t.type,mydata:a});break;case"getCouponsList":a=await Ml(t),e.postMessage({type:t.type,mydata:a});break;case"getConfig":a=await Fl(t.pos,t.devicetype),e.postMessage({type:t.type,pos:t.pos,mydata:a});break;case"getRequest":E("Here at getRequest "),Ft=0,Jt="",ea="",Vt=0,ze.webRequest.onBeforeRequest.hasListener(Mt)&&ze.webRequest.onBeforeRequest.removeListener(Mt),ze.webRequest.onBeforeSendHeaders.hasListener(gt)&&ze.webRequest.onBeforeSendHeaders.removeListener(gt),pt[`${t.api}~${e.sender.tab.id}`]||(pt[`${t.api}~${e.sender.tab.id}`]=1),ze.webRequest.onBeforeRequest.addListener(Mt,{urls:[t.api]},["requestBody"]),ze.webRequest.onBeforeSendHeaders.addListener(gt,{urls:[t.api]},["requestHeaders"]);async function r(){if(Ft==1&&Vt%2==0){ze.webRequest.onBeforeRequest.removeListener(Mt),ze.webRequest.onBeforeSendHeaders.removeListener(gt);try{e.postMessage({type:t.type,mydata:{headers:Jt,body:ea}})}catch(o){E("error here ",o)}}else setTimeout(r,500)}await r();break;case"getResponse":E("Here at getResponse "),Ft=0,Jt="",ea="",Vt=0,ze.webRequest.onHeadersReceived.hasListener(gt)&&ze.webRequest.onHeadersReceived.removeListener(gt),ze.webRequest.onResponseStarted.hasListener(Mt)&&ze.webRequest.onResponseStarted.removeListener(Mt),pt[`${t.api}~${e.sender.tab.id}`]||(pt[`${t.api}~${e.sender.tab.id}`]=1),ze.webRequest.onHeadersReceived.addListener(gt,{urls:[t.api]},["responseHeaders"]),ze.webRequest.onResponseStarted.addListener(Mt,{urls:[t.api]},["responseHeaders"]);async function c(){if(Ft==1&&Vt%2==0){ze.webRequest.onHeadersReceived.removeListener(gt),ze.webRequest.onResponseStarted.removeListener(Mt);try{e.postMessage({type:t.type,mydata:{headers:Jt,body:ea}}),delete pt[`${t.api}~${e.sender.tab.id}`]}catch(o){E("error here ",o)}}else setTimeout(r,500)}await c();break;case"getCurrentUrl":a=await getCurrentUrl();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getSiteLogo":a=await To(t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getPOS":a=await fn(t.url,e.sender.tab.id);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"isBlockUISite":a=await Lo(t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getACPOS":a=await No(t.url);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"sendForSpecExtraction":a=await Ro(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"postTotalSavings":a=await Po(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"postUpdate":a=await Mo(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"filterData":a=await go(t.data,t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"postSavingsAlert":a=await Fo(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getCartConfig":a=await Bl(t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getHeadersFromAPI":a=await el(t.url);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"checkCartConfigExistence":a=await cn(t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"checkSavingSites":a=await cn(t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getScrapConfig":a=await Ul(t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getEtConfig":a=await $l(t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"createFlightQuerySearch":a=await Vl(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"pollFlight":a=await Kl(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getProductCategory":a=await Ao(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getTurkCountries":a=await Gl();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getUserCountry":a=await h.getItem("userCountry");try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getPriceComparison":a=await zl(t.pid,t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"checkToCallPriceComparisonFunction":a=await Hl(t.url);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getDittoScrapConfig":a=await ko(t);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getSearchHTML":a=await _o(t.data,t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"sendExactData":a=await Oo(t.exactData,t.pos,t.pid,t.prod,t.price,t.image,t.src);try{e.postMessage({type:t.type,mydata:a})}catch{}case"getExactHtml":a=await dr(t.exactUrl);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"sendDittoSearchData":a=await vo(t.data,t.currData);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getCurrencyMap":a=await Qn();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getElectronicProduct":a=await Wl();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getElectronicCategories":a=await Yl();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getSkuForSearch":a=await yi();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"fireEvent":a=await Fe(t.eventName,t.params);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"reloadTab":try{Hc(t.tabId),a="Tab reloaded",e.postMessage({type:t.type,mydata:a})}catch{}break;case"logErrorMonitorData":a=await ha(t.params);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"logError":a=await v(t.funcName,t.err);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"firePageViewEvent":a=await Kc(t.eventName,t.hostName,t.otherParams);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getDittoSearchData":a=await ln(t.pid,t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getDittoSearchDataGlobal":a=await Zl(t.pid,t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"checkIfSpendLive":a=await Xl(t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"spendCalculateCart":a=await ns(t.siteConfig,t.pos,t==null?void 0:t.lastQuarter,t.cookie,t.localStorage,t.domMap,e.sender.tab.id,"",t==null?void 0:t.calculateLatest);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"spendCalculate":try{Ve[e.sender.tab.id]||(Ve[e.sender.tab.id]=t==null?void 0:t.spendMapAnalyticsCnt),qe[e.sender.tab.id]||(qe[e.sender.tab.id]=t==null?void 0:t.spendMapAnalyticsTime)}catch{}a=await po(t.pos,t.siteConfig,t.username,t.cookie,t.localStorage,t.domMap,e.sender.tab.id,t==null?void 0:t.calculateLatest,t==null?void 0:t.lastQuarter),a.spendMapAnalyticsCnt=Ve[e.sender.tab.id],a.spendMapAnalyticsTime=qe[e.sender.tab.id],delete Ve[e.sender.tab.id],delete qe[e.sender.tab.id];try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"zeptoOrderJSON":Nt[e.sender.tab.id]||(Nt[e.sender.tab.id]={},Nt[e.sender.tab.id].orderJSON=t==null?void 0:t.orderJSON,Nt[e.sender.tab.id].orderAPIArr=t==null?void 0:t.orderAPIArr);let l={};try{l=await gc(e.sender.tab.id,t==null?void 0:t.pos)}catch{}if(Nt[e.sender.tab.id].orderJSON)for(let o of Nt[e.sender.tab.id].orderJSON)try{let f=o==null?void 0:o.orderId;l[f]&&(o.orderDetails=l[f]),(i=l[f])!=null&&i.refundAmt&&(o.orderTotal-=(s=l[f])==null?void 0:s.refundAmt)}catch{}a=Nt[e.sender.tab.id].orderJSON;try{e.postMessage({type:t.type,mydata:a})}catch{}delete Nt[e.sender.tab.id];break;case"getSpendConfig":a=await os(t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"setTimeId":try{Ve[e.sender.tab.id]||(Ve[e.sender.tab.id]=t==null?void 0:t.spendMapAnalyticsCnt),qe[e.sender.tab.id]||(qe[e.sender.tab.id]=t==null?void 0:t.spendMapAnalyticsTime)}catch{}a=await ls(t==null?void 0:t.spendId,t==null?void 0:t.pos,e.sender.tab.id),a.spendMapAnalyticsCnt=Ve[e.sender.tab.id],a.spendMapAnalyticsTime=qe[e.sender.tab.id],delete Ve[e.sender.tab.id],delete qe[e.sender.tab.id];try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getCheckoutAnalytics":a=Zr;try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getUsernameFromSW":a=await qu(t==null?void 0:t.pos,t==null?void 0:t.url,t==null?void 0:t.body);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"responseFromSW":a=await bo(t==null?void 0:t.url,t==null?void 0:t.payload);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getSpendSummary":a=await us(t.pos,t.username,t.siteConfig);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"pushSpendData":await cs(t==null?void 0:t.data,t==null?void 0:t.pos,t==null?void 0:t.spendId,t==null?void 0:t.siteConfig,e.sender.tab.id),a=await hs(t.spendId,t.data,t==null?void 0:t.curArr,t==null?void 0:t.addressMap,t==null?void 0:t.isBusiness);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getOrdersScrapedCount":a=yo(e.sender.tab.id);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getProductsScrapedArr":a=wo(e.sender.tab.id);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getUserUsedSpendCount":a=await Nd();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"updateAutoSync":a=await mo();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getExtIdAuth":a=await Id();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"spendErrorLog":a=await Bs(t.pos,t.error);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"sendAndClearSpendApiLogs":a=await Wc(t.spendLogs);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"updateCouponStatus":a=await Jo(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"ACMonitor":a=await Bo(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getACAnalyticsId":a=await Sl(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"ACTSMonitor":a=await jo(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"checkoutScrap":a=await Uo(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"voucherScrap":a=await $o(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"Popularity":a=await Vo(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getHTMLScrapSites":a=await Ko();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"sendScrapHTML":a=await Go(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"sendCategoryCrawl":a=await Yo(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getCategoryConfig":a=await Wo(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getBankPosConfig":a=await Jl();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getTurkFlagCurrencies":a=await jl();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getAffCouponsNew":a=await Zo(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getCpnCollectionConfig":a=await Xo(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"sendCouponScrap":a=await Qo(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getFeeds":a=await Co(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"extID":u.ext_id=await h.getItem("ext_id"),a=u.ext_id;try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"sendWishlistData":a=await tu(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getScrapConfigWishlist":a=await eu(t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"sendCurrentMonitorData":a=await dd(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"featureMonitorData":a=await hd(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"countMonitor":await Ss(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"errorMonitor":await ha(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getRequestToAny":let d=await oe(t.data,"GET","");try{e.postMessage({type:t.type,mydata:d})}catch{}break;case"groceryCheckout":await bd(t.data);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getResponseFromBackground":a=await ws(t.url,t.options,t.isText);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"fetchReferralCode":a=await Td();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"verifyReferral":a=await Ld(t.referralCode);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getFlipkartLowestSellerPrice":a=await So(t.prodCode,t.currPincode,t.config);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getSocialProofData":a=await Pd();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"sendFeedBackData":a=await Rd(t.likeNewUI,t.comment,t.source,t.url);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"checkEmailVerified":Ol();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"checkLogin":a=await gd();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"handleLogin":a=await Md();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getCookiesFromBackground":a=await ki(t.url,t.name);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"setExtensionCookie":a=await Vd(t.name,t.value,t.days);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"checkTelegramConnectStatus":a=await Sd();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getTelegramBotUrl":a=await Ud();try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"sendAmazonVariants":a=await Ru(t.arr);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"sendPidsForThunder":a=await ks(t.arr,t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getDataFromSendPairCache":a=await Pu(t.pid,t.pos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getDealScore":a=await Nu(t.arr,t.pos,t.currentPrice,t.oos);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"getAdCreatives":a=await Fd(t.id);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"trackImpressionPixel":a=await Jd(t.params);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"trackClickPixel":a=await jd(t.params);try{e.postMessage({type:t.type,mydata:a})}catch{}break;case"fireExternalAdPixel":a=await Bd(t.url);try{e.postMessage({type:t.type,mydata:a})}catch{}break;default:u.ext_id=await h.getItem("ext_id"),a=u.ext_id;try{e.postMessage({type:"DEFAULT",mydata:"Unhandle default response from BG"})}catch{}break}}):E("Unhandled port request ",e)}),chrome.tabs.onUpdated.addListener(async function(e,t,a){var i="12.png",s=a.url,r=e;Ca(ma,r),Ca(gr,r);var c=0;let l=await fn(a.url,e);if(l&&l!=""&&l!=null){var i=xc,d=0;c=1,ma.push({tabID:r,tabURL:s,res:d,count:d})}else{var i=Ic,o=2,d=0;ma.push({tabID:r,tabURL:s,res:o,count:d})}(!ui[e]||c==1)&&(ui[e]=!0,chrome.action.setIcon({tabId:e,path:i}))}),chrome.tabs.onRemoved.addListener(async function(e){E("here21",e),gu(e),Ca(ma,e),Ca(gr,e);let t=`lastUrl_${e}`;try{(await chrome.storage.local.get(t))[t]!==void 0&&(await chrome.storage.local.remove(t),E(`Cleaned up lastUrl storage for tab ${e}`))}catch(a){E(`Error checking/removing lastUrl storage for tab ${e}:`,a)}}),chrome.runtime.onMessage.addListener(function(e,t,a){async function i(){try{if(E("entered ",e),Object.keys(u).length==0){a({farewell:"",status:!1});return}if(e.method=="getLocalStorage")a({data:u});else if(e.getCurPosition){var s=e.getCurPosition.siteName.toUpperCase(),r=0;for(var c in siteCurrentPosition)if(s.split(c).length>1){r=1,a({result:siteCurrentPosition[c]});break}r==0&&a({result:"0~"})}else if(e.extractConfig)ia[e.extractConfig.siteid]!=null?a({result:ia[e.extractConfig.siteid].configData}):a({result:"empty"});else if(e.checkStatus)sa[e.checkStatus.host]!=null?a({result:sa[e.checkStatus.host].status}):a({result:"empty"});else if(e.getConfigOOS)Gt[e.getConfigOOS.site_id]!=null?a({result:Gt[e.getConfigOOS.site_id].config}):a({result:"empty"});else if(e.removeDomains)typeof Tt<"u"&&typeof Tt.domains<"u"&&Tt.domains!=""&&Object.keys(Tt).length>0?a({result:Tt.domains}):a({result:"empty"});else if(e.extractCheckoutConfig)na[e.extractCheckoutConfig.siteid]!=null?a({result:na[e.extractCheckoutConfig.siteid].configData}):a({result:"empty"});else if(e.checkCheckoutStatus)ca[e.checkCheckoutStatus.siteid]!=null?a({result:ca[e.checkCheckoutStatus.siteid].status}):a({result:"empty"});else if(e.config_api)rr.push(e.config_api),a({result:"finished"}),chrome.webRequest.onBeforeRequest.addListener(Sn,{urls:rr},["requestBody"]),chrome.webRequest.onBeforeSendHeaders.addListener(Fn,{urls:rr},["requestHeaders"]);else if(typeof e.data<"u"){var l=e.data.split("~*~*"),d=l[0],o=l[1],f=l[2],p=l[3],w=l[4],x=l[5];let M=l[6],N=l[7],B=l[8];var m="https://api.buyhatke.com/paapi/priceAlert",y="prod="+encodeURIComponent(d)+"&price="+o+"&price_set="+B+"&image="+encodeURIComponent(f)+"&url="+encodeURIComponent(p)+"&pos="+w+"&pid="+M+"&sitepos="+encodeURIComponent(N)+"&ext_id="+u.ext_id+"&auth_val="+u.ext_auth;try{let W=await oe(m,"POST",y,"formData");_t(63,5,1,"set price alert success for site "+w+" and url "+p,w,0),a({farewell:W})}catch(W){v("setPriceAlertError",W),_t(63,5,-1,"set price alert error for site "+w+" and url "+p,w,0),a({farewell:"error"})}}else if(typeof e.search<"u"){name=e.search;var O=name.split("~*~*"),b=parseInt(O[2]),I="";name.split("moreData=").length>1&&(I=name.split("moreData=")[1],name=name.split("moreData=")[0]);var O=name.split("~*~*"),L=parseFloat(O[1]);name=O[0];var F=name.split("-");name=F.join(" ");for(var c=0;Cr[c]!=0;)c++;Cr[c]=1;var j=c;_u(name.trim(),L,c,t.tab.id,t.tab.url,I,b)}else if(typeof e.sendTabID<"u")a({farewell:t.tab.id});else if(typeof e.sendOptionCookie<"u")a({farewell:{ext_id:u.ext_id,ext_id_bh:u.ext_id,ext_auth:u.ext_auth,ext_auth_bh:u.ext_auth}});else if(typeof e.sendSourceInstall<"u")a({farewell:u.sourceInstall});else if(typeof e.submitTabID<"u")au(e.submitTabID),a({farewell:t.tab.id});else if(typeof e.checkTabID<"u")ru(e.checkTabID),a({farewell:t.tab.id});else if(typeof e.checkSubscription<"u")a({farewell:su(e.checkSubscription)});else if(typeof e.sendStartTime<"u")a({farewell:nu(e.sendStartTime)});else if(typeof e.tabAssignedHash<"u")a({farewell:u.tabAssignedHash});else if(typeof e.sendTabIDF<"u")a({farewell:t.tab.id});else if(typeof e.visitedEcomm<"u")Ta(e.visitedEcomm),a({farewell:"OK"});else if(e.monitorStart){let M=e.monitorStart;_t(118,4,1,encodeURIComponent("ac start pair event  "+M),M,1)}else if(e.monitorEnd){let M=e.monitorEnd,N=M.split("~")[0],B=M.split("~")[1];_t(118,4,1,encodeURIComponent("ac end pair event "+N+" using coupon "+B),N,-1)}else if(e.monitorEndFail){let M=e.monitorEndFail;_t(118,4,-1,"ac end pair event no applied coupon "+M,M,-1)}else if(e.couponDisplayStart){let M=e.couponDisplayStart;_t(121,4,1,encodeURIComponent("ac icon display start "+M),M,1)}else if(e.couponDisplayEnd){let M=e.couponDisplayEnd;_t(121,4,1,encodeURIComponent("ac icon display end "+M),M,-1)}else if(e.interceptorWorkingStart){let M=e.interceptorWorkingStart;_t(119,4,1,encodeURIComponent("interceptor working start event"+M),M,1)}else if(e.interceptorWorkingEnd){let M=e.interceptorWorkingEnd;_t(119,4,1,encodeURIComponent("interceptor working end event"+M),M,-1)}else if(typeof e.showPush<"u")Hi[e.showPush]||(Hi[e.showPush]=1),a({farewell:"OK"});else if(typeof e.getMIFlashSale<"u")a({farewell:u.flashSale});else if(typeof e.sendSalesData<"u")a({farewell:"Done"}),await h.setItem("checkedArray",e.sendSalesData);else if(typeof e.getbhList<"u")typeof u.hashBL>"u"||u.hashBL==""||Object.keys(u.hashBL).length==0?a({farewell:""}):a({farewell:u.hashBL});else if(typeof e.sendbhList<"u")typeof u.hashBL>"u"||u.hashBL==""||Object.keys(u.hashBL).length==0?a({farewell:""}):(Dl(u.hashBL),a({farewell:""}));else if(typeof e.clearbhList<"u")a({farewell:""}),await h.setItem("hashBL",""),await h.setItem("flagBL",0);else if(typeof e.email<"u")typeof u.ext_email>"u"||u.ext_email==""||Object.keys(u.ext_email).length==0?a({farewell:"No"}):a({farewell:u.ext_email});else if(typeof e.execJioSale<"u")t.tab.id,a({farewell:""});else if(typeof e.extName<"u")a({farewell:chrome.runtime.id});else if(typeof e.getTypesCurrent<"u")a({farewell:u.subsTypeSelected});else if(typeof e.setNotifType<"u")a({farewell:""}),await h.setItem("subsTypeSelected",e.setNotifType);else if(typeof e.subsType<"u")a({farewell:u.subsTypeSelected});else if(e.searchTesting)a({farewell:u.searchTesting});else if(typeof e.matchExists<"u")a({farewell:matchSelected});else if(typeof e.extId<"u")a({farewell:u.ext_id});else if(typeof e.fetchFeatures<"u")a({farewell:u.features_json});else if(typeof e.ext_auth<"u")a({farewell:u.ext_auth});else if(e.type=="GET_CURRENT_TAB")a({status:!0,id:t.tab.id,url:t.tab.url});else if(typeof e.regisDone<"u")a({status:!0}),await h.setItem("register",1);else if(typeof e.getCoupons<"u")e.getCoupons==2?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=111&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("http://www.myntra.com/?utm_source=buyhutke&utm_medium=aff")}):e.getCoupons==1?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=50&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("http://www.jabong.com/")}):e.getCoupons==3?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=129&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("http://www.snapdeal.com/?utm_source=aff_prog")}):e.getCoupons==4?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=1&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("http://www.ebay.in/")}):e.getCoupons==7?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=421&source=extension&ext1=pushA&ext2="+u.ext_id+"&link="+encodeURIComponent("http://www.shopclues.com/appliances-5/breakfast-appliances-offers.html?utm_medium=notification")}):e.getCoupons==10?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=99&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("http://www.infibeam.com/")}):e.getCoupons==8?chrome.tabs.create({url:"http://track.in.omgpm.com/?AID=368059&PID=11256&CID=3954200&MID=387804&r=http://shopping.indiatimes.com/"}):e.getCoupons==9?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=4&source=extension&ext1=auto-coupon&ext2="+u.ext_id+encodeURIComponent("http://www.homeshop18.com/?it_category=AP&it_action=WB-HSLOGO&it_label=AP-HSLOGO-140609131400-PR-WB-OT-MR-HS18_HomeShop18Logo&it_value=0")}):e.getCoupons==13?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=1289&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link=https%3A%2F%2Fwww.cleartrip.com"},function(M){}):e.getCoupons==15?chrome.tabs.create({url:"http://track.in.omgpm.com/?AID=368059&PID=9629&CID=3944269&MID=348512"}):e.getCoupons==16?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=1352&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link=http%3A%2F%2Fwww.dominos.co.in"}):e.getCoupons==17?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=1293&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("http://www.yatra.com/")}):e.getCoupons==18?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?tagType="+u.setTagType+"&pos=63&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("http://www.amazon.in/")}):e.getCoupons==19?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=1000&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("http://www.fabfurnish.com/")}):e.getCoupons==20?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=57&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("http://www.lenskart.com/")}):e.getCoupons==22?chrome.tabs.create({url:"https://track.in.omgpm.com/?AID=368059&PID=8422&CID=3944299&MID=218153"}):e.getCoupons==24?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=333&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("https://www.pepperfry.com/")}):e.getCoupons==26?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=429&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("http://www.zivame.com/")}):e.getCoupons==28?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=426&source=extension&ext1=auto-coupon&ext2="+u.ext_id+"&link="+encodeURIComponent("http://www.bluestone.com/")}):e.getCoupons==32&&chrome.tabs.create({url:"http://track.in.omgpm.com/?AID=368059&PID=10859&CID=3944292&MID=478605"}),chrome.tabs.update(parseInt(t.tab.id),{selected:!0}),yl(e.getCoupons,t.tab.id);else if(!(typeof e.getCouponsData<"u")){if(typeof e.getDeals<"u")wl(e.getDeals,t.tab.id);else if(!(typeof e.pids<"u")){if(typeof e.processDONE<"u")Ou(e.processDONE);else if(typeof e.savings<"u")Al(e.savings);else if(!(typeof e.pidsAmaz<"u")){if(!(typeof e.pidsMyn<"u")){if(!(typeof e.pidsJab<"u")){if(!(typeof e.pidsSnap<"u")){if(typeof e.pairsFlip<"u")Q(e.pairsFlip,0);else if(typeof e.pairsGeneralise<"u"){let M=e.pairsGeneralise.actPos,{pairPos:N,currPos:B}=ni(M);Q(e.pairsGeneralise.data,N)}else if(typeof e.currentGeneralise<"u"){let M=e.currentGeneralise.actPos,{pairPos:N,currPos:B}=ni(M);C(e.currentGeneralise.data,B)}else if(typeof e.dp<"u")ht(e.dp);else if(typeof e.pairsPrettySecrets<"u")Q(e.pairsPrettySecrets,433);else if(typeof e.pairsLandmark<"u")Q(e.pairsLandmark,31);else if(typeof e.pairsPur<"u")Q(e.pairsPur,26);else if(typeof e.pairsKoovs<"u")Q(e.pairsKoovs,13);else if(typeof e.pairsEbay<"u")Q(e.pairsEbay,-1);else if(typeof e.pairss19<"u")Q(e.pairss19,15);else if(typeof e.pairsZovi<"u")Q(e.pairsZovi,12);else if(typeof e.pairsFab<"u")Q(e.pairsFab,20);else if(typeof e.pairsPepp<"u")Q(e.pairsPepp,19);else if(typeof e.pairsCroma<"u")Q(e.pairsCroma,9);else if(typeof e.pairsABOF<"u")Q(e.pairsABOF,1850);else if(typeof e.pairsRediff<"u")Q(e.pairsRediff,32);else if(typeof e.pairsRediffB<"u")Q(e.pairsRediffB,35);else if(typeof e.pairsIndiatimes<"u")Q(e.pairsIndiatimes,14);else if(typeof e.pairsHk<"u")Q(e.pairsHk,17);else if(typeof e.pairsJewels<"u")Q(e.pairsJewels,21);else if(typeof e.pairsZivame<"u")Q(e.pairsZivame,18);else if(typeof e.pairsLens<"u")Q(e.pairsLens,23);else if(typeof e.pairsZoom<"u")Q(e.pairsZoom,27);else if(typeof e.pairsWatch<"u")Q(e.pairsWatch,22);else if(typeof e.pairsDone<"u")Q(e.pairsDone,28);else if(typeof e.pairsCilory<"u")Q(e.pairsCilory,16);else if(typeof e.pairsTrendin<"u")Q(e.pairsTrendin,24);else if(typeof e.pairsChumbak<"u")Q(e.pairsChumbak,30);else if(typeof e.pairsShop<"u")Q(e.pairsShop,29);else if(typeof e.pairsIndia<"u")Q(e.pairsIndia,33);else if(typeof e.pairsNaap<"u")Q(e.pairsNaap,36);else if(typeof e.pairsPaytm<"u")Q(e.pairsPaytm,1429);else if(typeof e.pairsFree<"u")Q(e.pairsFree,25);else if(typeof e.pairsCross<"u")Q(e.pairsCross,34);else if(typeof e.pairsBaby<"u")Q(e.pairsBaby,51);else if(typeof e.pairsBas<"u")Q(e.pairsBas,44);else if(typeof e.curDataBas<"u")C(e.curDataBas,44);else if(typeof e.pairsNGal<"u")Q(e.pairsNGal,430);else if(typeof e.curDataNGal<"u")C(e.curDataNGal,430);else if(typeof e.curDataPrettySecrets<"u")C(e.curDataPrettySecrets,433);else if(typeof e.curDataFlip<"u")C(e.curDataFlip,0);else if(typeof e.curDataAMS<"u")C(e.curDataAMS,40);else if(typeof e.curDataBaby<"u")C(e.curDataBaby,51);else if(typeof e.curDataPaytm<"u")C(e.curDataPaytm,1429);else if(typeof e.curDataFree<"u")C(e.curDataFree,25);else if(typeof e.curDataCross<"u")C(e.curDataCross,34);else if(typeof e.curDataIndia<"u")C(e.curDataIndia,33);else if(typeof e.curDataNaap<"u")C(e.curDataNaap,36);else if(typeof e.curDataLandmark<"u")C(e.curDataLandmark,31);else if(typeof e.curDataShop<"u")C(e.curDataShop,29);else if(typeof e.curDataChumbak<"u")C(e.curDataChumbak,30);else if(typeof e.curDataLens<"u")C(e.curDataLens,23);else if(typeof e.curDataPur<"u")C(e.curDataPur,26);else if(typeof e.curDataDone<"u")C(e.curDataDone,28);else if(typeof e.curDataZoom<"u")C(e.curDataZoom,27);else if(typeof e.curDataWatch<"u")C(e.curDataWatch,22);else if(typeof e.curDataTrendin<"u")C(e.curDataTrendin,24);else if(typeof e.curDataZovi<"u")C(e.curDataZovi,12);else if(typeof e.curDataAMB<"u")C(e.curDataAMB,1828);else if(typeof e.curDataNykaa<"u")C(e.curDataNykaa,1830);else if(typeof e.curDataZansaar<"u")C(e.curDataZansaar,1975);else if(typeof e.curDataEbay<"u")C(e.curDataEbay,-1);else if(typeof e.curDataClovia<"u")C(e.curDataClovia,1973);else if(typeof e.curDataMebel<"u")C(e.curDataMebel,1972);else if(typeof e.curDataFNY<"u")C(e.curDataFNY,1819);else if(typeof e.curDataLime<"u")C(e.curDataLime,424);else if(typeof e.curDataUrbanLad<"u")C(e.curDataUrbanLad,1827);else if(typeof e.curDataJewels<"u")C(e.curDataJewels,21);else if(typeof e.curDataIndiatimes<"u")C(e.curDataIndiatimes,14);else if(typeof e.curDataRediff<"u")C(e.curDataRediff,32);else if(typeof e.curDataZivame<"u")C(e.curDataZivame,18);else if(typeof e.curDataRediffB<"u")C(e.curDataRediffB,35);else if(typeof e.curDataCilory<"u")C(e.curDataCilory,16);else if(typeof e.curDatas19<"u")C(e.curDatas19,15);else if(typeof e.curDataKoovs<"u")C(e.curDataKoovs,13);else if(typeof e.curDataHS18<"u")C(e.curDataHS18,6);else if(typeof e.curDataCroma<"u")C(e.curDataCroma,9);else if(typeof e.curDataABOF<"u")C(e.curDataABOF,1850);else if(typeof e.curDataInfi<"u")C(e.curDataInfi,7);else if(typeof e.curDataFab<"u")C(e.curDataFab,20);else if(typeof e.curDataPepp<"u")C(e.curDataPepp,19);else if(typeof e.curDataHk<"u")C(e.curDataHk,17);else if(typeof e.curDataSnap<"u")C(e.curDataSnap,1);else if(typeof e.curDataShopClues<"u")C(e.curDataShopClues,2);else if(typeof e.curDataAmaz<"u")C(e.curDataAmaz,3);else if(typeof e.curDataJab<"u")C(e.curDataJab,4);else if(typeof e.curDataShein<"u")C(e.curDataShein,2362);else if(typeof e.curDataBanggood<"u")C(e.curDataBanggood,2364);else if(typeof e.curDataVeromoda<"u")C(e.curDataVeromoda,4423);else if(typeof e.curDataAdidas<"u")C(e.curDataAdidas,2097);else if(typeof e.curDataDecathlon<"u")C(e.curDataDecathlon,2335);else if(typeof e.curData2gud<"u")C(e.curData2gud,6031);else if(typeof e.curDataMyvishal<"u")C(e.curDataMyvishal,2372);else if(typeof e.curDataTatacliq<"u")C(e.curDataTatacliq,2190);else if(typeof e.curDataAjio<"u")C(e.curDataAjio,2191);else if(typeof e.curDataNykFas<"u")C(e.curDataNykFas,6068);else if(typeof e.curDataPlumG<"u")C(e.curDataPlumG,6069);else if(typeof e.curDataVoo<"u")C(e.curDataVoo,2266);else if(typeof e.curDataMrVoo<"u")C(e.curDataMrVoo,2267);else if(typeof e.curDataNetmeds<"u")C(e.curDataNetmeds,2238);else if(typeof e.curData1mg<"u")C(e.curData1mg,2237);else if(typeof e.curDataBook<"u")C(e.curDataBook,311);else if(typeof e.curDataAcad<"u")C(e.curDataAcad,1585);else if(typeof e.curDataSapnaonline<"u")C(e.curDataSapnaonline,451);else if(typeof e.curDataNNNow<"u")C(e.curDataNNNow,2192);else if(typeof e.curDataMyn<"u")C(e.curDataMyn,5);else if(typeof e.curDataFn<"u")C(e.curDataFn,11);else if(typeof e.pairsAmaz<"u")Q(e.pairsAmaz,1);else if(typeof e.pairsMyn<"u")Q(e.pairsMyn,2);else if(typeof e.pairsAMS<"u")Q(e.pairsAMS,40);else if(typeof e.pairsJab<"u")Q(e.pairsJab,3);else if(typeof e.pairsShein<"u")Q(e.pairsShein,2362);else if(typeof e.pairsBanggood<"u")Q(e.pairsBanggood,2364);else if(typeof e.pairsVeromoda<"u")Q(e.pairsVeromoda,4423);else if(typeof e.pairsAdidas<"u")Q(e.pairsAdidas,2097);else if(typeof e.pairsDecathlon<"u")Q(e.pairsDecathlon,2335);else if(typeof e.pairs2gud<"u")Q(e.pairs2gud,6031);else if(typeof e.pairsMyvishal<"u")Q(e.pairsMyvishal,2372);else if(typeof e.pairsTatacliq<"u")Q(e.pairsTatacliq,2190);else if(typeof e.pairsAjio<"u")Q(e.pairsAjio,2191);else if(typeof e.pairsNykFas<"u")Q(e.pairsNykFas,6068);else if(typeof e.pairsPlumG<"u")Q(e.pairsPlumG,6069);else if(typeof e.pairsVoo<"u")Q(e.pairsVoo,2266);else if(typeof e.pairsMrVoo<"u")Q(e.pairsMrVoo,2267);else if(typeof e.pairsNetmeds<"u")Q(e.pairsNetmeds,2238);else if(typeof e.pairs1mg<"u")Q(e.pairs1mg,2237);else if(typeof e.pairsBook<"u")Q(e.pairsBook,311);else if(typeof e.pairsAcad<"u")Q(e.pairsAcad,1585);else if(typeof e.pairsSapnaonline<"u")Q(e.pairsSapnaonline,451);else if(typeof e.pairsNNNow<"u")Q(e.pairsNNNow,2192);else if(typeof e.pairsSnap<"u")Q(e.pairsSnap,4);else if(typeof e.pairsFn<"u")Q(e.pairsFn,11);else if(typeof e.pairsShopClues<"u")Q(e.pairsShopClues,5);else if(typeof e.pairsHS18<"u")Q(e.pairsHS18,6);else if(typeof e.pairsInfi<"u")Q(e.pairsInfi,7);else if(typeof e.pairsNykaa<"u")Q(e.pairsNykaa,1830);else if(typeof e.pairsZansaar<"u")Q(e.pairsZansaar,1975);else if(typeof e.pairsClovia<"u")Q(e.pairsClovia,1973);else if(typeof e.addToBlockList<"u")Xu(e.addToBlockList);else if(typeof e.removeFromBlockList<"u")Qu(e.removeFromBlockList);else if(typeof e.getBlockList<"u")u.blockList!==void 0&&u.blockList!=""&&u.blockList!="null"&&u.blockList!="[]"&&u.blockList!="{}"&&Object.keys(u.blockList).length!=0?a({farewell:u.blockList}):a({farewell:"[]"});else if(typeof e.setTagType<"u")a({farewell:"[]"}),e.setTagType==1||e.setTagType=="1"?await h.setItem("setTagType",1):await h.setItem("setTagType","");else if(typeof e.getSessionKeyMMTInt<"u")a({farewell:Hn});else if(typeof e.pairsMebel<"u")Q(e.pairsMebel,1972);else if(typeof e.pairsFNY<"u")Q(e.pairsFNY,1819);else if(typeof e.pairsLime<"u")Q(e.pairsLime,424);else if(typeof e.pairsAMB<"u")Q(e.pairsAMB,1828);else if(typeof e.pairsUrbanLad<"u")Q(e.pairsUrbanLad,1827);else if(typeof e.removeURL<"u"){let M=e.removeURL,N=Tl(M);N&&a({farewell:N})}else if(typeof e.removeOOS<"u"){let M=e.removeOOS,N=Nl(M);N&&a({farewell:N})}else if(typeof e.detailArray<"u")Ue!=null&&Ue!="null"?a({farewell:Ue}):a({farewell:[]});else if(typeof e.offersArray<"u")er!=null&&er!="null"?(a({farewell:er}),parseInt(104*Math.random())==1):a({farewell:[]});else if(typeof e.userSetting<"u")E("userSetting was called ",u.featuresArray),a({farewell:u.featuresArray});else if(typeof e.hashTable<"u")a({farewell:ma});else if(typeof e.resultsTable<"u")a({farewell:gr});else if(typeof e.watchListArray<"u")a({farewell:Ue});else if(typeof e.watchlistMap<"u")a({farewell:ra});else if(typeof e.updateWatchlist<"u")Ue=e.updateWatchlist,a({farewell:"success"});else if(typeof e.updateWatchlistMap<"u")ra=e.updateWatchlistMap,a({farewell:"success"});else if(typeof e.updateWatchlistMapKeyWise<"u"){let M=Object.keys(e.updateWatchlistMapKeyWise)[0],N=Object.values(e.updateWatchlistMapKeyWise)[0];ra[M]=N,a({farewell:"success"})}else if(typeof e.hasGiven<"u")Ki=e.hasGiven,a({farewell:"success"}),await h.setItem("hasGiven",Ki);else if(typeof e.userName<"u")Wi=e.userName,a({farewell:"success"}),await h.setItem("userName",Wi);else if(typeof e.reqSent<"u")Gi=e.reqSent,a({farewell:"success"}),await h.setItem("reqSent",Gi);else if(typeof e.userID<"u")Oc=e.userID,a({farewell:"success"});else if(typeof e.updateIsVerified<"u")isVerified=e.isVerified,a({farewell:"success"}),await h.setItem("isVerified",isVerified);else if(typeof e.isVerified<"u")a({farewell:u.isVerified});else if(typeof e.updateWatchListArray<"u")Ue=e.updateWatchListArray,a({farewell:"success"});else if(typeof e.watchStockAlert<"u")E("Watch Stock Alert response sent",ba),a({farewell:ba});else if(typeof e.ixigoVar<"u")a({farewell:u.lastTime});else if(typeof e.ixigoVarSet<"u")u.lastTime=e.ixigoVarSet;else if(typeof e.sentClient_Id<"u"){if(u.tokenSent==0){await h.setItem("tokenSent",1);var D=e.sentClient_Id;try{await Fe("UniversalLog",{client_id:D,type:"info",action:"UPDATE_DATA",value:"extension",dev_id:u.ext_id,token:u.pushToken})}catch{}}}else if(typeof e.eccomVisit<"u")u.visited==""||u.visited==null||isNaN(u.visited)?await h.setItem("visited",1):await h.setItem("visited",parseInt(u.visited)+1),u.visited==3;else if(typeof e.saleArray<"u")a({farewell:al});else if(typeof e.saleVariables<"u")a({farewell:u.saleStarted});else if(typeof e.saleDate<"u")a({farewell:u.saleDate});else if(typeof e.sendNewPush<"u")Rl(),a({farewell:"OK"});else if(typeof e.refreshedYet<"u")a({farewell:u.refreshedYet+"~"+u.refreshedYetServer});else if(typeof e.getCurrentOffset<"u")a({farewell:u.diffTime});else if(typeof e.getInstructions<"u")a({farewell:u.instructions});else if(typeof e.getFlashSalesData<"u")a({farewell:u.existingSales});else if(typeof e.getCheckedSales<"u")a({farewell:u.checkedArray});else if(typeof e.subscribedFor<"u"){var l=JSON.parse(u.saleArray);l.length==0?a({farewell:"NONE"}):a({farewell:u.subscribedFor})}else if(typeof e.setSaleVariables<"u")a({farewell:"Success"}),await h.setItem("saleStarted",2),await h.setItem("saleFinished",5),await h.setItem("mostSensitive",0);else if(typeof e.setRefreshedYet<"u")a({farewell:"Success"}),await h.setItem("refreshedYet",1);else if(typeof e.ext_id<"u")a({farewell:u.ext_id+"~"+u.ext_auth});else if(typeof e.addEmail<"u"){await h.setItem("ext_email",e.addEmail);var m="https://compare.buyhatke.com/extension/addEmailExt.php",y="email="+encodeURIComponent(e.addEmail)+"&ext_id="+u.ext_id+"&auth_val="+u.ext_auth,R=await oe(m,"POST",y,"formData")}}}}}}}if(e.message=="user_details"){var $=[];$=[{ext_id:u.ext_id,auth_val:u.ext_auth,email:encodeURIComponent(u.ext_email)}],$=JSON.stringify($),a({farewell:$})}else if(e.message=="check_email_verified")u.verifiedExt&&u.verifiedExt=="1"&&Il(0),a({farewell:u.verifiedExt});else if(e.message=="alertList")a({identity:Ue});else if(e.message=="getVersion")a({farewell:u.version});else if(e.message=="featuresArray")a({farewell:u.featuresArray});else if(e.message=="importWL")a({farewell:u.wishListJson});else if(e.message=="getAddress")a({farewell:u.addressarray});else if(e.updateImportWL)a({farewell:"OK"}),await h.setItem("wishListJson",e.updateImportWL);else if(e.updateAddressArray)a({farewell:"OK"}),await h.setItem("addressarray",e.updateAddressArray);else if(e.actionFeaturesArr)a({farewell:"OK"}),await h.setItem("featuresArray",e.actionFeaturesArr);else if(e.actionCreateWishList)a({identity:"OK"}),await h.setItem("mywishlist",mywishlist);else if(e.actionMyWishList)a({farewell:"OK"}),await h.setItem("mywishlist",e.actionMyWishList);else if(e.message=="getEbayDetails"){var Y=u.bankBox1+"~*~"+u.bankBox2+"~*~"+u.bankBox3+"~*~"+u.bankBox4+"~*~"+u.phoneNo+"~*~"+u.emailEbay+"~*~"+u.myName;a({farewell:Y})}else if(e.updateWL)a({farewell:"OK"}),await h.setItem("mywishlist",e.updateWL);else if(e.updatePushNot)a({farewell:"OK"}),await h.setItem("pushNotStore",e.pushNotStore);else if(e.updatePromo)a({farewell:"OK"}),await h.setItem("promoPushArray",e.updatePromo);else if(e.message=="clearPushNot")a({farewell:"OK"}),await h.setItem("pushNotStore","");else if(e.message=="getPromoDetails")a({farewell:u.promoPushArray});else if(e.message==="openTab"&&e.url)chrome.tabs.create({url:e.url});else if(e.message=="getPriceAlertsInit")if(Ue!=null&&Ue!=null&&Ue!="null"){let M=await da();a({farewell:M||[]})}else a({farewell:"[]"});else e.message=="getPushNot"&&a({farewell:u.pushNotStore})}catch(M){v("addlistener",M),E("Error at addListener ",M),a({status:!1})}}return i(),!0})}catch(e){v("checkIcons",e),E("Error at checkIcons ",e)}}td();chrome&&chrome.notifications&&chrome.notifications.onButtonClicked&&chrome.notifications.onButtonClicked.addListener(function(e,t){if(E("here9 ",e),ua[e]!==void 0){var a=ua[e].listeners.onButtonClicked;ct.destroyNotification(e,a(t))}else en[e]&&t==0?(targetURL=en[e],ht("button-clicked-"+Mr[e])):t==1?(targetURL="https://compare.buyhatke.com/options/",ht("button-unsubscribed-"+Mr[e])):targetURL="",targetURL!=""?chrome.tabs.create({url:targetURL}):ht("button-error-"+Mr[e]),chrome.notifications.clear(e,function(){})});chrome&&chrome.notifications&&chrome.notifications.onClosed&&chrome.notifications.onClosed.addListener(async function(e,t){var i,s;if(E("here10 ",e),ua[e]!==void 0){var a=(s=(i=ua[e])==null?void 0:i.listeners)==null?void 0:s.onClosed;ct.destroyNotification(e,a(t))}await Fe("notiClosed")});chrome&&chrome.notifications&&chrome.notifications.onClicked&&chrome.notifications.onClicked.addListener(vl);async function Ls(){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");var e="https://compare.buyhatke.com/options/flashSaleNew.json",t="ext_id="+u.ext_id+"&auth_val="+u.ext_auth,a=await oe(e,"GET",t);a!=""&&a.trim()!="Authentication Failed!"&&JSON.parse(a).length!=0&&await h.setItem("existingSales",a)}catch(i){v("getFlashSales",err),E("Error getFlashSale ",i)}}Ls();setTimeout(async()=>{await Ls()},12e3*3600);async function Ps(){try{u.existingSales=await h.getItem("existingSales")||"[]",u.checkedArray=await h.getItem("checkedArray")||"{}",u.openTimeHash=await h.getItem("openTimeHash")||"{}",u.tabAssignedHash=await h.getItem("tabAssignedHash")||"{}";let e=u.existingSales,t=u.checkedArray,a=u.openTimeHash,i=u.tabAssignedHash;try{e=e?JSON.parse(e):[]}catch(s){console.error("Error parsing existingSales:",s),e=[]}try{t=t?JSON.parse(t):{}}catch(s){console.error("Error parsing checkArray:",s),t={}}try{a=a?JSON.parse(a):{}}catch{a={}}try{i=i?JSON.parse(i):{}}catch{i={}}Array.isArray(e)||(e=[]);for(let s=0;s<e.length;s++)if(Array.isArray(e[s]))for(let r=0;r<e[s].length;r++){const c=e[s][r];if(!c||!c.code||!c.time||!c.url)continue;const l=c.code;if(t[l]===!0){const d=c.time*1e3-Math.round(+new Date);if(d<6e5&&d>-3e5){const o=`${c.time}~${l}`;a[o]||(await chrome.windows.create({url:c.url},async function(f){var w,x,m,y;let p=((x=(w=f==null?void 0:f.tabs)==null?void 0:w[0])==null?void 0:x.url)||"";p=p.split("~#")[1]||o,i[p]=(y=(m=f==null?void 0:f.tabs)==null?void 0:m[0])==null?void 0:y.id,await h.setItem("tabAssignedHash",JSON.stringify(i))}),a[o]=!0)}}}await h.setItem("openTimeHash",JSON.stringify(a))}catch(e){v("checkFlashSales",e)}}Ps();setTimeout(async function(){await Ps()},5e3);async function ad(){try{var e="https://compare.buyhatke.com/getCookie.php",t=await oe(e,"GET",null);t&&await h.setItem("sourceInstall",t)}catch(a){v("checkSource",a),E("Error checkSource ",a)}}ad();async function rd(e){try{var t=u.features_json;t=JSON.parse(t),t[e]=1,await h.setItem("features_json",JSON.stringify(t))}catch(a){v("features1",a),E("Error features1 ",a)}}function id(e){try{return new URL(e),!0}catch{return!1}}async function nd(e){try{Object.keys(ri).length==0&&await Do();let t,a;try{a=new URL(e).hostname.replace(/^www\./,"")}catch{return e}let i=ri[a];if(i||(i={}),i.hasOwnProperty("urlSuffix")&&(e=e+i.urlSuffix),i.hasOwnProperty("urlPrefix")&&(e=i.urlPrefix+e),i.hasOwnProperty("replaceConfig"))for(let d of i.replaceConfig)try{e=e.replaceAll(d.replace,d.replaceWith)}catch{}let s=await fetch(e),r=s.url,c=await s.text(),l=i.pidFromResponse?c:r;if(i.hasOwnProperty("urlRegex")){let d=i.urlRegex;for(let o of d)try{let f=1;o.hasOwnProperty("match")&&(f=o.match);let p;if(o.hasOwnProperty("global")?p=l.match(new RegExp(o.regex,"g"))[f]:p=l.match(new RegExp(o.regex))[f],p!=null&&p!=""){l=p;break}}catch{}}return l&&id(l)?(l=encodeURIComponent(l),l.trim()):e}catch{return e}}async function sd(){try{let e=[],a=await fetch("https://ext1.buyhatke.com/extension-apis/fetchUrls");if(a.status>=400&&a.status<=599)throw new Error("status: "+a.status);if(a=await a.json(),a.status==0)return;let i=a.urls;i=await JSON.parse(i);let s;for(let l=0;l<i.length;l++){const{id:d,url:o}=i[l];let f="";try{s=await nd(o)}catch{}e.push({id:d,pid:s})}const c=await fetch("https://ext1.buyhatke.com/extension-apis/getPIDSfromURL",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(e){v("getPIDFromUrl",e),E(e)}}setInterval(async()=>{await sd()},60*60*1e3);async function cd(){try{let t=await fetch("https://ext1.buyhatke.com/extension-apis/fetchUrlForDeals");if(t.status>=400&&t.status<=599)throw new Error("status: "+t.status);if(t=await t.json(),!t||t.status!=="success"||!t.url)return;let a;try{if(a=await fetch(t.url,{method:"GET",redirect:"follow"}),!a.ok)return;let i=await a.text();const r=await fetch("https://4c8a9e7a.buyhatke.com/spidy/telegramDeals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:t.url,id:t.id,pos:t.pos,html:i})})}catch{}}catch(e){v("getPriceFromURL",e),E(e)}}setInterval(async()=>{await cd()},2*60*60*1e3);async function ld(){try{let e=await h.getItem("ext_id"),t=await h.getItem("ext_auth"),a=`https://settings.buyhatke.com/extension-settings/fURLP?ext_id=${e}&ext_auth=${t}`,i=await fetch(a);if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);if(i=await i.json(),!i||i.status!=1||!i.id||!i.jid||!i.data)return;let s=i.id,r=i.jid,c=i.append,l=i.data,d=l;if(c==1){let f=`https://search-new.bitbns.com/extension/configs-ext/prod/jobs/job${r}.txt`,p=await fetch(f);if(p.status>=400&&p.status<=599)throw new Error("status: "+p.status);p=await p.text(),d=p+l}let o;try{if(o=await Wu(d),!o)return;const p=await fetch("https://settings.buyhatke.com/extension-settings/sendPNewVP",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:i.id,job_id:i.jid,response:o})})}catch{}}catch(e){E(e)}}setInterval(async()=>{await ld()},1*60*60*1e3);async function od(){try{let e=await h.getItem("ext_id"),t=await h.getItem("ext_auth"),a=`https://settings.buyhatke.com/extension-settings/fetchURL?ext_id=${e}&ext_auth=${t}`,i=await fetch(a);if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);if(i=await i.json(),i.status==0)return;let s=JSON.parse(i.urls),{id:r,pid:c,pos:l,image:d}=s[0],o=await Us(d,l),f=await _s(o);if(f){let x=await fetch(f);x=await x.text(),x&&(o+="**exact-html=>"+x)}postData={id:r,pid:c,pos:l,html:o};const w=await fetch("https://ext1.buyhatke.com/extension-apis/sendDittoHTML",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(postData)})}catch(e){v("fetchURLS",e),E(e)}}setInterval(async()=>{await od()},4*60*60*1e3);async function Rs(){try{(!Ir||!xr||!kr)&&await fa();let e=(await chrome.storage.local.get("chEn")).chEn;if(e&&await xn("Check if ready?"),e)return;let t=await h.getItem("ext_id"),a=await h.getItem("ext_auth"),i=`https://settings.buyhatke.com/extension-settings/fetchPNewV2?ext_id=${t}&ext_auth=${a}`,s=await fetch(i);if(s.status>=400&&s.status<=599)throw new Error("status: "+s.status);if(s=await s.json(),s.status==0)return;let r=s.id,c=s.jid,l=s.append,d=s.data,o=d;if(l==1){let m=`https://search-new.bitbns.com/extension/configs-ext/prod/jobs/job${c}.txt`,y=await fetch(m);if(y.status>=400&&y.status<=599)throw new Error("status: "+y.status);y=await y.text(),o=y+d}let f=await xn([o]);const x=await fetch("https://settings.buyhatke.com/extension-settings/sendPNewV2",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r,j_id:c,data:f})})}catch(e){E(e)}}setInterval(async()=>{await Rs()},2*60*60*1e3);async function ud(){try{let e=await h.getItem("currentMonitorData"),t=JSON.parse(e??"[]");if(t.length>0){let a=`https://ext1.buyhatke.com/extension-apis/currentMonitor?extId=${u.ext_id}&extAuth=${u.ext_auth}`,i=await fetch(a,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)});return i.ok&&(i=await i.json(),i.status==1&&await h.removeItem("currentMonitorData")),""}}catch(e){return v("clearCurrentMonitorData",e),E(e),""}}setInterval(async()=>{await ud()},1e3*60*5);async function dd(e){try{let t=await h.getItem("currentMonitorData"),a=JSON.parse(t??"[]");a.push(e),await h.setItem("currentMonitorData",JSON.stringify(a))}catch(t){return v("setCurrentMonitorData",t),E(t),""}}async function gs(){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let e=await h.getItem("featureMonitorData"),t=JSON.parse(e??"[]");if(t.length>0){let a=`https://ext1.buyhatke.com/extension-apis/featureMonitor?extId=${u.ext_id}&extAuth=${u.ext_auth}`,i=await fetch(a,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)});return i.ok&&(i=await i.json(),i.status==1&&await h.removeItem("featureMonitorData")),""}}catch(e){return v("clearFeatureMonitorData",e),E(e),""}}gs();setInterval(async()=>{await gs()},1e3*60*5);async function hd(e){try{let t=await h.getItem("featureMonitorData"),a=JSON.parse(t??"[]");a.push(e),await h.setItem("featureMonitorData",JSON.stringify(a))}catch(t){return v("setFeatureMonitorData",t),E(t),""}}async function fd(){let e=await h.getItem("ext_id"),t=await h.getItem("ext_auth"),a="ext_id="+e+"&auth_val="+t;Xr=await oe("https://api.buyhatke.com/paapi/showStockAlerts","POST",a,"formData")}fd();async function pd(e){try{let t=await h.getItem("ACTSMonitorData"),a=JSON.parse(t??"[]");a.push(e),h.setItem("ACTSMonitorData",JSON.stringify(a))}catch(t){return v("setACTSMonitorData",t),E(t),""}}async function yd(e,t){try{const a={};for(const c of e)if(c.clubID&&c.ACanalytics){const l=c.clubID;a[l]||(a[l]=[]),a[l].push(c.ACanalytics)}const i={ext_id:String(t)};for(const c of Object.keys(a)){const l={};for(const o of a[c])Object.keys(o).forEach(f=>{const p=f;l[p]||(l[p]=0),l[p]+=o[f]||0});const d=Object.keys(l).map(o=>({stage:o,count:l[o]}));i[c]={stages:d}}const s=await fetch("https://ext1.buyhatke.com/extension-apis/analytics/track/Auto_Coupon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!s.ok)throw new Error(`API call failed for pos ${pos}: HTTP ${s.status}`);const r=await s.json();if(r.status!=1)throw new Error(`API call failed for pos ${pos}: Response ${JSON.stringify(r)}`);return}catch{return}}async function wd(e,t){try{for(const a of e)if(a.clubID&&a.ACAnalyticsValue){const i=a.clubID,s=a.ACAnalyticsValue,r={};s.each_coupon_apply!==void 0&&(r.each_coupon_apply=s.each_coupon_apply),s.time_taken!==void 0&&(r.time_taken=s.time_taken),s.event_type!==void 0&&(r.event_type=s.event_type);const c={ext_id:t,pos:i,...s.id!==void 0&&{id:s.id},stages:r};try{const l=await fetch("https://ext1.buyhatke.com/extension-apis/analytics/track/Auto_Coupon/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!l.ok||(await l.json()).status!=1)continue}catch{continue}}return}catch{return}}async function Ms(){try{let e=await h.getItem("ext_id"),t=await h.getItem("ACTSMonitorData"),a=JSON.parse(t??"[]");if(a.length>0)try{await yd(a,e),await wd(a,e),await h.removeItem("ACTSMonitorData")}catch{await h.removeItem("ACTSMonitorData")}}catch(e){return v("clearACTSMonitorData",e),E(e),""}}Ms();setInterval(Ms,30*60*1e3);async function Ss(e){try{let t=await h.getItem("countMoniorData"),a=JSON.parse(t??"[]");a.push(e),h.setItem("countMoniorData",JSON.stringify(a))}catch(t){return v("setCountMonitorData",t),E(t),""}}async function Fs(){try{let e=await h.getItem("countMoniorData"),t=JSON.parse(e??"[]");t.length>0&&await xi("https://ext1.buyhatke.com/monitoring-system/monitor/count/listen",t)==1&&h.removeItem("countMoniorData")}catch(e){return v("clearCountMonitorData",e),E(e),""}}Fs();setInterval(Fs,30*60*1e3);async function v(e,t,a=void 0){let i={funcName:e,error:t.message?t.message:t.error,url:a},s={eventID:12,errorSource:"service_worker",errorDetails:JSON.stringify(i)};await ha(s)}async function ha(e){try{let t=await h.getItem("errorMonitorData"),a=JSON.parse(t??"[]");a.push(e),h.setItem("errorMonitorData",JSON.stringify(a))}catch(t){return v("logMonitorData",t),E(t),""}}async function Or(){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let t=await(await fetch(`https://ext1.buyhatke.com/spend-apis/verification/keyEnc?extId=${u.ext_id}&extAuth=${u.ext_auth}`)).json();t.status&&t.keyEnc&&t.keyTime&&await chrome.storage.local.set({keyEnc:t.keyEnc,keyTime:t.keyTime})}catch{}}setInterval(async()=>{await Or()},60*60*1e3);Or();async function Js(){try{let e=await h.getItem("errorMonitorData"),t=JSON.parse(e??"[]");t.length>0&&await xi("https://ext1.buyhatke.com/monitoring-system/monitor/errorlog/listen",t)==1&&h.removeItem("errorMonitorData")}catch(e){return v("clearErrorMonitorData",e),E(e),""}}Js();setInterval(Js,30*60*1e3);async function md(e){try{let t=await h.getItem("apiMonitorData"),a=JSON.parse(t??"[]");a.push(e),h.setItem("apiMonitorData",JSON.stringify(a))}catch(t){return v("monitorApiResponseTime",t),E(t),""}}async function js(){try{let e=await h.getItem("apiMonitorData"),t=JSON.parse(e??"[]");t.length>0&&await xi("https://ext1.buyhatke.com/monitoring-system/monitor/responsetime/listen",t)==1&&h.removeItem("apiMonitorData")}catch{return""}}js();setInterval(js,30*60*1e3);async function xi(e,t){try{if(!Array.isArray(t))throw Error("Please Provide errEventData in correct Format");t={data:t};let a=await oe(e,"POST",t,"json");if(a=JSON.parse(a),a.status==1)return a.status;throw Error(a.msg)}catch{throw Error("Error in calling API")}}async function bd(e){try{await fetch("https://ext1.buyhatke.com/extension-apis/groceryCheckout?siteName="+e)}catch{}}async function Id(){try{let e=await h.getItem("ext_id"),t=await h.getItem("ext_auth");return{extId:e,extAuth:t}}catch{return{extId:"",extAuth:""}}}async function Bs(e,t){try{u.ext_id=await h.getItem("ext_id"),u.ext_auth=await h.getItem("ext_auth");let a=`https://ext1.buyhatke.com/spend-apis/spend-logs/logError?extId=${u.ext_id}&extAuth=${u.ext_auth}`,i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pos:e,error:t})})}catch(a){v("spendErrorLog",a)}}async function dr(e){try{const a=await fetch(e,{method:"GET"});if(!a.ok)throw new Error("Network response was not ok "+a.statusText);return await a.text()}catch{}}async function Us(e,t){try{let a=await Qn(),i="en-IN";a.hasOwnProperty(t)&&(i=a[t].countryCode);let s=await fetch("https://search-new.bitbns.com/buyhatke/getDittoSearchDomain",{method:"GET"});s=await s.json();let c=`${s.domain}/uploadbyurl?url=${e}?q=70&re=df&st=1722243143407&vpw=1413&vph=331&ep=gisbubu&hl=${i}`;const l=await fetch(c,{method:"GET",redirect:"follow"});if(!l.ok)throw new Error("Network response was not ok "+l.statusText);return await l.text()}catch{}}async function xd(e,t){try{let a=await fetch("https://blinkit.com/v2/services/secondary-data?filter=new_offer,show_product_group_sharing,is_new_user,cart_ab_test_variant,city_id,sku_auto_add,cart_banner_image,show_referral_login,product_sku_limit&offers_last_visit_ts=0",{headers:{app_client:"consumer_web",app_version:"52434332",lat:e,lon:t}});return a=await a.json(),a.analytics_properties.merchant_id}catch{return""}}async function kd(e,t){try{let i=await fetch("https://www.swiggy.com/api/instamart/home/select-location",{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36"},body:JSON.stringify({data:{lat:e,lng:t}})});return i=await i.json(),i.data.storeId}catch{return""}}async function _d(e,t){try{let a=await fetch(`https://api.zepto.co.in/api/v1/config/layout/?latitude=${e}&longitude=${t}&page_type=HOME&version=v2&show_new_eta_banner=true`,{headers:{Appversion:"11.0.0-WEB"}});return a=await a.json(),a.storeServiceableResponse.storeId}catch{return""}}async function vd(e){var t,a;try{let i={...Ua.zepto_place_id_api},s=i.url.replace("{place_id}",encodeURIComponent(e)),r=await Kt(i,s),c=JSON.parse(r);return(a=(t=c==null?void 0:c.result)==null?void 0:t.geometry)!=null&&a.location?{latitude:c.result.geometry.location.lat,longitude:c.result.geometry.location.lng}:{}}catch{return{}}}async function Od(e,t){var a;try{let i={...Ua.zepto_geocode},s=i.url.replace("{latitude}",encodeURIComponent(e)).replace("{longitude}",encodeURIComponent(t)),r=await Kt(i,s),c=JSON.parse(r);return((a=c==null?void 0:c.results)==null?void 0:a.length)>0?{placeId:c.results[0].place_id,address:c.results[0].formatted_address}:{}}catch{return{}}}async function Ad(e){try{let{latitude:t,longitude:a,place_id:i}=e,s=!1;if(!t&&!a){if(!i)return;let p=await vd(i);t=p.latitude,a=p.longitude,s=!0}let r=await Od(t,a),{placeId:c,address:l}=r,d=await xd(t,a),o=await kd(t,a),f=await _d(t,a);return{blinkitStoreId:d,instamartStoreId:o,zeptoStoreId:f,placeId:c,latitude:t,longitude:a,updateLatLong:s,address:l}}catch{return{}}}async function Ed(e){try{let t={...Ua.address_suggestion},a=t.url.replace("{query}",encodeURIComponent(e));const i=await Kt(t,a);return JSON.parse(i)}catch{return[]}}async function Dd(){try{let e=Math.random()<.5?1:2;Object.keys(Ua).length==0&&await Cn();let t=await h.getItem("version");switch(e){case 1:let a=`https://ext1.buyhatke.com/extension-apis/fetchLocationInfo?version=${t}`,i=await fetch(a);if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);if(i=await i.json(),i.status==0)return;let s=i.data;s=JSON.parse(s);let r=s.id,c=await Ad(s);if(!c)return;let{placeId:l,latitude:d,longitude:o,updateLatLong:f,address:p}=c,w={id:r,storeIds:{blinkitStoreId:c.blinkitStoreId,instamartStoreId:c.instamartStoreId,zeptoStoreId:c.zeptoStoreId},placeId:l,latitude:d,longitude:o,updateLatLong:f,address:p};await fetch(`https://ext1.buyhatke.com/extension-apis/insertStoreIds?version=${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});break;case 2:let x=`https://ext1.buyhatke.com/extension-apis/fetchPlaceName?version=${t}`,m=await fetch(x);if(m.status>=400&&m.status<=599)throw new Error("status: "+m.status);if(m=await m.json(),m.status==0)return;let y=m.data;y=JSON.parse(y);let{id:b,query:I}=y,O=await Ed(I),L={idQuery:b,address_suggestions:O};await fetch(`https://ext1.buyhatke.com/extension-apis/insertSuggestions?version=${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(L)});break}}catch(e){v("getPIDFromUrl",e),E(e)}}async function Nd(){try{let e=await fetch("https://ext1.buyhatke.com/spend-apis/googleAnalytics/events/spendButtonClicked");if(e.status>=400&&e.status<=599)throw new Error("status: "+e.status);return e=await e.json(),e.data.count||9}catch(e){return v("Error in getUserUsedSpendCount",e),9}}async function Td(){try{let e=await h.getItem("ext_id"),t=await h.getItem("ext_auth"),a=await fetch(`https://ext1.buyhatke.com/spend-apis/referrals/getReferralCode?extId=${e}&extAuth=${t}`);if(a.status>=400&&a.status<=599)throw new Error("status: "+a.status);let i=await a.json();if(i.status&&i.data){let{code:s}=i.data;return s}else return""}catch(e){return v("Error in fetchReferralCode",e),""}}const Ld=async e=>{try{if(!e)return{status:0,err:"Referral code is empty"};const t=new URLSearchParams,a="https://ext1.buyhatke.com/spend-apis/referrals/setReferral";let i=await h.getItem("ext_id"),s=await h.getItem("ext_auth");t.append("extId",i),t.append("extAuth",s),t.append("code",e);const r=await fetch(a,{method:"POST",body:t,headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"})});return r.ok?await r.json():{status:0,err:(r==null?void 0:r.statusText)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}};async function Pd(){try{const e=await h.getItem("ext_id"),t=await h.getItem("ext_auth"),a=await h.getItem("userCountry")??"India";let i="https://ext1.buyhatke.com/extension-apis/savings-api/socialProofData";e&&t&&(i=i+`?country=${a}`);const s=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)return{status:0,err:(s==null?void 0:s.statusText)||"Something went wrong."};const r=await s.json();return r.status==1?r:{status:0,err:(r==null?void 0:r.msg)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}}async function Rd(e,t,a,i){try{const s=await h.getItem("ext_id"),r=await h.getItem("ext_auth");let c="https://ext1.buyhatke.com/extension-apis/feedback/sendFeedback";const l=new URLSearchParams;l.append("type","1"),l.append("platform","0"),l.append("extId",s),l.append("extAuth",r),l.append("value",e),t&&l.append("comment",t),a&&l.append("source",a),i&&l.append("url",i);const d=await fetch(c,{method:"POST",body:l,headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"})});return d.ok?await d.json():{status:0,err:(d==null?void 0:d.statusText)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}}async function gd(){try{const e=await h.getItem("ext_id"),t=await h.getItem("ext_auth"),a=await fetch(`https://ext1.buyhatke.com/spend-apis/login/loggedIn?extId=${e}&extAuth=${t}`,{method:"GET"});return a.ok?await a.json():{status:0,err:(a==null?void 0:a.statusText)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}}async function Md(){try{const t=await fetch("https://ext1.buyhatke.com/spend-apis/login/gLogin",{method:"POST"});return t.ok?await t.json():{status:0,err:(t==null?void 0:t.statusText)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}}async function Sd(){try{const e=await h.getItem("telegramConnectData");if(e&&e.connectStatus)return{status:1,data:e};const t=await h.getItem("ext_id"),a=await h.getItem("ext_auth");let i=`https://ext1.buyhatke.com/extension-apis/telegramBot/connectStatus?extId=${t}&extAuth=${a}&platform=0`;const s=await fetch(i,{method:"GET"});if(!s.ok)return{status:0,err:(s==null?void 0:s.statusText)||"Something went wrong."};const r=await s.json();return r.status&&r.data.connectStatus&&h.setItem("telegramConnectData",r.data),r}catch(e){return console.log(e),{status:0,err:"Something went wrong."}}}async function Fd(e){try{const t=`https://search-new.bitbns.com/buyhatkeAdStatic/ads/adsList?slotId=${e}`,a=await fetch(t,{method:"GET"});if(!a.ok)return{status:0,err:(a==null?void 0:a.statusText)||"Something went wrong."};const i=await a.json();return Ba(i)}catch{return console.log(err),{status:0,err:"Something went wrong."}}}async function Jd(e){try{const t=await h.getItem("ext_id"),a=await h.getItem("ext_auth"),i=await h.getItem("userCity"),s={...e,extId:t,location:i||""},c=await fetch("https://search-new.bitbns.com/buyhatkeAdDashboard/track/impression",{method:"POST",body:JSON.stringify(s),headers:new Headers({"Content-Type":"application/json"})});return c.ok?await c.json():{status:0,err:(c==null?void 0:c.statusText)||"Something went wrong."}}catch(t){return console.log(t),{status:0,err:"Something went wrong."}}}async function jd(e){try{const t=await h.getItem("ext_id"),a=await h.getItem("ext_auth"),i=await h.getItem("userCity"),s={...e,extId:t,location:i||""},c=await fetch("https://search-new.bitbns.com/buyhatkeAdDashboard/track/click",{method:"POST",body:JSON.stringify(s),headers:new Headers({"Content-Type":"application/json"})});return c.ok?await c.json():{status:0,err:(c==null?void 0:c.statusText)||"Something went wrong."}}catch(t){return console.log(t),{status:0,err:"Something went wrong."}}}async function Bd(e){if(!e)return;const t="0",a="",i=Date.now()+Math.floor(Math.random()*1e9),s=e.replace("${GDPR}",t).replace("${GDPR_CONSENT_78}",a).replace("[CACHEBUSTER]",i.toString());fetch(s,{method:"GET",mode:"no-cors"})}async function Ud(){try{const e="https://t.me/Buyhatke_Alert_bot",t=await h.getItem("ext_id"),a=await h.getItem("ext_auth"),i=`extId=${t}##extAuth=${a}##platform=0`,s=btoa(i);return`${e}?start=${s}`}catch(e){return console.log(e),"https://t.me/Buyhatke_Alert_bot"}}setInterval(async()=>{await Dd()},30*60*1e3);self.addEventListener("error",e=>{v("Unhandled exception:",e)});setInterval(()=>{ir=null},6*60*60*1e3);setInterval(async()=>{try{await Fe("ExtensionRunning",{})}catch{}},10*60*1e3);setTimeout(async()=>{try{await Fe("ExtensionRunning",{})}catch{}},5e3);async function $d(){try{let e=await h.getItem("ext_id"),t=await h.getItem("ext_auth");if((await(await fetch(`https://settings.buyhatke.com/extension-settings/updateSettings?ext_id=${e}&ext_auth=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json()).success!=!0)throw new Error("logging failed !")}catch(e){v("persistMode",e)}}async function Hd(){try{let e=await h.getItem("ext_id"),t=await h.getItem("ext_auth"),i=await(await fetch(`https://settings.buyhatke.com/extension-settings/fetchSettings?ext_id=${e}&ext_auth=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json();if(i.success==!0)mr=i.flag;else throw new Error("logging failed !")}catch(e){v("fetchMode",e)}}async function Vd(e,t,a){try{const i=Math.floor(Date.now()/1e3)+a*24*60*60;await chrome.cookies.set({url:"https://buyhatke.com/",name:e,value:t,domain:".buyhatke.com",path:"/",expirationDate:i,secure:!0,httpOnly:!1,sameSite:"no_restriction"})}catch{}}async function ki(e="https://buyhatke.com",t="triggerSpend"){try{return await new Promise(i=>{chrome.cookies.get({url:e,name:t},s=>{i((s==null?void 0:s.value)??"")})})??""}catch{return""}}setInterval(function(){mr==!1&&Hd()},8*3600*1e3);let kn=0,$s=0;async function Kd(){kn=new Date().getTime()/1e3;debugger;new Date().getTime()/1e3-kn>2&&(mr=!0,await h.setItem("debugMod",!0),await $d(),clearInterval($s))}async function Gd(){let e=await h.getItem("debugMod");e&&e===!0?mr=!0:$s=setInterval(function(){Kd()},5*1e3)}Gd();
