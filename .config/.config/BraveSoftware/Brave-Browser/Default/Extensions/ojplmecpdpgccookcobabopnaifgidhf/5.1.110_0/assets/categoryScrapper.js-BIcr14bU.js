import{g as Ge,a as A,c as P,b as Ve,d as $,u as E,e as De,f as et,h as W,s as N,i as Ee,j as tt,k as rt,m as lt,l as at,n as nt,o as ot,p as it}from"./utility_all2-BNXd1yEL.js";import"./index-ljv-RBOm.js";let O=[],U=[],He=[],ze=[],Re=[],w="",v="";function ct(e){const n=/(\d+)\s*(?:\s*GB|\s*TB|\s*Gb|\s*Tb|\s*gb|\s*tb|\s*gB|\s*tB)/g;let a;const m=[];for(;(a=n.exec(e))!==null;)m.push(parseInt(a[1]));return m}const st=async(e,n)=>{var a,m,c,u,g,y,f,h,C,p,j,x,k,G,_,q,T,V,Z,D,ee,te,re,le,ae,ne,oe,ie,ce,se,ue,me,fe,de,ye,ge,he,Ce,be,we,Se,pe,ke,ve,xe,Ie,Pe,Oe,je,qe,Be,Ae,_e,Me,Ne,Le,Te;try{await new Promise(l=>setTimeout(l,1e3));let o=O;for(let l=0;l<o.length;l++)try{if((a=o[l])!=null&&a.onlyTable){let t=document.querySelectorAll((m=o[l])==null?void 0:m.onlyTable);if(t==null)continue;for(let r=0;r<t.length;r++){let s=t[r].querySelectorAll("tr");for(let i=0;i<s.length;i++){let d=((g=(u=(c=s[i])==null?void 0:c.querySelector("th"))==null?void 0:u.textContent)==null?void 0:g.trim())||"",b;if(d=="Best Sellers Rank"){let S=s[i].querySelectorAll("span");if(S==null||S==null)continue;let I=S.length;b=S[I-1].textContent.trim()}else b=((f=(y=s[i])==null?void 0:y.querySelector("td"))==null?void 0:f.textContent.trim())||"";d&&b&&(e[d]=b)}}}else if((h=o[l])!=null&&h.directCheckInUrl)window.location.href.includes(o[l].directCheckInUrl)&&(e.matchedCategory=o[l].assignCat);else if((C=o[l])!=null&&C.description){let t=(p=o[l])==null?void 0:p.description,r=document.querySelectorAll(t),s=(j=o[l])==null?void 0:j.ind;if(s?r=r[s]:r=document.querySelector(t),(x=o[l])!=null&&x.attribute){let i=o[l].attribute,d=(r==null?void 0:r[i])??(r==null?void 0:r.getAttribute(i));d&&(e.description=d)}}else if((k=o[l])!=null&&k.ai_review){let t=(G=o[l])==null?void 0:G.ai_review,r=document.querySelectorAll(t),s=(_=o[l])==null?void 0:_.ind;if(s?r=r[s]:r=document.querySelector(t),(q=o[l])!=null&&q.attribute){let i=o[l].attribute,d=(r==null?void 0:r[i])??(r==null?void 0:r.getAttribute(i));d&&(e.ai_review=d)}}else if((T=o[l])!=null&&T.value_in_key){let t=document.querySelectorAll((V=o[l])==null?void 0:V.classSelector);if(t==null)continue;for(let r=0;r<t.length;r++){let s=t[r].querySelectorAll((Z=o[l])==null?void 0:Z.key);for(let i=0,d=0;i<s.length;i++,d++){let S=s[i].textContent.trim().split(":",2);if(S.length==2){let I=S[0].trim(),Ze=S[1].trim();e[I]=Ze}}}}else if((D=o[l])!=null&&D.classSelector){let t=document.querySelectorAll((ee=o[l])==null?void 0:ee.classSelector);if(t==null)continue;for(let r=0;r<t.length;r++){let s=t[r].querySelectorAll((te=o[l])==null?void 0:te.key),i=t[r].querySelectorAll((re=o[l])==null?void 0:re.value);for(let d=0,b=0;d<s.length;d++,b++)if(s[d].textContent.trim()=="Customer Reviews"||s[d].textContent.trim()=="Best Sellers Rank"){b--;continue}else{let S=s[d].textContent.trim(),I=i[b].textContent.trim();e[S]=I}}}else if((le=o[l])!=null&&le.table){let t=document.querySelectorAll((ae=o[l])==null?void 0:ae.table);if(t==null)continue;for(let r=0;r<t.length;r++){let s=t[r].querySelectorAll((ne=o[l])==null?void 0:ne.key),i=t[r].querySelectorAll((oe=o[l])==null?void 0:oe.value);for(let d=0,b=0;d<s.length;d++,b++)if(s[d].textContent.trim()=="Customer Reviews"||s[d].textContent.trim()=="Best Sellers Rank"){b--;continue}else{let S=s[d].textContent.trim(),I=i[b].textContent.trim();e[S]=I}}}else if((ie=o[l])!=null&&ie.productName){let t=document.querySelector((ce=o[l])==null?void 0:ce.productName);if(t==null)continue;let r=t.textContent.trim();e.nameOfProduct=r}else if((se=o[l])!=null&&se.one_key){let t=((me=document.querySelector((ue=o[l])==null?void 0:ue.one_key))==null?void 0:me.textContent.trim())||null,r=((de=document.querySelector((fe=o[l])==null?void 0:fe.one_value))==null?void 0:de.textContent.trim())||null;if(t==null||t==null||r==null||r==null)continue;e[t]=r}else if((ye=o[l])!=null&&ye.firstClick){await document.querySelector((ge=o[l])==null?void 0:ge.firstClick).click(),await document.querySelector((he=o[l])==null?void 0:he.secondClick).click();let t=document.querySelectorAll((Ce=o[l])==null?void 0:Ce.classSelectorOfClick);if(t!=null)for(let r=0;r<t.length;r++){let s=t[r].querySelectorAll((be=o[l])==null?void 0:be.key),i=t[r].querySelectorAll((we=o[l])==null?void 0:we.value);for(let d=0,b=0;d<s.length;d++,b++)if(s[d].textContent.trim()=="Customer Reviews"||s[d].textContent.trim()=="Best Sellers Rank"){b--;continue}else{let S=s[d].textContent.trim(),I=i[b].textContent.trim();e[S]=I}}await document.querySelector((Se=o[l])==null?void 0:Se.closeClick).click()}else if((pe=o[l])!=null&&pe.highlight){let t=document.querySelectorAll((ke=o[l])==null?void 0:ke.highlight);if(t==null)continue;for(let r=0;r<t.length;r++){let i=t[r].textContent.trim().split(":");i.length==2&&(e[i[0]]=i[1])}}else if((ve=o[l])!=null&&ve.flipkartBreadcrumbClassSelector){let t=document.querySelectorAll((xe=o[l])==null?void 0:xe.flipkartBreadcrumbClassSelector);if(t==null)continue;let r="",s=t.length;for(let i=0;i<s-1;i++)r+=t[i].textContent.trim()+" ";e.breadcrumb=r}else if((Ie=o[l])!=null&&Ie.amazonBreadcrumbClassSelector){let t=document.querySelectorAll((Pe=o[l])==null?void 0:Pe.amazonBreadcrumbClassSelector);if(t==null)continue;let r="",s=t.length;for(let i=0;i<s;i++)r+=t[i].textContent.trim()+" ";e.breadcrumb=r}else if((Oe=o[l])!=null&&Oe.cromaBreadcrumbClassSelector){let t=document.querySelector((je=o[l])==null?void 0:je.cromaBreadcrumbClassSelector);if(t==null)continue;let r="",s=t.children.length;for(let i=0;i<s;i++)r+=t.children[i].textContent.trim()+" ";e.breadcrumb=r}else if((qe=o[l])!=null&&qe.relianceDigitalBreadcrumbClassSelector){let t=document.querySelector((Be=o[l])==null?void 0:Be.relianceDigitalBreadcrumbClassSelector);if(t==null)continue;let r="",s=t.children.length;for(let i=0;i<s-2;i++)r+=t.children[i].textContent.trim()+" ";e.breadcrumb=r}else if((Ae=o[l])!=null&&Ae.vijaySalesBreadcrumbIdSelector){let t=document.getElementById((_e=o[l])==null?void 0:_e.vijaySalesBreadcrumbIdSelector);if(t==null)continue;let r="",s=t.children.length;for(let i=0;i<s-1;i++)r+=t.children[i].textContent.trim()+" ";e.breadcrumb=r}else if((Me=o[l])!=null&&Me.singleKeyValue){let t=document.querySelectorAll((Ne=o[l])==null?void 0:Ne.singleKeyValue);if(t==null)continue;for(let r=0;r<t.length;r+=2)e[t[r].textContent.trim()]=t[r+1].textContent.trim()}else{let t=document.querySelectorAll((Le=o[l])==null?void 0:Le.key),r=document.querySelectorAll((Te=o[l])==null?void 0:Te.value);if(t==null||r==null)continue;for(let s=0,i=0;s<t.length;s++,i++)if((t[s].textContent.trim()=="Customer Reviews"||t[s].textContent.trim()=="Best Sellers Rank")&&n==2){i--;continue}else{let d=t[s].textContent.trim(),b=r[i].textContent.trim();e[d]=b}}}catch{}if(e.nameOfProduct){let l=ct(e.nameOfProduct);if(l.length>=2){let t=null,r=null;Math.min(l[0],l[1])<=4&&Math.max(l[0],l[1])<=32?(t=Math.max(l[0],l[1]),r=Math.min(l[0],l[1]),e["product ram"]=`${t} GB`,e["product rom"]=`${r} TB`):(t=Math.min(l[0],l[1]),r=Math.max(l[0],l[1]),e["product ram"]=`${t} GB`,e["product rom"]=`${r} GB`)}else if(l.length==1){let t=l[0];t>=50&&(e["product rom"]=`${t} GB`)}}K=0,await J(0)}catch{K=0,await J(0)}},ut=async e=>{try{let n=0,a="other",m=[];for(let c in U){let u=0,g=Object.keys(e),y,f=0;for(let h=0;h<U[c].length;h++){const{keys:C,values:p,isMust:j}=U[c][h];y=0;for(let x=0;x<C.length;x++){for(let k=0;k<g.length;k++){if((g[k]?g[k].toLowerCase():"").includes(C[x])){let _=e[g[k]]?e[g[k]].toLowerCase():"";for(let q=0;q<p.length;q++)if(_.includes(p[q])){let T=C[x],V=p[q];m.push({descriptionKey:T,lowerValue:_}),u++,y=1;break}}if(y==1)break}if(y==1)break}if(y==0&&j=="true"){f=1;break}}f!=1&&u>n&&u>=He[c]&&(n=u,a=c)}return e.hasOwnProperty("matchedCategory")&&(a=e.matchedCategory),{raw_data:e,refined_data:m,matchedCategory:a}}catch{}};let Ue=null,B=null;const X=async()=>{var n;var e=((n=O[0])==null?void 0:n.invisibleCSS)??"._8mqQwQ { display: none; } ._1TWLMK.icF5zO { opacity: 0.01; }";Ue=document.head||document.getElementsByTagName("head")[0],B=document.createElement("style"),Ue.appendChild(B),B.type="text/css",B.id="mytempCss",B.styleSheet?B.styleSheet.cssText=e:B.appendChild(document.createTextNode(e))};var K=0;const J=async e=>{K==0&&(document.getElementById("mytempCss")&&document.getElementById("mytempCss").remove(),e<10&&setTimeout(function(){J(e+1)},2e3))};X();const mt=e=>{try{const n=[];for(const[a,m]of Object.entries(e))m.forEach(c=>{n.push({...c,category:a})});return n}catch{}};function ft(e){try{let n=e.Master;n=mt(n);let a={};for(let m=0;m<n.length;m++)try{let c=n[m],u=c.key,g=c.value;u&&g&&(a[u]=g)}catch{}return a}catch{}}async function dt(e){try{let n=await fetch(e);return n=await n.json(),n}catch{}}let Je="";async function Qe(){try{let e=await P({type:"getElectronicProduct"});e&&e.length>0&&(Je=e)}catch{}}let F={};async function yt(){try{let e=await P({type:"getElectronicCategories"});e&&Object.keys(e).length>0&&(F=e)}catch{}}function Fe(e,n){try{const a=e.categoryObject.category?e.categoryObject.category.toLowerCase():"",m=e.categoryObject.subCategory?e.categoryObject.subCategory.toLowerCase():"",c=e.categoryObject.subSubCategory?e.categoryObject.subSubCategory.toLowerCase():"";for(const[u,g]of Object.entries(n)){const y=u.toLowerCase();if(a===y||m===y||c===y)return g}return null}catch{return null}}async function gt(){try{if(L||await Xe(),Object.keys(F).length==0&&await yt(),w==2){let c=ot().replace("Home*~","").split("*~").slice(0,3),u={categoryObject:{category:c[0]||"",subCategory:c[1]||"",subSubCategory:c[2]||""}};const g=Fe(u,F);return isNaN(parseInt(g))?"other":parseInt(g)}const e=Fe(v,F);return isNaN(parseInt(e))?"other":parseInt(e)}catch{return"other"}}const We=async()=>{try{if(w=await Ge(),w==""||w==null||w==null)throw new Error("Cannot get pos");O=await P({type:"getCategoryConfig",data:w});let e=!1,n={};w==6645&&(e=!0),(O==null||O==null||O.length==0)&&!e&&E(0),w==2&&await X();let a=await P({type:"getCategoryConfig",data:"rules"});if(a==null||a==null||a.length==0)throw new Error("Cannot get Rules");U=a[0].categoryRules,He=a[0].thresholdMatches,ze=a[0].categoryId,Re=a[0].minPrice;try{if(e){let h=await De();e=!0;let C=await dt(`https://mdm.vijaysales.com/web/api/prod-spec-content.json?sku=${h}`);n=ft(C)}e||(O[0].hasOwnProperty("scriptSelector")?await Ct(O,n,w):await st(n,w))}catch{}let{raw_data:m,refined_data:c,matchedCategory:u}=await ut(n),g=et();g=1-g;let y=await gt(),f={pid:A(),name:Ve(),image:W(),price:$(),oos:g,pos:w,raw_data:m,refined_data:c,cat_id:ze[u],cat_id_new:y};if(f.pid&&f.name&&f.price||N(!1),f.cat_id==18){let h=Ee();f={...f,...h}}else if(f.cat_id==37||f.cat_id==38||f.cat_id==39){u="other";let h=Ee();h.soldBy&&h.soldBy!=""&&(f={pid:A(),pos:w,soldBy:h.soldBy},await P({type:"sendCategoryCrawl",data:f}));return}u!="other"&&f.price!=0&&f.price<Re[u]&&(u="other"),u!="other"||y?(await P({type:"sendCategoryCrawl",data:f}),y!="other"?E(1):E(-1)):E(-1)}catch{}};function H(e,n){try{let a=e.split("."),m=n;if(a.length==1&&a[0]=="")return n;for(let c=0;c<a.length;c++)m=m[a[c]];return m}catch{return""}}async function ht(e,n){try{for(let a=0;a<n.length;a++){let m=n[a].attributes;for(let c=0;c<m.length;c++){let u=m[c];u.hasOwnProperty("name")&&u.hasOwnProperty("value")&&(key=u.name,val=u.value),e[key]=val}}}catch{}}async function Ct(e,n,a){try{a==8579&&await new Promise(y=>setTimeout(y,3e3));let m=document.querySelector(e[0].scriptSelector);m=JSON.parse(m.textContent);let c=H(e[0].brandSelector,m),u=H(e[0].modelSelector,m);c!=""&&(n[c]=c),u!=""&&(n[u]=u);let g=H(e[0].specifications,m);await ht(n,g)}catch{}}let L=!1;async function Y(){try{let e=A(),n=Ve(),a=$(),m=w;if(e&&w&&n&&(L=!0),e&&w&&n&&a){let c={pid:e,prod:n,price:a,pos:m},u;u=await P({type:"getProductCategory",data:c}),(u==null?void 0:u.status)==1&&(v=u)}}catch{}}let $e="";function bt(e=5e3,n=100){return new Promise(a=>{let m=0;const c=setInterval(()=>{const u=A(),g=W();u&&g&&(clearInterval(c),a(!0)),m+=n,m>=e&&(clearInterval(c),a(!1))},n)})}async function Xe(e=1e4,n=100){return new Promise((a,m)=>{let c=0;const u=setInterval(async()=>{try{await Y(),L&&(clearInterval(u),a(L)),c+=n,c>=e&&(clearInterval(u),a(null))}catch{clearInterval(u),a(null)}},n)})}async function Ye(){var e;if(it()!=1)try{if(!await bt())return;if(A()==""||W()==""){N(!1);return}$e=await tt();let a,m=99999999999,c=0,u,g=await P({type:"extID"});if(rt.hasOwnProperty(w)?a=await lt():a=await at(),a=a.map((y,f)=>{let h=y.prodUrl||"",C=y.pos??f,p=C?"https://t.buyhatke.com/Navigation/?pos="+C+"&source=extension&ext1=new-deals&ext2="+g+"&link="+encodeURIComponent(h):h;return{productName:y.prod||"",productImage:y.imageUrl||"",productLink:p,currentPrice:y.price||0,sitePosition:C,siteName:y.site_name||"",siteImage:y.site_logo||"",internalPid:y.internalPid||0}}),a&&a.length>0?(nt(a),L||await Xe(),Je.map(f=>f.toLowerCase()).some(f=>{var h,C,p,j,x,k;return f==((C=(h=v==null?void 0:v.categoryObject)==null?void 0:h.subCategory)==null?void 0:C.toLowerCase())||f==((j=(p=v==null?void 0:v.categoryObject)==null?void 0:p.category)==null?void 0:j.toLowerCase())||f==((k=(x=v==null?void 0:v.categoryObject)==null?void 0:x.subSubCategory)==null?void 0:k.toLowerCase())})?N(!1):N(!0)):N(!1),a&&a.length>0){m=a.reduce((h,C)=>C.currentPrice<h?C.currentPrice:h,((e=a[0])==null?void 0:e.currentPrice)??1/0),c=$()-m,c>0&&(u=Math.round(c/$()*100));let f={hostName:window.location.hostname};chrome&&chrome.storage&&chrome.storage.sync&&chrome.storage.sync.get("noOfTimesDealsPromptShown",function(h){let C=+(h.noOfTimesDealsPromptShown||"0");if(C<3){let p=`Found similar products starting from ${$e}${m}`;chrome.storage.sync.set({noOfTimesDealsPromptShown:`${C+1}`})}})}else{let f={hostName:window.location.hostname};await P({type:"fireEvent",eventName:"DittoNoResult",params:f})}}catch{}}let z=0,M=0,Ke=location.href,Q=null,R=null;function wt(){(document.readyState==="interactive"||document.readyState==="complete")&&(clearInterval(St),pt())}const St=setInterval(wt,500);async function pt(){try{w=await Ge(),Q=A(),z||(z=1,await Qe(),await Y(),await We(),await Ye(),z=0),kt()}catch{z=0}}function kt(){new MutationObserver(()=>{const e=location.href;e!==Ke&&(Ke=e,R&&clearInterval(R),M=0,R=setInterval(async()=>{const n=A();n!==Q&&(Q=n,clearInterval(R),K=1,await X(),setTimeout(async()=>{try{M||(M=1,await Qe(),await We(),await Y(),await Ye(),M=0)}catch(a){console.error("Error inside interval flow:",a),M=0}},2e3))},500))}).observe(document,{subtree:!0,childList:!0})}
