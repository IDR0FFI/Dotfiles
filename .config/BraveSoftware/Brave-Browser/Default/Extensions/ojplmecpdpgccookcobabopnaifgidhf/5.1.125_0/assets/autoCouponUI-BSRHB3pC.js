import{aj as Je,G as ie,ax as _e,ay as Se,c2 as ke,c3 as be,ao as ne,H as Ue,J as le,c4 as Fe,K as Ce,E as ge,ap as Be,c5 as $e,c6 as We,c7 as Ke,c8 as Ve,I as Ye,c9 as de,c as A,a as ce,ca as je,cb as _,cc as j,cd as Ge,ce as ze,q as ve,t as Ze,cf as Qe,cg as pe}from"./utility_all2-0mYDd1Oa.js";const W=e=>{le(e),Fe(e),e||ne(!1)},ue=e=>{Ce(e)},qe=e=>{be(e)},At=()=>{de(!0),oe(),setTimeout(()=>{de(!1)},1e3)},Lt=()=>{Me(),le(!1),ne(!0)},Ae=e=>{ke(e)},Xe=e=>{_e(e)},et=e=>{Se(e)},tt=()=>{},xt=(e,t)=>{it(e,t)},M=e=>{const t=ge(Ye),n=t.lastShowAutoCouponState&&!t.showAutoCoupon;t.showAutoCouponPopup||t.applyButtonJustClicked,le(!0),ne(!1),Be(!0),Ce(!1),$e(t.showAutoCoupon),We(e)},at=e=>{Ke(e)},rt=e=>{Ve(e)};function nt(e){if(e===window.location.origin)return!0;if(e.startsWith("chrome-extension://")){if(chrome.runtime&&chrome.runtime.id){const n=`chrome-extension://${chrome.runtime.id}`;return e===n}return!1}try{if(window.parent&&window.parent!==window){const n=window.parent.location.origin;if(e===n)return!0}}catch{}return Ue().some(n=>{if(e===n)return!0;const d=e.replace(/^https?:\/\/www\./,"https://"),a=n.replace(/^https?:\/\/www\./,"https://");return d===a})}typeof window<"u"&&window.addEventListener("message",e=>{var t;((t=e.data)==null?void 0:t.source)==="buyhatke-extension"&&Je()&&nt(e.origin)&&(e.data.type===ie.COMMAND_APPLY_CLICKED?(_e(!1),Se(!1),ke(null),be([]),oe()):(e.data.type===ie.COMMAND_PANEL_CLOSED||e.data.type===ie.COMMAND_POPUP_CLOSED)&&(W(!1),ue(!1),ne(!0),Me()))});let y=1,I="",r={},z=0,G=0,x=-1,J="₹",N={},Le="",te=!1,ae=0,q="",xe="",w="",Ee=!1,b="",E={},v={},R=0,O=-1,Ne=!1,Ie=!1,X=!1,me=0,B=0,ee="",L="";function oe(e){Ee=!0,Re(w)}function Me(){X=!1,Oe(w)}async function it(e,t){try{if(!Ne)return;r=await De();let n=[],d=0,a="";if(w.interceptor_api!=""){if(await U(w),a=await wt(w,e),y==1)return;a=JSON.parse(JSON.stringify(a).replaceAll("buyhatke",e.code)),w.lowercase&&(a=JSON.parse(JSON.stringify(a).toLowerCase()))}let l={msg:"",id:e.id,code:e.code,success:!1,savings:0};try{if(w.interceptor_api!=""){let p=a.url,h=-1;try{if(h=await fetch(p,a),!h.ok)try{h=await h.json(),l.msg=Q(w,"cpn_message",h)||"",h=-1}catch{l.msg=""}}catch{l.msg=""}if(h!=-1){h=await h.json();try{if(l.savings=Q(w,"discount",h)||0,w.operation)switch(w.operation.type){case"divide":l.savings/=w.operation.value;break;case"multiply":l.savings*=w.operation.value;break;case"add":l.savings+=w.operation.value;break;case"subtract":l.savings-=w.operation.value;break}}catch{l.savings=0}}}else if(w.hatke_AC&&w.total_price!=null){await U(w),await g(w,e.code);let p=await Y(w);p.type==="totalprice"?l.savings=B-p.price:p.type==="discount"?l.savings=p.price:l.msg=p.msg}else if(w.sync!=null){await U(w),await g(w,e.code);let p=await Y(w);p.type==="dis"?l.savings=p.dis:l.msg=p.msg}return l.success=l.savings>0,n.push(l),l.savings>0?(await F({type:"ACMonitor",data:{clubID:xe,status:3,prevStatus:x}}),Te({dis:l.savings,code:t},w),{success:!0,savings:l.savings,code:e.code}):(Z(w),{success:!1,message:l.msg||"Coupon not applicable",code:e.code})}catch(p){return Z(w),{success:!1,message:p.message,code:e.code}}}catch(n){return Z(w),{success:!1,message:n.message,code:e.code}}}const D={getAllItems:()=>chrome.storage.local.get(),getItem:async e=>(await chrome.storage.local.get(e))[e],setItem:async(e,t)=>await chrome.storage.local.set({[e]:t}),removeItems:async e=>await chrome.storage.local.remove(e),removeItem:async e=>await chrome.storage.local.remove(e)};async function V(e){try{return await A(e)}catch{return}}async function Oe(e){try{if(e.reload!=null&&(await D.removeItem("buyhatke"+I),r={}),y=1,z==1){if(E.abrubtly_closed=1,R){let t=Date.now();const n=await K(R,t);v.time_taken=n,v.event_type="abrubtly_closed",O&&O!=-1&&(v.id=O)}E.process_started!=null&&await V({type:"ACTSMonitor",data:{clubID:b,ACanalytics:E,ACAnalyticsValue:v}}),E={},v={},ae>0&&x!=3&&x!=4?(await F({type:"ACMonitor",data:{clubID:b,status:8,prevStatus:x}}),N.pos=b,await A({type:"fireEvent",eventName:"ACUIclosedForcefullywithDis",params:N})):x!=4&&x!=3&&(await F({type:"ACMonitor",data:{clubID:b,status:5,prevStatus:x}}),N.pos=b,await A({type:"fireEvent",eventName:"AutoCouponUIclosedForcefully",params:N}))}x=5,e.reload!=null&&(r.prevStatus=x),Ie&&st(I);return}catch(t){throw new Error(t.message)}}async function st(e){try{return await A({type:"reloadTab",tabId:e})}catch{}}function Te(e,t){Xe(e),Ne=!0,t.discount_reload!=null&&(Ie=!0)}function Z(e){try{G==0?et(!0):M(!1),G=0,Oe(e)}catch(t){throw new Error(t.message)}}async function re(e){try{return await A(e)}catch{return[]}}async function F(e){try{return await A(e)}catch{return}}async function ut(e){try{return await A(e)}catch{return[]}}const De=async()=>new Promise(async e=>{let t=await JSON.parse(await D.getItem("buyhatke"+I)==null?"{}":await D.getItem("buyhatke"+I));e(t||r)});function lt(e){try{let t=e.split("?");if(t.length>1){let d=new URLSearchParams(t[1]).get("link");if(d){let a=decodeURIComponent(d);return new URL(a).hostname}}return new URL(e).hostname}catch{}}async function K(e,t){if(!Number.isInteger(e)||!Number.isInteger(t)||e<0||t<0||t<e)return 0;const n=t-e;return Math.min(n,99999999)}async function Pe(e){try{if(e.automatic.coupon_click.name!=null&&e.automatic.coupon_click.name!=""&&document.querySelector(e.automatic.coupon_click.name)||e.automatic.coupon_click.proxyname!=null&&e.automatic.coupon_click.proxyname!=""&&document.querySelector(e.automatic.coupon_click.proxyname)||e.automatic.coupon_value.name!=null&&e.automatic.coupon_value.name!=""&&document.querySelector(e.automatic.coupon_value.name)||e.automatic.apply_button.name!=null&&e.automatic.apply_button.name!=""&&document.querySelector(e.automatic.apply_button.name))return!0;if(e.automatic.multi_remove!=null&&e.automatic.multi_remove.length>0){for(let t=0;t<e.automatic.multi_remove.length;t++)if(e.automatic.multi_remove[t].name!=""&&document.querySelector(e.automatic.multi_remove[t].name))return!0}return!1}catch{throw new Error("Error in pagechecker")}}function ye(e,t){var n;for(let d=0;d<t.length;d++)if(new RegExp(t[d].url).test(e.url)&&!((n=t[d])!=null&&n.platform))return t[d];return null}async function ot(e,t){var a;let n=0,d=[];for(let l=0;l<t.length;l++)new RegExp(t[l].url).test(e.url)&&!((a=t[l])!=null&&a.platform)&&d.push(t[l]);if(d.length==0)return t;for(;n==0;){for(let l=0;l<d.length;l++)if(document.querySelector(d[l].selector)||d[l].proxy_sel!=null&&document.querySelector(d[l].proxy_sel))return n=1,d[l];await _(500)}return t[0]}async function fe(){try{if(y=1,I="",r={},z=0,G=0,q=await ve(),!q.url||q.url==""||q.url==null||q.url==null)throw new Error("Cannot get URL");let e=lt(q.url);if(I=q.id,b=await Ze(),b==""||b==null||b==null)throw new Error("Cannot get ACpos");E={},v={},R=0,O=-1;let t=await Qe();if(w=await ut({type:"getConfig",pos:b,devicetype:t}),w==null||w==null||w.length==0)throw new Error("Cannot get config");let n=0;if(ee=await A({type:"getCheckoutAnalytics"}),L=ee==null?void 0:ee.ACCheckPoints,w[0].iframeConfigPicker){const d=await ot(q,w);if(d){try{await A({type:"fireEvent",eventName:"analyticsCommonBh",params:{type:"error_pair_level",pos:b,config:L==null?void 0:L.events[0],name:L==null?void 0:L.name,tabId:I}})}catch{}w=d}}else if(w[0].hatke_AC){const d=ye(q,w);if(d){try{await A({type:"fireEvent",eventName:"analyticsCommonBh",params:{type:"error_pair_level",pos:b,config:L==null?void 0:L.events[0],name:L==null?void 0:L.name,tabId:I}})}catch{}w=d}if(!Array.isArray(w))for(;n==0;){if(await Pe(w)==!0){try{await A({type:"fireEvent",eventName:"analyticsCommonBh",params:{type:"error_pair_level",pos:b,config:L==null?void 0:L.events[1],name:L==null?void 0:L.name,tabId:I}})}catch{}n=1,te=!0;break}await _(500)}}else{for(let a=0;a<w.length;a++){let l=w[a].selector;if(w[a].is_executable&&document.querySelector(l)){n=1;break}}const d=ye(q,w);if(d){try{await A({type:"fireEvent",eventName:"analyticsCommonBh",params:{type:"error_pair_level",pos:b,config:L==null?void 0:L.events[0],name:L==null?void 0:L.name,tabId:I}})}catch{}w=d}}if(Array.isArray(w)&&n==1){let d={hostname:e};d.pos=b,await A({type:"fireEvent",eventName:"ACCartUrlError",params:d})}if(!w.is_executable)return;if(w.discount2!=null&&w.id==1288&&document.querySelector("div.fareTypeWrap:nth-child(4) > div > div >span.fareHeader")!=null&&document.querySelector("div.fareTypeWrap:nth-child(4) > div > div >span.fareHeader").innerHTML=="Other Services"&&(w.discount=w.discount2),w.reload!=null&&(r=await De(),r=r=="null"?{}:r),w.hide_couponlist,w.isGlobal&&(J="$"),j(J),w.crncy&&(J=w.crncy),j(J),r.crncySymbol&&(J=r.crncySymbol,j(J)),!Array.isArray(w)){let d="";if(w.reload!=null&&r.couponList!=null)d=await JSON.parse(r.couponList);else if(w.cat!=null?d=await re({type:"getCouponsList",pos:w.id,cat:w.cat}):d=await re({type:"getCouponsList",pos:w.id}),d=d.filter(a=>!a.code.toUpperCase().includes("HONEY")),d.length==0){await F({type:"ACMonitor",data:{clubID:b,status:9}});return}}r.ACAnalytics&&r.ACAnalyticsValue&&(E=r.ACAnalytics,v=r.ACAnalyticsValue),r.startMS!=null&&r.processid!=null&&(R=r.startMS,O=r.processid),r.processing&&(X=r.processing),r.globalPreMaxDis&&(ae=r.globalPreMaxDis),w.iframeURL&&(at(b),rt(w.iframeURL)),await dt(w)}catch{}}async function we(e){for(;;){if(X){await _(1e3);continue}let t=await ve(),n=!1;if(new RegExp(e.url).test(t.url)&&!(e!=null&&e.platform)&&(n=!0),e.hatke_AC&&n){const a=await Pe(e);W(!!a)}else e.selector&&e.selector!=""&&document.querySelector(e.selector)||e.proxy_sel!=null&&document.querySelector(e.proxy_sel)?W(!0):W(!1);await _(1e3)}}function Re(e){try{if(Ee&&(te=!1,X=!0,W(!1),ue(!0),he(e)),r.couponList==null)te=!0;else if(Object.keys(r).length!=0&&r.couponList!=null){he(e),ue(!0),W(!1);let t=JSON.parse(r.couponList),n=JSON.parse(r.coupon_arr),d=t==null?void 0:t.map(p=>{const h=n==null?void 0:n.find(f=>f.code===p.code);return h?{...p,savings:(h==null?void 0:h.savings)||0,msg:(h==null?void 0:h.msg)||"",success:(h==null?void 0:h.success)||!1}:p});qe(d);let a=r==null?void 0:r.ACpos,l;a!==void 0&&n[a]?l=n[a]:l=n==null?void 0:n.reduce((p,h)=>{const f=parseFloat(h.saving||0),S=parseFloat(p.saving||0);return f>S?h:p},n[0]||{}),Ae(l)}}catch{}}async function dt(e){try{if(te){try{await A({type:"fireEvent",eventName:"ACIconShown",params:{pos:b,hostName:window.location.hostname}})}catch{}E.icon_shown=1,W(!0),Re(e),we(e),pe(!0)}else{let t=0;for(;t==0;){if(document.querySelector(e.selector)||e.proxy_sel!=null&&document.querySelector(e.proxy_sel)){t=1;try{await A({type:"fireEvent",eventName:"ACIconShown",params:{pos:b,hostName:window.location.hostname}})}catch{}E.icon_shown=1,W(!0),pe(!0),we(e);try{await A({type:"fireEvent",eventName:"analyticsCommonBh",params:{type:"error_pair_level",pos:b,config:L==null?void 0:L.events[1],name:L==null?void 0:L.name,tabId:I}})}catch{}e.reload!=null&&r.is_UIOpen&&oe(!0);break}await _(500)}}}catch{}}async function ct(e){try{if(e.cpns_on_page==null)return!1;for(let t=0;t<e.cpns_on_page.length;t++)document.querySelector(e.cpns_on_page[t].name)&&document.querySelector(e.cpns_on_page[t].name).click(),await _(1e3);return!0}catch{return!1}}async function pt(e,t){try{if(await ct(t)){let d=await JSON.parse(await D.getItem("CPNS"+I+b)==null?"{}":await D.getItem("CPNS"+I+b));if(d.ONPAGE_CPNS!=null&&d.ONPAGE_CPNS.length!=0){let a=[...e];const l=S=>S?S.toUpperCase().trim():"",p=d.ONPAGE_CPNS.map(S=>l(S.code)),h=a.filter(S=>!p.includes(l(S.code)));a=[...d.ONPAGE_CPNS.map(S=>a.find(c=>l(c.code)===l(S.code))||S),...h],e=a,await D.removeItem("CPNS"+I+b)}}return e}catch{throw new Error}}async function he(e){var t;try{let n=document.getElementById("hk-ac-id-apply-button");if(typeof ce<"u"&&ce()!=""&&n!=null&&n!=null&&n!=""){let a=window.location.href;const l=new URL(a);je(47,"misplaced AutoCoupon",`${l.origin}${l.pathname}`)}if((e.reload==null||e.reload!=null&&Object.keys(r).length==0)&&await A({type:"getAffCouponsNew",data:{pos:b,url:q.url}}),e.loginCheck!=null&&e.loginCheck.name!=null&&e.loginCheck.name!=""&&document.querySelector(e.loginCheck.name)!=null&&document.querySelector(e.loginCheck.name).innerHTML.includes(e.loginCheck.text)){let a=q.url;a=a.split("//"),a=a[1],a=a.split("/"),a=a[0],M(!1);return}if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((t=document.querySelector(e.isLogin))==null?void 0:t.style.display)!="none"){let a=q.url;a=a.split("//"),a=a[1],a=a.split("/"),a=a[0],M(!1),tt(a);return}if(G=0,await _(1e3),y==0||z==1)return;e.reload!=null&&r.prevStatus!=null?x=r.prevStatus:(x=0,await F({type:"ACMonitor",data:{clubID:b,status:0}}),N={hostname:Le},N.pos=b,await A({type:"fireEvent",eventName:"AutoCouponClicked",params:N})),e.reload!=null&&(r.prevStatus=x),y=0;let d="";try{if(e.reload!=null&&r.couponList!=null)d=await JSON.parse(r.couponList),r.startMS!=null&&r.processid!=null&&(O=r.processid,R=r.startMS);else{if(O=await V({type:"getACAnalyticsId",data:{pos:b}}),R=Date.now(),E.process_started=1,v.process_started=1,e.getcatsel!=null){let l=document.querySelector(e.getcatsel.name);l&&l.innerText.toLowerCase().includes(e.getcatsel.text.toLowerCase())&&(e.cat=e.getcatsel.cat)}e.cat?d=await re({type:"getCouponsList",pos:e.id,cat:e.cat}):d=await re({type:"getCouponsList",pos:e.id}),d=d.filter(l=>!l.code.toUpperCase().includes("HONEY"));let a=d;if(e.cpns_on_page!=null)try{d=await pt(d,e)}catch{d=a}qe(d),d.length>0&&(E.found_coupon=1),await F({type:"ACMonitor",data:{clubID:b,status:1,prevStatus:x}}),N.pos=b,await A({type:"fireEvent",eventName:"CouponListFetched",params:N}),x=1,e.reload!=null&&(r.prevStatus=x),await F({type:"ACMonitor",data:{clubID:b,status:2,prevStatus:x}}),N.pos=b,await A({type:"fireEvent",eventName:"ExecutionStarted",params:N}),x=2,e.reload!=null&&(r.prevStatus=x),e.reload!=null&&(r.couponList=JSON.stringify(d),r.startMS=R,r.processid=O,r.ACAnalytics=E,r.ACAnalyticsValue=v,r.processing=X)}}catch{d=[]}if(y==1||(e.hide_couponlist,e.reload!=null&&(r.is_UIOpen=!0),z=1,await mt(d,e),z=0,y==1))return}catch{}}async function mt(e,t){var n,d;try{let a=t.reload!=null&&r.coupon_arr!=null?await JSON.parse(r.coupon_arr):[],l=0;t.default_dis&&(l=await kt(t),isNaN(l)?l=0:l=parseFloat(l));let p="";if(t.interceptor_api!=""){if(await U(t),p=await ft(t),y==1)return;p=await JSON.parse(JSON.stringify(p).replaceAll("buyhatke","BUYHATKE"))}const h=new Map;let f=0;r.max!=null&&(f=r.max),(t.reload==null||r.iterator!=e.length)&&void 0,t.reload!=null&&r.iterator==e.length&&(r.iterator-1,void 0);try{if(t.hatke_AC&&t.reload&&r.initial_price!=null&&t.total_price!=null)B=parseFloat(r.initial_price),J=r.crncySymbol,j(J);else if(t.hatke_AC&&t.reload&&r.code=="BUYHATKE"&&r.initial_price==null&&t.total_price!=null){let m=await Y(t);m.type=="totalprice"&&(B=m.price,J=m.cS,j(J)),t.reload!=null&&(r.initial_price=B,r.crncySymbol=J,j(J),await D.setItem("buyhatke"+I,JSON.stringify(r)))}else if(t.hatke_AC&&r.initial_price==null&&t.total_price!=null){await U(t),await _(1e3),t.reload!=null&&(r.code="BUYHATKE",await D.setItem("buyhatke"+I,JSON.stringify(r))),await g(t,"BUYHATKE"),await _(1e3);let m=await Y(t);m.type=="totalprice"&&(B=m.price,B=parseFloat(B),J=m.cS,j(J))}}catch(m){throw new Error(m.message)}let S=0;r.totaltime!=null&&(S=r.totaltime);for(let m=t.reload==null||r.iterator==null?0:parseInt(r.iterator);m<e.length&&y==0;m++){let c=Date.now();r.cpnstartMS!=null&&r.iterator!=null&&r.iterator==m&&r.canCheck!=null&&r.canCheck&&(c=r.cpnstartMS);let i=t.reload!=null&&r.my_obj!=null?await JSON.parse(r.my_obj):{msg:"",id:e[m].id,code:e[m].code,success:!1,savings:0},u=Math.floor(100*(m+1)/e.length),o=0;if(y==1)return;if(t.interceptor_api!=""){let s="",C="";s=m==0?"BUYHATKE":e[m-1].code,C=e[m].code,t.lowercase&&(s!="BUYHATKE"&&(s=s.toLowerCase()),C=C.toLowerCase()),p=await JSON.parse(JSON.stringify(p).replaceAll(s,C));let P=p.url,k=-1;try{if(y==1)return;if(k=await fetch(P,p),!k.ok)try{if(y==1)return;k=await k.json(),t.discount_arr!=null?(i.msg==null&&(i.msg=""),k=-1):(i.msg=Q(t,"cpn_message",k),i.msg==null&&(i.msg=""),k=-1)}catch{i.msg="",k=-1}}catch{i.msg="",k=-1}if(k!=-1){if(y==1)return;if(k=await k.json(),t.discount_arr!=null)try{o=await ht(t.discount_arr[0],"discount",k,C)}catch{o=0}else try{o=Q(t,"discount",k),(isNaN(o)||o==null||o==null)&&(o=0)}catch{o=0}o!=0&&t.operation!=null&&(t.operation.type=="divide"&&(o/=t.operation.value),t.operation.type=="multiply"&&(o*=t.operation.value),t.operation.type=="add"&&(o+=t.operation.value),t.operation.type=="subtract"&&(o-=t.operation.value));let T="";if(o==0&&!t.discount_arr){try{T=Q(t,"cpn_message",k),T==null&&(T="")}catch{T=""}T=T.replace(/<[^>]+>/g,""),T=T.replace(/\s+/g," ").trim()}i.savings=0,i.msg="",o>0?(i.savings=o,i.msg=T,i.success=!0):i.msg=T||""}else o=0,i.savings=o}else if(t.hatke_AC&&t.reload&&t.total_price!=null)if(r.iterator!=null&&r.iterator==m&&r.canCheck!=null&&r.canCheck){let s=await Y(t);if(y==1)return;let C="";if(s.type=="discount")o=s.price;else if(s.type=="cashback")o=s.price;else if(s.type=="totalprice"){let P=s.price;o=B-P}else s.type=="totalpricemsg"&&(C=s.msg,o=0);isNaN(o)&&(o=0),o=o.toFixed(2),o=parseFloat(o),i.savings=0,i.msg="",o>0&&(i.savings=o,i.msg=C,i.success=!0)}else r.iterator=m,r.my_obj=JSON.stringify(i),r.coupon_arr=JSON.stringify(a),await U(t),await _(1e3),r.canCheck=!0,await g(t,e[m].code),await _(1e3);else if(t.hatke_AC&&t.total_price!=null){if(await U(t),await _(1e3),y==1||(await g(t,e[m].code),y==1))return;await _(1e3);let s=await Y(t);if(y==1)return;let C="";if(s.type=="discount")o=s.price;else if(s.type=="cashback")o=s.price;else if(s.type=="totalprice"){let P=s.price;o=B-P}else s.type=="totalpricemsg"&&(C=s.msg,o=0);isNaN(o)&&(o=0),o=o.toFixed(2),o=parseFloat(o),i.savings=0,i.msg="",o>0&&(i.savings=o,i.msg=C,i.success=!0)}else if(t.sync!=null){if(await U(t),y==1||(await g(t,e[m].code),y==1))return;let s=await Y(t,e[m].code);if(y==1)return;let C="";s.type=="dis"?o=s.dis:(C=s.msg,o=0),isNaN(o)&&(o=0),o=parseFloat(o),i.savings=0,i.msg="",o>0&&(i.savings=o,i.msg=C,i.success=!0)}else if(t.reload!=null){if(r.iterator!=null&&r.iterator==m&&r.canCheck!=null&&r.canCheck){let s=await _t(t);if(y==1)return;let C="";s.type=="dis"?o=s.dis:(C=s.msg,o=0),isNaN(o)&&(o=0),o=parseFloat(o),i.savings=0,i.msg="",o>0&&(i.savings=o,i.msg=C,i.success=!0)}else if(r.iterator=m,r.my_obj=JSON.stringify(i),r.coupon_arr=JSON.stringify(a),await U(t),r.canCheck=!0,r.cpnstartMS=c,t.automatic.coupon_click_reload!=null&&(r.canCheck=!1),await g(t,e[m].code),t.success_reload&&document.querySelector(t.reload.cpn_message.name)!=null){let s=document.querySelector(t.reload.cpn_message.name).innerHTML;t.reload.cpn_message.selector&&(s=document.querySelector(t.reload.cpn_message.selector).innerHTML);let C=t.reload.cpn_message.split.length;for(let P=0;P<C;P++)if(s.split(t.reload.cpn_message.split[P].string)[t.reload.cpn_message.split[P].index]!=null)s=s.split(t.reload.cpn_message.split[P].string)[t.reload.cpn_message.split[P].index];else{s="";break}i.msg=s}}if(t.reload!=null&&r.cpnstartMS!=null&&(c=r.cpnstartMS),c){let s=Date.now();const C=await K(c,s);S=Number(S+C),t.reload!=null&&(r.totaltime=S)}if(y==1)return;if(h.has(parseFloat(o))||h.set(parseFloat(o),m),f<o&&(f=o,t.reload!=null&&(r.max=f,r.ACpos=m)),o>0&&(ae=o,t.reload!=null&&(r.globalPreMaxDis=ae)),y!=1&&void 0,a.push(i),a.length===0)return null;Ae(a[a.length-1]),t.reload!=null&&(r.coupon_arr=JSON.stringify(a),r.my_obj=void 0)}if(S!=0&&e.length!=0&&(v.each_coupon_apply=Math.floor(S/e.length)),y==1)return;if(f==0&&l==0){if(t.initialstate&&await U(t),t.reload!=null&&(await D.removeItem("buyhatke"+I),r={}),E.process_success=1,R){let m=Date.now();const c=await K(R,m);v.time_taken=c,v.event_type="success"}O&&O!=-1&&(v.id=O,await V({type:"ACTSMonitor",data:{clubID:b,ACanalytics:E,ACAnalyticsValue:v}})),E={},v={},await F({type:"ACMonitor",data:{clubID:b,status:4,prevStatus:x}}),N.pos=b,await A({type:"fireEvent",eventName:"successWithoutDiscount",params:N}),x=4,t.reload!=null&&(r.prevStatus=x),Z(t)}else{try{let s={PIDs:await Ge(),pos:xe,ts:Date.now(),discount:f,couponCode:t.reload==null?e[h.get(parseFloat(f))].code:e[r.ACpos].code,id:95};await A({type:"fireEvent",eventName:"StageEvents",ts:Date.now(),params:{...s}})}catch{}if(t.reload!=null&&r.iterator!=null&&r.iterator==e.length-1)r.iterator=e.length,await U(t),await g(t,t.reload==null?e[h.get(parseFloat(f))].code:e[r.ACpos].code);else if(t.reload==null)if(t.default_dis&&l>f){t.automatic.coupon_click.name!=""&&document.querySelector(t.automatic.coupon_click.name)!=null&&(document.querySelector(t.automatic.coupon_click.name).click(),t.automatic.coupon_click.wait&&await _(1e3));let o=document.querySelectorAll(".coupon-base-validCouponContainer .coupon-base-labelUnchecked");for(let s=0;s<o.length;s++)o[s].click();await _(1e3),document.querySelector("#applyCoupon")!=null&&(document.querySelector("#applyCoupon").click(),t.automatic.clear_button.wait&&await _(1e3))}else{if(await U(t),y==1)return;t.default_dis?await bt(t,t.reload==null?e[h.get(parseFloat(f))].code:e[r.ACpos].code):await g(t,t.reload==null?e[h.get(parseFloat(f))].code:e[r.ACpos].code)}let m=Math.max(f,l);if(E.process_success=1,E.best_applied=1,R){let o=Date.now();const s=await K(R,o);v.time_taken=s,v.event_type="success",v.savings=m}O&&O!=-1&&(v.id=O,await V({type:"ACTSMonitor",data:{clubID:b,ACanalytics:E,ACAnalyticsValue:v}})),E={},v={},await F({type:"ACMonitor",data:{clubID:b,status:3,prevStatus:x}}),N.pos=b,await A({type:"fireEvent",eventName:"successWithDiscount",params:N}),x=3,t.reload!=null&&(r.prevStatus=x),Te({dis:f>=l?f:l,code:f>=l?t.reload==null?h.get(parseFloat(f)):r.ACpos:""},t),t.reload!=null&&(ze(!0),await D.removeItem("buyhatke"+I),r={}),r.ACsavings=f>=l?f:l,r.pos=t.id,r.ACpos=t.id,r.ts=Date.now(),await D.setItem("hatkeACsaving",r);let c=await D.getItem("ext_id"),i=await D.getItem("ext_auth"),u=f>=l?f:l;try{if(u>0){let o={pos:t.id,prod:"",pid:"",price:"",extId:c,extAuth:i,type:"autoCoupon",savings:u};await A({type:"postSavingsAlert",data:o})}}catch{}}(n=document.querySelector("#hk-autoCoupon > div.hk-c-modal.hk-c-modal--wide.hk-ext-animated > div.hk-l-flexColumns > div.hk-aCoup__main.hk-u-padding__15.hk-c-modal__wrapper--scrollable > div.hk-js-aCoup__contentWrap.hk-aCoup__contentWrap > div.hk-u-padding__v-05.hk-u-text__align--center > button"))==null||n.addEventListener("click",()=>{new hkSubmitCouponsClass().openModal(),y!=1}),(d=document.querySelector("#hk-autoCoupon > div.hk-c-modal.hk-c-modal--wide.hk-ext-animated > div.hk-l-flexColumns > div.hk-aCoup__main.hk-u-padding__15.hk-c-modal__wrapper--scrollable > div.hk-u-margin__v-15.hk-u-disp--flex.hk-js-aCoup__footerContent.hk-l-flex--allCenter > div.hk-c-links.hk-c-links--iconTri.hk-tri--right.hk-js-modal__open.hk-js-fdbkModal"))==null||d.addEventListener("click",()=>{fdb=new hkfeedbackClass,fdb.openModal(),y!=1}),await St({type:"updateCouponStatus",data:{pos:t.id,cpnStatus:a}})}catch(a){if(a.message=="Login Required"){if(G=1,E.not_loggedin=1,R){let l=Date.now();const p=await K(R,l);v.time_taken=p,v.event_type="not_loggedin"}O&&O!=-1&&(v.id=O,await V({type:"ACTSMonitor",data:{clubID:b,ACanalytics:E,ACAnalyticsValue:v}})),E={},v={},G==0&&y==0&&x==-1&&(await F({type:"ACMonitor",data:{clubID:b,status:6}}),N.pos=b,await A({type:"fireEvent",eventName:"AutoCouponError",params:N})),M(!1)}else if(a.message=="ACReadTotalPriceError"){if(E.missing_price=1,R){let l=Date.now();const p=await K(R,l);v.time_taken=p,v.event_type="missing_price"}O&&O!=-1&&(v.id=O,await V({type:"ACTSMonitor",data:{clubID:b,ACanalytics:E,ACAnalyticsValue:v}})),E={},v={},await F({type:"ACMonitor",data:{clubID:b,status:7,prevStatus:x}}),N.pos=b,await A({type:"fireEvent",eventName:"ACReadTotalPriceError",params:N})}else{if(E.process_failed=1,R){let l=Date.now();const p=await K(R,l);v.time_taken=p,v.event_type="failed"}O&&O!=-1&&(v.id=O,await V({type:"ACTSMonitor",data:{clubID:b,ACanalytics:E,ACAnalyticsValue:v}})),E={},v={},await F({type:"ACMonitor",data:{clubID:b,status:6,prevStatus:x}}),N.pos=b,await A({type:"fireEvent",eventName:"AutoCouponError",params:N})}x=6,t.reload!=null&&(r.prevStatus=x);try{Z(t)}catch(l){throw window.alert("Error : cannot run autocoupon try reloading the site"),new Error(l.message)}}}async function g(e,t){var n,d,a,l,p,h,f,S,m,c;try{let i=0;if(y==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((n=document.querySelector(e.isLogin))==null?void 0:n.style.display)!="none"){y=1;let s=q.url;throw s=s.split("//"),s=s[1],s=s.split("/"),s=s[0],M(!1),new Error("Login Required")}e.automatic.coupon_click_reload!=null&&await D.setItem("buyhatke"+I,JSON.stringify(r)),e.automatic.coupon_click_reload!=null&&document.querySelector(e.automatic.coupon_click_reload.name)!=null&&(document.querySelector(e.automatic.coupon_click_reload.name).click(),i=1,e.automatic.coupon_click_reload.wait&&await _(1e3)),e.conditional_sel&&me==0&&((a=(d=e.conditional_sel)==null?void 0:d.coupon_click)==null?void 0:a.text_selector)!=null&&document.querySelector((p=(l=e.conditional_sel)==null?void 0:l.coupon_click)==null?void 0:p.text_selector)&&document.querySelector(e.conditional_sel.coupon_click.text_selector).textContent.toLowerCase().includes(e.conditional_sel.coupon_click.text)&&(e.automatic.coupon_click.name=e.conditional_sel.coupon_click.name,me=1),e.automatic.coupon_click.name!=""&&document.querySelector(e.automatic.coupon_click.name)!=null&&i==0?(document.querySelector(e.automatic.coupon_click.name).click(),i=1,e.automatic.coupon_click.wait&&await _(1e3)):e.automatic.coupon_click.proxyname!=""&&document.querySelector(e.automatic.coupon_click.proxyname)!=null&&i==0&&(document.querySelector(e.automatic.coupon_click.proxyname).click(),i=1,e.automatic.coupon_click.wait&&await _(1e3));let u=0;for(;e.automatic.coupon_value.name!=""&&!document.querySelector(e.automatic.coupon_value.name);){if(e.automatic.coupon_click.name!=""&&document.querySelector(e.automatic.coupon_click.name)&&i==0?(document.querySelector(e.automatic.coupon_click.name).click(),i=1):e.automatic.coupon_click.name!=""&&document.querySelector(e.automatic.coupon_click.proxyname)&&i==0&&(document.querySelector(e.automatic.coupon_click.proxyname).click(),i=1),y==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((h=document.querySelector(e.isLogin))==null?void 0:h.style.display)!="none"){y=1;let s=q.url;throw s=s.split("//"),s=s[1],s=s.split("/"),s=s[0],M(!1),new Error("Login Required")}u++,u%4==0&&(i=0,u=0),await _(1e3)}if(y==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((f=document.querySelector(e.isLogin))==null?void 0:f.style.display)!="none"){y=1;let s=q.url;throw s=s.split("//"),s=s[1],s=s.split("/"),s=s[0],M(!1),new Error("Login Required")}e.automatic.coupon_click_reload!=null&&(r.canCheck=!0);let o=document.querySelector(e.automatic.coupon_value.name);if(o.focus(),!o)return;if(o.click(),o.focus(),o.select(),document.execCommand("insertText",!1,"")||(o.value=""),o.dispatchEvent(new Event("change",{bubbles:!0})),await He(o,t,e),e.automatic.coupon_value.wait!=!1&&(e.automatic.coupon_value.wait==!0?await _(1e3):await _(e.automatic.coupon_value.wait)),e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((S=document.querySelector(e.isLogin))==null?void 0:S.style.display)!="none"){y=1;let s=q.url;throw s=s.split("//"),s=s[1],s=s.split("/"),s=s[0],M(!1),new Error("Login Required")}if(u=0,y==1)return;if(e.interceptor_api==""&&e.sync!=null)for(;e.automatic.apply_button.name!=""&&!document.querySelector(e.automatic.apply_button.name)||u<3;){if(e.automatic.apply_button.name!=""&&document.querySelector(e.automatic.apply_button.name)?u++:u=0,e.isLogin!=null&&document.querySelector(e.islogin)!=null&&document.querySelector(e.isLogin).style.display!="none"){y=1;let s=q.url;throw s=s.split("//"),s=s[1],s=s.split("/"),s=s[0],M(!1),new Error("Login Required")}if(y==1)return;await _(500)}else for(;e.automatic.apply_button.name!=""&&!document.querySelector(e.automatic.apply_button.name);){if(e.automatic.apply_button.name!=""&&document.querySelector(e.automatic.apply_button.name)?u++:u=0,e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((m=document.querySelector(e.isLogin))==null?void 0:m.style.display)!="none"){y=1;let s=q.url;throw s=s.split("//"),s=s[1],s=s.split("/"),s=s[0],M(!1),new Error("Login Required")}if(y==1)return;await _(500)}if(y==1)return;if(e.reload!=null&&await D.setItem("buyhatke"+I,JSON.stringify(r)),document.querySelector(e.automatic.apply_button.name).click(),e.automatic.apply_button.wait!=!1&&(e.automatic.apply_button.wait==!0?await _(1e3):await _(e.automatic.apply_button.wait)),e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((c=document.querySelector(e.isLogin))==null?void 0:c.style.display)!="none"){y=1;let s=q.url;throw s=s.split("//"),s=s[1],s=s.split("/"),s=s[0],M(!1),new Error("Login Required")}if(y==1||e.hatke_AC&&e.reload==null||e.sync!=null&&e.interceptor_api=="")return;if(e.reload!=null&&e.success_reload==null)for(;;)await _(1e4),e.reload!=null&&await D.setItem("buyhatke"+I,JSON.stringify(r)),document.querySelector(e.automatic.apply_button.name)&&document.querySelector(e.automatic.apply_button.name).click();if(y==1)return;if(e.automatic.clear_button.name!=""&&document.querySelector(e.automatic.clear_button.name)!=null)if(e.automatic.mouse_event_clear!=null&&e.automatic.mouse_event_clear){const s=document.querySelector(e.automatic.clear_button.name);s&&!s.disabled&&window.getComputedStyle(s).display!=="none"&&(s.click(),s.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0})),s.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0})),s.dispatchEvent(new MouseEvent("click",{bubbles:!0})))}else document.querySelector(e.automatic.clear_button.name).click()}catch(i){throw new Error(i.message)}}function se(e){var t,n;try{const d=/((?:[A-Z]{3}(?=[₹$€£¥₩])?|Rs|[₹$€£¥₩])\s?[₹$€£¥₩]?)?\s?([0-9]+(?:[\s,][0-9]{3})*(?:\.[0-9]{1,2})?)\s?((?:[A-Z]{3}|Rs|[₹$€£¥₩])?)?/,a=e.replace(/\s+/g," ").trim(),l=a.match(d);if(!l||!l[2]){let m=Number(a);return isNaN(m)?null:{currencySymbol:"",price:m.toFixed(2)}}let p=((t=l[1])==null?void 0:t.trim())||"",h=((n=l[3])==null?void 0:n.trim())||"",f=parseFloat(l[2].replace(/,/g,"").replace(/\s/g,""));return{currencySymbol:p||h,price:f.toFixed(2)}}catch{return null}}function yt(e){try{let t=["total","cashback","discount"];for(t=t.map(n=>n.toLowerCase());e.length;){let n=e.text().toLowerCase();for(let d of t)if(n.includes(d))return d;e=e.prev()}return"null"}catch{return"null"}}async function Y(e,t){var n,d,a,l,p,h,f,S;try{N={hostname:Le};let m=0;if(e.sync&&e.sync.skipsel!=null){for(let c=0;c<e.sync.skipsel.length;c++)if(document.querySelector(e.sync.skipsel[c].clearsel)!=null)return document.querySelector(e.sync.skipsel[c].clearsel).click(),await _(1e3),{type:"msg",msg:"skipping coupon as per skip selector"}}if(e.hatke_AC&&e.total_price!=null){if(e.waitforsel!=null){let c=0;for(;;){if(c++,c>=120)throw await A({type:"fireEvent",eventName:"WaitForSelError",params:N}),m=0,new Error("WaitForSelError");if(y==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((n=document.querySelector(e.isLogin))==null?void 0:n.style.display)!="none"){y=1;let i=q.url;throw i=i.split("//"),i=i[1],i=i.split("/"),i=i[0],M(!1),new Error("Login Required")}if(e.popup&&document.querySelector(e.popup.name)!=null&&((d=document.querySelector(e.popup.name))==null?void 0:d.style.display)!="none"){let i=document.querySelector(e.popup.selector);if(i&&(i.click(),!e.popup.continue))return{type:"msg",msg:"Not Applicable On Current Cart"}}if(e.waitforsel!=null){let i;for(let u=0;u<e.waitforsel.name.length&&(i=document.querySelector(e.waitforsel.name[u]),!i);u++);if(i)break}await _(500)}}for(;;){if(m++,m>=240)throw m=0,new Error("ACReadTotalPriceError");if(y==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((a=document.querySelector(e.isLogin))==null?void 0:a.style.display)!="none"){y=1;let c=q.url;throw c=c.split("//"),c=c[1],c=c.split("/"),c=c[0],M(!1),new Error("Login Required")}if(e.popup&&document.querySelector(e.popup.name)!=null&&((l=document.querySelector(e.popup.name))==null?void 0:l.style.display)!="none"){let c=document.querySelector(e.popup.selector);if(c&&(c.click(),!e.popup.continue))return{type:"msg",msg:"Not Applicable On Current Cart"}}if(e.total_price!=null){let c,i;for(let u=0;u<e.total_price.name.length;u++)try{if(c=document.querySelector(e.total_price.name[u]),c&&c.textContent!=null&&c.textContent!="")break}catch{if(i=$(e.total_price.name[u]),i&&i.length)break}if(c&&c.textContent!=null&&c.textContent!=""||i&&i.length>0)break}await _(500)}try{if(e.total_price!=null&&e.total_price.name.length>0){let c="",i=-1,u;for(let o=0;o<e.total_price.name.length;o++){try{if(document.querySelector(e.total_price.name[o])){let s=document.querySelector(e.total_price.name[o]);if(s){const C=se(s.textContent);c="totalprice",C.currencySymbol!=null?u=C.currencySymbol:u="",i=C.price}}}catch{const C=$(e.total_price.name[o]);let P=yt(C);if(C.length){let k;if(C[0].textContent==null||C[0].textContent==""||C[0].textContent==null){let T=await C.text();const H=se(T);H&&(H.currencySymbol!=null?u=H.currencySymbol:u="",k=H.price)}else{const T=se(C[0].textContent);T&&(T.currencySymbol!=null?u=T.currencySymbol:u="",k=T.price)}P=="discount"?(c="discount",i=k):P=="cashback"?(c="cashback",i=k):(c="totalprice",i=k)}}if(o==e.total_price.name.length-1){if(i>=0)return{type:c,price:i,cS:u};throw new Error("ACReadTotalPriceError")}}}}catch(c){throw new Error(c.message)}}if(e.sync.syncwithcode!=null){let c=0,i=0,u=0;for(;;){if(u++,u>=120)throw await A({type:"fireEvent",eventName:"syncwithcodeErr",params:N}),u=0,new Error("WaitForSelError");if(e.sync.syncwithcode.name!=null&&e.sync.syncwithcode.name!=""&&e.sync.syncwithcode.errname!=null&&e.sync.syncwithcode.errname!=""){let o=document.querySelectorAll(e.sync.syncwithcode.name);for(let s=0;s<o.length;s++){let C=o[s].querySelector(e.sync.syncwithcode.codesel).innerHTML.trim(),P=e.sync.syncwithcode.codesplit.length;for(let k=0;k<P;k++)C.split(e.sync.syncwithcode.codesplit[k].string)[e.sync.syncwithcode.codesplit[k].index]!=null&&(C=C.split(e.sync.syncwithcode.codesplit[k].string)[e.sync.syncwithcode.codesplit[k].index]);if(C==t){c=1;break}}if(c==1||document.querySelector(e.sync.syncwithcode.errname))break}await _(500)}if(c==1)try{if(document.querySelector(e.sync.syncwithcode.name)!=null){let o=document.querySelectorAll(e.sync.syncwithcode.name);for(let s=0;s<o.length;s++){let C=o[s].querySelector(e.sync.syncwithcode.codesel).innerHTML.trim(),P=e.sync.syncwithcode.codesplit.length;for(let k=0;k<P;k++)if(C.split(e.sync.syncwithcode.codesplit[k].string)[e.sync.syncwithcode.codesplit[k].index]!=null)C=C.split(e.sync.syncwithcode.codesplit[k].string)[e.sync.syncwithcode.codesplit[k].index];else{i=1;break}if(C==t){let k=o[s].querySelector(e.sync.syncwithcode.discsel).innerHTML,T=e.sync.syncwithcode.discsplit.length;for(let H=0;H<T;H++)k.split(e.sync.syncwithcode.discsplit[H].string)[e.sync.syncwithcode.discsplit[H].index]!=null&&(k=k.split(e.sync.syncwithcode.discsplit[H].string)[e.sync.syncwithcode.discsplit[H].index]);k=k.replaceAll(",","");try{isNaN(k)&&(k=0),k=parseFloat(k)}catch{k=0}return e.sync.syncwithcode.discwait!=null&&await _(e.sync.syncwithcode.discwait),{type:"dis",dis:k}}}return{type:"msg",msg:""}}}catch{return{type:"msg",msg:""}}else return{type:"msg",msg:""}}for(;e.sync.cashback&&document.querySelector(e.sync.cashback.name)==null&&document.querySelector(e.sync.discount.name)==null&&(document.querySelector(e.sync.cpn_message.name)==null||((p=document.querySelector(e.sync.cpn_message.name))==null?void 0:p.innerHTML.length)==0)||e.sync.cashback==null&&document.querySelector(e.sync.discount.name)==null&&(document.querySelector(e.sync.cpn_message.name)==null||((h=document.querySelector(e.sync.cpn_message.name))==null?void 0:h.innerHTML.length)==0);){if(m++,m>=240)throw N.pos=b,await A({type:"fireEvent",eventName:"ACReadDiscountError",params:N}),m=0,new Error("Can Read Discount/Message");if(y==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((f=document.querySelector(e.isLogin))==null?void 0:f.style.display)!="none"){y=1;let c=q.url;throw c=c.split("//"),c=c[1],c=c.split("/"),c=c[0],M(!1),new Error("Login Required")}if(e.popup&&document.querySelector(e.popup.name)!=null&&((S=document.querySelector(e.popup.name))==null?void 0:S.style.display)!="none"){let c=document.querySelector(e.popup.selector);if(c&&(c.click(),!e.popup.continue))return{type:"msg",msg:"Not Applicable On Current Cart"}}await _(500)}if(await _(800),e.sync.dis_text!=null&&e.sync.dis_text.name!=null&&document.querySelector(e.sync.dis_text.name)!=null&&e.sync.dis_text.textSelector!=null&&document.querySelector(e.sync.dis_text.textSelector)!=null&&e.sync.dis_text.text!=null&&e.sync.dis_text.text!=""&&e.sync.dis_text.text!=null){if(document.querySelector(e.sync.dis_text.textSelector).innerHTML.includes(e.sync.dis_text.text)){if(document.querySelector(e.sync.discount.name)!=null){let i=document.querySelector(e.sync.discount.name).innerHTML;e.sync.discount.selector&&(i=document.querySelector(e.sync.discount.selector).innerHTML);let u=e.sync.discount.split.length;for(let o=0;o<u;o++)if(i.split(e.sync.discount.split[o].string)[e.sync.discount.split[o].index]!=null)i=i.split(e.sync.discount.split[o].string)[e.sync.discount.split[o].index];else{i="";break}i=i.replaceAll(",","");try{isNaN(i)&&(i=0),i=parseFloat(i)}catch{i=0}return{type:"dis",dis:i}}}else if(document.querySelector(e.sync.cpn_message.name)!=null){let i=document.querySelector(e.sync.cpn_message.name).innerHTML;e.sync.cpn_message.selector&&(i=document.querySelector(e.sync.cpn_message.selector).innerHTML);let u=e.sync.cpn_message.split.length;for(let o=0;o<u;o++)if(i.split(e.sync.cpn_message.split[o].string)[e.sync.cpn_message.split[o].index]!=null)i=i.split(e.sync.cpn_message.split[o].string)[e.sync.cpn_message.split[o].index];else{i="";break}return{type:"msg",msg:i}}}else if(e.sync.cpn_messagetext!=null&&e.sync.cpn_messagetext.name!=null&&document.querySelector(e.sync.cpn_messagetext.name)!=null&&e.sync.cpn_messagetext.textSelector!=null&&document.querySelector(e.sync.cpn_messagetext.textSelector)!=null){if(document.querySelector(e.sync.cpn_messagetext.textSelector).innerHTML.includes(t)){if(document.querySelector(e.sync.cpn_message.name)!=null){let i=document.querySelector(e.sync.cpn_message.name).innerHTML;e.sync.cpn_message.selector&&(i=document.querySelector(e.sync.cpn_message.selector).innerHTML);let u=e.sync.cpn_message.split.length;for(let o=0;o<u;o++)if(i.split(e.sync.cpn_message.split[o].string)[e.sync.cpn_message.split[o].index]!=null)i=i.split(e.sync.cpn_message.split[o].string)[e.sync.cpn_message.split[o].index];else{i="";break}return{type:"msg",msg:i}}}else if(document.querySelector(e.sync.discount.name)!=null){let i=document.querySelector(e.sync.discount.name).innerHTML;e.sync.discount.selector&&(i=document.querySelector(e.sync.discount.selector).innerHTML);let u=e.sync.discount.split.length;for(let o=0;o<u;o++)if(i.split(e.sync.discount.split[o].string)[e.sync.discount.split[o].index]!=null)i=i.split(e.sync.discount.split[o].string)[e.sync.discount.split[o].index];else{i="";break}i=i.replaceAll(",","");try{isNaN(i)&&(i=0),i=parseFloat(i)}catch{i=0}return{type:"dis",dis:i}}}else if(document.querySelector(e.sync.cpn_message.name)!=null){let c=document.querySelector(e.sync.cpn_message.name).innerHTML;e.sync.cpn_message.selector&&(c=document.querySelector(e.sync.cpn_message.selector).innerHTML);let i=e.sync.cpn_message.split.length;for(let u=0;u<i;u++)if(c.split(e.sync.cpn_message.split[u].string)[e.sync.cpn_message.split[u].index]!=null)c=c.split(e.sync.cpn_message.split[u].string)[e.sync.cpn_message.split[u].index];else{c="";break}return{type:"msg",msg:c}}else if(document.querySelector(e.sync.discount.name)!=null){let c=document.querySelector(e.sync.discount.name).innerHTML;e.sync.discount.selector&&(c=document.querySelector(e.sync.discount.selector).innerHTML);let i=e.sync.discount.split.length;for(let u=0;u<i;u++)if(c.split(e.sync.discount.split[u].string)[e.sync.discount.split[u].index]!=null)c=c.split(e.sync.discount.split[u].string)[e.sync.discount.split[u].index];else{c="";break}c=c.replaceAll(",","");try{isNaN(c)&&(c=0),c=parseFloat(c)}catch{c=0}return{type:"dis",dis:c}}else if(e.sync.cashback&&document.querySelector(e.sync.cashback.name)!=null){let c=document.querySelector(e.sync.cashback.name).innerHTML;e.sync.cashback.selector&&(c=document.querySelector(e.sync.cashback.selector).innerHTML);let i=e.sync.cashback.split.length;for(let u=0;u<i;u++)if(c.split(e.sync.cashback.split[u].string)[e.sync.cashback.split[u].index]!=null)c=c.split(e.sync.cashback.split[u].string)[e.sync.cashback.split[u].index];else{c="";break}c=c.replaceAll(",","");try{isNaN(c)&&(c=0),c=parseFloat(c)}catch{c=0}return{type:"dis",dis:c}}return{type:"msg",msg:"error"}}catch(m){throw new Error(m.message)}}async function ft(e){try{let t="",n=A({type:"getRequest",api:e.interceptor_api});if(await _(500),await g(e,"BUYHATKE"),y==1)return;if(n=await n,t=n.headers,t.headers={},t.requestHeaders!=null){for(let d=0;d<t.requestHeaders.length;d++)t.headers[t.requestHeaders[d].name]=t.requestHeaders[d].value;delete t.requestHeaders}if(e.credentials&&(t.credentials=e.credentials),n.body!="NULL"&&(t.body=n.body,t.body.indexOf("formData")>-1)){t.headers["Content-Type"]!=null&&t.headers["Content-Type"].indexOf("multipart/form-data")>-1&&(t.headers["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8");let d=JSON.parse(t.body);d=d.formData;let a="";for(let l in d)a+=`${l}=${d[l][0]}&`;t.body=a}return t}catch(t){throw new Error(t.message)}}async function wt(e,t){try{let n="",d=A({type:"getRequest",api:e.interceptor_api});if(await _(500),await g(e,t.code),y==1)return;if(d=await d,n=d.headers,n.headers={},n.requestHeaders!=null){for(let a=0;a<n.requestHeaders.length;a++)n.headers[n.requestHeaders[a].name]=n.requestHeaders[a].value;delete n.requestHeaders}if(e.credentials&&(n.credentials=e.credentials),d.body!="NULL"&&(n.body=d.body,n.body.indexOf("formData")>-1)){n.headers["Content-Type"]!=null&&n.headers["Content-Type"].indexOf("multipart/form-data")>-1&&(n.headers["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8");let a=JSON.parse(n.body);a=a.formData;let l="";for(let p in a)l+=`${p}=${a[p][0]}&`;n.body=l}return n}catch(n){throw new Error(n.message)}}async function He(e,t,n){try{if(!e)return;if(e.click(),e.focus(),e.select(),document.execCommand("insertText",!1,t)||(e.value=t),e.dispatchEvent(new Event("change",{bubbles:!0})),n.enterKey){const d=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",which:13,keyCode:13});e.dispatchEvent(d)}}catch(d){throw new Error(d.message)}}async function U(e){var t,n,d;try{if(y==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((t=document.querySelector(e.isLogin))==null?void 0:t.style.display)!="none"){y=1;let a=q.url;throw a=a.split("//"),a=a[1],a=a.split("/"),a=a[0],M(!1),new Error("Login Required")}if(e.automatic.remove_button.name==""&&e.automatic.multi_remove!=null)for(let a=0;a<e.automatic.multi_remove.length;a++){if(y==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((n=document.querySelector(e.isLogin))==null?void 0:n.style.display)!="none"){y=1;let l=q.url;throw l=l.split("//"),l=l[1],l=l.split("/"),l=l[0],M(!1),new Error("Login Required")}if(document.querySelector(e.automatic.multi_remove[a].name)!=null){let l=document.querySelectorAll(e.automatic.multi_remove[a].name);for(let p=0;p<l.length;p++)if(e.reload!=null&&(r.canCheck=!1,await D.setItem(`buyhatke${I}`,JSON.stringify(r))),l[p].click(),e.automatic.multi_remove[a].wait!=!1&&(e.automatic.multi_remove[a].wait==!0?await _(1e3):await _(e.automatic.multi_remove[a].wait)),e.reload!=null&&a==e.automatic.multi_remove.length-1&&p==l.length-1)for(;;){await _(1e4);for(let h=0;h<l.length;h++)e.reload!=null&&(r.canCheck=!1,await D.setItem(`buyhatke${I}`,JSON.stringify(r))),l[h].click(),e.automatic.multi_remove[a].wait!="false"&&(e.automatic.multi_remove[a].wait=="true"?await _(1e3):await _(e.automatic.multi_remove[a].wait))}}}else if(e.automatic.remove_button.name!=""&&document.querySelector(e.automatic.remove_button.name)!=null){e.reload!=null&&(r.canCheck=!1,await D.setItem(`buyhatke${I}`,JSON.stringify(r)));let a=document.querySelectorAll(e.automatic.remove_button.name);for(let l=0;l<a.length;l++){if(a[l].click(),e.reload!=null&&l+1==a.length&&e.applyreload==null)for(;;)await _(1e4),document.querySelector(e.automatic.remove_button.name)!=null&&document.querySelector(e.automatic.remove_button.name).click();if(e.automatic.remove_button.wait!=!1&&(e.automatic.remove_button.wait==!0?await _(1e3):await _(e.automatic.remove_button.wait)),e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((d=document.querySelector(e.isLogin))==null?void 0:d.style.display)!="none"){y=1;let p=q.url;throw p=p.split("//"),p=p[1],p=p.split("/"),p=p[0],M(!1),new Error("Login Required")}}}}catch(a){throw new Error(a.message)}}function ht(e,t,n,d){try{let a=0;if(e.typeid==1){let l=e.path.split("."),p=n,h=0;for(let f=0;f<l.length;f++)if(l[f]=="*"){let S=w.search_ele[h];if(S.type=="array"){for(let m=0;m<p.length;m++)if(JSON.stringify(p[m]).includes(S.string)){p=p[m];break}}h++}else p=p[l[f]];if(Array.isArray(p))for(let f=0;f<p.length;f++)p[f][e.select]==d&&(a=p[f][e.getvalue])}else if(e.typeid=2){let l=e.path.split("."),p=n,h=0;for(let f=0;f<l.length;f++)if(l[f]=="*"){let S=w.search_ele[h];if(S.type=="array"){for(let m=0;m<p.length;m++)if(JSON.stringify(p[m]).includes(S.string)){p=p[m];break}}h++}else p=p[l[f]];if(Array.isArray(p))for(let f=0;f<p.length;f++){let S=p[f];if(e.path2!=null&&S[e.path2]!=null&&(S=S[e.path2]),Array.isArray(S)&&S.length>0)for(let m=0;m<S.length;m++)if(e.notselectkey!=null&&S[m][e.notselectkey]!=null){if(S[m][e.notselectkey]!=null&&S[m][e.notselectkey]==e.notselectvalue)continue;a=a+S[m][e.getvalue]}else a=a+S[m][e.getvalue]}}return a==null&&(a=0),typeof a=="number"&&(a=Math.abs(a)),a}catch{return 0}}function Q(e,t,n){let d=e[t].split("."),a=n,l=0;for(let p=0;p<d.length;p++)if(d[p]=="*"){let h=e.search_ele[l];if(h.type=="array"){for(let f=0;f<a.length;f++)if(JSON.stringify(a[f]).includes(h.string)){a=a[f];break}}l++}else a=a[d[p]];if(e.responseType=="html/text"&&a!=null){let p=a;typeof p!="string"&&(p=JSON.stringify(p));let h=e.sync[t].split.length;for(let f=0;f<h;f++)if(p.split(e.sync[t].split[f].string)[e.sync[t].split[f].index]!=null)p=p.split(e.sync[t].split[f].string)[e.sync[t].split[f].index];else{p="";break}if(p=p.trim(),t!="cpn_message")try{p=p.replaceAll(",",""),isNaN(p)&&(p="0"),p=parseFloat(p)}catch{p=0}return p}return typeof a=="number"&&(a=Math.abs(a)),a}async function _t(e){var t;try{for(;document.querySelector(e.reload.discount.name)==null&&document.querySelector(e.reload.cpn_message.name)==null;){if(y==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((t=document.querySelector(e.isLogin))==null?void 0:t.style.display)!="none"){y=1;let n=q.url;throw n=n.split("//"),n=n[1],n=n.split("/"),n=n[0],M(!1),new Error("Login Required")}await _(500)}if(await _(800),document.querySelector(e.reload.discount.name)!=null){let n=document.querySelector(e.reload.discount.name).innerHTML,d=e.reload.discount.split.length;for(let a=0;a<d;a++)if(n.split(e.reload.discount.split[a].string)[e.reload.discount.split[a].index]!=null)n=n.split(e.reload.discount.split[a].string)[e.reload.discount.split[a].index];else{n="";break}n=n.replaceAll(",","");try{isNaN(n)&&(n=0),n=parseFloat(n)}catch{n=""}return{type:"dis",dis:n}}else if(document.querySelector(e.reload.cpn_message.name)!=null){let n=document.querySelector(e.reload.cpn_message.name).innerHTML,d=e.reload.cpn_message.split.length;for(let a=0;a<d;a++)if(n.split(e.reload.cpn_message.split[a].string)[e.reload.cpn_message.split[a].index]!=null)n=n.split(e.reload.cpn_message.split[a].string)[e.reload.cpn_message.split[a].index];else{n="";break}return{type:"msg",msg:n}}}catch(n){throw new Error(n.message)}}async function St(e){try{let t=await A(e);return""}catch{return""}}async function kt(e){try{document.querySelector(e.automatic.coupon_click.name).click(),await _(1e3);let t=0,n=document.querySelectorAll("div.coupon-base-validCouponContainer > div:not(.coupon-base-expiredCoupon) > div.coupon-base-infoContainer > div.coupon-base-benefit > span.coupon-base-amount");for(let d=0;d<n.length;d++)t+=parseFloat(n[d].innerText);return t}catch{return 0}}async function bt(e,t){var n,d,a,l,p,h,f;try{let S=0;if(y==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((n=document.querySelector(e.isLogin))==null?void 0:n.style.display)!="none"){y=1;let u=q.url;throw u=u.split("//"),u=u[1],u=u.split("/"),u=u[0],M(!1),new Error("Login Required")}e.automatic.coupon_click.name!=""&&document.querySelector(e.automatic.coupon_click.name)!=null&&S==0&&(document.querySelector(e.automatic.coupon_click.name).click(),S=1,e.automatic.coupon_click.wait&&await _(1e3));let m=0;for(;e.automatic.coupon_value.name!=""&&!document.querySelector(e.automatic.coupon_value.name);){if(e.automatic.coupon_click.name!=""&&document.querySelector(e.automatic.coupon_click.name)&&S==0&&(document.querySelector(e.automatic.coupon_click.name).click(),S=1),y==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((d=document.querySelector(e.isLogin))==null?void 0:d.style.display)!="none"){y=1;let u=q.url;throw u=u.split("//"),u=u[1],u=u.split("/"),u=u[0],M(!1),new Error("Login Required")}m++,m%4==0&&(S=0,m=0),await _(500)}if(y==1)return;if(e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((a=document.querySelector(e.isLogin))==null?void 0:a.style.display)!="none"){y=1;let u=q.url;throw u=u.split("//"),u=u[1],u=u.split("/"),u=u[0],M(!1),new Error("Login Required")}let c=document.querySelector(e.automatic.coupon_value.name);if(c.focus(),!c)return;if(c.click(),c.focus(),c.select(),document.execCommand("insertText",!1,"")||(c.value="new text"),c.dispatchEvent(new Event("change",{bubbles:!0})),await He(c,t,e),e.automatic.coupon_value.wait!=!1&&(e.automatic.coupon_value.wait==!0?await _(1e3):await _(e.automatic.coupon_value.wait)),e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((l=document.querySelector(e.isLogin))==null?void 0:l.style.display)!="none"){y=1;let u=q.url;throw u=u.split("//"),u=u[1],u=u.split("/"),u=u[0],M(!1),new Error("Login Required")}if(m=0,y==1)return;if(e.interceptor_api==""&&e.sync!=null)for(;e.automatic.apply_button.name!=""&&!document.querySelector(e.automatic.apply_button.name)||m<3;){if(e.automatic.apply_button.name!=""&&document.querySelector(e.automatic.apply_button.name)?m++:m=0,e.isLogin!=null&&document.querySelector(e.islogin)!=null&&document.querySelector(e.isLogin).style.display!="none"){y=1;let u=q.url;throw u=u.split("//"),u=u[1],u=u.split("/"),u=u[0],M(!1),new Error("Login Required")}if(y==1)return;await _(500)}else for(;e.automatic.apply_button.name!=""&&!document.querySelector(e.automatic.apply_button.name);){if(e.automatic.apply_button.name!=""&&document.querySelector(e.automatic.apply_button.name)?m++:m=0,e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((p=document.querySelector(e.isLogin))==null?void 0:p.style.display)!="none"){y=1;let u=q.url;throw u=u.split("//"),u=u[1],u=u.split("/"),u=u[0],M(!1),new Error("Login Required")}if(y==1)return;await _(500)}if(y==1)return;if(e.reload!=null&&await D.setItem("buyhatke"+I,JSON.stringify(r)),document.querySelector(e.automatic.apply_button.name).click(),e.automatic.apply_button.wait!=!1&&(e.automatic.apply_button.wait==!0?await _(1e3):await _(e.automatic.apply_button.wait)),e.isLogin!=null&&document.querySelector(e.isLogin)!=null&&((h=document.querySelector(e.isLogin))==null?void 0:h.style.display)!="none"){y=1;let u=q.url;throw u=u.split("//"),u=u[1],u=u.split("/"),u=u[0],M(!1),new Error("Login Required")}if(y==1||e.sync!=null&&e.interceptor_api=="")return;if(e.reload!=null)for(;;)await _(3e3),e.reload!=null&&await D.setItem("buyhatke"+I,JSON.stringify(r)),document.querySelector(e.automatic.apply_button.name)&&document.querySelector(e.automatic.apply_button.name).click();if(y==1)return;let i=document.querySelectorAll("div.coupon-base-validCouponContainer > div:not(.coupon-base-expiredCoupon) > div.coupon-base-checkBoxContainer > div.coupon-base-customCheckbox > span.coupon-base-labelUnchecked");for(let u=0;u<i.length;u++)i[u].click();await _(1e3),(f=document.querySelector("button#applyCoupon"))==null||f.click()}catch(S){throw new Error(S.message)}}function Ct(){(document.readyState==="interactive"||document.readyState==="complete")&&(clearInterval(vt),window!=window.top,fe())}const vt=setInterval(Ct,500);export{D as a,At as b,Lt as c,Me as d,it as e,xt as g,oe as i,r as l};
