class gc{constructor(t){this.dbName=t.dbName,this.storeName=t.storeName,this.version=t.version??1,this.upgradeHandler=t.onUpgrade??(r=>{r.objectStoreNames.contains(this.storeName)||r.createObjectStore(this.storeName,{keyPath:"key"})}),this.isSupported=typeof indexedDB<"u",this.dbPromise=null}openDB(){return this.isSupported?new Promise((t,r)=>{const i=indexedDB.open(this.dbName,this.version);i.onupgradeneeded=a=>{const s=i.result;this.upgradeHandler(s,a.oldVersion,a.newVersion)},i.onsuccess=()=>t(i.result),i.onerror=()=>r(i.error??new Error("IndexedDB open error"))}):Promise.reject(new Error("IndexedDB is not supported in this environment"))}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async get(t){if(!this.isSupported)return;const r=await this.getDB();return new Promise((i,a)=>{const l=r.transaction(this.storeName,"readonly").objectStore(this.storeName).get(t);l.onsuccess=()=>{const c=l.result;c&&typeof c=="object"&&"value"in c?i(c.value):i(c)},l.onerror=()=>a(l.error??new Error("IndexedDB get error"))})}async set(t,r){if(!this.isSupported)return;const i=await this.getDB();return new Promise((a,s)=>{const o=i.transaction(this.storeName,"readwrite");o.objectStore(this.storeName).put({key:t,value:r}),o.oncomplete=()=>a(),o.onerror=()=>s(o.error??new Error("IndexedDB set transaction error"))})}async delete(t){if(!this.isSupported)return;const r=await this.getDB();return new Promise((i,a)=>{const s=r.transaction(this.storeName,"readwrite");s.objectStore(this.storeName).delete(t),s.oncomplete=()=>i(),s.onerror=()=>a(s.error??new Error("IndexedDB delete transaction error"))})}async clear(){if(!this.isSupported)return;const t=await this.getDB();return new Promise((r,i)=>{const a=t.transaction(this.storeName,"readwrite");a.objectStore(this.storeName).clear(),a.oncomplete=()=>r(),a.onerror=()=>i(a.error??new Error("IndexedDB clear transaction error"))})}}const as=new gc({dbName:"chatAssistantDB",storeName:"chatHistory",version:1,onUpgrade:(e,t,r)=>{e.objectStoreNames.contains("chatHistory")||e.createObjectStore("chatHistory",{keyPath:"key"})}});let kc="BO8_Gm4O4tOivltbZImpbwXGFcI4GVM_48tP2_tSbn4kvjV-m21VZp6hnfG473o30NoYEpUlo568mOpq9bA7pnk",xc=Tc(kc);var Vr={},Wr=[],vc={},Ga={},yr=[],Ac=chrome.runtime.getManifest(),Ws=Ac.version;function Kr(){var e=Math.floor(Math.random()*9007199254740992)+1;return e.toString()}function Tc(e){const t="=".repeat((4-e.length%4)%4),r=(e+t).replace(/-/g,"+").replace(/_/g,"/"),i=atob(r),a=new Uint8Array(i.length);for(let s=0;s<i.length;++s)a[s]=i.charCodeAt(s);return a}async function _c(e,t){try{let i=navigator.userAgent.match(/Chrome\/(\d+\.\d+\.\d+\.\d+)/);return i&&i[1].split(".").length==4?i[1]:""}catch(r){return t("getChromeFunction",r),await e("errorGettingChromeVerison"),""}}async function Po(e,t,r,i,a,s){try{s.tl=await a.getItem("tl"),(!s.tl||s.tl==""||Object.keys(s.tl).length==0)&&await a.setItem("tl",JSON.stringify({})),s.wlswji=await a.getItem("wlswji"),(!s.wlswji||s.wlswji==""||s.wlswji==null||Object.keys(s.wlswji).length==0)&&await a.setItem("wlswji",JSON.stringify({})),s.sourceSent=await a.getItem("sourceSent"),(s.sourceSent==""||typeof s.sourceSent>"u"||Object.keys(s.sourceSent).length==0)&&await a.setItem("sourceSent",0),s.version=await a.getItem("version"),(s.version!=Ws||Object.keys(s.version).length==0)&&(r("updated-version-"+Ws),await a.setItem("version",Ws));const f=[{key:"Price Comparison Top Bar",value:1,transKey:"priceComparison"},{key:"Price Graph History",value:1,transKey:"priceHistory"},{key:"Price Alert Button",value:1,transKey:"priceAlert"},{key:"Spend Lens Button",value:1,transKey:"spendLens"},{key:"Coupons and Deals Tab",value:1,transKey:"coupon"},{key:"Apply Coupons automatically",value:1,transKey:"autoCoupons"},{key:"Ditto Button",value:1,transKey:"ditto"}];s.featuresArray=await a.getItem("featuresArray");let p=[];try{p=s.featuresArray?JSON.parse(s.featuresArray):[]}catch{p=[]}(s.featuresArray==null||p.length==0||p.some(I=>!I.transKey))&&await a.setItem("featuresArray",JSON.stringify(f)),s.first=await a.getItem("first"),s.features_json=await a.getItem("features_json"),(s.features_json==null||Object.keys(s.features_json).length==0)&&await a.setItem("features_json","[0,0,0,0,0]"),s.subscribedFor=await a.getItem("subscribedFor"),(s.subscribedFor==null||Object.keys(s.subscribedFor).length==0)&&await a.setItem("subscribedFor",""),s.saleArray=await a.getItem("saleArray"),(s.saleArray==null||Object.keys(s.saleArray).length==0)&&await a.setItem("saleArray",""),s.saleFinished=await a.getItem("saleFinished"),(s.saleFinished==null||Object.keys(s.saleFinished).length==0)&&await a.setItem("saleFinished",0),s.saleStarted=await a.getItem("saleStarted"),(s.saleStarted==null||Object.keys(s.saleStarted).length==0)&&await a.setItem("saleStarted",0),s.refreshedYet=await a.getItem("refreshedYet"),(s.refreshedYet==null||Object.keys(s.refreshedYet).length==0)&&await a.setItem("refreshedYet",0),s.specialTab=await a.getItem("specialTab"),(s.specialTab==null||Object.keys(s.specialTab).length==0)&&await a.setItem("specialTab",""),s.mostSensitive=await a.getItem("mostSensitive"),(s.mostSensitive==null||Object.keys(s.mostSensitive).length==0)&&await a.setItem("mostSensitive",""),s.instructions=await a.getItem("instructions"),(s.instructions==null||Object.keys(s.instructions).length==0)&&await a.setItem("instructions",""),s.diffTime=await a.getItem("diffTime"),(s.diffTime==null||Object.keys(s.diffTime).length==0)&&await a.setItem("diffTime",0),s.activeSale=await a.getItem("activeSale"),(s.activeSale==null||Object.keys(s.activeSale).length==0)&&await a.setItem("activeSale",0),s.email_lucky=await a.getItem("email_lucky"),(s.email_lucky==null||Object.keys(s.email_lucky).length==0)&&await a.setItem("email_lucky",""),s.email_sent=await a.getItem("email_sent"),(s.email_sent==null||Object.keys(s.email_sent).length==0)&&await a.setItem("email_sent",0),s.phoneNo=await a.getItem("phoneNo"),(s.phoneNo==null||Object.keys(s.phoneNo).length==0)&&await a.setItem("phoneNo",""),s.myName=await a.getItem("myName"),(s.myName==null||Object.keys(s.myName).length==0)&&await a.setItem("myName",""),s.emailEbay=await a.getItem("emailEbay"),(s.emailEbay==null||Object.keys(s.emailEbay).length==0)&&await a.setItem("emailEbay",""),s.bankBox1=await a.getItem("bankBox1"),(s.bankBox1==null||Object.keys(s.bankBox1).length==0)&&await a.setItem("bankBox1",""),s.bankBox2=await a.getItem("bankBox2"),(s.bankBox2==null||Object.keys(s.bankBox2).length==0)&&await a.setItem("bankBox2",""),s.bankBox3=await a.getItem("bankBox3"),(s.bankBox3==null||Object.keys(s.bankBox3).length==0)&&await a.setItem("bankBox3",""),s.bankBox4=await a.getItem("bankBox4"),(s.bankBox4==null||Object.keys(s.bankBox4).length==0)&&await a.setItem("bankBox4",""),s.verifiedExt=await a.getItem("verifiedExt"),(s.verifiedExt==null||Object.keys(s.verifiedExt).length==0)&&await a.setItem("verifiedExt",0),s.listNotIDs=await a.getItem("listNotIDs"),(s.listNotIDs==null||Object.keys(s.listNotIDs).length==0)&&await a.setItem("listNotIDs",""),s.lastTime=await a.getItem("lastTime"),(s.lastTime===void 0||Object.keys(s.lastTime).length==0)&&await a.setItem("lastTime",0),s.blockList=await a.getItem("blockList"),(s.blockList===void 0||Object.keys(s.blockList).length==0)&&await a.setItem("blockList",""),s.mywishlist=await a.getItem("mywishlist"),(s.mywishlist==null||s.mywishlist.trim()==""||s.mywishlist.trim()=="[]"||Object.keys(s.mywishlist).length==0)&&await a.setItem("mywishlist",""),s.searchTesting=await a.getItem("searchTesting"),(typeof s.searchTesting>"u"||s.searchTesting==""||s.searchTesting=="[]"||Object.keys(s.searchTesting).length==0)&&await a.setItem("searchTesting",0),s.flashSale=await a.getItem("flashSale"),(s.flashSale==null||s.flashSale==""||Object.keys(s.flashSale).length==0)&&await a.setItem("flashSale",JSON.stringify([{key:"Mi5",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#MI5",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Gold",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Silver",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Dark Grey",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 32 GB, Gold",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Mi Powerbank",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#MIPOWER20000",startsAt:1464165e3},{key:"Redmi Note 3, 32 GB, Grey",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3}]));var o=await a.getItem("flashSale");o=JSON.parse(o);for(let I=0;I<o.length;I++)o[I].startsAt=1464165e3;await a.setItem("flashSale",JSON.stringify(o)),o=await a.getItem("flashSale"),o=JSON.parse(o);let u=o.length;var l={};u==6&&(l.key="Redmi Note 3, 32 GB, Grey",l.value=0,l.url="http://www.mi.com/in/hdindex/openbuy/#HM3A",l.startsAt=1464165e3,o.push(l)),s.tokenSent=await a.getItem("tokenSent"),(s.tokenSent==null||s.tokenSent==""||Object.keys(s.tokenSent).length==0)&&(await a.setItem("tokenSent",0),s.tokenSent=0),s.salesArray=await a.getItem("salesArray"),(s.salesArray==null||Object.keys(s.salesArray).length==0)&&await a.setItem("salesArray",JSON.stringify([{key:"Paytm Sale",value:0},{key:"American Swan Sale",value:0}])),s.promoPushArray=await a.getItem("promoPushArray"),(s.promoPushArray==null||s.promoPushArray==""||Object.keys(s.promoPushArray).length==0)&&await a.setItem("promoPushArray",JSON.stringify([{key:"SUBSCRIBE TO PROMOTIONAL PUSH MESSAGES:",value:1},{key:"10:00 AM - 09:00 PM",value:1},{key:"09:00 PM - 10:00 AM",value:1},{key:"Live Offer Updates (1st- 6th Oct)",value:1}])),s.promoPushArray=await a.getItem("promoPushArray");var c=s.promoPushArray;c=JSON.parse(c),c.length<4&&(c.push({key:"Live Offer Updates (1st- 6th Oct)",value:1}),c=JSON.stringify(c),await a.setItem("promoPushArray",c)),s.noIDs=await a.getItem("noIDs"),(s.noIDs==null||Object.keys(s.noIDs).length==0)&&await a.setItem("noIDs",0),await a.setItem("saleMonitor",0),await a.setItem("timeRemaining",1e11),s.checkedArray=await a.getItem("checkedArray"),(s.checkedArray==null||s.checkedArray==""||Object.keys(s.checkedArray).length==0)&&await a.setItem("checkedArray","{}"),s.openTimeHash=await a.getItem("openTimeHash"),(s.openTimeHash==null||s.openTimeHash==""||Object.keys(s.openTimeHash).length==0)&&await a.setItem("openTimeHash","{}"),s.flagBL=await a.getItem("flagBL"),(s.flagBL==null||s.flagBL==""||Object.keys(s.flagBL).length==0)&&await a.setItem("flagBL",0),await a.setItem("flagBL",0),s.tabAssignedHash=await a.getItem("tabAssignedHash"),(s.tabAssignedHash==null||s.tabAssignedHash==""||Object.keys(s.tabAssignedHash).length==0)&&await a.setItem("tabAssignedHash","{}"),s.ext_id=await a.getItem("ext_id"),s.actBL=await a.getItem("actBL"),s.ext_id&&parseInt(s.ext_id)>264e4?(s.actBL==""||typeof s.actBL>"u"||Object.keys(s.actBL).length==0)&&await a.setItem("actBL",0):await a.setItem("actBL",85),s.ext_auth=await a.getItem("ext_auth"),s.isVerified=await a.getItem("isVerified"),s.verifiedExt=await a.getItem("verifiedExt"),s.verifiedExt==1&&s.isVerified!=1?(s.isVerified=1,await a.setItem("isVerified",1)):s.isVerified==1&&s.verifiedExt!=1?(s.verifiedExt=1,await a.setItem("verifiedExt",1)):(typeof s.isVerified>"u"||Object.keys(s).length==0)&&(s.isVerified=0,await a.setItem("isVerified",0));var d=yr.length;setTimeout(async function(){await Oo(i,t,a)},5e3),Array.isArray(yr)&&yr.length>0?(await a.setItem("noIDs",yr.length),chrome.gcm.register(yr,registerCallback)):await a.setItem("noIDs",0)}catch(f){e("initLocalStorage",Po),t("At initLocalStorage ",f)}}async function Oo(e,t,r){try{let i=await self.registration.pushManager.getSubscription(),a=JSON.parse(await r.getItem("web_push_subscription")||"{}");if(a.subscription&&(a=a.subscription),!i||i&&a&&i.endpoint!=a.endpoint){let s=(await _c(e,t)).split(".")[0],o=!1;(s==""||s<=122)&&(o=!0);let l=await self.registration.pushManager.subscribe({userVisibleOnly:o,applicationServerKey:xc});await r.setItem("web_push_subscription",JSON.stringify({subscription:l,userVisibleOnly:o})),await r.setItem("can_send_wp_subscription",1),await Sc(l,o,t,r)&&await r.setItem("can_send_wp_subscription",0)}}catch(i){t("Subscribe error: ",i)}}async function Sc(e,t,r,i){try{let a=await i.getItem("ext_id"),s=await i.getItem("ext_auth"),o=`https://ext1.buyhatke.com/extension-apis/updateSubscriptions?extId=${a}&extAuth=${s}`,l=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:e,userVisibleOnly:t})});return l=await l.json(),l.status==1}catch(a){return r("sendSubscriptionToServer",a),!1}}function Pc(e,t,r,i,a,s){try{if(e=="")e=chrome.runtime.getURL("logo_128x128.png");else var o={type:"basic",title:t,message:r,iconUrl:e,priority:100,requireInteraction:!0};var l=i,c=s;Vr[c]=a,chrome.notifications.create(c,o,function(d){Wr.push({notfID:d,URL:i}),chrome.storage.local.get("paNotifsLinkArr",function(f){if(f.paNotifsLinkArr)f.paNotifsLinkArr.push({notfID:d,URL:i}),f.paNotifsLinkArr.length>50&&(f.paNotifsLinkArr=f.paNotifsLinkArr.slice(-50)),chrome.storage.local.set({paNotifsLinkArr:f.paNotifsLinkArr},function(){});else{let p=[{notfID:d,URL:i}];chrome.storage.local.set({paNotifsLinkArr:p},function(){})}})})}catch{}}function Oc(e,t,r,i,a){try{if(e=="")e=chrome.runtime.getURL("logo_128x128.png");else var s={type:"basic",title:t,message:r,iconUrl:e,priority:100,requireInteraction:!0};var o=i,l=Kr();Vr[l]=a,chrome.notifications.create(l,s,function(c){Wr.push({notfID:c,URL:i}),chrome.storage.local.get("paNotifsLinkArr",function(d){if(d.paNotifsLinkArr)d.paNotifsLinkArr.push({notfID:c,URL:i}),d.paNotifsLinkArr.length>50&&(d.paNotifsLinkArr=d.paNotifsLinkArr.slice(-50)),chrome.storage.local.set({paNotifsLinkArr:d.paNotifsLinkArr},function(){});else{let f=[{notfID:c,URL:i}];chrome.storage.local.set({paNotifsLinkArr:f},function(){})}})})}catch{}}async function pn(e,t,r,i,a,s,o){try{var l=await o.getItem("promoPushArray"),c=new Date,d=c.getHours();if(l=JSON.parse(l),l[0].value==0||l[1].value==0&&l[2].value==0)return;var f=0;if(!(l[1].value==1&&l[2].value==1)){if(l[1].value==1){if(!(d>=10&&d<21)){setTimeout(function(){pn(e,t,r,i,a,s,o)},18e5);return}}else if(l[1].value==1&&!(d<10||d>=21)){setTimeout(function(){pn(e,t,r,i,a,s,o)},18e5);return}}var p={type:"basic",title:e,message:t,iconUrl:chrome.runtime.getURL("logo_128x128.png"),priority:100,requireInteraction:!0},u=r,I=Kr();Vr[I]=i,chrome.notifications.create(I,p,function(k){Wr.push({notfID:k,URL:r})})}catch(k){a("notify",k),s("Error in notify ",k)}}async function fn(e,t,r,i,a,s,o,l,c){try{var d=await c.getItem("promoPushArray");if(d=JSON.parse(d),s=="")s="Claim Offer";else if(d[3].value==0)return;var f=new Date,p=f.getHours();if(p=Math.floor(p),d[0].value==0||d[1].value==0&&d[2].value==0)return;var u=0;if(!(d[1].value==1&&d[2].value==1)){if(d[1].value==1){if(!(p>=10&&p<21)){s=="Check Updated Offers"&&setTimeout(function(){fn(e,t,r,i,a,s,o,l,c)},18e5);return}}else if(d[2].value==1&&!(p<10||p>=21)){s=="Check Updated Offers"&&setTimeout(function(){fn(e,t,r,i,a,s,o,l,c)},18e5);return}}var I={type:"basic",title:t,message:r,buttons:[{title:s},{title:"Push Settings"}],iconUrl:e,priority:100,requireInteraction:!0},k=i,y=Kr();Vr[y]=a,vc[y]=i,chrome.notifications.create(y,I,function(b){Wr.push({notfID:b,URL:i})})}catch(b){o("notifyIcon",b),l("Error in notifyIcon ",b)}}async function hn(e,t,r,i,a,s,o,l){try{var c=await l.getItem("promoPushArray"),d=new Date,f=d.getHours();if(c=JSON.parse(c),c[0].value==0||c[1].value==0&&c[2].value==0)return;var p=0;if(!(c[1].value==1&&c[2].value==1)){if(c[1].value==1){if(!(f>=10&&f<21)){setTimeout(function(){hn(e,t,r,i,a,s,o,l)},18e5);return}}else if(c[1].value==1&&!(f<10||f>=21)){setTimeout(function(){hn(e,t,r,i,a,s,o,l)},18e5);return}}var u={type:"image",title:t,imageUrl:e,message:r,iconUrl:chrome.runtime.getURL("logo_128x128.png"),priority:100},I=i,k=Kr();Vr[k]=a,chrome.notifications.create(k,u,function(y){Wr.push({notfID:y,URL:i})})}catch(y){s("notifyImage",y),o("Error in notifyImage ",y)}}function Do(e,t,r,i,a){r!==void 0||(r=""),r=Kr(),chrome.notifications.create(r,e,function(s){Ga[s]!==void 0&&clearTimeout(Ga[s].timer),Ga[s]={listeners:t,timer:setTimeout(function(){Lo(s,function(o){o&&Do(e,t,s)})},5e3)}})}function Lo(e,t){Ga[e]!==void 0&&(clearTimeout(Ga[e].timer),delete Ga[e]),chrome.notifications.clear(e,function(r){t&&t(r)})}chrome&&chrome.contextMenus&&chrome.contextMenus.onClicked&&(chrome.runtime.onInstalled.addListener(async()=>{chrome.contextMenus.create({id:"bh-menu",title:"Compare prices on Buyhatke",type:"normal",contexts:["selection"]})}),chrome.contextMenus.onClicked.addListener((e,t)=>{e.menuItemId;const r=new URL("https://www.google.com/search?q=site%3Abuyhatke.com+"+encodeURIComponent(e.selectionText));chrome.tabs.create({url:r.href,index:t.index+1})}));const Eo=Object.freeze(Object.defineProperty({__proto__:null,createNotification:Do,destroyNotification:Lo,initLocalStorage:Po,notify:pn,notifyIcon:fn,notifyImage:hn,notifyPAImage:Oc,notifyPAOffers:Pc,subscribe:Oo},Symbol.toStringTag,{value:"Module"}));var Dc=[],Lc=chrome.runtime.getManifest(),Ks=Lc.version;async function Ec(e,t,r,i,a,s){try{s.tl=await a.getItem("tl"),(!s.tl||s.tl==""||s.tl==="undefined"||Object.keys(s.tl).length==0)&&await a.setItem("tl",JSON.stringify({})),s.wlswji=await a.getItem("wlswji"),(!s.wlswji||s.wlswji==""||s.wlswji==null||s.wlswji==="undefined"||Object.keys(s.wlswji).length==0)&&await a.setItem("wlswji",JSON.stringify({})),s.sourceSent=await a.getItem("sourceSent"),(s.sourceSent==""||typeof s.sourceSent>"u"||s.sourceSent==="undefined"||Object.keys(s.sourceSent).length==0)&&await a.setItem("sourceSent",0),s.version=await a.getItem("version"),(s.version!=Ks||Object.keys(s.version).length==0)&&(r("updated-version-"+Ks),await a.setItem("version",Ks)),s.featuresArray=await a.getItem("featuresArray"),(s.featuresArray==null||s.featuresArray==="undefined"||Object.keys(s.featuresArray).length==0)&&await a.setItem("featuresArray",JSON.stringify([{key:"Price Comparison Top Bar",value:1,transKey:"priceComparison"},{key:"Price Graph History",value:1,transKey:"priceHistory"},{key:"Price Alert Button",value:1,transKey:"priceAlert"},{key:"Spend Lens Button",value:1,transKey:"spendLens"},{key:"Coupons and Deals Tab",value:1,transKey:"coupon"},{key:"Apply Coupons automatically",value:1,transKey:"autoCoupons"},{key:"Ditto Button",value:1,transKey:"ditto"}])),s.first=await a.getItem("first"),s.features_json=await a.getItem("features_json"),(s.features_json==null||s.features_json==="undefined"||Object.keys(s.features_json).length==0)&&await a.setItem("features_json","[0,0,0,0,0]"),s.subscribedFor=await a.getItem("subscribedFor"),(s.subscribedFor==null||s.subscribedFor==="undefined"||Object.keys(s.subscribedFor).length==0)&&await a.setItem("subscribedFor",""),s.saleArray=await a.getItem("saleArray"),(s.saleArray==null||s.saleArray==="undefined"||Object.keys(s.saleArray).length==0)&&await a.setItem("saleArray",""),s.saleFinished=await a.getItem("saleFinished"),(s.saleFinished==null||s.saleFinished==="undefined"||Object.keys(s.saleFinished).length==0)&&await a.setItem("saleFinished",0),s.saleStarted=await a.getItem("saleStarted"),(s.saleStarted==null||s.saleStarted==="undefined"||Object.keys(s.saleStarted).length==0)&&await a.setItem("saleStarted",0),s.refreshedYet=await a.getItem("refreshedYet"),(s.refreshedYet==null||s.refreshedYet==="undefined"||Object.keys(s.refreshedYet).length==0)&&await a.setItem("refreshedYet",0),s.specialTab=await a.getItem("specialTab"),(s.specialTab==null||s.specialTab==="undefined"||Object.keys(s.specialTab).length==0)&&await a.setItem("specialTab",""),s.mostSensitive=await a.getItem("mostSensitive"),(s.mostSensitive==null||s.mostSensitive==="undefined"||Object.keys(s.mostSensitive).length==0)&&await a.setItem("mostSensitive",""),s.instructions=await a.getItem("instructions"),(s.instructions==null||s.instructions==="undefined"||Object.keys(s.instructions).length==0)&&await a.setItem("instructions",""),s.diffTime=await a.getItem("diffTime"),(s.diffTime==null||s.diffTime==="undefined"||Object.keys(s.diffTime).length==0)&&await a.setItem("diffTime",0),s.activeSale=await a.getItem("activeSale"),(s.activeSale==null||s.activeSale==="undefined"||Object.keys(s.activeSale).length==0)&&await a.setItem("activeSale",0),s.email_lucky=await a.getItem("email_lucky"),(s.email_lucky==null||s.email_lucky==="undefined"||Object.keys(s.email_lucky).length==0)&&await a.setItem("email_lucky",""),s.email_sent=await a.getItem("email_sent"),(s.email_sent==null||s.email_sent==="undefined"||Object.keys(s.email_sent).length==0)&&await a.setItem("email_sent",0),s.phoneNo=await a.getItem("phoneNo"),(s.phoneNo==null||s.phoneNo==="undefined"||Object.keys(s.phoneNo).length==0)&&await a.setItem("phoneNo",""),s.myName=await a.getItem("myName"),(s.myName==null||s.myName==="undefined"||Object.keys(s.myName).length==0)&&await a.setItem("myName",""),s.emailEbay=await a.getItem("emailEbay"),(s.emailEbay==null||s.emailEbay==="undefined"||Object.keys(s.emailEbay).length==0)&&await a.setItem("emailEbay",""),s.bankBox1=await a.getItem("bankBox1"),(s.bankBox1==null||s.bankBox1==="undefined"||Object.keys(s.bankBox1).length==0)&&await a.setItem("bankBox1",""),s.bankBox2=await a.getItem("bankBox2"),(s.bankBox2==null||s.bankBox2==="undefined"||Object.keys(s.bankBox2).length==0)&&await a.setItem("bankBox2",""),s.bankBox3=await a.getItem("bankBox3"),(s.bankBox3==null||s.bankBox3==="undefined"||Object.keys(s.bankBox3).length==0)&&await a.setItem("bankBox3",""),s.bankBox4=await a.getItem("bankBox4"),(s.bankBox4==null||s.bankBox4==="undefined"||Object.keys(s.bankBox4).length==0)&&await a.setItem("bankBox4",""),s.verifiedExt=await a.getItem("verifiedExt"),(s.verifiedExt==null||s.verifiedExt==="undefined"||Object.keys(s.verifiedExt).length==0)&&await a.setItem("verifiedExt",0),s.listNotIDs=await a.getItem("listNotIDs"),(s.listNotIDs==null||s.listNotIDs==="undefined"||Object.keys(s.listNotIDs).length==0)&&await a.setItem("listNotIDs",""),s.lastTime=await a.getItem("lastTime"),(s.lastTime===void 0||s.lastTime==="undefined"||Object.keys(s.lastTime).length==0)&&await a.setItem("lastTime",0),s.blockList=await a.getItem("blockList"),(s.blockList===void 0||s.blockList==="undefined"||Object.keys(s.blockList).length==0)&&await a.setItem("blockList",""),s.mywishlist=await a.getItem("mywishlist"),(s.mywishlist==null||s.mywishlist==="undefined"||s.mywishlist.trim()==""||s.mywishlist.trim()=="[]"||Object.keys(s.mywishlist).length==0)&&await a.setItem("mywishlist",""),s.searchTesting=await a.getItem("searchTesting"),(typeof s.searchTesting>"u"||s.searchTesting==="undefined"||s.searchTesting==""||s.searchTesting=="[]"||Object.keys(s.searchTesting).length==0)&&await a.setItem("searchTesting",0),s.flashSale=await a.getItem("flashSale"),(s.flashSale==null||s.flashSale==="undefined"||s.flashSale==""||Object.keys(s.flashSale).length==0)&&await a.setItem("flashSale",JSON.stringify([{key:"Mi5",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#MI5",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Gold",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Silver",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Dark Grey",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 32 GB, Gold",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Mi Powerbank",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#MIPOWER20000",startsAt:1464165e3},{key:"Redmi Note 3, 32 GB, Grey",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3}]));var o=await a.getItem("flashSale");o=JSON.parse(o);for(let p=0;p<o.length;p++)o[p].startsAt=1464165e3;await a.setItem("flashSale",JSON.stringify(o)),o=await a.getItem("flashSale"),o=JSON.parse(o);let f=o.length;var l={};f==6&&(l.key="Redmi Note 3, 32 GB, Grey",l.value=0,l.url="http://www.mi.com/in/hdindex/openbuy/#HM3A",l.startsAt=1464165e3,o.push(l)),s.tokenSent=await a.getItem("tokenSent"),(s.tokenSent==null||s.tokenSent==="undefined"||s.tokenSent==""||Object.keys(s.tokenSent).length==0)&&(await a.setItem("tokenSent",0),s.tokenSent=0),s.salesArray=await a.getItem("salesArray"),(s.salesArray==null||s.salesArray==="undefined"||Object.keys(s.salesArray).length==0)&&await a.setItem("salesArray",JSON.stringify([{key:"Paytm Sale",value:0},{key:"American Swan Sale",value:0}])),s.promoPushArray=await a.getItem("promoPushArray"),(s.promoPushArray==null||s.promoPushArray==="undefined"||s.promoPushArray==""||Object.keys(s.promoPushArray).length==0)&&await a.setItem("promoPushArray",JSON.stringify([{key:"SUBSCRIBE TO PROMOTIONAL PUSH MESSAGES:",value:1},{key:"10:00 AM - 09:00 PM",value:1},{key:"09:00 PM - 10:00 AM",value:1},{key:"Live Offer Updates (1st- 6th Oct)",value:1}])),s.promoPushArray=await a.getItem("promoPushArray");var c=s.promoPushArray;c=JSON.parse(c),c.length<4&&(c.push({key:"Live Offer Updates (1st- 6th Oct)",value:1}),c=JSON.stringify(c),await a.setItem("promoPushArray",c)),s.noIDs=await a.getItem("noIDs"),(s.noIDs==null||Object.keys(s.noIDs).length==0)&&await a.setItem("noIDs",0),await a.setItem("saleMonitor",0),await a.setItem("timeRemaining",1e11),s.checkedArray=await a.getItem("checkedArray"),(s.checkedArray==null||s.checkedArray=="undefined"||s.checkedArray==""||Object.keys(s.checkedArray).length==0)&&await a.setItem("checkedArray","{}"),s.openTimeHash=await a.getItem("openTimeHash"),(s.openTimeHash==null||s.openTimeHash=="undefined"||s.openTimeHash==""||Object.keys(s.openTimeHash).length==0)&&await a.setItem("openTimeHash","{}"),s.flagBL=await a.getItem("flagBL"),(s.flagBL==null||s.flagBL=="undefined"||s.flagBL==""||Object.keys(s.flagBL).length==0)&&await a.setItem("flagBL",0),await a.setItem("flagBL",0),s.tabAssignedHash=await a.getItem("tabAssignedHash"),(s.tabAssignedHash==null||s.tabAssignedHash=="undefined"||s.tabAssignedHash==""||Object.keys(s.tabAssignedHash).length==0)&&await a.setItem("tabAssignedHash","{}"),s.ext_id=await a.getItem("ext_id"),s.actBL=await a.getItem("actBL"),s.ext_id&&parseInt(s.ext_id)>264e4?(s.actBL==""||typeof s.actBL>"u"||Object.keys(s.actBL).length==0)&&await a.setItem("actBL",0):await a.setItem("actBL",85),s.ext_auth=await a.getItem("ext_auth"),s.isVerified=await a.getItem("isVerified"),s.verifiedExt=await a.getItem("verifiedExt"),s.verifiedExt==1&&s.isVerified!=1?(s.isVerified=1,await a.setItem("isVerified",1)):s.isVerified==1&&s.verifiedExt!=1?(s.verifiedExt=1,await a.setItem("verifiedExt",1)):(typeof s.isVerified>"u"||Object.keys(s).length==0)&&(s.isVerified=0,await a.setItem("isVerified",0));var d=Dc.length;setTimeout(async function(){await No()},5e3),await a.setItem("noIDs",d)}catch(f){e("initLocalStorage",f),t("At initLocalStorage ",f)}}async function No(e,t,r){}function Nc(e,t,r,i,a,s){}function Mc(e,t,r,i,a){}async function Rc(e,t,r,i,a,s,o){}async function jc(e,t,r,i,a,s,o,l,c){}async function Uc(e,t,r,i,a,s,o,l){}function $c(e,t,r,i,a){}function Jc(e,t){}const Fc=Object.freeze(Object.defineProperty({__proto__:null,createNotification:$c,destroyNotification:Jc,initLocalStorage:Ec,notify:Rc,notifyIcon:jc,notifyImage:Uc,notifyPAImage:Mc,notifyPAOffers:Nc,subscribe:No},Symbol.toStringTag,{value:"Module"}));let Bc="BO8_Gm4O4tOivltbZImpbwXGFcI4GVM_48tP2_tSbn4kvjV-m21VZp6hnfG473o30NoYEpUlo568mOpq9bA7pnk",Hc=Kc(Bc);var zr={},Zr=[],Vc={},Ca={},rs=[],Wc=chrome.runtime.getManifest(),zs=Wc.version;function Xr(){var e=Math.floor(Math.random()*9007199254740992)+1;return e.toString()}function Kc(e){const t="=".repeat((4-e.length%4)%4),r=(e+t).replace(/-/g,"+").replace(/_/g,"/"),i=atob(r),a=new Uint8Array(i.length);for(let s=0;s<i.length;++s)a[s]=i.charCodeAt(s);return a}async function zc(e,t){try{let i=navigator.userAgent.match(/Chrome\/(\d+\.\d+\.\d+\.\d+)/);return i&&i[1].split(".").length==4?i[1]:""}catch(r){return t("getChromeFunction",r),await e("errorGettingChromeVerison"),""}}async function Mo(e,t,r,i,a,s){try{s.tl=await a.getItem("tl"),(!s.tl||s.tl==""||Object.keys(s.tl).length==0)&&await a.setItem("tl",JSON.stringify({})),s.wlswji=await a.getItem("wlswji"),(!s.wlswji||s.wlswji==""||s.wlswji==null||Object.keys(s.wlswji).length==0)&&await a.setItem("wlswji",JSON.stringify({})),s.sourceSent=await a.getItem("sourceSent"),(s.sourceSent==""||typeof s.sourceSent>"u"||Object.keys(s.sourceSent).length==0)&&await a.setItem("sourceSent",0),s.version=await a.getItem("version"),(s.version!=zs||Object.keys(s.version).length==0)&&(r("updated-version-"+zs),await a.setItem("version",zs)),s.featuresArray=await a.getItem("featuresArray"),(s.featuresArray==null||Object.keys(s.featuresArray).length==0)&&await a.setItem("featuresArray",JSON.stringify([{key:"Price Comparison Top Bar",value:1,transKey:"priceComparison"},{key:"Price Graph History",value:1,transKey:"priceHistory"},{key:"Price Alert Button",value:1,transKey:"priceAlert"},{key:"Spend Lens Button",value:1,transKey:"spendLens"},{key:"Coupons and Deals Tab",value:1,transKey:"coupon"},{key:"Apply Coupons automatically",value:1,transKey:"autoCoupons"},{key:"Ditto Button",value:1,transKey:"ditto"}])),s.first=await a.getItem("first"),s.features_json=await a.getItem("features_json"),(s.features_json==null||Object.keys(s.features_json).length==0)&&await a.setItem("features_json","[0,0,0,0,0]"),s.subscribedFor=await a.getItem("subscribedFor"),(s.subscribedFor==null||Object.keys(s.subscribedFor).length==0)&&await a.setItem("subscribedFor",""),s.saleArray=await a.getItem("saleArray"),(s.saleArray==null||Object.keys(s.saleArray).length==0)&&await a.setItem("saleArray",""),s.saleFinished=await a.getItem("saleFinished"),(s.saleFinished==null||Object.keys(s.saleFinished).length==0)&&await a.setItem("saleFinished",0),s.saleStarted=await a.getItem("saleStarted"),(s.saleStarted==null||Object.keys(s.saleStarted).length==0)&&await a.setItem("saleStarted",0),s.refreshedYet=await a.getItem("refreshedYet"),(s.refreshedYet==null||Object.keys(s.refreshedYet).length==0)&&await a.setItem("refreshedYet",0),s.specialTab=await a.getItem("specialTab"),(s.specialTab==null||Object.keys(s.specialTab).length==0)&&await a.setItem("specialTab",""),s.mostSensitive=await a.getItem("mostSensitive"),(s.mostSensitive==null||Object.keys(s.mostSensitive).length==0)&&await a.setItem("mostSensitive",""),s.instructions=await a.getItem("instructions"),(s.instructions==null||Object.keys(s.instructions).length==0)&&await a.setItem("instructions",""),s.diffTime=await a.getItem("diffTime"),(s.diffTime==null||Object.keys(s.diffTime).length==0)&&await a.setItem("diffTime",0),s.activeSale=await a.getItem("activeSale"),(s.activeSale==null||Object.keys(s.activeSale).length==0)&&await a.setItem("activeSale",0),s.email_lucky=await a.getItem("email_lucky"),(s.email_lucky==null||Object.keys(s.email_lucky).length==0)&&await a.setItem("email_lucky",""),s.email_sent=await a.getItem("email_sent"),(s.email_sent==null||Object.keys(s.email_sent).length==0)&&await a.setItem("email_sent",0),s.phoneNo=await a.getItem("phoneNo"),(s.phoneNo==null||Object.keys(s.phoneNo).length==0)&&await a.setItem("phoneNo",""),s.myName=await a.getItem("myName"),(s.myName==null||Object.keys(s.myName).length==0)&&await a.setItem("myName",""),s.emailEbay=await a.getItem("emailEbay"),(s.emailEbay==null||Object.keys(s.emailEbay).length==0)&&await a.setItem("emailEbay",""),s.bankBox1=await a.getItem("bankBox1"),(s.bankBox1==null||Object.keys(s.bankBox1).length==0)&&await a.setItem("bankBox1",""),s.bankBox2=await a.getItem("bankBox2"),(s.bankBox2==null||Object.keys(s.bankBox2).length==0)&&await a.setItem("bankBox2",""),s.bankBox3=await a.getItem("bankBox3"),(s.bankBox3==null||Object.keys(s.bankBox3).length==0)&&await a.setItem("bankBox3",""),s.bankBox4=await a.getItem("bankBox4"),(s.bankBox4==null||Object.keys(s.bankBox4).length==0)&&await a.setItem("bankBox4",""),s.verifiedExt=await a.getItem("verifiedExt"),(s.verifiedExt==null||Object.keys(s.verifiedExt).length==0)&&await a.setItem("verifiedExt",0),s.listNotIDs=await a.getItem("listNotIDs"),(s.listNotIDs==null||Object.keys(s.listNotIDs).length==0)&&await a.setItem("listNotIDs",""),s.lastTime=await a.getItem("lastTime"),(s.lastTime===void 0||Object.keys(s.lastTime).length==0)&&await a.setItem("lastTime",0),s.blockList=await a.getItem("blockList"),(s.blockList===void 0||Object.keys(s.blockList).length==0)&&await a.setItem("blockList",""),s.mywishlist=await a.getItem("mywishlist"),(s.mywishlist==null||s.mywishlist.trim()==""||s.mywishlist.trim()=="[]"||Object.keys(s.mywishlist).length==0)&&await a.setItem("mywishlist",""),s.searchTesting=await a.getItem("searchTesting"),(typeof s.searchTesting>"u"||s.searchTesting==""||s.searchTesting=="[]"||Object.keys(s.searchTesting).length==0)&&await a.setItem("searchTesting",0),s.flashSale=await a.getItem("flashSale"),(s.flashSale==null||s.flashSale==""||Object.keys(s.flashSale).length==0)&&await a.setItem("flashSale",JSON.stringify([{key:"Mi5",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#MI5",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Gold",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Silver",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 16 GB, Dark Grey",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Redmi Note 3, 32 GB, Gold",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3},{key:"Mi Powerbank",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#MIPOWER20000",startsAt:1464165e3},{key:"Redmi Note 3, 32 GB, Grey",value:0,url:"http://www.mi.com/in/hdindex/openbuy/#HM3A",startsAt:1464165e3}]));var o=await a.getItem("flashSale");o=JSON.parse(o);for(let p=0;p<o.length;p++)o[p].startsAt=1464165e3;await a.setItem("flashSale",JSON.stringify(o)),o=await a.getItem("flashSale"),o=JSON.parse(o);let f=o.length;var l={};f==6&&(l.key="Redmi Note 3, 32 GB, Grey",l.value=0,l.url="http://www.mi.com/in/hdindex/openbuy/#HM3A",l.startsAt=1464165e3,o.push(l)),s.tokenSent=await a.getItem("tokenSent"),(s.tokenSent==null||s.tokenSent==""||Object.keys(s.tokenSent).length==0)&&(await a.setItem("tokenSent",0),s.tokenSent=0),s.salesArray=await a.getItem("salesArray"),(s.salesArray==null||Object.keys(s.salesArray).length==0)&&await a.setItem("salesArray",JSON.stringify([{key:"Paytm Sale",value:0},{key:"American Swan Sale",value:0}])),s.promoPushArray=await a.getItem("promoPushArray"),(s.promoPushArray==null||s.promoPushArray==""||Object.keys(s.promoPushArray).length==0)&&await a.setItem("promoPushArray",JSON.stringify([{key:"SUBSCRIBE TO PROMOTIONAL PUSH MESSAGES:",value:1},{key:"10:00 AM - 09:00 PM",value:1},{key:"09:00 PM - 10:00 AM",value:1},{key:"Live Offer Updates (1st- 6th Oct)",value:1}])),s.promoPushArray=await a.getItem("promoPushArray");var c=s.promoPushArray;c=JSON.parse(c),c.length<4&&(c.push({key:"Live Offer Updates (1st- 6th Oct)",value:1}),c=JSON.stringify(c),await a.setItem("promoPushArray",c)),s.noIDs=await a.getItem("noIDs"),(s.noIDs==null||Object.keys(s.noIDs).length==0)&&await a.setItem("noIDs",0),await a.setItem("saleMonitor",0),await a.setItem("timeRemaining",1e11),s.checkedArray=await a.getItem("checkedArray"),(s.checkedArray==null||s.checkedArray==""||Object.keys(s.checkedArray).length==0)&&await a.setItem("checkedArray","{}"),s.openTimeHash=await a.getItem("openTimeHash"),(s.openTimeHash==null||s.openTimeHash==""||Object.keys(s.openTimeHash).length==0)&&await a.setItem("openTimeHash","{}"),s.flagBL=await a.getItem("flagBL"),(s.flagBL==null||s.flagBL==""||Object.keys(s.flagBL).length==0)&&await a.setItem("flagBL",0),await a.setItem("flagBL",0),s.tabAssignedHash=await a.getItem("tabAssignedHash"),(s.tabAssignedHash==null||s.tabAssignedHash==""||Object.keys(s.tabAssignedHash).length==0)&&await a.setItem("tabAssignedHash","{}"),s.ext_id=await a.getItem("ext_id"),s.actBL=await a.getItem("actBL"),s.ext_id&&parseInt(s.ext_id)>264e4?(s.actBL==""||typeof s.actBL>"u"||Object.keys(s.actBL).length==0)&&await a.setItem("actBL",0):await a.setItem("actBL",85),s.ext_auth=await a.getItem("ext_auth"),s.isVerified=await a.getItem("isVerified"),s.verifiedExt=await a.getItem("verifiedExt"),s.verifiedExt==1&&s.isVerified!=1?(s.isVerified=1,await a.setItem("isVerified",1)):s.isVerified==1&&s.verifiedExt!=1?(s.verifiedExt=1,await a.setItem("verifiedExt",1)):(typeof s.isVerified>"u"||Object.keys(s).length==0)&&(s.isVerified=0,await a.setItem("isVerified",0));var d=rs.length;setTimeout(async function(){await Ro(i,t,a)},5e3),Array.isArray(rs)&&rs.length>0?await a.setItem("noIDs",rs.length):await a.setItem("noIDs",0)}catch(f){e("initLocalStorage",Mo),t("At initLocalStorage ",f)}}async function Ro(e,t,r){try{let i=await self.registration.pushManager.getSubscription(),a=JSON.parse(await r.getItem("web_push_subscription")||"{}");if(a.subscription&&(a=a.subscription),!i||i&&a&&i.endpoint!=a.endpoint){let s=(await zc(e,t)).split(".")[0],o=!1;(s==""||s<=122)&&(o=!0);let l=await self.registration.pushManager.subscribe({userVisibleOnly:o,applicationServerKey:Hc});await r.setItem("web_push_subscription",JSON.stringify({subscription:l,userVisibleOnly:o})),await r.setItem("can_send_wp_subscription",1),await Zc(l,o,t,r)&&await r.setItem("can_send_wp_subscription",0)}}catch(i){t("Subscribe error: ",i)}}async function Zc(e,t,r,i){try{let a=await i.getItem("ext_id"),s=await i.getItem("ext_auth"),o=`https://ext1.buyhatke.com/extension-apis/updateSubscriptions?extId=${a}&extAuth=${s}`,l=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:e,userVisibleOnly:t})});return l=await l.json(),l.status==1}catch(a){return r("sendSubscriptionToServer",a),!1}}function Xc(e,t,r,i,a,s){try{if(e=="")e=chrome.runtime.getURL("logo_128x128.png");else var o={type:"basic",title:t,message:r,iconUrl:e,priority:100,requireInteraction:!0};var l=i,c=s;zr[c]=a,chrome.notifications.create(c,o,function(d){Zr.push({notfID:d,URL:i}),chrome.storage.local.get("paNotifsLinkArr",function(f){if(f.paNotifsLinkArr)f.paNotifsLinkArr.push({notfID:d,URL:i}),f.paNotifsLinkArr.length>50&&(f.paNotifsLinkArr=f.paNotifsLinkArr.slice(-50)),chrome.storage.local.set({paNotifsLinkArr:f.paNotifsLinkArr},function(){});else{let p=[{notfID:d,URL:i}];chrome.storage.local.set({paNotifsLinkArr:p},function(){})}})})}catch{}}function Yc(e,t,r,i,a){try{if(e=="")e=chrome.runtime.getURL("logo_128x128.png");else var s={type:"basic",title:t,message:r,iconUrl:e,priority:100,requireInteraction:!0};var o=i,l=Xr();zr[l]=a,chrome.notifications.create(l,s,function(c){Zr.push({notfID:c,URL:i}),chrome.storage.local.get("paNotifsLinkArr",function(d){if(d.paNotifsLinkArr)d.paNotifsLinkArr.push({notfID:c,URL:i}),d.paNotifsLinkArr.length>50&&(d.paNotifsLinkArr=d.paNotifsLinkArr.slice(-50)),chrome.storage.local.set({paNotifsLinkArr:d.paNotifsLinkArr},function(){});else{let f=[{notfID:c,URL:i}];chrome.storage.local.set({paNotifsLinkArr:f},function(){})}})})}catch{}}async function yn(e,t,r,i,a,s,o){try{var l=await o.getItem("promoPushArray"),c=new Date,d=c.getHours();if(l=JSON.parse(l),l[0].value==0||l[1].value==0&&l[2].value==0)return;var f=0;if(!(l[1].value==1&&l[2].value==1)){if(l[1].value==1){if(!(d>=10&&d<21)){setTimeout(function(){yn(e,t,r,i,a,s,o)},18e5);return}}else if(l[1].value==1&&!(d<10||d>=21)){setTimeout(function(){yn(e,t,r,i,a,s,o)},18e5);return}}var p={type:"basic",title:e,message:t,iconUrl:chrome.runtime.getURL("logo_128x128.png"),priority:100,requireInteraction:!0},u=r,I=Xr();zr[I]=i,chrome.notifications.create(I,p,function(k){Zr.push({notfID:k,URL:r})})}catch(k){a("notify",k),s("Error in notify ",k)}}async function mn(e,t,r,i,a,s,o,l,c){try{var d=await c.getItem("promoPushArray");if(d=JSON.parse(d),s=="")s="Claim Offer";else if(d[3].value==0)return;var f=new Date,p=f.getHours();if(p=Math.floor(p),d[0].value==0||d[1].value==0&&d[2].value==0)return;var u=0;if(!(d[1].value==1&&d[2].value==1)){if(d[1].value==1){if(!(p>=10&&p<21)){s=="Check Updated Offers"&&setTimeout(function(){mn(e,t,r,i,a,s,o,l,c)},18e5);return}}else if(d[2].value==1&&!(p<10||p>=21)){s=="Check Updated Offers"&&setTimeout(function(){mn(e,t,r,i,a,s,o,l,c)},18e5);return}}var I={type:"basic",title:t,message:r,buttons:[{title:s},{title:"Push Settings"}],iconUrl:e,priority:100,requireInteraction:!0},k=i,y=Xr();zr[y]=a,Vc[y]=i,chrome.notifications.create(y,I,function(b){Zr.push({notfID:b,URL:i})})}catch(b){o("notifyIcon",b),l("Error in notifyIcon ",b)}}async function wn(e,t,r,i,a,s,o,l){try{var c=await l.getItem("promoPushArray"),d=new Date,f=d.getHours();if(c=JSON.parse(c),c[0].value==0||c[1].value==0&&c[2].value==0)return;var p=0;if(!(c[1].value==1&&c[2].value==1)){if(c[1].value==1){if(!(f>=10&&f<21)){setTimeout(function(){wn(e,t,r,i,a,s,o,l)},18e5);return}}else if(c[1].value==1&&!(f<10||f>=21)){setTimeout(function(){wn(e,t,r,i,a,s,o,l)},18e5);return}}var u={type:"image",title:t,imageUrl:e,message:r,iconUrl:chrome.runtime.getURL("logo_128x128.png"),priority:100},I=i,k=Xr();zr[k]=a,chrome.notifications.create(k,u,function(y){Zr.push({notfID:y,URL:i})})}catch(y){s("notifyImage",y),o("Error in notifyImage ",y)}}function jo(e,t,r,i,a){r!==void 0||(r=""),r=Xr(),chrome.notifications.create(r,e,function(s){Ca[s]!==void 0&&clearTimeout(Ca[s].timer),Ca[s]={listeners:t,timer:setTimeout(function(){Uo(s,function(o){o&&jo(e,t,s)})},5e3)}})}function Uo(e,t){Ca[e]!==void 0&&(clearTimeout(Ca[e].timer),delete Ca[e]),chrome.notifications.clear(e,function(r){t&&t(r)})}const Qc=Object.freeze(Object.defineProperty({__proto__:null,createNotification:jo,destroyNotification:Uo,initLocalStorage:Mo,notify:yn,notifyIcon:mn,notifyImage:wn,notifyPAImage:Yc,notifyPAOffers:Xc,subscribe:Ro},Symbol.toStringTag,{value:"Module"})),Gc="/assets/ext_inactive-B-nkdQPw.png",Cc="/assets/ext_active-C5sMckP4.png";addEventListener("unhandledrejection",async e=>{Xn(e.reason)});addEventListener("error",async e=>{Xn(e.message)});addEventListener("onError",async e=>{Xn(e.message)});let W={},he={},Le={},Ie={},_e={},Da={},La={},Zs=chrome.runtime.id,_t=Eo;Zs.includes("Price-Tracker--Spend-Lens-Buyhatke")||Zs.includes("98B976E3G5")?_t=Fc:Zs.includes("Price-Comparison@buyhatke.com")?_t=Qc:_t=Eo;function qc(e){return new Promise(t=>{let r=setInterval(async()=>(clearInterval(r),t()),e)})}setInterval(function(){console.clear()},5*60*1e3);function eu(e,t){return!Number.isInteger(e)||!Number.isInteger(t)||e<0||t<0||t<e?0:t-e}let tu="",ut=[],Qt={},rt={},ht={},ra={};function Rt(e,t,r,i=0){try{i?rt[r][t]?rt[r][t][e]?rt[r][t][e]+=i:rt[r][t][e]=i:(rt[r][t]={},rt[r][t][e]=i):rt[r][t]?rt[r][t][e]?rt[r][t][e]+=1:rt[r][t][e]=1:(rt[r][t]={},rt[r][t][e]=1)}catch{}}function Xs(e,t,r){try{ht[r][t]?ht[r][t][e]||(ht[r][t][e]=Date.now()):(ht[r][t]={},e=="start_ms"||e=="end_ms"?ht[r][t][e]=Date.now():ht[r][t][e]+=2*Date.now()-ht[r][t][e])}catch{}}let bn={cartCheckPoints:{name:"checkoutPage",events:[{key:"thnksPage"},{TTL:10*60*1e3,key:"postUpdateDataNew",prev:"thnksPage"}],errorMessage:"errorCH"},ACCheckPoints:{name:"autoCouponPage",events:[{key:"acPage"},{TTL:15*60*1e3,key:"floatingBtn",prev:"acPage"}],errorMessage:"errorAC"}};var Ys=[],Qs=[],Ye=[],mr=[],hs=[],jt={},ct=[],_s={},au=[],ss=[],ns="",wt=0,Ui={},$i={},qa={},ys={},Ss={},Tt={},Ji=0,Fi=0,Bi="",ru=0,In="",Us=!1;let lt="";var is="2";let pa=null,wr=0,su=10,vt=null;var os={};let Zt=[];function J(...e){}Object.keys($i).length>100&&($i={});var Pr=function(e){var t=nu(ou(lu(iu(e),8*e.length)));return t.toLowerCase()};function nu(e){for(var t,r="0123456789ABCDEF",i="",a=0;a<e.length;a++)t=e.charCodeAt(a),i+=r.charAt(t>>>4&15)+r.charAt(15&t);return i}function iu(e){for(var t=Array(e.length>>2),r=0;r<t.length;r++)t[r]=0;for(r=0;r<8*e.length;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function ou(e){for(var t="",r=0;r<32*e.length;r+=8)t+=String.fromCharCode(e[r>>5]>>>r%32&255);return t}function lu(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,i=-271733879,a=-1732584194,s=271733878,o=0;o<e.length;o+=16){var l=r,c=i,d=a,f=s;i=kt(i=kt(i=kt(i=kt(i=gt(i=gt(i=gt(i=gt(i=It(i=It(i=It(i=It(i=bt(i=bt(i=bt(i=bt(i,a=bt(a,s=bt(s,r=bt(r,i,a,s,e[o+0],7,-680876936),i,a,e[o+1],12,-389564586),r,i,e[o+2],17,606105819),s,r,e[o+3],22,-1044525330),a=bt(a,s=bt(s,r=bt(r,i,a,s,e[o+4],7,-176418897),i,a,e[o+5],12,1200080426),r,i,e[o+6],17,-1473231341),s,r,e[o+7],22,-45705983),a=bt(a,s=bt(s,r=bt(r,i,a,s,e[o+8],7,1770035416),i,a,e[o+9],12,-1958414417),r,i,e[o+10],17,-42063),s,r,e[o+11],22,-1990404162),a=bt(a,s=bt(s,r=bt(r,i,a,s,e[o+12],7,1804603682),i,a,e[o+13],12,-40341101),r,i,e[o+14],17,-1502002290),s,r,e[o+15],22,1236535329),a=It(a,s=It(s,r=It(r,i,a,s,e[o+1],5,-165796510),i,a,e[o+6],9,-1069501632),r,i,e[o+11],14,643717713),s,r,e[o+0],20,-373897302),a=It(a,s=It(s,r=It(r,i,a,s,e[o+5],5,-701558691),i,a,e[o+10],9,38016083),r,i,e[o+15],14,-660478335),s,r,e[o+4],20,-405537848),a=It(a,s=It(s,r=It(r,i,a,s,e[o+9],5,568446438),i,a,e[o+14],9,-1019803690),r,i,e[o+3],14,-187363961),s,r,e[o+8],20,1163531501),a=It(a,s=It(s,r=It(r,i,a,s,e[o+13],5,-1444681467),i,a,e[o+2],9,-51403784),r,i,e[o+7],14,1735328473),s,r,e[o+12],20,-1926607734),a=gt(a,s=gt(s,r=gt(r,i,a,s,e[o+5],4,-378558),i,a,e[o+8],11,-2022574463),r,i,e[o+11],16,1839030562),s,r,e[o+14],23,-35309556),a=gt(a,s=gt(s,r=gt(r,i,a,s,e[o+1],4,-1530992060),i,a,e[o+4],11,1272893353),r,i,e[o+7],16,-155497632),s,r,e[o+10],23,-1094730640),a=gt(a,s=gt(s,r=gt(r,i,a,s,e[o+13],4,681279174),i,a,e[o+0],11,-358537222),r,i,e[o+3],16,-722521979),s,r,e[o+6],23,76029189),a=gt(a,s=gt(s,r=gt(r,i,a,s,e[o+9],4,-640364487),i,a,e[o+12],11,-421815835),r,i,e[o+15],16,530742520),s,r,e[o+2],23,-995338651),a=kt(a,s=kt(s,r=kt(r,i,a,s,e[o+0],6,-198630844),i,a,e[o+7],10,1126891415),r,i,e[o+14],15,-1416354905),s,r,e[o+5],21,-57434055),a=kt(a,s=kt(s,r=kt(r,i,a,s,e[o+12],6,1700485571),i,a,e[o+3],10,-1894986606),r,i,e[o+10],15,-1051523),s,r,e[o+1],21,-2054922799),a=kt(a,s=kt(s,r=kt(r,i,a,s,e[o+8],6,1873313359),i,a,e[o+15],10,-30611744),r,i,e[o+6],15,-1560198380),s,r,e[o+13],21,1309151649),a=kt(a,s=kt(s,r=kt(r,i,a,s,e[o+4],6,-145523070),i,a,e[o+11],10,-1120210379),r,i,e[o+2],15,718787259),s,r,e[o+9],21,-343485551),r=ba(r,l),i=ba(i,c),a=ba(a,d),s=ba(s,f)}return Array(r,i,a,s)}function $s(e,t,r,i,a,s){return ba(cu(ba(ba(t,e),ba(i,s)),a),r)}function bt(e,t,r,i,a,s,o){return $s(t&r|~t&i,e,t,a,s,o)}function It(e,t,r,i,a,s,o){return $s(t&i|r&~i,e,t,a,s,o)}function gt(e,t,r,i,a,s,o){return $s(t^r^i,e,t,a,s,o)}function kt(e,t,r,i,a,s,o){return $s(r^(t|~i),e,t,a,s,o)}function ba(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function cu(e,t){return e<<t|e>>>32-t}async function Xn(e,t={}){return t.errMsg=e,ge("extension_error",{...e,...t})}var ms={},ws=[],er={},tr={},ar={},Ra={},rr={},sa={};let Ot=null;var w={};const x={getAllItems:()=>chrome.storage.local.get(),getItem:async e=>(await chrome.storage.local.get(e))[e],setItem:(e,t)=>new Promise(r=>{const i=t??"";chrome.storage.local.set({[e]:i},()=>{w[e]=i,r()})}),removeItem:e=>{chrome.storage.local.remove(e),w[e]&&delete w[e]}};async function uu(e,t){try{let r={},i=await vl(t),a=ra[e].orderAPIArr;for(let s in a)try{let o=a[s],l=await cr(e,{action:"changeDomFromSW",data:{eachOrderSel:o,siteConfig:i}});r[s]=l==null?void 0:l.finalRes,await new Promise(c=>setTimeout(c,7e3))}catch{await new Promise(d=>setTimeout(d,7e3));let l=a[s],c=await cr(e,{action:"changeDomFromSW",data:{eachOrderSel:l,siteConfig:i}});r[s]=c==null?void 0:c.finalRes}return r}catch{}}let ja={},na={};const du="CT_Internal_port_alive";var Wa=null;const $o=1e3;var Hi=!0,gn=4*$o,Vi=setInterval(Jo,gn);async function Jo(){Wa==null&&(Wa=chrome.runtime.connect({name:du}),Wa.onDisconnect.addListener(e=>{chrome.runtime.lastError,Wa=null})),Wa&&(Wa.postMessage({content:"ping"}),chrome.runtime.lastError),Hi&&(Hi=!1,clearInterval(Vi),gn=270*$o,Vi=setInterval(Jo,gn))}let Wi=!1;const pu="https://www.google-analytics.com/mp/collect",fu="https://www.google-analytics.com/debug/mp/collect",hu="G-QH3G6YCPV0",yu="i6Ays3ubRDuAv9WVfLYjkg",mu=100,wu=30;async function bu(){try{let{sessionData:e}=await chrome.storage.session.get("sessionData");const t=Date.now();return e&&e.timestamp&&((t-e.timestamp)/6e4>wu?e=null:(e.timestamp=t,await chrome.storage.session.set({sessionData:e}))),e||(e={session_id:t.toString(),timestamp:t.toString()},await chrome.storage.session.set({sessionData:e})),e.session_id}catch{}}async function Ki(){try{let t=(await chrome.storage.local.get("ext_id")).ext_id;return t||(t=self.crypto.randomUUID()),t}catch{}}async function Fo(){try{let e="Chrome",t=navigator.userAgent||navigator.vendor||window.opera;/android/i.test(t)?e="Android":/iPad|iPhone|iPod/.test(t)&&!window.MSStream?e="iOS":chrome.runtime.id=="gdgnlfdenkmjcfgjpnookbglpndleahm"?e="Edge":chrome.runtime.id.includes("Price-Tracker--Spend-Lens-Buyhatke")?e="Safari":chrome.runtime.id=="Price-Comparison@buyhatke.com"&&(e="Firefox"),await x.setItem("userPlatform",e);let r="";try{r=await(await fetch("https://checkip.amazonaws.com/")).text(),r=r.split(`
`).join("")}catch{r=await(await fetch("https://api.ipify.org/")).text(),r=r.split(`
`).join("")}let a=await(await fetch("https://ipapi.co/"+r+"/json/")).json(),s=a.city,o=a.country_name;s&&o&&(await x.setItem("userCity",s),await x.setItem("userCountry",o))}catch{}}Fo();setInterval(function(){Fo()},24*3600*1e3);let zi=0,Or=[];async function ge(e,t={},r=""){try{zi++,t.session_id||(t.session_id=await bu()),t.engagement_time_msec||(t.engagement_time_msec=mu);try{if(t.version?t.version="NA":t.version=await x.getItem("version"),t.ext_id?t.ext_id="NA":t.ext_id=await x.getItem("ext_id"),!t.source){let c=await x.getItem("referralDataSource");c?(t.utm_source=c.source,t.cs=c.source):(t.utm_source="NA",t.cs="NA")}let i="NA",a="NA",s="NA";i=await x.getItem("userCountry"),s=await x.getItem("userPlatform"),a=await x.getItem("userCity"),t.country=i,t.city=a,t.platform=s;let o="";if((t==null?void 0:t.type)=="error_pair_level"){await fp(t==null?void 0:t.config,t==null?void 0:t.pos,t==null?void 0:t.name,(t==null?void 0:t.tabId)||r,t==null?void 0:t.orderId);return}if(e=="StageEvents")Or.push({name:e,params:t});else if(e!="AnalyticsSent")Or.push({name:e,params:t});else return;e!="page_view"&&(e=e+"NewUI"),o=JSON.stringify({client_id:await Ki(),events:[{name:e,params:t}]}),zi%1e3==5&&(o=JSON.stringify({client_id:await Ki(),user_properties:{country:{value:i},city:{value:a},source:{value:t.cs.toUpperCase()},platform:{value:s},version:{value:t.version}},events:[{name:e,params:t}]}));const l=await fetch(`${Wi?fu:pu}?measurement_id=${hu}&api_secret=${yu}`,{method:"POST",body:o});if(!Wi)return}catch{}}catch{}}function Iu(e){chrome.tabs.reload(parseInt(e))}async function gu(e){try{let t=await x.getItem("ext_id"),r=await x.getItem("ext_auth"),i={};i.data=e,i=JSON.stringify(i);let s=await(await fetch(`https://settings.buyhatke.com/extension-settings/updateGA?ext_id=${t}&ext_auth=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:i})).json();return""}catch(t){return R("referralData",t),J(t),""}}setInterval(function(){Or.length>0&&(gu(Or),Or=[])},30*60*1e3);async function ku(e,t,r={}){try{return ge(e,{page_title:t,page_location:t,...r})}catch{}}let zt={};async function St(e,t,r){const i=await fetch(t,r);if(i.status>=400){if(Rt("third_party_api_error",e),zt[e]=zt[e]||{},zt[e][i.status]=zt[e][i.status]||{},zt[e][i.status][t]=zt[e][i.status][t]||0,zt[e][i.status][t]++,i.status==406&&e==2)return i;await ge("SpendCalcExtractMissing",{pos:e,missing_keys_report:"API_ERROR",url:t}),await ur({eventID:77,errorSource:"fetchSpend",errorDetails:{pos:e,missing_keys_report:"API_ERROR",url:t}})}return i}async function xu(){try{if(Object.keys(zt).length>0){w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");const e=Object.assign(zt);if(zt={},(await(await fetch(`https://ext1.buyhatke.com/spend-apis/spend-calc/logFailedApis?extId=${w.ext_id}&extAuth=${w.ext_auth}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()).status!=1)throw new Error("logging failed !")}}catch(e){R("sendAndClearSpendApiLogs",e)}}async function vu(e){try{if(Object.keys(e).length>0&&(w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth"),(await(await fetch(`https://ext1.buyhatke.com/spend-apis/spend-calc/logFailedApis?extId=${w.ext_id}&extAuth=${w.ext_auth}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()).status!=1))throw new Error("logging failed !")}catch(t){R("sendAndClearSpendApiLogsViaCS",t)}}setInterval(()=>{for(var e in er){var t=Date.now();t-er[e].time>60*60*1e3&&delete er[e]}for(var e in tr){var t=Date.now();t-tr[e].time>60*60*1e3&&delete tr[e]}for(var e in ar){var t=Date.now();t-ar[e].time>60*60*1e3&&delete ar[e]}for(var e in Ra){var t=Date.now();t-Ra[e].time>60*60*1e3&&delete Ra[e]}for(var e in sa){var t=Date.now();t-sa[e].time>60*60*1e3&&delete sa[e]}for(var e in rr){var t=Date.now();t-rr[e].time>60*60*1e3&&delete rr[e]}},60*60*1e3);function Au(e){var t={};t.time=Date.now(),t.configData=e,er[JSON.parse(e)[0].id]=t}function Tu(e){var t={};t.time=Date.now(),t.configData=e,tr[JSON.parse(e).id]=t}function _u(e,t){var r={};r.time=Date.now(),r.status=e,ar[t]=r}function Su(e,t){var r={};r.time=Date.now(),r.config=e,Ra[t]=r,J("status",Ra[t])}function Pu(e){var t={};t.time=Date.now(),t.domains=e,sa=t}function Ou(e,t){var r={};r.time=Date.now(),r.status=e,rr[t]=r}var Co="";let Zi="";function Bo(e){Zi=e.requestId;let t="";e.hasOwnProperty("requestBody")&&(e.requestBody.hasOwnProperty("raw")?t=String.fromCharCode.apply(null,new Uint8Array(e.requestBody.raw[0].bytes)):t=JSON.stringify(e.requestBody)),ms[Zi]=t}function Ho(e){ia=e.requestHeaders,chrome.tabs.query({active:!0,currentWindow:!0},function(t){let r=!1,i=[!1,!1,!1];e.method=="OPTIONS"||(JSON.stringify(ms[e.requestId]).search(new RegExp("couponBuyhatke","i"))>-1&&(r=!0,i[0]=!0),JSON.stringify(ia).search(new RegExp("couponBuyhatke","i"))>-1&&(r=!0,i[1]=!0),e.url.search(new RegExp("couponBuyhatke","i"))>-1&&(r=!0,i[2]=!0)),r&&(e.tabId==-1&&(e.tabId=t[0].id),chrome.tabs.sendMessage(e.tabId,{requestBody:ms[e.requestId],headers:ia,url:e.url,method:e.method,replace:i},function(a){}),ws=[],ms={},chrome.webRequest.onBeforeRequest.removeListener(Bo),chrome.webRequest.onBeforeSendHeaders.removeListener(Ho))})}function Du(e){var t;return new Promise(function(r,i){chrome.webRequest.onBeforeSendHeaders.addListener(function(a){t=a.requestHeaders,r(t)},{urls:[e]},["blocking","requestHeaders"])})}function oe(e,t){var r;if(!e||typeof t!="string")return null;try{const i=t.split(".");let a=e;for(const s of i){if(a==null)return null;if(s.includes("[")){const o=s.substring(0,s.indexOf("[")),l=parseInt(s.match(/\d+/)[0],10);a=(r=a[o])==null?void 0:r[l]}else a=a[s]}return a}catch{return null}}function Lu(e){try{let t=Date.now(),r=2*60*60*1e3,i=t-r;if(!e)return!1;let a=parseInt(e,10);if(isNaN(a))return!1;let s;return e.toString().length===10?s=a*1e3:s=a,s>i}catch{return!1}}function Vo(){try{let e=Object.keys(Qt);for(let t of e){let r=Qt[t];(!r||!Lu(r==null?void 0:r.timestamp))&&delete Qt[t]}}catch{}}setTimeout(Vo,100);setInterval(Vo,5*60*1e3);function Eu(e){let t=Date.now(),r=2*60*60*1e3,i=t-r;return e.filter(a=>{try{let s=a.split("~"),o=s[s.length-1];if(!o)return!1;let l=parseInt(o,10);if(isNaN(l))return!1;let c;return o.length===10?c=l*1e3:c=l,c>i}catch{return!1}})}function Wo(){let e=ut.length;ut=Eu(ut),e-ut.length}setTimeout(Wo,100);setInterval(Wo,5*60*1e3);const Xi=[2268,7907,7740,7006,6660,25622,25848,25846,25847];async function Nu(e,t){var r;try{if(e.method!=="GET"&&e.method!=="POST")return;let i,a,s;try{i=await Dt(e.url),a=await Ja(i),s=(r=a==null?void 0:a.config_current)==null?void 0:r.varSelector}catch{return}if(!s)return;let o;try{o=oe(t,s.productPidSelector)}catch{return}if(!o)return;let l=[],c;try{c=oe(t,s.variantRootPath)}catch{return}if(!c)return;if(Array.isArray(c))for(let d of c)try{Mu(d,s,o,l)}catch{}else if(typeof c=="object"&&c!==null)try{for(let d of Object.keys(c))try{let f=c[d];if(s.variantPidSelector==="KEY")d!==o&&l.push(d);else try{let p=oe(f,s.variantPidSelector);p&&p!==o&&l.push(p)}catch{}}catch{}}catch{}try{l.length>0&&(Qt[o]={variants:l,time_stamp:e.timeStamp})}catch{}}catch{}}function Mu(e,t,r,i){try{if(!e)return;if(t.variantPidSelector==="KEY")try{for(let a of Object.keys(e))a!==r&&i.push(a)}catch{}else try{let a=oe(e,t.variantPidSelector);a&&a!==r&&i.push(a)}catch{}}catch{}}async function Yi(e,t){var r,i,a,s,o,l,c,d;try{if(e.method!=="GET"&&e.method!=="POST")return;const f=await Dt(e.url);let p=await Ja(f);const u=(r=p==null?void 0:p.config_current)==null?void 0:r.storeSelector;if(!u)return;if(u.hasOwnProperty("get_sid_from_header"))try{let m=null,A=null,P="",S=e.url;if(u.hasOwnProperty("pidRegex"))for(let v=0;v<u.pidRegex.length;v++)try{let _=1;u.hasOwnProperty("match")&&(_=u.match);let T;if(u.hasOwnProperty("global")?T=S.match(new RegExp(u.pidRegex[v],"g"))[_]:T=S.match(new RegExp(u.pidRegex[v]))[_],T!=null&&T!=""){m=T;break}}catch{}if(u.hasOwnProperty("storeRegex"))for(let v=0;v<((i=u==null?void 0:u.storeRegex)==null?void 0:i.length);v++)try{let _=1;u.hasOwnProperty("match")&&(_=u.match);let T;if(u.hasOwnProperty("global")?T=S.match(new RegExp(u.storeRegex[v],"g"))[_]:T=S.match(new RegExp(u.storeRegex[v]))[_],T!=null&&T!=""){A=T;break}}catch{}if(u.hasOwnProperty("getSpin")){let v=[];for(let _ of u.getSpin)try{let T=oe(t,_.rootPath);if(T&&!Array.isArray(T))continue;let E=[];for(let g of T)try{if(oe(g,_.filter.filterPath)==_.filter.value){let $=oe(g,_.targetPath);for(let K of $)K&&K[_.pidSelector]==m&&E.push(K)}}catch{}for(let g of E)try{let O=oe(g,_.innerPath);for(let $ of O){let K=oe($,_.spinSelector),z=oe($,_.quantitySelector);if(z=z.replace(/\s/g,""),K&&z){let F=`${f}~${m}~${A}~${e.tabId}~${K}~${z}~${e.timeStamp}`;ut.push(F),v.push(K)}}}catch{}}catch{}v&&u.hasOwnProperty("captureVariantSpins")&&(Qt[m]={variants:v,timestamp:e.timeStamp})}if(!m&&u.hasOwnProperty("getPID"))for(let v of u.getPID)try{let _=oe(t,v.rootPath),T=oe(_,v.pidSelector),E=oe(_,v.targetPath);for(let g of E){let O=oe(g,v.spinSelector),$=oe(g,v.quantitySelector);if($=$.replace(/\s/g,""),O&&$){let K=`${f}~${T}~${A}~${e.tabId}~${O}~${$}~${e.timeStamp}`;ut.push(K)}}}catch{}if(!u.hasOwnProperty("getSpin")&&!u.hasOwnProperty("getPID")&&f&&m&&A){const v=`${f}~${m}~${A}~${e.tabId}`;ut.push(v)}else return}catch{}if(f==6660)try{let m="",A="";if($r)m=$r;else{const S=await chrome.cookies.get({url:"https://www.jiomart.com",name:(u==null?void 0:u.pincodeKey)||"nms_mgo_pincode"}),v=S==null?void 0:S.value;if(v){let _=(s=(a=p==null?void 0:p.config_api[0])==null?void 0:a.pinCodeSelector)==null?void 0:s.url;_=_.replace("PLACEHOLDER0",v);let T=await fetch(_);T=await T.json();let E=p==null?void 0:p.config_api[0].pincodeToStore;m=Yn(T,E,{})}else throw new Error("Pincode not found in cookie 'nms_mgo_pincode' for https://www.jiomart.com")}let P=e.url;if(u.hasOwnProperty("pidRegex"))for(let S=0;S<u.pidRegex.length;S++)try{let v=1;u.hasOwnProperty("match")&&(v=u.match);let _;if(u.hasOwnProperty("global")?_=P.match(new RegExp(u.pidRegex[S],"g"))[v]:_=P.match(new RegExp(u.pidRegex[S]))[v],_!=null&&_!=""){A=_;break}}catch{}if(m&&A){let S=`${f}~${A}~${m}~${e.tabId}~${e.timeStamp}`;ut.push(S)}}catch{}const I=(l=(o=p==null?void 0:p.config_current)==null?void 0:o.storeSelector)==null?void 0:l.targetpath,k=(d=(c=p==null?void 0:p.config_current)==null?void 0:c.storeSelector)==null?void 0:d.pidSelector,y=oe(t,I);let b=oe(t,k),h=[];if(u!=null&&u.variants&&Array.isArray(u.variants))try{let m=[];for(const A of u.variants){let P=oe(t,A.rootPath);if(P&&Array.isArray(P)&&(P==null?void 0:P.length)>0){let S=P[0],v=S==null?void 0:S[A.targetPath];if(v&&typeof v=="object"){let _=Object.keys(v);try{for(const T of _){let E=v[T],g=T;A.variantPidSelector==="KEY"?(g=T,g!=b&&m.push(g)):A.variantPidSelector&&(g=oe(E,A.variantPidSelector));let O=E==null?void 0:E[A.storeIdSelector];g&&O&&h.push(`${g}~${O}`)}}catch{}}}}m&&u.hasOwnProperty("captureVariantPids")&&(Qt[b]={variants:m,timestamp:e.timeStamp})}catch{}if(h.length>0)try{for(let m of h){let[A,P]=m.split("~");if(f&&A&&P){let S=`${f}~${A}~${P}~${e.tabId}~${e.timeStamp}`;ut.push(S)}}h.length=0}catch{}if(f&&b&&y){let m=`${f}~${b}~${y}~${e.tabId}~${e.timeStamp}`;ut.push(m)}}catch{}}function Ru(e,t){try{const r=[];for(const i of t){let a;typeof e=="number"?a=i[e]:a=oe(i,e),Array.isArray(a)?r.push(...a):a!=null?r.push(a):r.push(i)}return r}catch{return[]}}let va=new Map,Ua=new Map,$r="";async function ju(e){const r=(await chrome.tabs.query({})).find(i=>i.url===e);return r?r.id:null}async function Uu(e,t,r,i,a={}){try{if(typeof e=="string"){let s=t.htmlConfig,o=i.tabId;(!o||o==-1)&&(await new Promise(d=>setTimeout(d,1e3)),o=await ju(i.url));let l=await chrome.tabs.sendMessage(o,{action:"getJiomartPidList",config:s.scrappingConfig,htmlText:e});s=s.parsingConfig;let c=oe(a,s.storeId);if(c&&c!="")for(let d of l.pidArr)va.set(d,{data:c,setTime:Date.now()})}t=t.processData;for(let s of t){let o=oe(e,s.prodListPath);if(!(!o||!o.length))for(let l of o)try{let c=[],d=!0;for(let y of s.isQuick){let b=oe(l,y.selector);if(y.equalTo){if(b.toString()!=y.equalTo&&y.checkLengthAttribute){let h=oe(l,y.checkLengthAttribute);if(y.lengthEqualTo){if(!h||h.length!=y.lengthEqualTo){d=!1;continue}}else if(!h||h.length==1){d=!1;continue}}}else if(Array.isArray(b)){const h=b.every(m=>String(m).includes("PANINDIA"));if(b.length===1||h){d=!1;continue}}else if(typeof b=="object"&&b!==null){const m=Object.keys(b).every(A=>String(A).includes("PANINDIA"));if(Object.keys(b).length===1||m){d=!1;continue}}else b||(d=!1)}let f=oe(l,s.prod),p=oe(l,s.pid);p=p.split("/p/")[1];let u=oe(l,s.image);s.imagePrefix&&(u=s.imagePrefix+u);let I=oe(l,s.quantity),k=oe(l,s.brand);if(s.singleStoreId){let y,b,h=0,m,A=[];if(y=oe(l,s.price),b=oe(l,s.mrp),s.available){let P=0;P=oe(l,s.available),P||(h=1)}if(s.oos){let P=0;P=oe(l,s.oos),P&&(h=1)}s.storeId.includes("reqBody")?m=oe(a,s.storeId.split("reqBody.")[1]):m=oe(l,s.storeId),p&&p!=""&&m&&m!=""&&(A.push({pid:p,prod:f,image:u,price:y,mrp:b,storeId:m,quantity:I,qCom:1,version:chrome.runtime.getManifest().version,oos:h}),va.set(p,{data:A,setTime:Date.now()}));continue}if(d){let y=oe(l,s.allStorePriceList);if(Array.isArray(y)){const b=y.every(h=>String(h).includes("PANINDIA"));if(y.length===1&&b){Ua.set(p,{flag:!0,setTime:Date.now()});continue}}else if(typeof y=="object"&&y!==null){const h=Object.values(y).every(m=>String(m).includes("PANINDIA"));if(Object.keys(y).length===1&&h){Ua.set(p,{flag:!0,setTime:Date.now()});continue}}for(let b in y)try{let h=y[b],m,A,P,S=0;if(s.storeId.includes("same~")?m=h.split("|")[s.storeId.split("~")[1]]:s.storeId.includes("~Key~")?m=b:m=oe(h,s.storeId),s.price.includes("same~")?A=h.split("|")[s.price.split("~")[1]]:A=oe(h,s.price),s.mrp.includes("same~")?P=h.split("|")[s.mrp.split("~")[1]]:P=oe(h,s.mrp),s.available){let v=0;s.available.includes("same~")?v=h.split("|")[s.available.split("~")[1]]:v=oe(h,s.available),v||(S=1)}if(s.oos){let v=0;s.oos.includes("same~")?v=h.split("|")[s.available.split("~")[1]]:v=oe(h,s.oos),v&&(S=1)}p&&p!=""&&f&&f!=""&&A>0&&m&&m!=""&&c.push({pid:p,prod:f,image:u,price:A,mrp:P,storeId:m,quantity:I,qCom:1,version:chrome.runtime.getManifest().version,oos:S})}catch{}va.set(p,{data:c,setTime:Date.now()})}else Ua.set(p,{flag:!0,setTime:Date.now()})}catch{}}}catch{}}let $a=new Map,nr=new Map;function $u(e,t,r){try{let i=!1,a=oe(e,t.isQuick),s=oe(e,t.articleId);if(!s)return;if(!a){$a.set(s,{flag:!1,setTime:Date.now()});return}for(let o of t.isEqualTo)o==a&&(i=!0);$a.set(s,{flag:i,setTime:Date.now()})}catch{}}function Ju(e,t,r){try{let i=oe(e,t.articleId),a=oe(e,t.pid);a&&a!=""&&i&&i!=""&&nr.set(a.toString(),{articleId:i.toLowerCase(),setTime:Date.now()})}catch{}}function Yn(e,t,r){try{let i=oe(e,t.store);return e.status=="success"?($r=i,i):null}catch{return null}}async function Ko(e,t="sendPair",r=""){try{if(t=="sendPair"){e=JSON.parse(e);let i=[],a=[],s=[];for(let o of e){let l=va.get(o.pid),c=l==null?void 0:l.data;if(c&&!Array.isArray(c))o={...o,storeId:[c],qCom:1,price:[o.price],mrp:[o.mrp],oos:[o.oos]},i.push(o),va.delete(o.pid);else if(c&&c.length>0){let d={...o};d.mrp=c.map(f=>f.mrp),d.price=c.map(f=>f.price),d.oos=c.map(f=>f.oos),d.storeId=c.map(f=>f.storeId),d.qCom=1,i.push(d),va.delete(o.pid)}else{let d=Ua.get(o.pid);d!=null&&d.flag?(a.push(o),Ua.delete(o.pid)):s.push(o)}}if(i.length>0)for(let l=0;l<i.length;l+=500){const c=i.slice(l,l+500);le(JSON.stringify(c),25850)}return i.length==0&&(a=s),a.length>0?JSON.stringify(a):null}else{e=JSON.parse(e);let i=e.pid;i=i.split("/")[i.split("/").length-1];let a=nr.get(i),s=a==null?void 0:a.articleId;if(!s)return JSON.stringify(e);nr.delete(i);let o=$a.get(s);if(!(o==null?void 0:o.flag))return JSON.stringify(e);if($a.delete(s),!$r){let c=await Ja(6660);const d=await chrome.tabs.sendMessage(r,{action:"getJiomartPincode",config:c.config_api[0].pinCodeSelector});if(d&&d.pincode){let f=d.pincode,p=c.config_api[0].pinCodeSelector.url;p=p.replace("PLACEHOLDER0",f);let u=await fetch(p);u=await u.json();let I=c==null?void 0:c.config_api[0].pincodeToStore;if(!Yn(u,I,{}))return JSON.stringify(e)}}return e={...e,storeId:$r,qCom:1},ce(e,25850,r),null}}catch{return null}}function Gs(e,t,r){var i,a;try{if(!t)return[];const s=[],o=t.selectors;let l=[e];try{for(const c of t.path)if(l=Ru(c,l),!l.length)return[]}catch{return[]}try{for(const c of l)try{if(!c)continue;if(o.hasOwnProperty("innerPath")){const d=o.hasOwnProperty("pidSelector")?oe(c,o.pidSelector):null,f=[];if(o.hasOwnProperty("variantSelectorArray")){const u=oe(c,o.variantSelectorArray);if(Array.isArray(u))for(const I of u)try{let k=oe(I,o.variantPidSelector);k&&f.push(k)}catch{}}const p=oe(c,o.innerPath);if(!Array.isArray(p))continue;for(const u of p){let I=o.hasOwnProperty("innerPIDSelector")?oe(u,o.innerPIDSelector):d;if(!I)continue;let k=[];if(o.hasOwnProperty("selectedProdSelector")){const E=oe(u,o.selectedProdSelector);if(E){for(const g of f)g!=E&&k.push(`${I}?selectedProd=${g}`);I=`${I}?selectedProd=${E}`}}const y=oe(u,o.priceSelector);if(!y)continue;let b=oe(u,o.mrpSelector),h=oe(u,o.prodSelector);if(!h)continue;if(o.hasOwnProperty("brandSelector")){let E=oe(c,o.brandSelector);E&&(h=`${E} ${h}`)}let m=oe(u,o.imageSelector);o.hasOwnProperty("imagePlaceholderUrl")&&(m=(i=o.imagePlaceholderUrl)==null?void 0:i.replace("PLACEHOLDER",m));let A=1;const P=o.hasOwnProperty("oosSelector")&&oe(u,o.oosSelector),S=r||oe(u,o.storeSelector);if(t.qCom&&!S)continue;const v=oe(u,o.quantitySelector),_=P&&P>0?0:o.hasOwnProperty("oosSelector")?1:2;let T="";if(o.hasOwnProperty("spin")&&(T=oe(u,o.spin),k=f.filter(E=>E!=T)),o.hasOwnProperty("variantSelector")&&o.hasOwnProperty("variantPidSelector")){const E=oe(c,o.variantSelector);if(Array.isArray(E))for(const g of E){let O=oe(g,o.variantPidSelector);!O||O==I||k.push(O)}else if(typeof E=="object"&&o.variantPidSelector==="KEY")for(const g in E)g!=I&&k.push(g)}(!b||b===0)&&(b=y),s.push({pid:I,price:y,prod:h,image:m,oos:_,mrp:b,qCom:A,storeId:S,quantity:v,variants:k,version:chrome.runtime.getManifest().version,spin:T})}}else{let d=oe(c,o.pidSelector);if(!d)continue;if(o.hasOwnProperty("selectedProdSelector")){const A=oe(c,o.selectedProdSelector);A&&(d=`${d}?selectedProd=${A}`)}let f=oe(c,o.priceSelector);if(!f)continue;let p=oe(c,o.mrpSelector);if(o.hasOwnProperty("priceDivider")){let A=o.priceDivider;f=f/A,p=p/A}let u=oe(c,o.prodSelector);if(!u)continue;if(o.hasOwnProperty("brandSelector")){let A=oe(c,o.brandSelector);A&&(u=`${A} ${u}`)}let I=oe(c,o.imageSelector);o.hasOwnProperty("imagePlaceholderUrl")&&(I=(a=o.imagePlaceholderUrl)==null?void 0:a.replace("PLACEHOLDER",I));const k=o.hasOwnProperty("oosSelector")&&oe(c,o.oosSelector),y=r||oe(c,o.storeSelector);if(t.qCom&&!y)continue;const b=oe(c,o.quantitySelector),h=k&&k>0?0:o.hasOwnProperty("oosSelector")?1:2;let m=[];if(o.hasOwnProperty("variantSelector")&&o.hasOwnProperty("variantPidSelector")){const A=oe(c,o.variantSelector);if(Array.isArray(A))for(const P of A){let S=oe(P,o.variantPidSelector);!S||S==d||m.push(S)}else if(typeof A=="object"&&o.variantPidSelector==="KEY")for(const P in A)P!=d&&m.push(P)}(!p||p===0)&&(p=f),s.push({pid:d,price:f,prod:u,image:I,oos:h,mrp:p,qCom:1,storeId:y,quantity:b,variants:m,version:chrome.runtime.getManifest().version})}}catch{}}catch{}return s}catch{}}const za=new Map;let Cs=new Map;async function Fu(e,t){try{const r=await Dt(e.url);let i=await Ja(r);try{let a=[];for(const o of i.config_api){let l;if((o==null?void 0:o.storeIdFromHeader)===!0){const c=e.requestHeaders.find(f=>f.name==="storeId"),d=c==null?void 0:c.value;l=Gs(t,o,d)}else if(o.storeIdFromStorage&&o.getStoreFromCookie===1){const c=await Fs(o.storeIdFromStorage);l=Gs(t,o,c)}else l=Gs(t,o);l&&l.length>0&&a.push(...l)}const s=a.flat();if(s.length>0){const o=JSON.stringify(s);await le(o,r)}}catch{}}catch{}}async function Bu(e,t){try{let r=await fetch("https://ext1.buyhatke.com/extension-apis/groc-latlong",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e,pos:t})})}catch{}}let aa={};async function Hu(e,t){try{const r=await Dt(e.url);let i=await Ja(r);if(i.hasOwnProperty("lat_long_config")){i=i.lat_long_config;let a=t,s=[];if(i.hasOwnProperty("latLongList")){let l=i.latLongList.jsonPath;Array.isArray(l)||(l=[l]);for(const c of l)try{const d=M(a,c);if(d){a=d;break}}catch{continue}}if(!a||!i.attributes||typeof i.attributes!="object")return 1;Array.isArray(a)||(a=[a]);let o=null;if(i.hasOwnProperty("selectAddress")){let l=M(t,i.selectAddress.addressList),c=M(t,i.selectAddress.selectedId);for(let d of l)try{if(M(d,i.selectAddress.addressId)==c){o=d;break}}catch{}}for(let l of a){let c=i.attributes,d={};for(let u of Object.keys(c))try{let I="",k=c[u];k.type=="global"?o&&k.fromSelectedAddress?I=M(o,k.jsonPath):I=M(t,k.jsonPath):I=M(l,k.jsonPath),d[u]=I,k.toStore&&I&&(aa[String(r)]||(aa[String(r)]={}),aa[String(r)][u]=I,aa[String(r)].lastUpdated=Date.now())}catch{}if(i.hasOwnProperty("checkStored")){let u=!0,I=Date.now(),k=!1;for(let h of i.checkStored)if(aa[String(r)]&&aa[String(r)][h]&&I-aa[String(r)].lastUpdated<=1e3*5&&!d[h])d[h]=aa[String(r)][h],k=!0;else{u=!1;break}const b=(i.requiredAttributes||[]).every(h=>d[h]!==void 0&&d[h]!==null&&d[h]!="");u&&k&&b&&delete aa[String(r)]}(i.requiredAttributes||[]).every(u=>d[u]!==void 0&&d[u]!==null&&d[u]!="")&&s.push(d)}s.length>0&&await Bu(s,r)}return 1}catch{}}async function Vu(e){var t,r,i,a,s,o;try{const l=za.get(e.requestId);try{if(e.url.startsWith("https://1.rome.api.flipkart.com/api/4/page/")||e.url.startsWith("https://2.rome.api.flipkart.com/api/4/page/")){let v=null;try{v=JSON.parse(l)}catch{}let _=v&&typeof v.pageUri=="string"?v.pageUri:"",T=_.includes("marketplace=HYPERLOCAL")||_.toLowerCase().includes("marketplace=hyperlocal");if(!T){za.delete(e.requestId);return}if(T&&(_.includes("/hyperlocal/pr?q=")||_.includes("s/p/a?pid="))){za.delete(e.requestId);return}}let S=await Md();if(S=S==null?void 0:S.urls,Array.isArray(S)&&S.some(v=>e.url.includes(v))){za.delete(e.requestId);return}}catch{}za.delete(e.requestId);const c=e.requestHeaders.reduce((P,S)=>(P[S.name]=S.value,P),{});let d=e.url;const f=new URL(e.url);if(d.startsWith("https://www.jiomart.com/lcat/rest/v1/vertex/search-products")||d.startsWith("https://www.jiomart.com/trex/search")){let S=JSON.parse(l).query;if(Cs.get(S)){Cs.delete(S);return}else Cs.set(S,!0)}else d.startsWith("https://api.zepto.com")||d.startsWith("https://cdn.bff.zeptonow.com")?c["X-Buyhatke-Request"]="true":f.searchParams.set("duplicate","true");const p={method:e.method||"GET",headers:c};l&&(p.body=l);let u;if(e.url.startsWith("https://1.sonic.fdp.api.flipkart.com/4/data/collector/business")||e.url.startsWith("https://2.sonic.fdp.api.flipkart.com/4/data/collector/business")||(u=await fetch(f.href,p),!u.ok&&f.href.includes("2.rome")?(f.href=f.href.replace("2.rome","1.rome"),u=await fetch(f.href,p)):!u.ok&&f.href.includes("1.rome")&&(f.href=f.href.replace("1.rome","2.rome"),u=await fetch(f.href,p))),!u||!u.ok)return;if(Ku.some(P=>e.url.startsWith(P))){const P=Object.fromEntries(f.searchParams.entries()),S={pathname:f.pathname,href:f.href};let v=l;try{v=JSON.parse(v)}catch{}let _={...S,...P};v&&typeof v=="object"&&(_={..._,reqBody:v});let T=await u.json();T.urlObject=_,Hu(e,T);return}const y=await Dt(e.url);let b=await Ja(y),h;const m=(i=(r=(t=b==null?void 0:b.config_api)==null?void 0:t[0])==null?void 0:r.textResponseUrls)==null?void 0:i.some(P=>d.startsWith(P));if(y==6660&&m?h=await u.text():y==25622&&d=="https://www.swiggy.com/instamart"?(h=await u.text(),h=h.split(b.config_f.scriptSelectorAPI.start)[1],h=h.split(b.config_f.scriptSelectorAPI.end)[0],h=JSON.parse(h)):h=await u.json(),y==6660||d.startsWith("https://3yp0hp3wsh-dsn.algolia.net/1/indexes/")){if(!b.config_api)return;let P=e.url;if(P.startsWith("https://www.jiomart.com/payment/serviceability/check")){Yn(h,b==null?void 0:b.config_api[0].pincodeToStore,e);return}if((o=(s=(a=b==null?void 0:b.config_api)==null?void 0:a[0])==null?void 0:s.productUrls)==null?void 0:o.some(v=>P.startsWith(v))){const v=Object.fromEntries(f.searchParams.entries()),T={...{pathname:f.pathname,href:f.href},...v};Uu(h,b==null?void 0:b.config_api[0],P,e,T);return}if(P.startsWith("https://www.jiomart.com/catalog/productdetails/get/")){Ju(h,b==null?void 0:b.config_api[0].getDetails,e),Yi(e,h);return}if(P.startsWith("https://www.jiomart.com/platform/logistics/api/v1/promise")){$u(h,b==null?void 0:b.config_api[0].processPromise,e);return}return}Wu.some(P=>e.url.startsWith(P))&&(Yi(e,h),Nu(e,h)),Fu(e,h)}catch{}}const Qi=["https://blinkit.com/feed/*","https://www.swiggy.com/api/instamart/*","https://www.swiggy.com/instamart","https://digital.dmart.in/api/v3/homepage*","https://digital.dmart.in/api/v3/search/*","https://digital.dmart.in/api/v3/plp/*","https://digital.dmart.in/api/v3/hybridproductlist*","https://www.dmart.in/_next/data/*","https://digital.dmart.in/api/v2/pincodes/details*","https://www.bigbasket.com/listing-svc/v2/products*","https://blinkit.com/v1/layout/product/*","https://blinkit.com/v1/layout/search?*","https://blinkit.com/v1/layout/listing_widgets*","https://blinkit.com/visibility*","https://www.jiomart.com/trex/search*","https://3yp0hp3wsh-dsn.algolia.net/1/indexes/*","https://3yp0hp3wsh-dsn.algolia.net/1/indexes/*/queries/*","https://www.jiomart.com/lcat/rest/v1/vertex/search-products*","https://www.jiomart.com/payment/serviceability/check*","https://www.jiomart.com/catalog/productdetails/get/*","https://www.jiomart.com/platform/logistics/api/v1/promise","https://www.jiomart.com/catalog/recommendations/get/*","https://www.jiomart.com/cms/topdeals/get_single_topdeal*","https://www.amazon.in/tez/browse/*","https://2.rome.api.flipkart.com/api/4/page/*","https://1.rome.api.flipkart.com/api/4/page/*","https://1.rome.api.flipkart.com/4/user/state","https://2.rome.api.flipkart.com/4/user/state","https://1.sonic.fdp.api.flipkart.com/4/data/collector/business","https://2.sonic.fdp.api.flipkart.com/4/data/collector/business","https://api.zepto.com/api/v2/get_page*","https://api.zepto.com/api/v3/search*","https://api.zepto.com/api/v2/store-products-by-store-subcategory-id*","https://bff-gateway.zepto.com/lms/api/v2/get_page*","https://bff-gateway.zepto.com/api/v3/search*","https://cdn.bff.zeptonow.com/api/v2/get_page*","https://cdn.bff.zeptonow.com/api/v3/search*","https://cdn.bff.zeptonow.com/api/v2/store-products-by-store-subcategory-id*","https://www.amazon.in/portal-migration/hz/glow/get-location-label*","https://www.bigbasket.com/ui-svc/v2/header/?*"],Wu=["https://blinkit.com/v1/layout/product/","https://www.swiggy.com/api/instamart/item/","https://www.amazon.in/tez/browse/minidp?asin","https://2.rome.api.flipkart.com/api/4/page/","https://1.rome.api.flipkart.com/api/4/page/","https://www.amazon.in/tez/browse/minidp?asin","https://www.jiomart.com/catalog/productdetails/get/"],Ku=["https://www.amazon.in/tez/browse/getOverlayWidgets?brandId=qqfsWw9RkO","https://digital.dmart.in/api/v2/pincodes/details","https://1.rome.api.flipkart.com/4/user/state","https://2.rome.api.flipkart.com/4/user/state","https://api.zepto.com/api/v2/get_page?latitude=","https://blinkit.com/visibility","https://www.bigbasket.com/ui-svc/v2/header/?","https://1.sonic.fdp.api.flipkart.com/4/data/collector/business","https://2.sonic.fdp.api.flipkart.com/4/data/collector/business","https://www.amazon.in/portal-migration/hz/glow/get-location-label"];function zu(){try{const e=t=>{try{if(t.url.startsWith("https://api.zepto.com")||t.url.startsWith("https://cdn.bff.zeptonow.com")){if(t.requestHeaders.some(i=>i.name.toLowerCase()==="x-buyhatke-request"))return}else if(new URL(t.url).searchParams.get("duplicate")==="true")return;Vu(t)}catch{}};chrome.webRequest.onBeforeRequest.addListener(t=>{try{if(!t.requestBody||!t.requestBody.raw)return;if(t.requestBody&&t.requestBody.raw){const r=t.requestBody.raw[0].bytes;if(r){const i=String.fromCharCode.apply(null,new Uint8Array(r));za.set(t.requestId,i)}}}catch{}},{urls:[...Qi]},["requestBody"]),chrome.webRequest.onBeforeSendHeaders.addListener(e,{urls:[...Qi]},["requestHeaders"])}catch{}}zu();function Zu(e){return new Promise(function(t,r){chrome.webRequest.onBeforeSendHeaders.addListener(function(i){const a=i.requestHeaders.reduce((s,o)=>(s[o.name.toLowerCase()]=o.value,s),{});t(a)},{urls:[e]},["requestHeaders"])})}function Xu(e){var t;return new Promise(function(r,i){chrome.webRequest.onBeforeRequest.addListener(function(a){t=decodeURIComponent(String.fromCharCode.apply(null,new Uint8Array(a.requestBody.raw[0].bytes))),r(t)},{urls:[e]},["blocking","requestBody"])})}var Gi=["cr","ic","ket"],qs={},Ci={},kn=new Array,Yu=[];for(var en=0;en<100;en++)kn[en]=0;function zo(e,t,r){try{chrome.cookies.get({url:e,name:t},function(i){if(chrome.runtime.lastError){r&&r(null);return}r&&r(i?i.value:null)})}catch{r&&r(null)}}zo("https://amazon.in/","session_id",function(e){});var Qu=chrome.runtime.getManifest();Qu.version;function Gu(e){const t="=".repeat((4-e.length%4)%4),r=(e+t).replace(/-/g,"+").replace(/_/g,"/"),i=atob(r),a=new Uint8Array(i.length);for(let s=0;s<i.length;++s)a[s]=i.charCodeAt(s);return a}const Cu="BO8_Gm4O4tOivltbZImpbwXGFcI4GVM_48tP2_tSbn4kvjV-m21VZp6hnfG473o30NoYEpUlo568mOpq9bA7pnk";Gu(Cu);async function qu(e,t){try{let r=`https://ext1.buyhatke.com/extension-apis/updateSubscriptions?extId=${w.ext_id}&extAuth=${w.ext_auth}`,i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:e,userVisibleOnly:t})});return i=await i.json(),i.status==1}catch(r){return J("sendSubscriptionToServer",r),!1}}setInterval(async()=>{try{if((await x.getItem("can_send_wp_subscription")||0)!=1)return;let t=JSON.parse(await x.getItem("web_push_subscription")||"{}");if(Object.keys(t).length>0){let r=t.subscription,i=t.userVisibleOnly;await qu(r,i)&&await x.setItem("can_send_wp_subscription",0)}}catch(e){J("sending sub",e)}},1e3*60*60);_t.initLocalStorage(R,J,Mt,ge,x,w);async function Zo(){let e=await x.getItem("ext_auth"),t=await x.getItem("ext_id");t&&e?chrome.runtime.setUninstallURL("https://compare.buyhatke.com/uninstall.php?ext_id="+t+"&auth_val="+e):setTimeout(function(){Zo()},5e3)}Zo();async function qi(e){try{var t=await x.getItem("tl");t?t=JSON.parse(t):t={};var r=0;if(t[e]){var i=parseInt(t[e]),a=Math.floor(Date.now()/1e3);a-i>1800&&(r=1,t[e]=a)}else{var a=Math.floor(Date.now()/1e3);t[e]=a,r=1}x.setItem("tl",JSON.stringify(t)),r==1&&ed(e)}catch(s){R("repostSome",s),J("Error in reportSome ",s)}}async function ed(e){try{w.ext_id=await x.getItem("ext_id");return}catch(t){R("someVal",t),J("Error in someVal ",t)}}function Xo(e){try{var e=new URL(e);return e.hostname}catch{return""}}async function td(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime(),r=await fetch("https://utility.buyhatke.com/whl.json?rand="+t);if(r.status>=400&&r.status<=599)throw new Error("status: "+r.status);await x.setItem("whl",await r.text())}catch(e){R("getWHL",e),J("Error in getWHL() ",e)}}td();async function Ya(e){try{w.ext_id=await x.getItem("ext_id");let t=await fetch("http://geoip.hmageo.com/ip/");if(t.status>=400&&t.status<=599)throw new Error("status: "+t.status);if(t=await t.text(),t){let r=await fetch("https://utility.buyhatke.com/bl.php?ip="+text+"&domain="+e+"&ext_id="+w.ext_id);if(r.status>=400&&r.status<=599)throw new Error("status: "+r.status)}}catch(t){R("sessVal",t),J("Error sessVal ",t)}}var Yo="amazon",tn=["backend.pricedekho.com","cmsprod.coupondunia.in","fapp1.coupondunia.in","app.coupondunia.in","staging.cashkaro.com","email.mysmartprice.com","email.desidime.com","data.flipshope.com","u.flipshope.com","upld.smartprix.com","backend.pricedekho.com","pddb-admin.pricedekho.com","dashboard.grabon.in","admin.grabon.in","email.91mobiles.com","webmanager.pennyful.in","xsso.indiafreestuff.in","ww31.indiafreestuff.in"];async function ad(e){try{if(Qo(e),w.whl=await x.getItem("whl"),w.whl==null||w.whl=="")return 1;var t=await JSON.parse(w.whl);e=Xo(e);for(var r=e,i=0,a=0;a<tn.length;a++)if(tn[a]==r||r.split(tn[a]).length>1){i=1,qi(r);var s=await x.getItem("hashBL");s==null||s==""?(s={},s[r]=1,Ya(r)):(s=JSON.parse(s),typeof s[r]>"u"?(s[r]=1,Ya(r)):s[r]++),await x.setItem("hashBL",JSON.stringify(s));return}for(var o=0;o<t.length;o++)if(t[o].site==e||e.split(t[o].site).length>1)return 0;if(e=e.split(Yo),e[0]=="www."||e[0]=="")return 0;if(e.length==1)return 0;qi(r);var s=await x.getItem("hashBL");s==null||s==""?(s={},s[r]=1,Ya(r)):(s=JSON.parse(s),typeof s[r]>"u"?(s[r]=1,Ya(r)):s[r]++),await x.setItem("hashBL",JSON.stringify(s))}catch(l){R("checkMainFunc",l),J("Error in checkMainFunc ",l)}}var Wt="mlaiogloeg",eo=[Yo,"backend.pricedekho.com","cmsprod.coupondunia.in","fapp1.coupondunia.in","app.coupondunia.in","staging.cashkaro.com","email.mysmartprice.com","click.mysmartprice.com","email.desidime.com","data.flipshope.com","u.flipshope.com","upld.smartprix.com","backend.pricedekho.com","pddb-admin.pricedekho.com","dashboard.grabon.in","admin.grabon.in","email.91mobiles.com","webmanager.pennyful.in","xsso.indiafreestuff.in","ww31.indiafreestuff.in","smartprix.slack.com","new.smartprix.com","et3.smartprix.com","todo.91mobiles.com","mailer.91mobiles.com","click.mysmartprice.com"],an=["pricedekho","coupondunia","cashkaro","mysmartprice","desidime","flipshope","smartprix","grabon","91mobiles","pennyful","indiafreestuff","flipkart","makkhichoose","kernelinsights"];async function Qo(e){try{if(e=="")return;for(var t=0;t<an.length;t++){e.split("://").length==1&&(e="http://"+e),e=Xo(e);var r=e;if(e.split(an[t]).length>1){if(e=e.split("://"),e.length>1?e=e[1]:e=e[0],e=e.split(an[t]),!((e[1]==".com"||e[1]==".in")&&(e[0]=="www."||e[0]==""))){w.wlswji=await x.getItem("wlswji");var i=w.wlswji;typeof i>"u"||i==""?(i={},i[r]=1,Ya(r),await x.setItem("wlswji",JSON.stringify(i))):(i=JSON.parse(i),i[r]||(i[r]=1,Ya(r),await x.setItem("wlswji",JSON.stringify(i))))}break}}}catch(a){R("checkSomeDomain",a),J("Error in ",a)}}async function Go(){const e="lastUrl_",t=[],r=await chrome.storage.local.get(null);for(const i in r)if(i.startsWith(e)){const a=i.substring(e.length),s=parseInt(a);if(!isNaN(s))try{await chrome.tabs.get(s)}catch{t.push(i)}}t.length>0&&await chrome.storage.local.remove(t)}setInterval(async function(){await Go()},10*60*1e3);setTimeout(async function(){await Go()},100);function rd(e){for(var t=0;t<eo.length;t++)if(e.split(eo[t]).length>1)return!0;return!1}async function sd(e){e.split("webstore/detail").length>1&&(e.split("ggdlnemgdnagmpkchejgmgpbidihmali").length>1||e.split("iiinclagpealgnaglbmkdbfbgchjjbpg").length>1)&&await nd()}async function nd(){try{if(w.sourceSent=await x.getItem("sourceSent"),w.ext_id=await x.getItem("ext_id"),parseInt(w.sourceSent)==1)return;var e="https://compare.buyhatke.com/extension/scstore.php",t="ext_id="+w.ext_id+"&auth_val="+w.ext_auth,r=new getXMLHTTPRequest;r.open("POST",e,!0),await Ae(e,"POST",t,"formData")&&await x.setItem("sourceSent",1)}catch(i){R("makeHTTPRequest",i),J("Issue with makeHTTPRequest ",i)}}async function id(){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth"),fetch("https://utility.buyhatke.com/updateVersion.php?ext_id="+w.ext_id+"&ext_auth="+w.ext_auth+"&version="+chrome.runtime.getManifest().version).then(function(e){if(e.status>=400&&e.status<=599)throw new Error("status: "+e.status);return e.json()}).then(function(e){e.success==!0&&e.ext_id==w.ext_id&&fetch(e.url).then(function(t){return t.text()}).then(function(t){})}).catch(e=>{R("uodateExtensionManifestAnalytics",e)})}catch(e){R("uodateExtensionManifestAnalytics",e),J("Issue with makeHTTPRequest ",e)}}setInterval(function(){id()},2*3600*1e3);function Qn(){var e=Wt[0]+Wt[2]+Wt[3]+Wt[1]+"."+Wt[9]+Wt[4]+Wt[7]+Wt[9]+Wt[6]+Wt[8];chrome.tabs.query({},function(t){for(var r=0;r<t.length;r++)Qo(t[r].url),rd(t[r].url)?ad(t[r].url):t[r].url.split("myntra").length>1||t[r].url.split(e).length>1||sd(t[r].url)})}Qn();chrome.tabs.onCreated.addListener(function(e){Qn()});chrome.tabs.onUpdated.addListener(function(e){Qn()});var Co="";async function od(e,t){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var r="https://compare.buyhatke.com/extension/getCoupons.php",i="ext_id="+w.ext_id+"&auth_val="+w.ext_auth+"&pos="+e,a=await Ae(r,"POST",i,"formData");a&&chrome.tabs.sendMessage(t,{coupons:a})}catch(s){R("getCoupons",s),J("Error getCoupons ",s)}}async function ld(e,t){try{let s=e.split("~*~*");switch(e=s[0],s[1]){case"0":var r="https://compare.buyhatke.com/dealsAPI/pidToList.php";break;case"1":var r="https://compare.buyhatke.com/dealsAPI/pidToListAmaz.php";break;case"2":var r="https://compare.buyhatke.com/dealsAPI/pidToListSnap.php";break;case"3":var r="https://compare.buyhatke.com/dealsAPI/pidToListMyn.php";break;case"4":var r="https://compare.buyhatke.com/dealsAPI/pidToListJab.php";break;default:var r="https://compare.buyhatke.com/dealsAPI/pidToList.php";break}w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var i="ext_id="+w.ext_id+"&auth_val="+w.ext_auth+"&pid="+e,a=await Ae(r,"POST",i,"formData");a&&chrome.tabs.sendMessage(t,{deals:a})}catch(s){R("getDeals",s),J("Error getDeals ",s)}}async function Dr(){await Ft()}Dr();setTimeout(async()=>{await Dr()},1e3*10800);async function qo(){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var e="https://t.buyhatke.com/dynamicExt/offersNew.txt?rand="+Math.floor(Math.random()*1e4+1),t="ext_id="+w.ext_id+"&auth_val="+w.ext_auth,r=await Ae(e,"GET",t,"formData");r!=""&&(au=JSON.parse(r))}catch(i){R("checkStatusPushDeals",i),J("Error checkStatusPushDeals ",i)}}qo();setTimeout(async()=>{await qo()},1e3*1200);async function cd(){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var e="https://t.buyhatke.com/dynamicExt/offers.txt?rand="+Math.floor(Math.random()*1e4+1),t="ext_id="+w.ext_id+"&auth_val="+w.ext_auth,r=await Ae(e,"GET",t,"formData");r!=""&&(hs=JSON.parse(r))}catch(i){R("checkStatusURLDeals",i),J("Error checkStatusURLDeals ",i)}}setTimeout(async()=>{await cd()},1e3*1200);function ud(){let t=parseInt(new Date().getTime()/1e3);return t-t%900}async function el(){try{_s={};var e="https://search-new.bitbns.com/extension/configs-ext/prod/OC_newest.json?rand="+ud(),t=await Ae(e,"GET",{},"formData");if(t!==""){ct=JSON.parse(t);let r=Object.keys(ct),i=Math.floor(Date.now()/1e3);for(let a=0;a<r.length;a++){let s=r[a],o=ct[s];for(let l=0;l<o.length;l++){let c=o[l];if(c.start-i<900&&c.end>i){_s[s]=1;break}}}}}catch(r){R("checkOffersLiveURL",r),J("Error checkOffersLiveURL ",r)}}el();setInterval(async()=>{await el()},1e3*900);async function dd(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var t="https://compare.buyhatke.com/wishlist3/api/fetchWLData.php",r="ext_id="+w.ext_id+"&auth_val="+w.ext_auth,i=await Ae(t,"GET",r,"formData");i!=""&&await x.setItem("mywishlist",i)}catch(a){R("callWishList",a),J("Error callWishList ",ee)}}setTimeout(async()=>{},1e3*3600*24);let to={};function xn(e){const t={},r=e.split("?")[1];if(r){const i=r.split("&");for(const a of i){const[s,o]=a.split("=");t[s]=o}}return t}async function pd(){let e="";try{w.ext_id=await x.getItem("ext_id");let r="";if(typeof w.ext_id>"u"||w.ext_id=="undefined"||w.ext_id==""||parseFloat(w.ext_id)==0||w.ext_id==0||isNaN(parseInt(w.ext_id))||Object.keys(w.ext_id).length==0){if(typeof w.ext_id>"u"||parseFloat(w.ext_id)==0||isNaN(parseInt(w.ext_id))||w.ext_id==0||Object.keys(w.ext_id).length==0){var t="https://compare.buyhatke.com/extensionRegister.php?isNew=3";r="ExtensionInstalled"}else{var t="https://compare.buyhatke.com/extensionRegister.php?isNew=0";r="ExtensionInstalled"}let i=await fetch(t);if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);if(i=await i.text(),e=i.split("~"),e.length>1&&!isNaN(parseInt(e[0]))&&!isNaN(parseInt(e[1]))){await x.setItem("ext_id",e[0]),await x.setItem("ext_auth",e[1]);try{r&&await ge(r,{})}catch{}ao=0;let a=0;chrome.windows.getAll({populate:!0},function(s){s.forEach(async function(o){o.tabs.forEach(async function(l){let c=l.url.toString();if(c.split("chromewebstore.google.com").length>1||c.includes("chrome.google.com")&&c.includes("ojplmecpdpgccookcobabopnaifgidhf")||c.includes("gdgnlfdenkmjcfgjpnookbglpndleahm")||c.includes("id6476868488")){let d=xn(c),f=d.utm_source,p=d.utm_medium;await ls(f,p),a=1}})})}),a==0&&ls("","",a)}}else if(w.ext_id&&w.ext_id.toString().length>15){var t="https://compare.buyhatke.com/extensionRegister.php?isNew=3";r="ExtensionIDUpdated";let a=await fetch(t);if(a.status>=400&&a.status<=599)throw new Error("status: "+a.status);if(a=await a.text(),e=a.split("~"),e.length>1&&!isNaN(parseInt(e[0]))&&!isNaN(parseInt(e[1]))){await x.setItem("ext_id",e[0]),await x.setItem("ext_auth",e[1]);try{r&&await ge(r,{})}catch{}ao=0;let s=0;chrome.windows.getAll({populate:!0},function(o){o.forEach(async function(l){l.tabs.forEach(async function(c){let d=c.url.toString();if(d.split("chromewebstore.google.com").length>1||d.split("chrome.google.com").length>1&&d.split("ojplmecpdpgccookcobabopnaifgidhf").length>1||d.includes("gdgnlfdenkmjcfgjpnookbglpndleahm")||d.includes("id6476868488")){let f=xn(d),p=f.utm_source,u=f.utm_medium;await ls(p,u),s=1}})})}),s==0&&ls("","",s)}}}catch(r){R("getExtId",r),J("Error in getExtId ",r)}}async function fd(){try{let e=await chrome.storage.sync.get("contextId");if(e=e.contextId,!e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let r="";for(let i=0;i<10;i++){const a=Math.floor(Math.random()*t.length);r+=t[a]}chrome.storage.sync.set({contextId:r})}}catch{}}chrome.runtime.onInstalled.addListener(async e=>{if(J({details:e}),!(e.reason!=="install"&&e.reason!=="update")){if(await pd(),e&&e.reason=="update"&&e.previousVersion){let t=chrome.runtime.getManifest().version;if(t&&t.trim()!=e.previousVersion.trim())try{await ge("ExtensionUpdate",{})}catch{}}if(fd(),w.first=await x.getItem("first"),(!w.first||Object.keys(w.first).length==0)&&e.reason==="install")try{chrome.tabs.query({},async t=>{let r="";for(const a of t){const s=a.url||"";if(s.includes("ojplmecpdpgccookcobabopnaifgidhf")||s.includes("gdgnlfdenkmjcfgjpnookbglpndleahm")||s.includes("id6476868488")){const o=xn(s);o&&o.utm_source&&(r=o.utm_source);break}}let i="https://buyhatke.com/getting-started";if(r)try{const s=await(await fetch(`https://search-new.bitbns.com/buyhatke/gettingStarted?source=${encodeURIComponent(r)}`)).json();s&&s.url&&(i=s.url)}catch(a){J(a)}chrome.tabs.create({url:i,active:!0}),await x.setItem("first","true")})}catch(t){J(t)}}});var ao=0,bs=[];async function tl(){try{let e=await x.getItem("paNotifsLinkArr");const t=Array.isArray(e)?e:[];bs.push(...t)}catch(e){J(e)}}tl();async function hd(e){try{return new Promise(t=>{chrome.tabs.create({url:e,active:!0},function(r){chrome.windows.update(r.windowId,{focused:!0},function(){t()})})})}catch(t){J(t)}}async function yd(e){try{await tl();for(let r=0;r<bs.length;r++)bs[r].notfID==e&&await hd(bs[r].URL);if(ir[e]!==void 0){var t=ir[e].listeners.onClicked;_t.destroyNotification(e,t())}chrome.notifications.clear(e,function(){}),await ge("pushNotiClicked")}catch(r){J(r)}}async function ro(e,t,r,i,a,s){w.pushNotStore=await x.getItem("pushNotStore"),w.pushNotStore!=null&&w.pushNotStore!=""&&(ss=JSON.parse(w.pushNotStore)),ss.push({notfID:a,URL:i,image:e,title:t,detail:r,type:s}),ns=JSON.stringify(ss),w.pushNotStore=ns,await x.setItem("pushNotStore",ns),ss=[],ns=""}var ir={};async function Gn(){try{let e=await x.getItem("verifiedExt"),t=await x.getItem("ext_email");if(w.saleMonitor=await x.getItem("saleMonitor"),w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth"),e==1)return vt&&(clearInterval(vt),vt=null),!0;if(t&&e==0){let r=await x.getItem("timeEmailAdded"),i=parseInt(new Date().getTime()/1e3);if(!r||r==""||typeof r=="object"||i-r>3600){await x.setItem("ext_email",""),vt&&(clearInterval(vt),vt=null);return}const a="https://compare.buyhatke.com/extension/checkEmailVerified.php",s="ext_id="+w.ext_id+"&auth_val="+w.ext_auth,o=await Ae(a,"POST",s,"formData");if(o)return await x.setItem("ext_email",o),await x.setItem("verifiedExt",1),await x.setItem("isVerified",1),Ft(),vt&&(clearInterval(vt),vt=null),!0}return!1}catch(e){return R("checkEmailVerified",e),J("Error checkEmailVerified ",e),!1}}Gn();vt=setInterval(async()=>{await Gn()&&vt&&(clearInterval(vt),vt=null)},1e3*60*5);async function md(){wr=0,pa&&(clearInterval(pa),pa=null),pa=setInterval(async()=>{if(wr++,await Gn()){clearInterval(pa),pa=null,wr=0,vt&&(clearInterval(vt),vt=null);return}wr>=su&&(clearInterval(pa),pa=null,wr=0)},1e3*60)}async function wd(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var t="https://compare.buyhatke.com/extension/addSavings.php",r="ext_id="+w.ext_id+"&auth_val="+w.ext_auth+"&savings="+e;await Ae(t,"POST",r,"formData")}catch(i){R("sendSavings",i),J("Error sendSavings ",i)}}async function bd(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var e="https://api.buyhatke.com/compare/extension/getLink4.php",t="ext_id="+w.ext_id+"&auth_val="+w.ext_auth;if(await Ae(e,"POST",t,"formData")){let a=await Ae(e,"GET",t)}}catch(r){R("openLink",r),J("Error openLink ",r)}}async function Id(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var t="https://compare.buyhatke.com/options/listHere.php";if(e!=""&&typeof e<"u"){var r="ext_id="+w.ext_id+"&auth_val="+w.ext_auth+"&fullList="+e;await Ae(t,"POST",r,"formData")}}catch(i){R("sendToServerList",i),J("Error sendToServerList ",i)}}async function al(e){try{w.listNotIDs=await x.getItem("listNotIDs");var t=e;if(typeof t[0].nothing!=null&&typeof t[0].nothing<"u"&&t[0].nothing!=null&&t[0].nothing!="null"){r=0;return}else if(typeof t[0].verifiedExt!=null&&typeof t[0].verifiedExt<"u")await x.setItem("verifiedExt",t[0].verifiedExt),Ft();else if(typeof t[0].prod!=null&&typeof t[0].prod<"u"){var r=1;if(typeof t[0].notID!=null&&(w.listNotIDs&&typeof w.listNotIDs=="string"&&w.listNotIDs.split(t[0].notID).length>1?r=0:(typeof t[0].notID<"u"&&await x.setItem("listNotIDs",w.listNotIDs+"-"+t[0].notID),r=1)),r==1){let i="Rs.";t[0].pos&&(t[0].pos==6326||t[0].pos==6304||t[0].pos==6514||t[0].pos==6306||t[0].pos==1321||t[0].pos==6305||t[0].pos==8958||t[0].pos==6103||t[0].pos==8959||t[0].pos==6307||t[0].pos==8960||t[0].pos==8961||t[0].pos==8962||t[0].pos==8970||t[0].pos==8968||t[0].pos==8971||t[0].pos==6310||t[0].pos==8967||t[0].pos==8969||t[0].pos==8963||t[0].pos==8980)?i="$":t[0].pos&&t[0].pos==8965?i="":t[0].pos&&t[0].pos==8976?i="AED":t[0].currSymbol&&(i=t[0].currSymbol),await ge("priceAlertNotiReceived"),_t.notifyPAImage(t[0].image,t[0].prod+" Price Drop Alert","Price dropped by "+i+" "+t[0].diff+". It is now available at "+i+" "+t[0].cur_price+". Click me to grab the DEAL !",t[0].link,"priceAlertPush"),await ro(t[0].image,t[0].prod+"Price Drop Alert","Price dropped by "+i+" "+t[0].diff+". It is now available at "+i+" "+t[0].cur_price+". Click me to grab the DEAL !",t[0].link,t[0].notID,1)}}else{var r=1;if(typeof t[0].notID!=null&&(w.listNotIDs&&typeof w.listNotIDs=="string"&&w.listNotIDs.split(t[0].notID).length>1?r=0:(typeof t[0].notID<"u"&&await x.setItem("listNotIDs",w.listNotIDs+"-"+t[0].notID),r=1)),r==1){if(typeof t[0].luckyWinner!=null&&typeof t[0].luckyWinner<"u")if(!t[0].expiry||t[0].expiry>Math.floor(Date.now()/1e3)){Mt("pushLucky"+t[0].notID),_t.notifyPAImage(t[0].smallIcon,t[0].title,t[0].desc,t[0].link,"pushLucky"+t[0].notID);return}else Mt("pushLucky-Expired"+t[0].notID);else t[0].smallIcon!=null&&t[0].smallIcon!=""?!t[0].expiry||t[0].expiry>Math.floor(Date.now()/1e3)?(Mt("pushImageIcon"+t[0].notID),_t.notifyIcon(t[0].smallIcon,t[0].title,t[0].desc,t[0].link,"pushImage"+t[0].notID,"",R,J,x)):Mt("pushImageIcon-Expired"+t[0].notID):t[0].image!=null&&t[0].image!=""?!t[0].expiry||t[0].expiry>Math.floor(Date.now()/1e3)?(Mt("pushImage"+t[0].notID),_t.notifyImage(t[0].image,t[0].title,t[0].desc,t[0].link,"pushImage"+t[0].notID,R,J,x)):Mt("pushImage-Expired"+t[0].notID):(Mt("pushNormal"+t[0].notID),_t.notify(t[0].title,t[0].desc,t[0].link,"pushNormal"+t[0].notID,R,J,x));await ro(t[0].image,t[0].title,t[0].desc,t[0].link,t[0].notID,0)}}}catch(i){R("messageRecieved",i),J("Error messageReceived ",i)}}chrome&&chrome.gcm&&chrome.gcm.onMessage.addListener(al);self.addEventListener("push",async function(e){try{await ge("pushNotiReceived");let t=await e.data.json();await al(t)}catch(t){J("push event",t)}});self.addEventListener("pushsubscriptionchange",async function(){try{await _t.subscribe()}catch(e){J("pushsubscriptionchange",e)}});async function gd(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let i=e,a=w.ext_id;var t="https://api.buyhatke.com/paapi/removeStockAlert",r="alert_id="+i+"&ext_id="+a+"&auth_val="+w.ext_auth;let s=await Ae(t,"POST",r,"formData");try{await ge("OOSAlertRemoved",{})}catch{}return s}catch(i){R("removeOOSAlert",i),J("error removeOOSAlert ",i)}}async function kd(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let i=e,a=w.ext_id;var t="https://api.buyhatke.com/paapi/removeAlert",r="link_id="+i+"&ext_id="+a+"&auth_val="+w.ext_auth;let s=await Ae(t,"POST",r,"formData");try{await ge("PriceAlertRemoved",{})}catch{}return s}catch(i){R("removeWatch",i),J("error removeWatch ",i)}}function rn(e){chrome.tabs.onUpdated.addListener(function(t,r){J("here11 ",r),r.status=="complete"})}async function xd(e,t,r,i){try{if(w.setTagType=await x.getItem("setTagType"),w.sourceInstall=await x.getItem("sourceInstall"),w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth"),e==18){let a="https://t.buyhatke.com/Navigation/?tagType="+w.setTagType+"&pos=63&source="+w.sourceInstall+"&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("http://www.amazon.in/");chrome.tabs.create({url:a},function(s){var o=s.id;rn(o)})}else if(r=="nothing"){let a="https://t.buyhatke.com/Navigation/?pos="+e+"&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("https://"+t);chrome.tabs.create({url:a},function(s){var o=s.id;rn(o)})}else{let a="https://t.buyhatke.com/Navigation/?pos="+e+"&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent(t)+"&flag="+r;chrome.tabs.create({url:a},function(s){var o=s.id;rn(o)})}chrome.tabs.update(parseInt(i),{selected:!0}),vd(e)}catch(a){R("getAffCoupons",a),J("Error ",a)}}async function vd(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var t="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/getAutoCoupons.php",r="ext_id="+w.ext_id+"&auth_val="+w.ext_auth+"&flag=1&pos="+e;await Ae(t,"POST",r,"formData")}catch(i){R("getAddCouponsData",i),J("error getAddCouponsData ",i)}}async function rl(){try{await x.setItem("refreshedYetServer",0)}catch(e){R("getRefresh",e),J("Error in getRefresh ",e)}}rl();setTimeout(async()=>{await rl()},1e3*900);function Ad(){_t.notifyPAImage("https://s3-ap-southeast-1.amazonaws.com/push-images/autocoupons-winner-notify.png","You have done it ","Yippeee!! Congrats! you have successfully booked your new phone at Amazon Flash Sale via Buyhatke. Tap to rate us and share your review","http://bit.ly/2sjz41k","pushLucky30012319926"),Mt("pushImageIconFlashSaleDyn-63")}let Td=56,ot;try{ot=browser}catch{ot=chrome}let Ia=0,ia="",Qa="",Ea=0;async function sl(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let t=`https://search-new.bitbns.com/autocoupon-apis/getCoupons?siteId=${e.pos}`;e.cat&&(t+=`&category=${e.cat}`);let r=await fetch(t);if(r.status>=400&&r.status<=599)throw new Error("status: "+r.status);let i=await r.json();if(i.status==0)throw new Error("cannot get coupons");return i.data}catch(t){return R("getCouponsList",t),[]}}async function Gt(){try{if(Object.keys(he).length>0)return he;let e=new Date,r=`https://search-new.bitbns.com/extension/Grocery-Config/platformSearch.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?[]:(i=await i.json(),i&&typeof i=="object"&&(i.setTime=Date.now()),he=i,i)}catch{}}let so={7740:"blinkit",25622:"instamart",7907:"zepto",25850:"jiomart",2268:"bbNow",25848:"flipkart_minutes",25847:"amazon_fresh",7006:"dmart",63:"amazon"};async function _d(){try{let e=await x.getItem("allStoresId"),t=await x.getItem("userLocation");if(!e||!t)return null;let r,i;try{r=typeof e=="string"?JSON.parse(e):e,i=typeof t=="string"?JSON.parse(t):t}catch(o){return console.error(o),null}if(!i||!i.latitude||!i.longitude)return null;let a=[];for(let[o,l]of Object.entries(r)){o==="bigbasket"&&(o="bbNow");let c=Object.keys(so).find(d=>so[d]===o);c&&a.push({storeId:l,pos:parseInt(c),lat:i.latitude,long:i.longitude,pincode:i.pincode||""})}if(a.length===0)return null;let s=await fetch("https://quick.buyhatke.com/extension-apis/grocery/update-store-location",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return s.status>=400&&s.status<599?null:(s=await s.json(),s)}catch{return null}}async function Sd(e,t,r){try{let a=await fetch("https://quick.buyhatke.com/extension-apis/grocery/store-lookup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pos:e,latitude:t,longitude:r})});return a.status>=400&&a.status<599?null:(a=await a.json(),a)}catch{}}async function yt(){try{if(Object.keys(W).length>0)return W;let e=new Date,r=`https://search-new.bitbns.com/extension/Grocery-Config/connectToPlatforms.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?[]:(i=await i.json(),i&&typeof i=="object"&&(i.setTime=Date.now()),W=i,i)}catch{}}async function Yr(){try{if(Object.keys(Le).length>0)return Le;let e=new Date,r=`https://search-new.bitbns.com/extension/Grocery-Config/getAddress.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?[]:(i=await i.json(),i&&typeof i=="object"&&(i.setTime=Date.now()),Le=i,i)}catch{}}async function la(){try{if(Object.keys(Ie).length>0)return Ie;let e=new Date,r=`https://search-new.bitbns.com/extension/Grocery-Config/platformPrice.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?[]:(i=await i.json(),i&&typeof i=="object"&&(i.setTime=Date.now()),Ie=i,i)}catch{}}async function Ta(){try{if(Object.keys(_e).length>0)return _e;let e=new Date,r=`https://search-new.bitbns.com/extension/Grocery-Config/platformCart.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?[]:(i=await i.json(),i&&typeof i=="object"&&(i.setTime=Date.now()),_e=i,i)}catch{}}setInterval(()=>{let e=Date.now(),t=4*60*60*1e3;he&&he.setTime&&e-he.setTime>t&&(he={}),W&&W.setTime&&e-W.setTime>t&&(W={}),Le&&Le.setTime&&e-Le.setTime>t&&(Le={}),Ie&&Ie.setTime&&e-Ie.setTime>t&&(Ie={}),_e&&_e.setTime&&e-_e.setTime>t&&(_e={}),Da&&Da.setTime&&e-Da.setTime>t&&(Da={}),La&&La.setTime&&e-La.setTime>t&&(La={})},24*60*60*1e3);async function Pd(e){try{const t=await x.getItem("ext_id");if(!t)throw new Error("ext_id not found in chromeStorage");const r="https://ext1.buyhatke.com/extension-apis/analytics/track/Auto_Coupon/logs",i={ext_id:t,pos:e.pos,stage:"process_started"},a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(a.status>=400&&a.status<=599)throw new Error(`HTTP error: ${a.status}`);const s=await a.json();if(s.status===0)throw new Error(s.error||"Failed to get process_started id");return s.id}catch(t){return R("getACAnalyticsId",t),null}}async function Od(e,t){try{t=="iOS"||t=="Android"?t="mobile":t="extension";let r=new Date,i=new Date(r.getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate()).getTime(),s=`https://search-new.bitbns.com/buyhatke/get-config?version=${await x.getItem("version")}&type=configs-coupons&pos=${e}&deviceType=${t}&&rand=${i}`,o=await fetch(s);return o.status>=400&&o.status<599?[]:(o=await o.json(),o)}catch(r){return R("getConfig",r),[]}}async function Dd(){try{let e=new Date,r=`https://search-new.bitbns.com/extension/configs-coupons/prod/bankPosConfig.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?[]:(i=await i.json(),i)}catch(e){return R("getConfig",e),[]}}async function Ld(){try{let e=new Date,r=`https://search-new.bitbns.com/extension/configs-coupons/prod/turkFlagCurrencies.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?[]:(i=await i.json(),i)}catch(e){return R("getConfig",e),[]}}async function Ed(e){try{if(ys[e])return ys[e];let t=new Date,r=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()).getTime(),i=`https://search-new.bitbns.com/extension/savings-config/prod/${e}.json?rand=${r}`,a=await fetch(i);return a.status>=400&&a.status<599?"":(a=await a.json(),ys[e]=a,a)}catch(t){return R("getCartConfig",t),""}}async function nl(){try{let e=new Date,r=`https://search-new.bitbns.com/extension/savings-config/prodSiteList/savingSites.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);if(i.status>=400&&i.status<599)return!1;i=await i.json();let a=Object.keys(i);for(let s=0;s<a.length;s++)Ss[a[s]]=i[a[s]]}catch(e){return R("checkCartConfigExistence",e),!1}}nl();setInterval(function(){ys={},Ss={},nl()},8*3600*1e3);async function no(e){try{return Ss[e]!==void 0?Ss[e]:!1}catch(t){return R("checkSavingSites",t),!1}}let vn={};setInterval(function(){vn={}},3600*1e3);async function Nd(e){try{if(!e||vn[e])return[];if(or==="iOS"||or==="Android")return[];let r=new Date,i=new Date(r.getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate()).getTime(),a=`https://search-new.bitbns.com/extension/configs-giftVoucher/prod/${e}.json?rand=${i}`,s=await fetch(a);return s.status==404&&(vn[e]=1),s.status>=400&&s.status<599?"":(s=await s.json(),s)}catch(t){return R("getScrapConfig",t),[]}}let or="";async function il(){try{or=await x.getItem("userPlatform")||""}catch{}return or}il();setInterval(()=>{il()},10*60*1e3);let Ps=new Map;async function Ja(e){try{let t=Ps.get(e),i=or==="iOS"||or==="Android"?"mobile/":"desktop/";if(t)return t.res;let a=new Date,s=new Date(a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()).getTime(),o=`https://search-new.bitbns.com/extension/configs-ext/prod/${i}${e}.json?rand=${s}`,l=await fetch(o);return l.status>=400&&l.status<599?"":(l=await l.json(),l&&l.toCacheInBackgroud&&Ps.set(e,{res:l,setTime:Date.now()}),l)}catch(t){return R("getScrapConfig",t),""}}setInterval(()=>{const e=Date.now();for(const[t,r]of Ps.entries())e-r.setTime>4*60*60*1e3&&Ps.delete(t)},1*60*60*1e3);setInterval(()=>{try{const e=Date.now();for(const[t,r]of va.entries())e-r.setTime>15*60*1e3&&va.delete(t);for(const[t,r]of Ua.entries())e-r.setTime>15*60*1e3&&Ua.delete(t);for(const[t,r]of nr.entries())e-r.setTime>15*60*1e3&&nr.delete(t);for(const[t,r]of $a.entries())e-r.setTime>15*60*1e3&&$a.delete(t)}catch{}},5*60*1e3);let Is={};async function Cn(){try{let e=new Date,r=`https://search-new.bitbns.com/extension/configs-ext/prod/spidyGlobalCountries.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);if(i.status>=400&&i.status<599)return"";i=await i.json(),Is=i}catch(e){return R("getScrapConfig",e),""}}Cn();setInterval(async()=>{await Cn},6*60*60*1e3);let sn=new Map;async function io(){try{if(Object.keys(Da).length>0)return Da;let e=new Date,r=`https://search-new.bitbns.com/extension/Grocery-Config/deliveryConfig.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?!1:(i=await i.json(),i&&typeof i=="object"&&(i.setTime=Date.now()),Da=i,i)}catch(e){return R("getDeliveryConfig",e),!1}}async function Md(){try{if(Object.keys(La).length>0)return La;let e=new Date,r=`https://search-new.bitbns.com/extension/Grocery-Config/rejectionUrls.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?!1:(i=await i.json(),i&&typeof i=="object"&&(i.setTime=Date.now()),La=i,i)}catch(e){return R("getGroceryRejectionConfig",e),!1}}async function Rd(e){try{if(![63,111,2,2191].includes(e))return"";if(sn.has(e))return sn.get(e);let t=new Date,r=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()).getTime(),i=`https://search-new.bitbns.com/extension/config-t/${e}.json?rand=${r}`,a=await fetch(i);return a.status>=400&&a.status<599?"":(a=await a.json(),sn.set(e,a),a)}catch(t){return R("getScrapConfig",t),""}}async function oo(e){try{let t=e;t=t.split("?")[0];for(let r in ol)if(new RegExp(r).test(t))return 1;return 0}catch{return 0}}let ol={};async function ll(){try{let e=new Date,r=`https://search-new.bitbns.com/extension/configs-coupons/prod/untrustedList.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}&r=12`,i=await fetch(r);if(i.status>=400&&i.status<599)return"";ol=await i.json()}catch(e){return R("getUntrustedConfig",e),""}}ll();setInterval(()=>{ll()},12*60*60*1e3);async function jd(e){try{return Object.keys(An).length!==0&&An[e]?0:1}catch(t){return R("CheckToCallACUntrustFunction",t),1}}let An={};async function cl(){try{let e=new Date,r=`https://search-new.bitbns.com/extension/configs-coupons/prod/blockedACList.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}&r=12`,i=await fetch(r);if(i.status>=400&&i.status<599)return"";An=await i.json()}catch(e){return R("getUntrustedConfig",e),""}}cl();setInterval(()=>{cl()},12*60*60*1e3);async function Ud(e){var t;try{const r=`flightToken:${e.link}`,i=30*60*1e3,s=(await chrome.storage.local.get(r))[r];if(s){if(Date.now()-s.timestamp<i)return s.token;await chrome.storage.local.remove(r)}let l=await fetch("https://ext1.buyhatke.com/extension-apis-test/travel-apis/create-generic",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});if(!l.ok)return"";const c=await l.json();if((t=c.data)!=null&&t.sessionToken){const d={token:c.data.sessionToken,timestamp:Date.now()};return await chrome.storage.local.set({[r]:d}),c.data.sessionToken}return""}catch{return""}}async function $d(e){try{let i=await fetch("https://ext1.buyhatke.com/extension-apis-test/travel-apis/poll-ext",{method:"POST",body:JSON.stringify({sessionToken:e}),headers:{"Content-Type":"application/json"}});if(i.status>=400&&i.status<599)return"";return i=await i.json(),i.data;return""}catch{return""}}async function Jd(){try{let e=new Date,r=`https://search-new.bitbns.com/extension/configs-ext/prod/turkCountries.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(e){return R("getScrapConfig",e),""}}async function lo(){try{let e=new Date,r=`https://search-new.bitbns.com/extension/configs-ext/prod/electronicCats.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(e){return R("getElectronicProduct",e),""}}async function Fd(){try{let e=new Date,r=`https://search-new.bitbns.com/extension/configs-ext/prod/electronicList.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(e){return R("getElectronicProduct",e),""}}let vr=[];async function qn(){try{if(vr.length)return vr;let e=new Date,r=`https://search-new.bitbns.com/extension/configs-ext/prod/posForSearchPids.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?[]:(vr=await i.json(),vr)}catch(e){return R("getSkuForSearch",e),[]}}setInterval(()=>{vr=[],qn()},24*60*60*1e3);qn();let Za=null;async function ei(){try{if(Za&&Object.keys(Za).length)return Za;let e=new Date,r=`https://search-new.bitbns.com/extension/configs-ext/prod/dealsValidity.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?{}:(Za=await i.json(),Za)}catch(e){return R("getDealsValidityConfig",e),{}}}setInterval(()=>{Za=null,ei()},12*60*60*1e3);ei();async function ul(){try{let e=new Date,r=`https://search-new.bitbns.com/extension/configs-ext/prod/countryInfo.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(e){return R("getScrapConfig",e),""}}let Qr={};async function dl(){try{let e=new Date,r=`https://search-new.bitbns.com/extension/configs-ext/prod/grocerystoreAPIs.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}&1`,i=await fetch(r);if(i.status>=400&&i.status<599)return"";i=await i.json(),Qr=i}catch(e){return R("getGroceryStoreMap",e),""}}dl();async function Tn(e,t){try{let r=`https://search-new.bitbns.com/buyhatke/getDittoSearchNew?pos=${t}&pid=${e}`,i=await fetch(r);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(r){return R("getDittoSearchData",r),""}}async function Bd(e,t){try{Object.keys(Aa).length===0&&await qr();for(const a in Aa)if(e.startsWith(a))return"";let r=`https://search-new.bitbns.com/buyhatke/comparePrice?PID=${e}&pos=${t}&trst=1`,i=await fetch(r);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(r){return R("getDittoSearchData",r),""}}let Lt="",Gr="",lr="",Cr="",gs=[],Os="",_n="",Sn="",Pn="",On="",pl="",fl="",hl="",Hd=0,yl=.05,Dn="",Ln="",ml=[],wl=[];async function _a(){try{let e=new Date,r=`https://search-new.bitbns.com/extension/configs-ext/prod/sd.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}123`,i=await fetch(r);return i.status>=400&&i.status<599?"":(i=await i.json(),Lt=i.d,Gr=i.c,lr=i.h,Cr=i.g,gs=i.r,Os=i.a,Pn=i.e,On=i.f,pl=i.j,fl=i.k,hl=i.i,Hd=i.l,ml=i.m||[],wl=i.n||[],_n=i.o,Sn=i.p,yl=i.q,Dn=i.plu,Ln=i.proVersion,i)}catch{return""}}async function Vd(e,t){try{let r=`https://search-new.bitbns.com/buyhatke/getDittoSearchNewGlobal?pos=${t}&pid=${e}`,i=await fetch(r);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(r){return R("getDittoSearchNewGlobal",r),""}}function M(e,t,r=!1){let i=e;if(typeof t=="object"){for(let a of t){let s=i;try{let o=a.split(".");r&&(o=a.split("~"));for(let l of o)s=s[l];if(s)return s}catch{}}throw new Error("Couldn't extract path !!")}else{let a=t.split(".");r&&(a=t.split("~"));for(let s of a)i=i[s];return i}}async function Xa(e){var t;try{let r;if(Ot)r=Ot;else{let f=new Date,u=`https://search-new.bitbns.com/extension/configs-spendCalc/prodNew/liveSpendConfig.json?rand=${new Date(f.getFullYear()+"/"+(f.getMonth()+1)+"/"+f.getDate()).getTime()}`;if(r=await fetch(u),r.status>=400&&r.status<599)return"";r=await r.json(),Ot=r}let i=r.spendPanelURL||"",a=r.currencyMap[e]||"",s=r.liveSites[e]||[],o=r.mobileLiveSites[e]||[],l=!!(r.autoSyncEnabled&&r.autoSyncEnabled[e]),c=(((t=r==null?void 0:r.multiPos)==null?void 0:t[e])||[]).map(f=>{var p;return{pos:f,currency:((p=r==null?void 0:r.currencyMap)==null?void 0:p[f])||""}}),d=(r==null?void 0:r.amazonLivesites)||[];return{spendLiveURLArr:s,spendPanelURL:i,spendCurrency:a,autoSyncEnabled:l,amazonLivesites:d,multiPos:c,mobileSpendLiveURLArr:o}}catch(r){R("checkIfSpendLive",r)}return{spendLiveURLArr:[],spendPanelURL:"",spendCurrency:"",autoSyncEnabled:!1}}function Ht(e){const t=new Date(e),r=t.getFullYear(),i=t.getMonth(),a=Math.floor(i/3);return`${r}_${a}`}async function cr(e,t){return new Promise((r,i)=>{chrome.tabs.sendMessage(e,t,a=>{chrome.runtime.lastError?i(new Error(chrome.runtime.lastError.message)):r(a)})})}function sr(e,t,r,i){var p;let a={},s={},o;if(!e.addressDetails)return a;const l=(u,I)=>{try{const k=I.split(".");let y=u;for(let b=0;b<k.length-1;b++){if(!y[k[b]])return;y=y[k[b]]}delete y[k[k.length-1]]}catch{Z("ERROR_DELTEPATH_FORMATADDDETAILS",i)}};function c(u){try{let I="";u!=null&&u.flatNo&&(I+=(u==null?void 0:u.flatNo)+", ",delete u.flatNo),u!=null&&u.addressLine1&&(I+=(u==null?void 0:u.addressLine1)+", ",delete u.addressLine1),u!=null&&u.addressLine2&&(I+=(u==null?void 0:u.addressLine2)+", ",delete u.addressLine2),u!=null&&u.addressLine3&&(I+=(u==null?void 0:u.addressLine3)+", ",delete u.addressLine3),I=I.replace(/, $/,""),u.addressLine=I}catch{Z("ERROR_PROCESSADDLINES_FORMATADDDETAILS",i)}}function d(u){let I="";u.firstName&&(I+=u.firstName+" ",delete u.firstName),u.lastName&&(I+=u.lastName,delete u.lastName),u.name=I}try{for(let u of e.addressDetails){let I=M(t,u.value);if(e.addressPath){o=M(t,e.addressPath)||[];for(let k of o)k.types.includes(u.value)&&(I=k[e.addPathList[u.value]])}I!=null&&I!==""&&(a[u.key]=I,l(t,u.value))}(a.addressLine1||a.addressLine2||a.addressLine3)&&c(a),(a.firstName||a.lastName)&&d(a)}catch(u){Z(`ERROR_${JSON.stringify(u)}_ADDDETAILS_FORMATADDDETAILS`,i)}if(e.addressJSON)try{for(let u of e.addressJSON){let I=M(t,u.value);I!=null&&I!==""&&(s[u.key]=I)}}catch(u){Z(`ERROR_${JSON.stringify(u)}_ADDJSON_FORMATADDDETAILS`,i)}return!Object.keys(s).length&&(e!=null&&e.addressDetails)&&((p=e==null?void 0:e.addressDetails)==null?void 0:p.empty)==="empty"&&(s.address=t),{addressJSON:s,...a}}async function co(e,t,r,i,a,s,o={},l,c){var d,f,p,u,I,k,y,b,h,m,A,P;try{let S,v=t.dataExtractor.orderApi,_=v.url,T=Object.assign({},v.options)||{};if(t.localStorageKeys)for(let L in t.localStorageKeys){let D=a[L];D&&(T.headers=JSON.parse(JSON.stringify(T.headers).replace(t.localStorageKeys[L],D)))}if(v!=null&&v.useCookie){let L;typeof(v==null?void 0:v.useCookie)=="object"?L=l.split("; ").filter(D=>D.startsWith(`${v.useCookie.mainKey}=`))[0].split("=")[1]:L=l.split("; ").filter(D=>D.startsWith(`${v.useCookie}=`))[0].split("=")[1];try{L=decodeURIComponent(L)}catch{L=L}try{let D=JSON.parse(L);L=M(D,(d=v==null?void 0:v.useCookie)==null?void 0:d.jsonPath)}catch{L=L}T.headers=(T==null?void 0:T.headers)&&JSON.parse(JSON.stringify(T.headers).replace("PLACEHOLDER2",L))}if(T.body)for(let L in r)T.body=T.body.replace(L,r[L]);if(t.dataFromDom)for(let L in t.dataFromDom)try{let D=c[L];D&&(T.headers=JSON.parse(JSON.stringify(T.headers).replace(t.dataFromDom[L].placeholder,D)),_=_.replace(t.dataFromDom[L].placeholder,D))}catch{}if(r)for(let L in r)r[L]&&((p=(f=t==null?void 0:t.dataExtractor)==null?void 0:f.orderApi)!=null&&p.ParamEncode)&&(r[L]=encodeURIComponent(r[L])),_=_.replace(L,r[L]);let E;try{if(E=await St(e,_,T),E.status>=300)throw new Error("Some error in API")}catch{}let g=await E.text();dt[e]=g;let O=(u=v==null?void 0:v.script)!=null&&u.splitForJSON?g.split(v.script.splitForJSON)[1]:g,$;try{$=(I=v==null?void 0:v.script)!=null&&I.splitForJSON?JSON.parse(O.split("};")[0]+"}"):JSON.parse(g)}catch{try{let D=0,V=-1;for(let ae in O){ae=parseInt(ae);let te=O[ae];if(te=="{")D++;else if(te=="}"&&(D--,D==0)){V=ae+1;break}}V==-1&&(V=O.length),O=O.substring(O.indexOf("{"),V),O=JSON.parse(O),v!=null&&v.checkVal&&($=M(O,v==null?void 0:v.checkVal))}catch{}}S=v!=null&&v.orderStatus?M($,v==null?void 0:v.orderStatus):S;let K=(k=v==null?void 0:v.script)!=null&&k.jsonPath?M($,(y=v==null?void 0:v.script)==null?void 0:y.jsonPath):(b=v==null?void 0:v.pidAttributes)!=null&&b.pidList?M($,(h=v==null?void 0:v.pidAttributes)==null?void 0:h.pidList):$,z=((m=v==null?void 0:v.script)==null?void 0:m.discountPath)&&M($,v.script.discountPath);if(v!=null&&v.pidPath){let L=M($,v.pidPath)||$;if(L&&typeof L=="object")for(let D in L)try{o[D]=L[D]}catch{Z(`ERROR_${D}_ORDERSCRIPT_ORDERDETAILS`,e)}}if(v!=null&&v.orderDetails)for(let L of v.orderDetails)try{s[L.key]=M($,L.value)}catch{Z(`ERROR_${L==null?void 0:L.key}_ORDERSCRIPT_ORDERDETAILS`,e)}let F=0;try{for(let L in K)try{for(let D of v.pidAttributes.itemDetails){let V=D!=="same"?M(K[L],D):K[L],ae={},te=v.pidAttributes.itemAtt;for(let ne in te)try{for(let q in V){if(ne=="price"){let re=Array.isArray(V)?parseFloat(M(V[q],te[ne]).replace(",","")):parseFloat(typeof M(V,te[ne])=="string"?M(V,te[ne]).replace(",",""):M(V,te[ne]));D!=="returnRequests"&&D!=="same"&&(F+=re),ae[ne]=re}if(ne=="pid")if(typeof te[ne]!="string")for(let re of te[ne])try{let ue=Array.isArray(V)?M(V[q],re):M(V,re);if(ue){ae[ne]=ue;break}}catch{Z(`ERROR_${re}_ORDERSCRIPT_PIDARR`,e)}else ae[ne]=Array.isArray(V)?M(V[q],te[ne]):M(V,te[ne]);else ae[ne]=Array.isArray(V)?M(V[q],te[ne]):M(V,te[ne])}}catch{Z(`ERROR_${ne}_ORDERSCRIPT_PIDARR`,e)}i.push(ae)}}catch{Z("ERROR_ORDERSCRIPTPIDARR",e)}if((A=v==null?void 0:v.pidAttributes)!=null&&A.discounts)for(let L of(P=v==null?void 0:v.pidAttributes)==null?void 0:P.discounts)try{F-=M(z,L)}catch{Z("ERROR_ORDERSCRIPT_DISCOUNTS",e)}}catch{Z("ERROR_PIDARR",e)}return{orderTotal:(F<0?0:F)||0,orderStatus:S}}catch(S){return Z(JSON.stringify(S),e),{orderTotal:0,orderStatus:""}}}function Wd(e,t,r){try{let i=[],a={};for(let o in e){let l=e[o],c=null;try{for(let d=0;d<r.length;d++){let f=r[d];if(f&&l){let p;try{p=M(f,l)}catch{p=void 0}if(p!=null){c=p;break}}}a[o]=c}catch{Z(`ERROR_${o}_EXTANDGRPATTR`,sitePos)}}let s=a?Math.max(...Object.values(a).map(o=>o?o.length:0)):0;for(let o=0;o<s;o++){let l={};try{for(let c in t){let d=t[c],f=Object.keys(e).find(p=>e[p]===e[c]);a[f]&&a[f][o]?l[c]=M(a[f][o],d):l[c]=void 0}i.push(l)}catch{Z("ERROR_MAXLEN_EXTANDGRPATTR",sitePos)}}return i}catch(i){Z(`ERROR_${JSON.stringify(i)}_EXTANDGRPATTR`,sitePos)}}function bl(e,t,r,i){try{let a=new RegExp(t.slice(1,-1)),s=e.match(a);if(s){let[,o,l,c]=s;r!=null&&r.dateOrder&&([,l,o,c]=s);let d={"01":"01","02":"02","03":"03","04":"04","05":"05","06":"06","07":"07","08":"08","09":"09",10:"10",11:"11",12:"12",Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12",January:"01",February:"02",March:"03",April:"04",May:"05",June:"06",July:"07",August:"08",September:"09",October:"10",November:"11",December:"12",Ocak:"01",ubat:"02",Mart:"03",Nisan:"04",Mays:"05",Haziran:"06",Temmuz:"07",Austos:"08",Eyll:"09",Ekim:"10",Kasm:"11",Aralk:"12"};return r!=null&&r.isYearFirstInDate&&([,c,l,o]=s),l.length<2&&(l=l.padStart(2,"0")),o.length<2?`${c}-${d[l]}-${o.padStart(2,"0")}`:`${c}-${d[l]}-${o}`}else return null}catch(a){return Z(`${JSON.stringify(a)}_FORMATDATE`,i),null}}async function Kd(e,t,r,i){var a,s,o,l,c,d,f,p,u,I,k;try{let y=[],b={moreOrdersAvailable:M(t,(a=r==null?void 0:r.paginationFields)==null?void 0:a.moreOrdersAvailable),pageOffset:M(t,(s=r==null?void 0:r.paginationFields)==null?void 0:s.pageOffset),prevOrders:M(t,(o=r==null?void 0:r.paginationFields)==null?void 0:o.prevOrders),nextPageUrl:M(t,(l=r==null?void 0:r.paginationFields)==null?void 0:l.nextPageUrl)};const h=_=>{let T=_==null?void 0:_.match(/\/detail\/(\d+)\//);return T?T[1]:null},m=_=>typeof _=="string"?_.replace(/[^0-9.]/g,""):_,A=_=>{let T=_==null?void 0:_.match(/\.v=([^&]+)/);return T?T[1]:null},P=_=>{var T,E,g;for(let O in _)if(O.startsWith("order-")){let $=_[O],K=[],z=Object.values($).find(L=>{var D;return(D=L==null?void 0:L.d)==null?void 0:D.orderDetailUrl}),F=h((T=z==null?void 0:z.d)==null?void 0:T.orderDetailUrl);$!=null&&$.c&&Array.isArray($==null?void 0:$.c)&&((E=$==null?void 0:$.c)==null||E.forEach(L=>{var D,V,ae,te,ne,q,re;try{if((D=$[L])!=null&&D.d){let ue=(V=$[L])==null?void 0:V.d,Te=A((ae=ue==null?void 0:ue.imageData)==null?void 0:ae.src);K.push({itemId:L||"",productName:M(ue,(te=r==null?void 0:r.processOrdersFields)==null?void 0:te.productName)||"",quantity:M(ue,(ne=r==null?void 0:r.processOrdersFields)==null?void 0:ne.quantity)||0,price:m(ue==null?void 0:ue.totalPrice)||0,imageUrl:M(ue,(q=r==null?void 0:r.processOrdersFields)==null?void 0:q.imageUrl)||"",imageVersion:Te||"",orderDetailUrl:M(ue,(re=r==null?void 0:r.processOrdersFields)==null?void 0:re.orderDetailUrl)||"",orderNumber:F||""})}}catch{Z(`ERROR_${L}_FORMATORDERLIST`,i)}})),y.push({orderId:((g=$==null?void 0:$.d)==null?void 0:g.webOrderNumber)||"",orderNumber:F||"",items:K||[]})}};t!=null&&t.orderList&&P(t==null?void 0:t.orderList);let S=r==null?void 0:r.maxIterations,v=0;for(;v<S&&(b!=null&&b.moreOrdersAvailable);)try{let _=await St(e,b==null?void 0:b.nextPageUrl,{method:"POST",headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded",modelversion:"v2",syntax:"graviton","x-aos-model-page":"OrdersPage","x-aos-stk":(c=t==null?void 0:t.meta)==null?void 0:c.h["x-aos-stk"],"x-requested-with":"Fetch"},body:new URLSearchParams({"orderList.pageOffset":(b==null?void 0:b.pageOffset)+1,"orderList.prevOrders":b==null?void 0:b.prevOrders,"orderList.lastOrder":(f=(d=t==null?void 0:t.orderList)==null?void 0:d.d)==null?void 0:f.lastOrder}),credentials:"include"});if(!_.ok)break;let T=await _.json();dt[i]=T,v++,b.moreOrdersAvailable=M(T,(p=r==null?void 0:r.nextPaginationFields)==null?void 0:p.moreOrdersAvailable),b.pageOffset=M(T,(u=r==null?void 0:r.nextPaginationFields)==null?void 0:u.pageOffset),b.prevOrders=M(T,(I=r==null?void 0:r.nextPaginationFields)==null?void 0:I.prevOrders),P((k=T==null?void 0:T.body)==null?void 0:k.orderList)}catch{break}return{orders:y,pagination:b}}catch(y){Z(`ERROR_${JSON.stringify(y)}_FORMATORDERLIST`,i)}}function zd(e,t,r){var i,a,s,o,l,c,d,f,p,u,I,k,y,b,h,m,A,P,S,v,_,T;try{let E=e==null?void 0:e.orderDetail,g=[];try{const O=D=>{var V;if(typeof D=="string"){let ae=((V=D.match(/[^0-9.,\s]/))==null?void 0:V[0])||"",te=parseFloat(D.replace(/[^0-9.]/g,""));return{currencySymbol:ae,numericValue:isNaN(te)?0:te}}return{currencySymbol:"",numericValue:isNaN(D)?0:D}},$=D=>{let V={January:"01",February:"02",March:"03",April:"04",May:"05",June:"06",July:"07",August:"08",September:"09",October:"10",November:"11",December:"12"};if(!D)return null;let ae=D==null?void 0:D.match(/^(\w+)\s+(\d{1,2}),\s+(\d{4})$/),te=D==null?void 0:D.match(/^(\d{1,2})\s+(\w+)\s+(\d{4})$/);if(ae){let[,ne,q,re]=ae,ue=q==null?void 0:q.padStart(2,"0"),Te=V[ne]||"00";return`${re}-${Te}-${ue}`}else if(te){let[,ne,q,re]=te,ue=ne.padStart(2,"0"),Te=V[q]||"00";return`${re}-${Te}-${ue}`}return D};let K=D=>{let V=D==null?void 0:D.match(/\.v=([^&]+)/);return V?V[1]:null};for(let D in E==null?void 0:E.orderItems)if(D.startsWith("orderItem-")){let V=E==null?void 0:E.orderItems[D],ae=M(V,(i=t==null?void 0:t.orderItemsFields)==null?void 0:i.status)||null,te=M(V,(a=t==null?void 0:t.orderItemsFields)==null?void 0:a.status2)||null,ne=D.replace("orderItem-",""),q=((o=(s=V.shippingInfo)==null?void 0:s["shipping-address"])==null?void 0:o.d)||null,re=K(M(V,(l=t==null?void 0:t.orderItemsFields)==null?void 0:l.imageVersion)),ue=O(M(V,(c=t==null?void 0:t.orderItemsFields)==null?void 0:c.priceDetails));g.push({itemId:ne,productName:((f=(d=V.orderItemDetails)==null?void 0:d.d)==null?void 0:f.productName)||"",quantity:((u=(p=V.orderItemDetails)==null?void 0:p.d)==null?void 0:u.quantity)||0,price:ue.numericValue||0,currency:ue.currencySymbol||"",image:((y=(k=(I=V.orderItemDetails)==null?void 0:I.d)==null?void 0:k.imageData)==null?void 0:y.src)||"",imageVersion:re||"",status:te||ae||"",...q&&{shippingAddress:q}})}let z=O((h=(b=E==null?void 0:E.pricingSummary)==null?void 0:b.d)==null?void 0:h.orderTotal),F=z==null?void 0:z.numericValue;(m=g[0])!=null&&m.status&&(t!=null&&t.invalidStatus.includes((A=g[0])==null?void 0:A.status.trim().toLowerCase()))&&(F=0);let L=((S=(P=E.billingInfo)==null?void 0:P["billing-contact-info"])==null?void 0:S.d)||null;return{orderId:M(E,(v=t==null?void 0:t.orderDetailsFields)==null?void 0:v.orderId)||"",orderDate:$(M(E,(_=t==null?void 0:t.orderDetailsFields)==null?void 0:_.orderDate,r))||"",orderTotal:F||0,currency:z.currencySymbol||"",orderStatus:((T=g[0])==null?void 0:T.status)||null,items:g||[],billingInfo:L||null}}catch{return null}}catch(E){return Z(`ERROR_${JSON.stringify(E)}_FORMATORDERDETAILS`,r),null}}function Zd(e,t){try{let r=e.indexOf(t);if(r===-1)return null;let i=e.indexOf("{",r);if(i===-1)return null;let a=0,s=i;for(;s<e.length&&(e[s]==="{"?a++:e[s]==="}"&&a--,a!==0);s++);if(a!==0)return null;let o=e.slice(i,s+1);try{return JSON.parse(o)}catch{return{}}}catch{return{}}}async function Xd(e,t,r,i,a,s,o,l,c,d=0,f={},p,u){var I,k,y,b,h,m,A,P,S,v,_,T,E,g,O,$,K,z,F,L;try{let D=t.dataExtractor.pidAttributes.pidApi,V=D.url,ae,te=Object.assign({},D.options),ne=!1;if(t.localStorageKeys)for(let j in t.localStorageKeys){let N=a[j];if(N){let X=typeof t.localStorageKeys[j]=="object"?(I=t.localStorageKeys[j])==null?void 0:I.value:t.localStorageKeys[j];te.headers=JSON.parse(JSON.stringify(te.headers).replaceAll(X,N)),te.body&&(te.body=JSON.parse(JSON.stringify(te.body).replaceAll(X,N)))}}if(D.useCookie){let j=Array.isArray(D.useCookie)?D.useCookie:[D.useCookie];for(let N of j){let X;if(typeof N=="object")try{N.getHttpSecureCookie?X=await ui(N.getHttpSecureCookie.url,N.getHttpSecureCookie.value):X=f.split("; ").filter(ie=>ie.startsWith(`${N.mainKey}=`))[0].split("=")[1]}catch{}else X=f.split("; ").filter(ie=>ie.startsWith(`${N}=`))[0].split("=")[1];try{X=decodeURIComponent(X)}catch{X=X}if(typeof N=="object"&&N.jsonPath)try{let ie=JSON.parse(X);X=M(ie,N.jsonPath)}catch{X=X}X||Z("MISSING_COOKIE",e),typeof N=="object"&&N.replaceWith?te.headers=JSON.parse(JSON.stringify(te.headers).replaceAll(N.replaceWith,X)):te.headers=JSON.parse(JSON.stringify(te.headers).replaceAll("PLACEHOLDER2",X))}}if(r){t.dataExtractor.commonAttributes.condRepl&&t.dataExtractor.commonAttributes.condRepl.group_Id&&(M(r,(k=D==null?void 0:D.checkVal)==null?void 0:k.key)===((y=D==null?void 0:D.checkVal)==null?void 0:y.value)?V=V.replace(D==null?void 0:D.toReplace,D==null?void 0:D.replaceWith[0]):V=V.replace(D==null?void 0:D.toReplace,D==null?void 0:D.replaceWith[1]));for(let j in r)r[j]&&((m=(h=(b=t==null?void 0:t.dataExtractor)==null?void 0:b.pidAttributes)==null?void 0:h.pidApi)!=null&&m.ParamEncode)&&(r[j]=encodeURIComponent(r[j])),V=V.replace(j,r[j])}if(te.body)if(D.replaceAllParams)for(let j in r){const N=new RegExp(j,"g");te.body=te.body.replace(N,r[j])}else for(let j in r)if(j==="APOLLOBILLNUMBER"){let N=r[j]===null?"null":`"${r[j]}"`;te.body=te.body.replace(`"${j}"`,N)}else te.body=te.body.replace(j,r[j]);if(t.dataFromDom)for(let j in t.dataFromDom)try{let N=p[j];N&&(te.headers=JSON.parse(JSON.stringify(te.headers).replace(t.dataFromDom[j].placeholder,N)),V=V.replace(t.dataFromDom[j].placeholder,N))}catch{Z("ERROR_SPECPID_DATAFROMDOM",e)}let q;try{if(t.domAPI){let j=await cr(d,{action:"callAPIFromDOM",data:{eachUrl:V,eachOptions:te}});if(q=j==null?void 0:j.result,D!=null&&D.script&&((A=D==null?void 0:D.script)!=null&&A.startMarker)&&((P=D==null?void 0:D.script)==null?void 0:P.jsonIndex)!==void 0){q=q==null?void 0:q.result;let N=q.split(`
`),X=N&&N.find(ie=>ie.trim().startsWith(D.script.startMarker));try{if(X){let ie=X.trim().substring(D.script.startMarker.length).trim();ae=JSON.parse(ie)[D.script.jsonIndex].pidApi.script.jsonData}}catch{Z("ERROR_SPECPID_DOMAPI_TGTLINE",e)}}else q=JSON.parse(q==null?void 0:q.result),q!=null&&q.data&&(q=q==null?void 0:q.data),ae=q||{}}else{q=await St(e,V,te);let j=q.headers&&q.headers.get("content-type");if((S=t==null?void 0:t.script)!=null&&S.name&&j&&j.includes("text/html")){let N=await q.text();dt[e]=N;let X=new RegExp(`<script id="${(v=t==null?void 0:t.script)==null?void 0:v.name}"[^>]*>([\\s\\S]*?)<\\/script>`,"i"),ie=N.match(X);if(ie&&ie[1])try{const H=JSON.parse(ie[1]);ae=zd(H,t,Tt,e)}catch{Z("ERROR_SCRIPTREG_SPECPID",e)}}else if(D!=null&&D.addressRegex)try{ae=await q.text(),dt[e]=ae}catch{Z("ERROR_ADDRESSREG_SPECPID",e)}else if(t!=null&&t.getSpecificJSONfromDomScript){let N=await q.text();dt[e]=N;let X=(T=(_=t==null?void 0:t.getSpecificJSONfromDomScript)==null?void 0:_.script)!=null&&T.splitForJSON?N.split(t==null?void 0:t.getSpecificJSONfromDomScript.script.splitForJSON)[1]:N;try{ae=(g=(E=t==null?void 0:t.getSpecificJSONfromDomScript)==null?void 0:E.script)!=null&&g.splitForJSON?JSON.parse(X.split("};")[0]+"}"):JSON.parse(N)}catch{try{let H=0,me=-1;for(let pe in X){pe=parseInt(pe);let Pe=X[pe];if(Pe=="{")H++;else if(Pe=="}"&&(H--,H==0)){me=pe+1;break}}me==-1&&(me=X.length),X=X.substring(X.indexOf("{"),me),X=JSON.parse(X),(O=t==null?void 0:t.getSpecificJSONfromDomScript)!=null&&O.checkVal&&(ae=M(X,($=t==null?void 0:t.getSpecificJSONfromDomScript)==null?void 0:$.checkVal))}catch{}}}else ae=await q.json(),dt[e]=ae}if(q.status>=300)throw new Error("Some error in API")}catch{Z("ERROR_SPECPID_DOMAPI",e)}let re=0,ue="",Te="",se=D==null?void 0:D.pidApiAttributes,Ee=[],Je="",Se={},We=0,st=0,ve=0,Ke;if(se!=null&&se.outerItemList)try{let j=M(ae,se.outerItemList);for(let N of j)try{t!=null&&t.commonStatus&&(Ke=M(N,t.commonStatus));let X=M(N,se.itemDetails);if(t!=null&&t.commonStatus)for(let ie of X)Ee.push({...ie,commonStatus:Ke});else for(let ie of X)Ee.push(ie)}catch{Z(`ERROR_SPECPID_${N}_OUTERITEMLIST`,e)}}catch{Z("ERROR_SPECPID_OUTERITEMLIST",e)}else if(se!=null&&se.itemDetails)Ee=M(ae,se.itemDetails);else if(D!=null&&D.addressRegex)try{c.addressJSON=Zd(ae,D==null?void 0:D.addressRegex)}catch{}if(se!=null&&se.orderDetails)for(let j in se==null?void 0:se.orderDetails)try{let N=se==null?void 0:se.orderDetails[j];if(typeof N=="object"&&N!==null&&!Array.isArray(N)){if(N!=null&&N.sel&&Array.isArray(N==null?void 0:N.sel)){let X;for(let H of N==null?void 0:N.sel)try{if(X=M(ae,H),X)break}catch{Z(`ERROR_${H}_SPECPIDORDERLIST`,e)}let ie=!1;if(N!=null&&N.toCheck&&Array.isArray(N==null?void 0:N.toCheck))for(let H of X)for(let me of N==null?void 0:N.toCheck)try{let pe=M(H,me);if(ie)break;if(pe&&pe.trim().toLowerCase().includes(N==null?void 0:N.shouldInclude)&&Array.isArray(N==null?void 0:N.extractValue))for(let Pe of N==null?void 0:N.extractValue)try{N=M(H,Pe),N&&(c[j]=typeof N=="string"?N.trim():N,ie=!0)}catch{Z("ERROR_EXTRACTVAL_SPECPID",e)}}catch{Z("ERROR_TOCHECK_SPECPID",e)}if(ie)continue}c[j]={};for(let X in N)c[j][X]=M(ae,N[X])}else c[j]=M(ae,se==null?void 0:se.orderDetails[j])}catch{Z(`ERROR_${j}_SPECPIDORDERLIST`,e)}for(let j in se)try{if(j=="orderTotal")re=M(ae,se[j]);else if(j==="orderTotal2")try{let ie=M(ae,se[j]).replace(/|,/g,"").split("-").map(me=>parseFloat(me.trim()));st=Math.max(...ie)}catch{Z("ERROR_ORDERTOTAL2_SPECPID",e)}else if(j=="getOrderTotalFromArray")try{let N=M(ae,se[j].orderTotalListPath),X=null;for(let ie of N)try{let H=M(ie,se[j].reqAttrKey),me=se[j].reqAttrVal;H==me&&(X=ie)}catch{}if(X)try{let ie=M(X,se[j].orderTotalKey);const H=new RegExp(se[j].currencyRegex,"u"),me=new RegExp(se[j].amountRegex,"u");let pe=null,Pe=null;const qe=ie.match(H);qe&&(pe=qe[0]);const B=ie.match(me);B&&(Pe=B[0]),Pe&&pe&&(Pe=Pe.replaceAll(",",""),Pe=parseFloat(Pe),st=Pe,c.curr=pe,u[pe]?u[pe]+=1:u[pe]=1)}catch{}}catch{}else if(j=="orderTotal2Array")for(let N of se[j])try{let H=M(ae,N).replace(/|,/g,"").split("-").map(pe=>parseFloat((pe.match(/[\d.,]+/)||[""])[0].replace(/,/g,""))),me=Math.max(...H);if(!isNaN(me)){st=me;break}}catch{}else if(j=="orderStatus")Te=M(ae,se[j]);else if(j=="orderUrl"){ue=se.orderUrl;for(let N in r)ue=ue.replace(N,r[N])}else if(j=="orderDate"){const N=await M(ae,se[j]);D.dateFormatRegex?Je=bl(N,D.dateFormatRegex,t,e):Je=(K=N==null?void 0:N.match(/^\d{4}-\d{2}-\d{2}/))==null?void 0:K[0]}else if(j=="orderDiscount")We=M(ae,se[j]),We=parseFloat(We);else if(j=="variousCharges")try{let N=M(ae,se[j]);for(let X of N){let ie;typeof(X==null?void 0:X.value)=="string"?ie=parseFloat(X==null?void 0:X.value.replace(/[^0-9.-]+/g,"")):typeof(X==null?void 0:X.value)=="number"&&(ie=X==null?void 0:X.value),isNaN(ie)||(ve+=ie)}}catch{Z("ERROR_VARIOUSCHANGES_SPECPID",e)}else if(j=="itemAtt"){let N=se[j];if(D!=null&&D.isMul)try{let X=D!=null&&D.pidArrPath?Wd(D==null?void 0:D.pidArrPath,se==null?void 0:se.itemAtt,ae,e):Ee;for(let ie of X)try{let H={},me=D!=null&&D.pidArrPath?ie:N;for(let pe in me)if(pe=="image"&&se.imagePrefix)H[pe]=se.imagePrefix+M(ie,me[pe]);else if(pe=="price"&&se.priceRegex){const Pe=new RegExp(se.priceRegex);let B=M(ie,me[pe]).match(Pe);H[pe]=B?B[0]:null}else if(pe=="addressJSON"){let Pe=M(ie,me[pe]);Pe&&(H[pe]=Pe)}else H[pe]=D!=null&&D.pidArrPath?M(me,pe):M(ie,me[pe]);if(H.price&&(H.price=parseFloat(H.price*(H.quantity||1)),H.status&&(t!=null&&t.invalidStatus.includes(H.status.toLowerCase()))&&(H.price=0),H.price&&ve&&ve>0&&(re+=parseFloat(H.price+ve)),t.pidPriceConvert&&(H.price=H.price*t.pidPriceConvert)),H!=null&&H.addressJSON)try{let pe=sr(t,H==null?void 0:H.addressJSON,Tt,e);if(pe&&(Object.keys(pe).length>1||Object.keys(pe).length===1&&((z=Object.keys(pe==null?void 0:pe.addressJSON))==null?void 0:z.length)>0)){let Pe;if(H!=null&&H.addID)Pe=H==null?void 0:H.addID;else{let qe=JSON.stringify(pe);qe=qe.replace(/[^a-zA-Z0-9]/g,""),Pe=Pr(qe)}l[Pe]?JSON.stringify(l[Pe]).length<JSON.stringify(pe).length&&(l[Pe]=Object.assign({},JSON.parse(JSON.stringify(pe)))):l[Pe]=pe,H.addID=Pe,H==null||delete H.addressJSON}}catch{Z("ERROR_ADDJSON_SPECPID",e)}i.push(H)}catch{Z(`ERROR_${ie}_SPECPID`,e)}}catch{Z("ERROR_ISMUL_SPECPID",e)}else for(let X of Ee){let ie={};for(let H in N)ie[H]=M(X,N[H]);i.push(ie)}}else Se[j]=M(ae,se[j])}catch{Z("ERROR_SPECPIDPIDATT",e)}if(Se!=null&&Se.addressJSON)try{let j=sr(t,Se==null?void 0:Se.addressJSON,Tt,e);if(j&&(Object.keys(j).length>1||Object.keys(j).length===1&&((F=Object.keys(j==null?void 0:j.addressJSON))==null?void 0:F.length)>0)){let N;if(Se!=null&&Se.addID)N=Se==null?void 0:Se.addID;else{let X=JSON.stringify(j);X=X.replace(/[^a-zA-Z0-9]/g,""),N=Pr(X)}l[N]?JSON.stringify(l[N]).length<JSON.stringify(j).length&&(l[N]=Object.assign({},JSON.parse(JSON.stringify(j)))):l[N]=j,Se.addID=N,Se==null||delete Se.addressJSON}}catch{Z("ERROR_SPECPIDADDRESSJSON",e)}if(c!=null&&c.addressJSON)try{let j=sr(t,c==null?void 0:c.addressJSON,Tt,e);if(j&&(Object.keys(j).length>1||Object.keys(j).length===1&&((L=Object.keys(j==null?void 0:j.addressJSON))==null?void 0:L.length)>0)){let N;if(c!=null&&c.addID)N=c==null?void 0:c.addID;else{let X=JSON.stringify(j);X=X.replace(/[^a-zA-Z0-9]/g,""),N=Pr(X)}l[N]?JSON.stringify(l[N]).length<JSON.stringify(j).length&&(l[N]=Object.assign({},JSON.parse(JSON.stringify(j)))):l[N]=j,c.addID=N,c==null||delete c.addressJSON}}catch{Z("ERROR_SPECPIDADDRESSJSON",e)}return Object.keys(Se).length>0&&i.push(Se),t.priceRegex&&typeof re=="string"&&(re=re==null?void 0:re.match(new RegExp(t.priceRegex.reg))[t.priceRegex.ind]),typeof re=="string"&&(re=re.replaceAll(",","")),se.orderDiscount&&se.variousCharges&&(Ke&&t.invalidStatus.includes(Ke.toLowerCase())?(re=0,re-=parseFloat(ve)):re=re-We+ve),re=parseFloat(re),Je&&(lt=Ht(Je),lt<s&&(ne=!0),o[lt]=o[lt]||{details:[],totalSpent:0}),Te.toLowerCase()!=="cancelled"&&!re&&(re=st),{orderTotal:re,orderStatus:Te,orderUrl:ue,quarterCrossed:ne,orderJSON:o,orderDate:Je,orderDiscount:We,totalExtraCharges:ve}}catch{Z("ERROR_SPECPIDADDRESSJSON",e)}}function Z(e,t){try{Tt[t]?Tt[t][e]?Tt[t][e]+=1:Tt[t][e]=1:(Tt[t]={},Tt[t][e]=1)}catch{}}function Yd(e){try{let t={},r={};for(let i in e){let{details:a}=e[i];for(let s of a){let{orderDate:o,orderDetails:l,orderId:c,orderTotal:d=0}=s,{itemDetails:f,storeOrderId:p,totalExtraCharge:u=0}=l;t[p]=t[p]||{},t[p].orderDate=o,t[p].orderId=p,t[p].orderTotal=t[p].orderTotal?t[p].orderTotal+d:d,t[p].totalExtraCharge=u,t[p].orderDetails=t[p].orderDetails||{},t[p].orderDetails.storeOrderId=p,Array.isArray(f)&&f.length>0&&(t[p].orderDetails.itemDetails?t[p].orderDetails.itemDetails.push(...f):t[p].orderDetails.itemDetails=[...f])}}for(let i in t)r[Ht(t[i].orderDate)]=r[Ht(t[i].orderDate)]||{},r[Ht(t[i].orderDate)].totalSpent=r[Ht(t[i].orderDate)].totalSpent?r[Ht(t[i].orderDate)].totalSpent+t[i].orderTotal+t[i].totalExtraCharge:t[i].orderTotal+t[i].totalExtraCharge,r[Ht(t[i].orderDate)].details=r[Ht(t[i].orderDate)].details||[],r[Ht(t[i].orderDate)].details.push({orderDate:t[i].orderDate,orderId:t[i].orderId,orderTotal:t[i].orderTotal>0?t[i].orderTotal+t[i].totalExtraCharge:t[i].orderTotal,orderDetails:t[i].orderDetails});return r}catch{return e}}async function Qd(e,t,r,i){var a,s;try{let o={},l={},c={},d=0;for(let p in e){const I=e[p].details||[];let k=[],y=[],b=0,h=0;for(let m of I)if(((a=m==null?void 0:m.orderDetails)==null?void 0:a.orderType)===i){y.push(m),d++,h+=Number(m.orderTotal||0);try{const S=((s=m==null?void 0:m.orderDetails)==null?void 0:s.itemDetails)||[];for(let v of S){let _=v==null?void 0:v.addID;_&&(c[_]||(c[_]=r[_]||{}))}}catch{}}else k.push(m),b+=Number(m.orderTotal||0);k.length>0&&(o[p]={details:k,totalSpent:b}),y.length>0&&(l[p]={details:y,totalSpent:h})}let f=t-d;return{normalOrderJSON:o,normalOrderCount:f,utilityOrderJSON:l,utilityOrderCount:d,utilityAddressMap:c}}catch{return{normalOrderJSON:e,normalOrderCount:t,utilityOrderJSON:{},utilityOrderCount:0,utilityAddressMap:{}}}}async function Il(e,t,r,i,a,s,o,l=null,c=!1){try{let d=null,f=0,p={},u={domCurr:null,curArr:[]},I={};if(e.isUtility&&t==e.isUtility&&os[e.isUtility]){let b=os[t];d=b.orderJSON,f=b.orderCount,p=b.addressMap,delete os[e.isUtility]}else{let b=await ip(e,t,r,i,a,s,o,l,c);d=b.orderJSON,f=b.orderCount,u=b.curr,I=b.quarterWiseCur,p=b.addressMap}if(e.isUtility&&e.isUtility!=t){let b=await Qd(d,f,p,e.isUtility);os[e.isUtility]={orderJSON:b.utilityOrderJSON,orderCount:b.utilityOrderCount,addressMap:b.utilityAddressMap},d=b.normalOrderJSON,f=b.normalOrderCount}if(e.fixOrderJSON&&(d=Yd(d)),c)return{orderJSON:d,addressMap:p,failedResponse:dt[t]};await xu();let k=[],y=0;for(let b in d){let h=d[b].totalSpent;e.multiCurr&&(u!=null&&u.domCurr)&&Object.keys(I).length&&(h=I[b][u==null?void 0:u.domCurr]||0),y+=h,k.push({quarter:b,tot_spent:h,details:JSON.stringify(d[b].details)})}return{data:k,additionalSpend:y,additionalOrders:f,curArr:u,addressMap:p}}catch(d){return Rt("spend_failed",t,o),Z(JSON.stringify(d),t),R("getQuarterWiseData",d),{data:[],additionalSpend:0}}}async function Gd(e,t,r,i=0,a,s={}){var o,l;try{let c={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},d,f=M(t,r.dataExtractor.commonAttributes.date);if(f){let k=f.match("([A-Za-z]{3})\\s+(\\d{1,2}),\\s+(\\d{4})");if(k){let y=c[k[1]],b=k[2].padStart(2,"0");d=`${k[3]}-${y}-${b}`}}let p=(l=(o=r==null?void 0:r.dataExtractor)==null?void 0:o.commonAttributes)==null?void 0:l.date1,u={};if(d)a=!0;else{a=!1;let k=M(t,p==null?void 0:p.url),y=await St(e,k,p==null?void 0:p.options);y=await y.text();let b=y.match(p==null?void 0:p.regex);if(p!=null&&p.priceRegex){let P=y.match(p.priceRegex);i=P&&P[1]&&!isNaN(parseFloat(P[1].replace(/,/g,"")))?parseFloat(P[1].replace(/,/g,"")):0}let[h,m,A]=b[1].split("-");if(d=`${A}-${h}-${m}`,p&&(p!=null&&p.deliveryAddress))try{const P=y==null?void 0:y.match(p.deliveryAddress);if(P&&P[1]){let S=P[1];S.endsWith("}")||(S+="}");const v=JSON.parse(S);u.deliveryAddress=v}}catch{Z("ERROR_DELIVERYADD_DATEFROMAPI",e)}if(p&&(p!=null&&p.countryCode)){const P=y==null?void 0:y.match(p.countryCode);P&&P[1]&&(u.countryCode=P[1])}s.addressJSON=u}let I={date:d,needSpec:a,orderDetails:s};return i&&(I.orderTotal=isNaN(i)?0:i),I}catch(c){Z(`${JSON.stringify(c)}_DATEFROMAPI`,e)}}function gl(e,t,r,i){try{const a=new Map;return e==null||e.forEach(s=>{const o=t.map(c=>s[c]).join("|");if(!a.has(o)){const c={};t.forEach(d=>c[d]=s[d]),c.items=[],a.set(o,c)}const l={};r==null||r.forEach(c=>{s.hasOwnProperty(c)&&(l[c]=s[c])}),a.get(o).items.push(l)}),Array.from(a.values())}catch(a){Z(`ERROR_${JSON.stringify(a)}_GRPORDERITEMS`,i)}}async function Cd(e,t){var r;try{let i={};for(let a of t==null?void 0:t.url)try{let s=t==null?void 0:t.options,o,l;try{if(o=await St(e,a,s),o.status>=300)throw new Error("Some error in API")}catch{}if(o.ok){if(t!=null&&t.isScript)try{if(o=await o.text(),o){let c=o.split(t==null?void 0:t.split1)[1],d=c&&JSON.parse(c.split(t==null?void 0:t.split2)[0]);l=M(d,t==null?void 0:t.addressList)}}catch{Z("ERROR_ISSCRIPT_FETCHADDRESS",e)}else o=await o.json(),l=M(o,t==null?void 0:t.addressList);for(let c in l)try{let d;if(t!=null&&t.addID){if(d=M(l[c],t==null?void 0:t.addID),i[d])continue;i[d]={}}for(let p of t==null?void 0:t.addressAttributes)try{i[d][p.key]=M(l[c],p.value)}catch{Z("ERROR_ADDRESSATT_FETCHADDRESS",e)}let f=sr(t,i[d],e);f&&(Object.keys(f).length>1||Object.keys(f).length===1&&((r=Object.keys(f==null?void 0:f.addressJSON))==null?void 0:r.length)>0)&&(i[d]=f)}catch{Z(`ERROR_${c}_ADDLIST_FETCHADDRESS`,e)}}}catch{Z(`ERROR_${a}_FETCHADDRESS`,e)}return i}catch(i){return Z(`ERROR_${JSON.stringify(i)}_FETCHADDRESS`,e),{}}}function ga(){const e=new Date,t=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),i=e.getFullYear();return`${r}-${t}-${i}`}function qd(e,t){return Array.from({length:Math.ceil(e.length/t)},(r,i)=>e.slice(i*t,i*t+t))}function ep(e){try{let t=0,r=-1;for(let i in e){i=parseInt(i);let a=e[i];if(a=="{")t++;else if(a=="}"&&(t--,t==0)){r=i+1;break}}return r==-1&&(r=e.length),e=e.substring(e.indexOf("{"),r),e=JSON.parse(e),e}catch{return{}}}async function tp(e,t,r,i,a){var s,o,l,c,d,f,p,u,I,k,y,b,h,m,A;try{let P=r==null?void 0:r.details,S=0;for(let v=0;v<P.length;v++)try{let _=P[v],T=t==null?void 0:t.url;if(a[`${_==null?void 0:_.date}~${_==null?void 0:_.movieId}~${_==null?void 0:_.profileId}`])continue;a[`${_==null?void 0:_.date}~${_==null?void 0:_.movieId}~${_==null?void 0:_.profileId}`]=!0,_!=null&&_.href&&(T=T+(_==null?void 0:_.href));let E=Object.assign({},t.options)||{},g=await St(e,T,E);if(g.status>=300)throw new Error("Wrong with API");if(t!=null&&t.isContent){if(g=await g.text(),(s=t==null?void 0:t.isContent)!=null&&s.regex){let $=new RegExp((o=t==null?void 0:t.isContent)==null?void 0:o.regex,"g"),K=[...g.matchAll($)];for(let z of K)try{g=JSON.parse(z[1].trim())}catch{}}}else g=await g.json();let O={};for(let $ in(l=t==null?void 0:t.dataExtractor)==null?void 0:l.commonAttributes)try{let K=(c=t==null?void 0:t.dataExtractor)==null?void 0:c.commonAttributes[$];Array.isArray(K)?K=K.map(z=>z.replaceAll("MOVIE_ID",_==null?void 0:_.movieId)):K=K.replaceAll("MOVIE_ID",_==null?void 0:_.movieId),O[$]=M(g,K,i==null?void 0:i.tildaSep)}catch{}if((O==null?void 0:O.watchStatus)=="FeatureNotStarted"?O.timeWatched=0:(O==null?void 0:O.watchStatus)=="FeatureFinished"&&(O.timeWatched=(O==null?void 0:O.totalTime)||0),!Object.keys(O).length||!(O!=null&&O.timeWatched)||!(O!=null&&O.totalTime))try{if((_==null?void 0:_.watchType)=="movie"){let $=M(g,(d=t==null?void 0:t.dataExtractor)==null?void 0:d.movieDetails,i==null?void 0:i.tildaSep);for(let K in $)try{let z=K;for(let F in(f=t==null?void 0:t.dataExtractor)==null?void 0:f.commonAttributes)try{let L=(p=t==null?void 0:t.dataExtractor)==null?void 0:p.commonAttributes[F];Array.isArray(L)?L=L.map(D=>D.replaceAll("MOVIE_ID",z)):L=L.replaceAll("MOVIE_ID",z),O[F]=M(g,L,i==null?void 0:i.tildaSep)}catch{}if((O==null?void 0:O.watchStatus)=="FeatureNotStarted"?O.timeWatched=0:(O==null?void 0:O.watchStatus)=="FeatureFinished"&&(O.timeWatched=(O==null?void 0:O.totalTime)||0),!Object.keys(O).length||!(O!=null&&O.timeWatched)||!(O!=null&&O.totalTime))for(let F in(u=t==null?void 0:t.dataExtractor)==null?void 0:u.extraAttributes)try{let L=(I=t==null?void 0:t.dataExtractor)==null?void 0:I.extraAttributes[F];O[F]=M($[K],L,i==null?void 0:i.tildaSep)}catch{}}catch{Z("ERROR_IN_DETAILS_MOVIE",e)}}else{let $=M(g,(k=t==null?void 0:t.dataExtractor)==null?void 0:k.seriesDetails,i==null?void 0:i.tildaSep);for(let K in $)try{let z=_==null?void 0:_.title,F=new RegExp("Episode\\s+(\\d+)");if(z&&(z=z.match(F)?z.match(F)[1]:0),((y=$[K])==null?void 0:y.episodeNumber)==z){let L=K;for(let D in(b=t==null?void 0:t.dataExtractor)==null?void 0:b.commonAttributes)try{let V=(h=t==null?void 0:t.dataExtractor)==null?void 0:h.commonAttributes[D];Array.isArray(V)?V=V.map(ae=>ae.replaceAll("MOVIE_ID",L)):V=V.replaceAll("MOVIE_ID",L),O[D]=M(g,V,i==null?void 0:i.tildaSep)}catch{}if((O==null?void 0:O.watchStatus)=="FeatureNotStarted"?O.timeWatched=0:(O==null?void 0:O.watchStatus)=="FeatureFinished"&&(O.timeWatched=(O==null?void 0:O.totalTime)||0),!Object.keys(O).length||!(O!=null&&O.timeWatched)||!(O!=null&&O.totalTime))for(let D in(m=t==null?void 0:t.dataExtractor)==null?void 0:m.extraAttributes)try{let V=(A=t==null?void 0:t.dataExtractor)==null?void 0:A.extraAttributes[D];O[D]=M($[K],V,i==null?void 0:i.tildaSep)}catch{}}}catch{Z("ERROR_IN_DETAILS_EPISODE",e)}}}catch{Z("ERROR_IN_TEMP_OBJ",e)}S+=(O==null?void 0:O.timeWatched)||0,P[v]={..._,...O}}catch{Z("ERROR_IN_TRAVERSE_SPEC_TIME",e)}r.totalSpent+=S}catch{Z("ERROR_IN_SPEC_API_TIME",e)}}function uo(e,t,r,i,a,s,o,l){var c,d,f,p,u,I;try{for(let k in e)try{let y=e[k],b=[];if((c=t==null?void 0:t.dataExtractor)!=null&&c.childrenArr){let h=[];try{h=M(y,(d=t==null?void 0:t.dataExtractor)==null?void 0:d.childrenArr)}catch{Z("ERROR_IN_EXTRACT_CHILDLIST",l)}h.length||(h=Array.isArray(y)?y:[y]);for(let m of h){let A={};for(let P in(f=t==null?void 0:t.dataExtractor)==null?void 0:f.commonAttributes){let S;try{S=M(m,(p=t==null?void 0:t.dataExtractor)==null?void 0:p.commonAttributes[P])}catch{}S&&(A[P]=S)}b.push(A)}}else{let h={};for(let m in(u=t==null?void 0:t.dataExtractor)==null?void 0:u.commonAttributes){let A;try{A=M(y,(I=t==null?void 0:t.dataExtractor)==null?void 0:I.commonAttributes[m])}catch{}A&&(h[m]=A)}b.push(h)}for(let h of b)try{if(h!=null&&h.date){let m=h.date;m=new Date(m).toISOString().slice(0,10);let A=Ht(m);if(A<s){o.val=!0;break}r[A]||(r[A]={totalSpent:0,details:[]}),h.profileId=i,h.date=m,ja[a]++,(h!=null&&h.image&&(h!=null&&h.movieId)||h!=null&&h.videoId)&&na[a].push({prod:(h==null?void 0:h.movieId)||(h==null?void 0:h.videoId),image:h==null?void 0:h.image}),r[A].details.push({...h})}}catch{Z("ERROR_IN_MOVIE_DATA_ARR",l)}}catch{Z("ERROR_IN_ORDER_LIST",l)}}catch{Z("ERROR_IN_CALC_ORDER_TIME",l)}}async function ap(e,t,r,i,a,s,o,l){var c,d,f,p,u,I,k,y,b,h,m,A,P,S,v,_,T,E,g,O,$,K,z,F,L,D,V,ae,te,ne,q,re,ue,Te,se,Ee,Je,Se,We,st,ve,Ke,j,N,X,ie,H,me,pe,Pe,qe,B,Q,G,C,fe,we,Re;try{let Ge=[],Pt={};if(e!=null&&e.profiles)try{let tt=(c=e==null?void 0:e.profiles)==null?void 0:c.url,He=(d=e==null?void 0:e.profiles)==null?void 0:d.options,Ne=await St(t,tt,He);if(Ne.status>=300)throw new Error("Some error in API");if((f=e==null?void 0:e.profiles)!=null&&f.isContent){if(Ne=await Ne.text(),(u=(p=e==null?void 0:e.profiles)==null?void 0:p.isContent)!=null&&u.splitForJSON){let Me=Ne==null?void 0:Ne.split((k=(I=e==null?void 0:e.profiles)==null?void 0:I.isContent)==null?void 0:k.splitForJSON)[1];Ne=ep(Me)}}else Ne=await Ne.json();let ke=M(Ne,(y=e==null?void 0:e.profiles)==null?void 0:y.profileList);if(Array.isArray(ke)||(ke=[ke]),(b=e==null?void 0:e.profiles)!=null&&b.profileListArr){let Me=M(Ne,(m=(h=e==null?void 0:e.profiles)==null?void 0:h.profileListArr)==null?void 0:m.path);for(let Oe of Me)try{ke.push(M(Oe,(P=(A=e==null?void 0:e.profiles)==null?void 0:A.profileListArr)==null?void 0:P.jsonPath))}catch{}}for(let Me of ke)try{let Oe=!0,Ze={};(S=e==null?void 0:e.profiles)!=null&&S.toPushCond&&M(Me,(_=(v=e==null?void 0:e.profiles)==null?void 0:v.toPushCond)==null?void 0:_.key)!=((E=(T=e==null?void 0:e.profiles)==null?void 0:T.toPushCond)==null?void 0:E.val)&&(Oe=!1);for(let nt in(g=e==null?void 0:e.profiles)==null?void 0:g.profileAttribute)Ze[nt]=M(Me,(O=e==null?void 0:e.profiles)==null?void 0:O.profileAttribute[nt]);Oe&&Ge.push(Ze)}catch{Z("ERROR_IN_PROFILE_LIST",t)}}catch{Z("ERROR_IN_PROFILES",t)}for(let tt of Ge)try{if(($=e==null?void 0:e.profiles)!=null&&$.switchProfile)try{let Ne=(z=(K=e==null?void 0:e.profiles)==null?void 0:K.switchProfile)==null?void 0:z.url,ke=Object.assign({},(L=(F=e==null?void 0:e.profiles)==null?void 0:F.switchProfile)==null?void 0:L.options),Me={};if((V=(D=e==null?void 0:e.profiles)==null?void 0:D.switchProfile)!=null&&V.formBodyKeys){if((te=(ae=e==null?void 0:e.profiles)==null?void 0:ae.switchProfile)!=null&&te.formBodyKeys)for(let Oe in(q=(ne=e==null?void 0:e.profiles)==null?void 0:ne.switchProfile)==null?void 0:q.formBodyKeys)try{let Ze=(ue=(re=e==null?void 0:e.profiles)==null?void 0:re.switchProfile)==null?void 0:ue.formBodyKeys[Oe],nt=tt[Oe];Me[Ze]=nt}catch{}Me=new URLSearchParams(Me).toString()}if((se=(Te=e==null?void 0:e.profiles)==null?void 0:Te.switchProfile)!=null&&se.profileKeys)for(let Oe in(Je=(Ee=e==null?void 0:e.profiles)==null?void 0:Ee.switchProfile)==null?void 0:Je.profileKeys)try{let Ze=(We=(Se=e==null?void 0:e.profiles)==null?void 0:Se.switchProfile)==null?void 0:We.profileKeys[Oe],nt=tt[Oe];Ne=Ne.replaceAll(Ze,nt),ke!=null&&ke.headers&&(ke.headers=JSON.parse(JSON.stringify(ke.headers).replaceAll(Ze,nt))),ke!=null&&ke.body&&(ke.body=ke.body.replaceAll(Ze,nt))}catch{}typeof Me=="string"&&(ke.body=ke.body.replaceAll("FORM_BODY",Me));try{await St(t,Ne,ke)}catch{}}catch{Z("ERROR_SWITCH_PROFILE",t)}let He="";for(let Ne=e==null?void 0:e.pageStart;Ne<=(e==null?void 0:e.pageEnd);Ne++)try{let ke;for(let Me of e.url){let Oe=Object.assign({},e.options);if(e.maxYear&&(Me=Me.replace("PLACEHOLDER_YEAR",(e==null?void 0:e.maxYear)-outerLoop)),e.yearStartEnd&&(Me=Me.replace("PLACEHOLDER_YEAR",ga().split("-")[0]+"-"+ga().split("-")[1]+"-"+(new Date().getFullYear()-outerLoop-1)).replace("PLACEHOLDER_YEAR",ga().split("-")[0]+"-"+ga().split("-")[1]+"-"+(new Date().getFullYear()-outerLoop))),Me=Me.replace("PLACEHOLDER0",Ne),Me=Me.replace("timestamp",Date.now()),e!=null&&e.queryParams&&He){let Ue=JSON.parse(JSON.stringify(e==null?void 0:e.queryParams).replaceAll("NEXT_TOKEN",He));Ue=new URLSearchParams({widgetArgs:JSON.stringify(Ue)}),Me=Me.replaceAll("PLACEHODLER_QUERY",Ue)}if(Oe.body){Oe.body=e.innerLoopMul?Oe.body.replace("PLACEHOLDER0",Ne*e.innerLoopMul):Oe.body.replace("PLACEHOLDER0",Ne);try{Oe.body=(st=Oe==null?void 0:Oe.body)==null?void 0:st.replace("PLACEHOLDER_PROFILEID",tt==null?void 0:tt.profileId)}catch{}}if(e.useCookie){let Ue;if(e!=null&&e.useCookieDirectly)try{let Ve=`${e.useCookieDirectly.mainKey}="([^"]+)"`;Ue=r.match(Ve)[e.useCookieDirectly.index]}catch{}else typeof e.useCookie=="object"?Ue=r.split("; ").filter(Ve=>Ve.startsWith(`${e.useCookie.mainKey}=`))[0].split("=")[1]:Ue=r.split("; ").filter(Ve=>Ve.startsWith(`${e.useCookie}=`))[0].split("=")[1];try{Ue=decodeURIComponent(Ue)}catch{Ue=Ue}try{let Ve=JSON.parse(Ue);Ue=M(Ve,e.useCookie.jsonPath)}catch{Ue=Ue}Oe.headers=JSON.parse(JSON.stringify(Oe.headers).replace("PLACEHOLDER2",Ue)),Me=Me.replace("PLACHOLDER_COOKIE",Ue)}if(e.localStorageKeys)for(let Ue in e.localStorageKeys){let Ve=i[Ue],$t=typeof e.localStorageKeys[Ue]=="object"?(ve=e.localStorageKeys[Ue])==null?void 0:ve.value:e.localStorageKeys[Ue];Ve&&(Oe.headers=JSON.parse(JSON.stringify(Oe.headers).replaceAll($t,Ve)),Me=Me.replaceAll($t,Ve),Oe.body&&(Oe.body=JSON.parse(JSON.stringify(Oe.body).replaceAll($t,Ve))))}let Ze;try{if(Ze=await St(t,Me,Oe),Ze.status>=300)throw new Error("Some error in API")}catch{}ke=await Ze.json();let nt="";if((Ke=e==null?void 0:e.dataExtractor)!=null&&Ke.nextPageKey&&(nt=M(ke,(j=e==null?void 0:e.dataExtractor)==null?void 0:j.nextPageKey)),nt==He&&((N=e==null?void 0:e.dataExtractor)!=null&&N.nextPageKey))break;He=nt;let Et={val:!1};if((X=e==null?void 0:e.dataExtractor)!=null&&X.outerOrderList){let Ue=M(ke,e.dataExtractor.outerOrderList);for(let Ve in Ue){let $t=Ue[Ve],Bt=M($t,e.dataExtractor.orderList);Et!=null&&Et.val||uo(Bt,e,o,tt==null?void 0:tt.profileId,s,l,Et,t)}}else{let Ue=M(ke,e.dataExtractor.orderList)||ke;(ie=e==null?void 0:e.dataExtractor)!=null&&ie.groupOrders&&(Ue=gl(Ue,e==null?void 0:e.groupKeys,e==null?void 0:e.itemKeys,t)),Et!=null&&Et.val||uo(Ue,e,o,tt==null?void 0:tt.profileId,s,l,Et,t)}}if(e.pageEndCheck&&M(ke,e.pageEndCheck.jsonPath)==e.pageEndCheck.equalTo)break}catch{Z("ERROR_IN_PARSING",t)}for(let Ne in o)try{if((H=e==null?void 0:e.timeCalc)!=null&&H.specAPI)await tp(t,e==null?void 0:e.timeCalc,o[Ne],e,Pt);else{let ke=0,Ze=(((me=o[Ne])==null?void 0:me.details)||[]).filter(Ve=>Ve.movieId!==void 0&&Ve.profileId===(tt==null?void 0:tt.profileId)).map(Ve=>Ve.movieId).map(Ve=>`Video:${Ve}`),nt=qd(Ze,100),Et=(pe=e==null?void 0:e.timeCalc)==null?void 0:pe.url,Ue=Object.assign({},(Pe=e==null?void 0:e.timeCalc)==null?void 0:Pe.options);for(let Ve of nt)try{let $t=JSON.stringify(Ve),Bt={...Ue};Bt!=null&&Bt.body&&(Bt.body=Bt.body.replace("PLACEHOLDER_MOVIEARR",$t));let ca;try{if(ca=await St(t,Et,Bt),ca.status>=300)throw new Error("error in API")}catch{continue}ca=await ca.json();let Sa=[];try{Sa=M(ca,(B=(qe=e==null?void 0:e.timeCalc)==null?void 0:qe.dataExtractor)==null?void 0:B.orderList)}catch{Sa=[]}if(!Sa.length)continue;for(let Fa of Sa)try{let $e={};for(let ua in(G=(Q=e==null?void 0:e.timeCalc)==null?void 0:Q.dataExtractor)==null?void 0:G.commonAttributes){let mt;try{mt=M(Fa,(fe=(C=e==null?void 0:e.timeCalc)==null?void 0:C.dataExtractor)==null?void 0:fe.commonAttributes[ua])}catch{}mt&&($e[ua]=mt)}$e!=null&&$e.timeWatched&&(ke+=isNaN(parseFloat($e==null?void 0:$e.timeWatched))?0:parseFloat($e==null?void 0:$e.timeWatched));let Fe=(Re=(we=o[Ne])==null?void 0:we.details)==null?void 0:Re.find(ua=>ua.movieId===$e.movieId);Fe?Object.assign(Fe,$e):o[Ne].details.push($e),($e!=null&&$e.image&&($e!=null&&$e.movieId)||$e!=null&&$e.videoId)&&na[s].push({prod:($e==null?void 0:$e.movieId)||($e==null?void 0:$e.videoId),image:$e==null?void 0:$e.image})}catch{}}catch{Z("ERROR_IN_BATCHES",t)}o[Ne].totalSpent+=ke||0}}catch{Z("ERROR_IN_TIMESPEND_OBJ",t)}}catch{Z("ERROR_IN_PROFILE_ARR",t)}}catch{Z("ERROR_IN_CALCULATE_TIME",t)}}function rp(e){try{const t={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};let r;if(/^\d{10,13}$/.test(e)){const i=parseInt(e);r=new Date(i<1e13?i*1e3:i)}else if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(e))r=new Date(e);else if(/Placed on/.test(e)){let i=e.match(/(\d{1,2})\s([a-z]{3})'?(\d{2})?,\s(\d{1,2}):(\d{2})\s?(am|pm)/i);if(i){let a=parseInt(i[1],10),s=t[i[2].toLowerCase()],o=parseInt("20"+(i[3]||new Date().getFullYear().toString().slice(-2)),10),l=parseInt(i[4],10),c=parseInt(i[5],10);i[6].toLowerCase()==="pm"&&l!==12&&(l+=12),i[6].toLowerCase()==="am"&&l===12&&(l=0),r=new Date(o,s,a,l,c)}}else if(/^\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}/.test(e))r=new Date(e.replace(" ","T"));else if(/^\w+\s\d{1,2},\s\d{4}\sat\s\d{1,2}:\d{2}\s?(AM|PM)/i.test(e)){let i=e.match(/([a-zA-Z]+) (\d{1,2}), (\d{4}) at (\d{1,2}):(\d{2})\s?(AM|PM)/i);if(i){let a=t[i[1].toLowerCase().slice(0,3)],s=parseInt(i[2],10),o=parseInt(i[3],10),l=parseInt(i[4],10),c=parseInt(i[5],10),d=i[6].toLowerCase();d==="pm"&&l!==12&&(l+=12),d==="am"&&l===12&&(l=0),r=new Date(o,a,s,l,c)}}return!r||isNaN(r.getTime())?e:r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return e}}async function sp(e,t,r,i){var a,s,o,l,c,d,f,p,u,I;try{let k={},y=t==null?void 0:t.url,b=Object.assign({},t==null?void 0:t.options);if(t!=null&&t.localStorageKeys)try{for(let m in t==null?void 0:t.localStorageKeys){let A=r[m],P=typeof t.localStorageKeys[m]=="object"?(a=t.localStorageKeys[m])==null?void 0:a.value:t.localStorageKeys[m];A&&(b.headers=JSON.parse(JSON.stringify(b.headers).replaceAll(P,A)),y=y.replaceAll(P,A),b.body&&(b.body=JSON.parse(JSON.stringify(b.body).replaceAll(P,A))))}}catch{Z("ERROR_LOCALSTORAGEKEYS",e)}if(t!=null&&t.dataFromDom)try{for(let m in t==null?void 0:t.dataFromDom){let A=i[m];A&&(b.headers=JSON.parse(JSON.stringify(b.headers).replace(t.dataFromDom[m].placeholder,A)),y=y.replace(t.dataFromDom[m].placeholder,A))}}catch{Z("ERROR_DATAFROMDOM",e)}let h;try{h=await St(e,y,b),h=await h.json()}catch{}if(t!=null&&t.extractDetails){let m=t==null?void 0:t.extractDetails;if(m!=null&&m.outerData)for(let A in m==null?void 0:m.outerData)try{k[A]=M(h,m==null?void 0:m.outerData[A])}catch{}if(m!=null&&m.details){k.details=[];let A=[];if((s=m==null?void 0:m.details)!=null&&s.outerList&&((o=m==null?void 0:m.details)!=null&&o.list)){let P=M(h,(l=m==null?void 0:m.details)==null?void 0:l.outerList);for(let S of P)try{let v=M(S,(c=m==null?void 0:m.details)==null?void 0:c.list);for(let _ of v)A.push(_)}catch{}}else if((d=m==null?void 0:m.details)!=null&&d.list)try{let P=M(h,(f=m==null?void 0:m.details)==null?void 0:f.list);Array.isArray(P)&&(A=P)}catch{}if((p=m==null?void 0:m.details)!=null&&p.data)for(let P of A)try{let S={};for(let v in(u=m==null?void 0:m.details)==null?void 0:u.data)S[v]=M(P,(I=m==null?void 0:m.details)==null?void 0:I.data[v]);k.details.push(S)}catch{}}}return k}catch{}}async function po(e,t,r,i,a){try{a.domAPI||(t=await t.json()),dt[e]=t;let s={},o=M(t,r==null?void 0:r.url),l=await St(e,o,r==null?void 0:r.options);if((l==null?void 0:l.status)>300)return;l=await l.text(),dt[e]=l;let c={};if(r!=null&&r.extractData)for(let d in r==null?void 0:r.extractData)try{let f=r==null?void 0:r.extractData[d].splitArr,p=l;for(let u of f)try{p=p.split(u==null?void 0:u.key)[u==null?void 0:u.index]}catch{Z("ERROR_UPDATE_DATA_FROM_SPEC_URL",e)}c[d]=p}catch{}if(r!=null&&r.nextUrl){let d=r==null?void 0:r.nextUrl,f=Object.assign({},r==null?void 0:r.nextOptions);i&&(r!=null&&r.nextPageKeyParams&&(d=d+(r==null?void 0:r.nextPageKeyParams)),d=d.replaceAll("PLACEHOLDER4",i));for(let u in c)try{d&&(d=d.replaceAll(u,c[u])),f!=null&&f.headers&&(f.headers=JSON.parse(JSON.stringify(f==null?void 0:f.headers).replaceAll(u,c[u]))),f!=null&&f.body&&(f.body=JSON.parse(JSON.stringify(f==null?void 0:f.body).replaceAll(u,c[u])))}catch{}let p=await St(e,d,f);if((p==null?void 0:p.status)>300)return;p=await p.json(),dt[e]=p,p&&Object.keys(p).length&&(s=p)}return s}catch{Z("ERROR_UPDATE_DATA_FROM_SPEC_URL",e)}}function np(e,t="",r,i){try{if(!t||!r)return e;const a=new URL(e);let s=null;if(i.qPAram){if(s=a.searchParams.get(i.qPAram),!s)return e}else return e;let o={};try{o=JSON.parse(s)}catch{}return o[r]=t,a.searchParams.set(i.qPAram,JSON.stringify(o)),a.toString()}catch{return e}}async function ip(e,t,r,i,a,s,o,l=null,c=!1){var P,S,v,_,T,E,g,O,$,K,z,F,L,D,V,ae,te,ne,q,re,ue,Te,se,Ee;let d={},f={},p={},u={},I=new Map,k=[],y,b=!1,h=0,m={},A=1;ja[o]=0,na[o]=[];try{if(!e)throw Rt("config_missing",t,o),Z("No_Config",t),Xs("end_ms",t,o),new Error("Config Not Found !");let Je={},Se="",We={},st={},ve=!1,Ke=((P=e==null?void 0:e.nextCallTokens)==null?void 0:P.initval)||null;e.isAddress&&(f=await Cd(t,e==null?void 0:e.isAddress)),e!=null&&e.priorDetails&&(m=await sp(t,e==null?void 0:e.priorDetails,a,s),A=(m==null?void 0:m.details.length)-1||1);for(let j=0;j<=((e==null?void 0:e.outerLoopUpto)??A);j++)try{if(m!=null&&m.details&&(m!=null&&m.details.length))Je=m==null?void 0:m.details[0],m.details.shift();else if(m!=null&&m.details&&!(m!=null&&m.details.length))break;let N,X=Math.floor(Date.now()/1e3);for(let ie=e.pageStart;ie<=e.pageEnd;ie+=e!=null&&e.rangeDiff?e==null?void 0:e.rangeDiff:1)try{Xs("page_start",t,o);let H,me=!1;for(let B of e.url){B||Z("NO_EACHURL",t);let Q=Object.assign({},e.options);if(e.hasOwnProperty("options2")&&e.hasOwnProperty("outerLoopForOptions2")&&j==e.outerLoopForOptions2&&(Q=Object.assign({},e.options2)),e.maxYear&&(B=B.replace("PLACEHOLDER_YEAR",(e==null?void 0:e.maxYear)-j)),e.yearStartEnd&&(B=B.replace("PLACEHOLDER_YEAR",ga().split("-")[0]+"-"+ga().split("-")[1]+"-"+(new Date().getFullYear()-j-1)).replace("PLACEHOLDER_YEAR",ga().split("-")[0]+"-"+ga().split("-")[1]+"-"+(new Date().getFullYear()-j))),B=B.replace("PLACEHOLDER0",ie),B=B.replace("timestamp",Date.now()),B=B.replace("PLACEHOLDER4",Se),B=e.innerLoopMul?B.replace("PLACEHOLDER_OFFSET",ie*e.innerLoopMul):B.replace("PLACEHOLDER_OFFSET",ie),e!=null&&e.initVal&&((S=e==null?void 0:e.initVal)!=null&&S.length))if(b)B=B.replace(e==null?void 0:e.initReplace,Se);else for(let G of e==null?void 0:e.initVal)try{let C;(G==null?void 0:G.value)=="curTimestamp"&&(C=Date.now()),B=B.replace(G==null?void 0:G.key,C),b=!0}catch{Z("ERROR_CALCSPEND_INIT_VAL",t)}if(B=B.replace("CURRYEAR",new Date().getFullYear()+j),Q.headers&&(Q.headers=JSON.parse(JSON.stringify(Q.headers).replace("CURRYEAR",new Date().getFullYear()+j))),Q.body&&(Q.body=JSON.parse(JSON.stringify(Q.body).replace("CURRYEAR",new Date().getFullYear()+j))),e.outerLoopArr&&(B=B.replace("PLACEHOLDER_OUTER",e.outerLoopArr[j]),Q.body=Q.body?Q.body.replace("PLACEHOLDER_OUTER",e.outerLoopArr[j]):Q.body),(_=(v=e==null?void 0:e.priorDetails)==null?void 0:v.extractDetails)!=null&&_.outerData)for(let G in m)try{Q.headers&&(Q.headers=JSON.parse(JSON.stringify(Q.headers).replace(G,m[G]))),Q.body&&(Q.body=JSON.parse(JSON.stringify(Q.body).replace(G,m[G])))}catch{}if(Je)for(let G in Je)B=B.replace(G,Je[G]),Q.headers&&(Q.headers=JSON.parse(JSON.stringify(Q.headers).replace(G,Je[G]))),Q.body&&(Q.body=JSON.parse(JSON.stringify(Q.body).replace(G,Je[G])));if(e!=null&&e.rangeDiff)try{let G=Math.min(ie,X),C=Math.min(ie+(e==null?void 0:e.rangeDiff)-1,X);if(G>=X){me=!0;break}B=B.replaceAll("PLACEHOLDER_START",G),B=B.replaceAll("PLACEHOLDER_END",C)}catch{}if(Object.keys(We).length>0)for(let G in We)e.hasOwnProperty("modifyUrlWithNextCallParams")?(B=np(B,We[G],G,e.modifyUrlWithNextCallParams),console.log("modified eachUrl",B)):B.includes("?")?B+=`&${G}=${We[G]}`:B+=`?${G}=${We[G]}`;if(Q.body&&(Q.body=e.innerLoopMul?Q.body.replace("PLACEHOLDER0",ie*e.innerLoopMul):Q.body.replace("PLACEHOLDER0",ie)),Q.body&&(e!=null&&e.nextCallTokens)&&(Ke?Q.body=Q.body.replace("PLACEHOLDER_NEXTCALLTOKEN",Ke):Q.body=Q.body.replace('"PLACEHOLDER_NEXTCALLTOKEN"',Ke)),e.useCookie){let G=Array.isArray(e.useCookie)?e.useCookie:[e.useCookie];for(let C of G){let fe;if(e!=null&&e.useCookieDirectly)try{let we=`${e.useCookieDirectly.mainKey}="([^"]+)"`;fe=i.match(we)[e.useCookieDirectly.index]}catch{Z("ERROR_CALCSPEND_COOKIE_DIRECTLY",t)}else if(typeof C=="object")try{C.getHttpSecureCookie?fe=await ui(C.getHttpSecureCookie.url,C.getHttpSecureCookie.value):fe=i.split("; ").filter(we=>we.startsWith(`${C.mainKey}=`))[0].split("=")[1]}catch{}else fe=i.split("; ").filter(we=>we.startsWith(`${C}=`))[0].split("=")[1];try{fe=decodeURIComponent(fe)}catch{fe=fe}if(typeof C=="object"&&C.jsonPath)try{let we=JSON.parse(fe);fe=M(we,C.jsonPath)}catch{fe=fe}if(fe||Z("MISSING_COOKIE",t),typeof C=="object"&&C.prefix&&(fe=C.prefix+fe),typeof C=="object"&&C.encodeBase64)try{fe=btoa(fe)}catch{}if(typeof C=="object"&&C.encodeUrl)try{fe=encodeURIComponent(fe)}catch{}typeof C=="object"&&C.replaceWith?(Q.headers=JSON.parse(JSON.stringify(Q.headers).replaceAll(C.replaceWith,fe)),B=B.replaceAll(C.replaceWith,fe)):(Q.headers=JSON.parse(JSON.stringify(Q.headers).replace("PLACEHOLDER2",fe)),B=B.replace("PLACHOLDER_COOKIE",fe))}}if(e.localStorageKeys)try{for(let G in e.localStorageKeys){let C=a[G],fe=typeof e.localStorageKeys[G]=="object"?(T=e.localStorageKeys[G])==null?void 0:T.value:e.localStorageKeys[G];C&&(Q.headers=JSON.parse(JSON.stringify(Q.headers).replaceAll(fe,C)),B=B.replaceAll(fe,C),Q.body&&(Q.body=JSON.parse(JSON.stringify(Q.body).replaceAll(fe,C))))}}catch{Z("ERROR_LOCALSTORAGEKEYS",t)}if(e.dataFromDom)try{for(let G in e.dataFromDom){let C=s[G];C&&(Q.headers=JSON.parse(JSON.stringify(Q.headers).replaceAll(e.dataFromDom[G].placeholder,C)),Q.body=JSON.parse(JSON.stringify(Q.body).replaceAll(e.dataFromDom[G].placeholder,C)),B=B.replace(e.dataFromDom[G].placeholder,C))}}catch{Z("ERROR_DATAFROMDOM",t)}try{if(e.keysFromAPI){let G=e.keysFromAPI.url,C=e.keysFromAPI.options;if(e.keysFromAPI.localStorageKeys)for(let we in e.keysFromAPI.localStorageKeys)try{let Re=a[we],Ge=typeof e.keysFromAPI.localStorageKeys[we]=="object"?(E=e.keysFromAPI.localStorageKeys[we])==null?void 0:E.value:e.keysFromAPI.localStorageKeys[we];Re&&(C.headers=JSON.parse(JSON.stringify(C.headers).replace(Ge,Re)),C.body=JSON.parse(JSON.stringify(C.body).replace(Ge,Re)),G=G.replace(Ge,Re))}catch{Z("ERROR_CALCSPEND_LOCALST_KEYS",t)}let fe;try{let we=await cr(o,{action:"callAPIFromDOM",data:{eachUrl:G,eachOptions:C}});fe=we==null?void 0:we.result,fe=JSON.parse(fe==null?void 0:fe.result),fe!=null&&fe.data&&(fe=fe==null?void 0:fe.data)}catch{Z("ERROR_CALCSPEND_SENDMSG_CONTENT",t)}for(let we of e.keysFromAPI.requiredKeys){let Re=M(fe,we.value),Ge=we.key;a[Ge]=Re,Re&&(Q.headers=JSON.parse(JSON.stringify(Q.headers).replace(Ge,Re)),B=B.replace(Ge,Re))}}}catch{Z("ERROR_KEYSFROMAPI",t)}if(t===2191){let G=j===0?"CURRENT_YEAR":`CURRENT_YEAR-${j}`;B=B.replace("PLACEHOLDER1",G)}try{if(e.domAPI){let G=await cr(o,{action:"callAPIFromDOM",data:{eachUrl:B,eachOptions:Q}});H=G==null?void 0:G.result,H=JSON.parse(H==null?void 0:H.result),H!=null&&H.data&&(H=H==null?void 0:H.data),dt[t]=H}else H=await St(t,B,Q);if(H.status>=300)throw new Error("Some error in API");break}catch{Z("ERROR_CALCSPEND_DOMAPI",t)}}if(me)break;if(H.status>=300)throw new Error("Some error in API");if(e.domAPI)N=H,e!=null&&e.specUrl&&(N=await po(t,H,e==null?void 0:e.specUrl,Se,e));else if(e!=null&&e.specUrl)N=await po(t,H,e==null?void 0:e.specUrl,Se,e);else if(e!=null&&e.getJSONfromDomScript){let B=await H.text();dt[t]=B;let Q=(O=(g=e==null?void 0:e.getJSONfromDomScript)==null?void 0:g.script)!=null&&O.splitForJSON?B.split(e==null?void 0:e.getJSONfromDomScript.script.splitForJSON)[1]:B;try{N=(K=($=e==null?void 0:e.getJSONfromDomScript)==null?void 0:$.script)!=null&&K.splitForJSON?JSON.parse(Q.split("};")[0]+"}"):JSON.parse(B)}catch{try{let C=0,fe=-1;for(let we in Q){we=parseInt(we);let Re=Q[we];if(Re=="{")C++;else if(Re=="}"&&(C--,C==0)){fe=we+1;break}}fe==-1&&(fe=Q.length),Q=Q.substring(Q.indexOf("{"),fe),Q=JSON.parse(Q),(z=e==null?void 0:e.getJSONfromDomScript)!=null&&z.checkVal&&(N=M(Q,(F=e==null?void 0:e.getJSONfromDomScript)==null?void 0:F.checkVal))}catch{}}}else{let B=H.headers&&H.headers.get("content-type");if((L=e==null?void 0:e.script)!=null&&L.name&&B&&(B!=null&&B.includes("text/html"))){let Q=await H.text();dt[t]=Q;let G=new RegExp(`<script id="${(D=e==null?void 0:e.script)==null?void 0:D.name}"[^>]*>([\\s\\S]*?)<\\/script>`,"i"),C=Q==null?void 0:Q.match(G);if(C&&C[1])try{let fe=JSON.parse(C[1]);N=await Kd(t,fe,e,t)}catch{}}else if(B!=null&&B.includes("text/html")&&((V=e==null?void 0:e.script)!=null&&V.splitForJSON)){let Q=await H.text();dt[t]=Q;for(let G=0;G<((ae=e==null?void 0:e.script)==null?void 0:ae.splitForJSON.length);G++)try{if(Q=Q.split((te=e==null?void 0:e.script)==null?void 0:te.splitForJSON[G])[(ne=e==null?void 0:e.script)==null?void 0:ne.index[G]],(q=e==null?void 0:e.script)!=null&&q.replace){let C=(re=e==null?void 0:e.script)==null?void 0:re.replace;try{if(C!=null&&C.toReplace&&(C!=null&&C.replaceWith)&&typeof C.toReplace[G]=="string"&&typeof C.replaceWith[G]=="string"){let fe=new RegExp(C==null?void 0:C.toReplace[G],"g"),we=C==null?void 0:C.replaceWith[G];try{Q=Q.replaceAll(fe,we)}catch{}}}catch{}}}catch{}try{N=JSON.parse(Q)}catch{}}else N=await H.json(),dt[t]=N}if((!N||!Object.keys(N).length)&&Z("MISSING_RESPONSEJSON",t),e.nextCallParams)for(let B in e.nextCallParams){let Q=B.split("~")[0],G;if(Array.isArray(e.nextCallParams[B])&&e.nextCallParams[B].length>1?G=Math.min(M(N,e.nextCallParams[B][0]),M(N,e.nextCallParams[B][1])):G=M(N,e.nextCallParams[B]),e.nextCallParamsRegex)try{const C=G.match(new RegExp(e.nextCallParamsRegex[B].str))[e.nextCallParamsRegex[B].ind];C&&(G=C)}catch{Z("ERROR_NEXTPAGEREGEX",t)}We[Q]!=G&&(We[Q]=G)}e!=null&&e.nextCallTokens&&(Ke=M(N,(ue=e==null?void 0:e.nextCallTokens)==null?void 0:ue.path)||null);let pe=0;async function Pe(B){var Q,G,C,fe,we,Re,Ge,Pt,tt,He,Ne,ke,Me,Oe,Ze,nt,Et,Ue,Ve,$t,Bt,ca,Sa,Fa;for(let $e in B){try{let Fe=B[$e],ua=!0,mt;if(e.dataExtractor.commonAttributes.orderId.includes("~")){let U=e.dataExtractor.commonAttributes.orderId.split("~");for(let Y of U)try{mt?mt=mt+"~"+M(Fe,Y):mt=M(Fe,Y)}catch{}}else{mt=M(Fe,e.dataExtractor.commonAttributes.orderId);let U=null;try{let Y=(G=(Q=e==null?void 0:e.dataExtractor)==null?void 0:Q.commonAttributes)==null?void 0:G.marketPlace;U=Y?M(Fe,Y):null,U=(U||"").trim()}catch{}mt&&(p[mt]=U||"Unknown")}if(Se=mt,e.dataExtractor.nextPageKey)try{Se=M(N,e.dataExtractor.nextPageKey),Se||(Se=M(Fe,e.dataExtractor.nextPageKey))}catch{}if(st[mt])continue;st[mt]=!0,pe++;let De,di=0,pi=0,fi=1,de={};try{if(e.apiForPid){let U={};if(e.dataExtractor.commonAttributes.selectors)try{for(let pt in e.dataExtractor.commonAttributes.selectors){let qt=M(Fe,e.dataExtractor.commonAttributes.selectors[pt]);U={...U,[pt]:qt}}}catch{}let Y={};await co(t,e,U,[],a,de,Y,i,s),(C=e.dataExtractor.orderApi)!=null&&C.pidPath&&(Fe[e.dataExtractor.orderApi.pidPath]=Y)}}catch{Z("ERROR_SPENDCALC_APIFORPID",t)}let it="";if(e.dataExtractor.commonAttributes.date||e!=null&&e.siteConfigdateAlt){if(it=e!=null&&e.siteConfigdateAlt?await Gd(t,Fe,e,ua,de).then(Y=>(ua=Y==null?void 0:Y.needSpec,De=isNaN(Y==null?void 0:Y.orderTotal)?0:parseFloat(Y==null?void 0:Y.orderTotal),de=(Y==null?void 0:Y.orderDetails)??de,Y==null?void 0:Y.date)):M(Fe,e.dataExtractor.commonAttributes.date),it||Z("ERROR_SPENDCALC_ORDERDATE",t),e.dateRegex){const[Y,Be,pt]=it.match(new RegExp(e.dateRegex));it=`${Be} ${pt}`}e.dateFormatRegex&&(it=bl(it,e.dateFormatRegex,e,t)),isNaN(it)||(it=parseInt(it));let U=Math.floor(Date.now()/1e3);if(it<U&&(it=it*1e3),it=new Date(it).toISOString().slice(0,10),lt=Ht(it),lt<r){ve=!0;continue}d[lt]=d[lt]||{details:[],totalSpent:0},u[lt]||(u[lt]=new Map)}let es={};if(e.dataExtractor.commonAttributes.selectors)try{for(let U in e.dataExtractor.commonAttributes.selectors){let Y=M(Fe,e.dataExtractor.commonAttributes.selectors[U]);es={...es,[U]:Y}}}catch{Z("ERROR_SPENDCALC_SELECTORS",t)}h++,ja[o]=h;let da=0,Ba;De=De||(e.dataExtractor.commonAttributes.totalAmount?M(Fe,e.dataExtractor.commonAttributes.totalAmount):0),e.priceRegex&&typeof De=="string"&&(De=De.match(new RegExp(e.priceRegex.reg))[e.priceRegex.ind]),e.priceReplace&&typeof De=="string"&&(De=De.replace(new RegExp(e.priceReplace,"g"),U=>U.replace(/\./g,"_").replace(/,/,".").replace(/_/g,","))),typeof De=="string"&&(De=De.replaceAll(",","")),De=parseFloat(De);let pr=0;try{pr=(we=(fe=e==null?void 0:e.dataExtractor)==null?void 0:fe.commonAttributes)!=null&&we.totalRefund?parseFloat(M(Fe,(Ge=(Re=e==null?void 0:e.dataExtractor)==null?void 0:Re.commonAttributes)==null?void 0:Ge.totalRefund)):0}catch{pr=0}let Xe=e.dataExtractor.commonAttributes.orderStatus?M(Fe,e.dataExtractor.commonAttributes.orderStatus):null;if((He=(tt=(Pt=e==null?void 0:e.dataExtractor)==null?void 0:Pt.commonAttributes)==null?void 0:tt.orderStatusArr)!=null&&He.selector)try{const U=M(Fe,e.dataExtractor.commonAttributes.orderStatusArr.selector);if(Array.isArray(U)&&U.length>0){const Y=(Me=(ke=(Ne=e==null?void 0:e.dataExtractor)==null?void 0:Ne.commonAttributes)==null?void 0:ke.orderStatusArr)==null?void 0:Me.index;if(Xe=Y!==void 0&&Number.isInteger(Y)&&Y<U.length?U[Y]:U[U.length-1],(nt=(Ze=(Oe=e==null?void 0:e.dataExtractor)==null?void 0:Oe.commonAttributes)==null?void 0:Ze.orderStatusArr)!=null&&nt.jsonPath)try{Xe=M(Xe,e.dataExtractor.commonAttributes.orderStatusArr.jsonPath)}catch{}}}catch{Xe=null}e!=null&&e.orderStatusRegex&&typeof Xe=="string"&&(Xe=Xe.match(new RegExp(e.orderStatusRegex.regex))[e.orderStatusRegex.index]);let Hs=[];if(e.dataExtractor.orderApi&&!e.apiForPid){let U=await co(t,e,es,Hs,a,de,i,s);De=U!=null&&U.orderTotal&&!isNaN(U==null?void 0:U.orderTotal)&&(U==null?void 0:U.orderTotal)>0?U==null?void 0:U.orderTotal:De,Xe=U!=null&&U.orderStatus&&(U==null?void 0:U.orderStatus.trim())!==""?U==null?void 0:U.orderStatus:Xe}if(e.orderDetails)for(let U of e.orderDetails)try{if(U.key=="image"&&e.dataExtractor.imagePrefix)de[U.key]=e.dataExtractor.imagePrefix+M(Fe,U.value);else if(U.key=="curr"){if(de[U.key]=M(Fe,U.value),e!=null&&e.curRegex){let Y=new RegExp((Et=e==null?void 0:e.curRegex)==null?void 0:Et.reg),Be=(Ue=de[U==null?void 0:U.key])==null?void 0:Ue.match(Y);Be&&(de[U==null?void 0:U.key]=Be[e==null?void 0:e.curRegex.ind])}e.multiCurr&&de[U.key]&&(I[de[U.key]]?I[de[U.key]]+=1:I[de[U.key]]=1)}else if(typeof U.value=="object"){let Y=U.value;de[U.key]={};for(let Be in Y)try{de[U.key][Be]=M(Fe,Y[Be])}catch{Z(`ERROR_SPENDCALC_${Be}`,t)}}else if(U!=null&&U.extract){let Y=M(Fe,U==null?void 0:U.extract);try{Y=JSON.parse(Y)}catch{Y=Y}de[U.key]=M(Y,U==null?void 0:U.value)}else if((U==null?void 0:U.key)=="orderTime")try{let Y=M(Fe,U==null?void 0:U.value);Y=rp(Y),de[U==null?void 0:U.key]=Y}catch{}else if(de[U.key]=M(Fe,U.value),U.valueMap&&de[U.key]!==void 0){const Y=U.valueMap[de[U.key]];Y!=null&&(de[U.key]=Y)}else U.notEqualTo&&de[U.key]&&(de[U.key]!=U.notEqualTo?de[U.key]=1:de[U.key]=0)}catch{Z(`ERROR_SPENDCALC_${U}_ORDERDETAILS`,t)}if(de.prod&&de.image&&na[o].push({prod:de.prod,image:de.image}),e.dataExtractor.pidList){de.itemDetails=[];async function U(Y){var fr,Pa,hi,yi,mi,wi,bi,Ii,gi,ki,xi,vi,Ai,Ti,_i,Si,Pi,Oi,Di,Li,Ei,Ni,Mi,Ri,ji;let Be=[];if(Array.isArray(e.dataExtractor.pidList))for(let be of e.dataExtractor.pidList)Be.push(be);else Be.push(e.dataExtractor.pidList);let pt=[];if(e.dataExtractor.pidAttributes.pidApi)try{if(ve!==void 0&&ve)return;let be;ua==!0&&(be=await Xd(t,e,es,pt,a,r,d,f,de,o,i,s,I)),di=(be==null?void 0:be.orderDiscount)||0,pi=(be==null?void 0:be.totalExtraCharges)||0,De=be!=null&&be.orderTotal&&!isNaN(De)&&(be==null?void 0:be.orderTotal)>0?be==null?void 0:be.orderTotal:De,Xe=be!=null&&be.orderStatus&&be.orderStatus.trim()!==""?be==null?void 0:be.orderStatus:Xe,Ba=be!=null&&be.orderUrl&&be.orderUrl.trim()!==""?be==null?void 0:be.orderUrl:Ba,ve=be!=null&&be.quarterCrossed?be==null?void 0:be.quarterCrossed:ve,d=be!=null&&be.orderJSON&&Object.keys(d).length>0?be==null?void 0:be.orderJSON:d,it=be!=null&&be.orderDate&&be.orderDate.trim()!==""?be==null?void 0:be.orderDate:it}catch{Z("ERROR_SPENDCALC_PIDAPI",t)}let qt=null;if((fr=e==null?void 0:e.dataExtractor)!=null&&fr.mappingPid)try{const{rootPath:be,mappingListPath:hr,itemsPath:Oa,tempPidKey:at,actualPidKey:Ha}=e.dataExtractor.mappingPid;let Vt=M(Y,be);typeof Vt=="string"&&(Vt=JSON.parse(Vt));let At=hr?M(Vt,hr):Vt;typeof At=="string"&&(At=JSON.parse(At));let ye=Oa?M(At,Oa):At;if(Array.isArray(ye)){qt={};for(const ea of ye){const ft=ea==null?void 0:ea[at],xe=ea==null?void 0:ea[Ha];ft&&xe&&(qt[ft]=xe)}}}catch{Z("ERROR_MAPPING_PID_MAP_BUILD",t)}for(let[be,hr]of Be.entries())try{let Oa;e!=null&&e.commonStatus&&(Oa=M(Y,e.commonStatus));let at;hr?at=M(Y,hr):at=[Y],typeof at=="string"&&(at=JSON.parse(at),(Pa=e==null?void 0:e.dataExtractor)!=null&&Pa.pidListPath&&(Array.isArray((hi=e==null?void 0:e.dataExtractor)==null?void 0:hi.pidListPath)?at=M(at,(yi=e==null?void 0:e.dataExtractor)==null?void 0:yi.pidListPath[be]):at=M(at,(mi=e==null?void 0:e.dataExtractor)==null?void 0:mi.pidListPath))),typeof at=="string"&&(e!=null&&e.dataExtractor.parseInnerPidList)&&(at=JSON.parse(at),at=M(at,e==null?void 0:e.dataExtractor.parseInnerPidList));for(let Ha in at){let Vt=[];if(e.dataExtractor.checkIfPidArr)try{let At=M(at[Ha],e.dataExtractor.checkIfPidArr);for(let ye of At)Vt.push(ye)}catch{Vt.push(at[Ha])}else Vt.push(at[Ha]);for(let At of Vt){let ye={},ea=!1,ft=null;try{ft=e.dataExtractor.pidAttributes.price?parseFloat(M(At,e.dataExtractor.pidAttributes.price)):0}catch{ft=0}if(ft&&e.pidPriceConvert&&(ft=ft*e.pidPriceConvert),e.dataExtractor.returnCheck)try{for(let xe of e.dataExtractor.returnCheck)try{M(At,xe)&&(ea=!0)}catch{}}catch{Z("ERROR_SPENDCALC_RETURNCHECK",t)}for(let xe in e.dataExtractor.pidAttributes)try{if(xe=="quantity"){let je=M(At,e.dataExtractor.pidAttributes[xe]);fi=isNaN(je)?1:parseInt(je),da=da*fi}if(xe!="price"){let je=M(At,e.dataExtractor.pidAttributes[xe]);if(ye[xe]=je,xe=="status"){if(ea&&(je="Returned",ye[xe]="Returned"),e!=null&&e.commonStatus&&(ye[xe]=Oa,e!=null&&e.commonStatus&&(e!=null&&e.invalidStatus.includes(Oa.trim().toLowerCase()))?ft=0:da+=ft),je&&ft>0&&!e.invalidStatus.includes(je.trim().toLowerCase())){if(e.dataExtractor.extraDiscount)for(let Qe of e.dataExtractor.extraDiscount)try{let ze=parseFloat(M(At,Qe));isNaN(ze)||(ft-=ze*e.pidPriceConvert)}catch{Z("ERROR_XTRADISCOUNT_SCRAPEPID",t)}da+=ft}}else if(xe=="addID"&&(e==null?void 0:e.addIDregex)!=null&&(e==null?void 0:e.addID)!="")try{const Qe=new RegExp(e==null?void 0:e.addIDregex,"g"),ze=je==null?void 0:je.match(Qe);ye[xe]=ze?ze[0]:null}catch{Z("ERROR_ADDREG_SCRAPEPID",t),ye[xe]=null}else if(xe=="image"){if(e.dataExtractor.imagePrefix&&(ye[xe]=e.dataExtractor.imagePrefix+je),e.dataExtractor.imageReplacements){let Qe=e.dataExtractor.imageReplacements;Qe&&(Qe.forEach(({key:ze,value:Va})=>{je=je.replace(`{${ze}}`,Va)}),ye[xe]=je)}if((wi=e==null?void 0:e.dataExtractor)!=null&&wi.parseImage)try{let Qe=je&&JSON.parse(je),ze=Qe&&M(Qe,(Ii=(bi=e==null?void 0:e.dataExtractor)==null?void 0:bi.parseImage)==null?void 0:Ii.jsonPath);ze&&!ze.startsWith((ki=(gi=e==null?void 0:e.dataExtractor)==null?void 0:gi.parseImage)==null?void 0:ki.imagePrefix)&&(ze=((vi=(xi=e==null?void 0:e.dataExtractor)==null?void 0:xi.parseImage)==null?void 0:vi.imagePrefix)+ze),ze&&(ye[xe]=ze)}catch{Z("ERROR_PARSEIMAGE_SCRAPEPID",t)}if((Ai=e==null?void 0:e.dataExtractor)!=null&&Ai.constructImageUrlParams)try{let Qe=[];for(let Ic of((_i=(Ti=e==null?void 0:e.dataExtractor)==null?void 0:Ti.constructImageUrlParams)==null?void 0:_i.params)??[])try{let Vs=M(At,Ic);Vs&&Qe.push(Vs)}catch{}let ze=((Pi=(Si=e==null?void 0:e.dataExtractor)==null?void 0:Si.constructImageUrlParams)==null?void 0:Pi.separator)??"",Va=((Di=(Oi=e==null?void 0:e.dataExtractor)==null?void 0:Oi.constructImageUrlParams)==null?void 0:Di.fixedValue)??"",ts=(Ei=(Li=e==null?void 0:e.dataExtractor)==null?void 0:Li.constructImageUrlParams)==null?void 0:Ei.extension,ta=Qe.length>0?Qe.join(ze):"";ta&&Va&&(ta+=ze+Va),ta&&ts&&(ta+="."+ts),ta&&((Ni=e==null?void 0:e.dataExtractor)!=null&&Ni.imagePrefix)&&(ta=((Mi=e==null?void 0:e.dataExtractor)==null?void 0:Mi.imagePrefix)+ta),ta&&(ye[xe]=ta)}catch{}}}else ft!=null&&ft!=null&&!isNaN(ft)&&(ye[xe]==0||!ye[xe])&&(ye[xe]=ft)}catch{Z(`ERROR_${xe}_PIDATTRIBUTES`,t)}for(let xe in e.dataExtractor.extraPidAttributes)try{let je=e.dataExtractor.extraPidAttributes[xe];je=je.replace("PLACEHOLDER_PID",ye.pid);let Qe=M(Y,je);ye[xe]=Qe}catch{Z("ERROR_SPENDCALC_XTRAPIDATTRIBUTES",t)}if(qt&&(ye!=null&&ye.pid)&&qt[ye.pid]&&(ye.pid=qt[ye.pid]),pt.length>0){const xe=pt.find(je=>je.pid==ye.pid);xe&&(ye={...ye,...xe})}if(Hs.length){const xe=Hs.find(je=>je.pid===ye.pid);xe&&(ye={...ye,...xe})}if(ye!=null&&ye.addressJSON)try{let xe=sr(e,ye==null?void 0:ye.addressJSON,t);if(xe&&(Object.keys(xe).length>1||Object.keys(xe).length===1&&((Ri=Object.keys(xe==null?void 0:xe.addressJSON))==null?void 0:Ri.length)>0)){let je;if(ye!=null&&ye.addID)je=ye==null?void 0:ye.addID;else{let Qe=JSON.stringify(xe);Qe=Qe.replace(/[^a-zA-Z0-9]/g,""),je=Pr(Qe)}f[je]?JSON.stringify(f[je]).length<JSON.stringify(xe).length&&(f[je]=Object.assign({},JSON.parse(JSON.stringify(xe)))):f[je]=xe,ye.addID=je,ye==null||delete ye.addressJSON}}catch{Z("ERROR_SPENDCALC_ADDRESSJSON",t)}if((ji=e==null?void 0:e.dataExtractor)!=null&&ji.mergeUsingPid){let xe=Object.keys(ye).find(ze=>ze.startsWith("pid")&&ye[ze]);console.log("pid key",xe);let je=xe?ye[xe]:null;const Qe=de.itemDetails.findIndex(ze=>{const Va=Object.keys(ze).find(ts=>ts.startsWith("pid"))??null;return ze[Va]===je});if(Qe>-1){const ze=de.itemDetails[Qe];"price"in ye&&!ye.price&&ze.price&&delete ye.price,Object.assign(ze,ye),ye={}}}Object.keys(ye).length>0&&(de.itemDetails.push(ye),na[o].push({prod:ye.prod,image:ye.image}),Ba&&(de.url=Ba))}}if(e.dataExtractor.pidList=="same")try{pt.length&&(de.itemDetails.push({...pt[0]}),na[o].push({prod:pt[0].prod,image:pt[0].image}),Ba&&(de.url=Ba))}catch{Z("ERROR_SAMEPIDLIST_SCRAPEPID",t)}}catch{Z("ERROR_SPENDCALC_PIDLIST",t)}}if(e.dataExtractor.outerPidList){let Y=[];if(Array.isArray(e.dataExtractor.outerPidList))for(let Be of e.dataExtractor.outerPidList)Y.push(Be);else Y.push(e.dataExtractor.outerPidList);for(let Be of Y){let pt=M(Fe,Be);for(let qt in pt){let fr=pt[qt];if(e.dataExtractor.commonAttributes.outerPidRefundAmt)try{let Pa=M(fr,e.dataExtractor.commonAttributes.outerPidRefundAmt);Pa&&(pr+=parseFloat(isNaN(Pa)?0:Pa))}catch{}await U(fr)}}}else await U(Fe)}try{for(let U of de.itemDetails){for(let Y in U)(U[Y]==null||U[Y]==null)&&delete U[Y];U.spin!=null&&U.spinId==null&&(U.spinId=U.spin,delete U.spin);for(let Y in U)if(Y.includes("~")){const Be=Y.split("~")[0];U.hasOwnProperty(Be)&&U[Be]==U[Y]&&delete U[Y]}}}catch{}if(De==0&&((ca=(Bt=($t=(Ve=e==null?void 0:e.dataExtractor)==null?void 0:Ve.pidAttributes)==null?void 0:$t.pidApi)==null?void 0:Bt.pidApiAttributes)!=null&&ca.variousCharges&&da!=0&&(da=da-di+pi),De=da),isNaN(pr)||(De-=pr),De&&e.orderPriceConvert&&(De=De*e.orderPriceConvert),e.dataExtractor.extraChargesPerOrder){let U=0;for(let Y of e.dataExtractor.extraChargesPerOrder)try{let Be=parseFloat(M(Fe,Y));isNaN(Be)||(U+=Be)}catch{Z("ERROR_SPENDCALC_XTRACHARGES",t)}U&&U>0&&(de.totalExtraCharge=U)}if(de!=null&&de.addressJSON)try{let U=sr(e,de==null?void 0:de.addressJSON,t);if(U&&(Object.keys(U).length>1||Object.keys(U).length===1&&((Sa=Object.keys(U==null?void 0:U.addressJSON))==null?void 0:Sa.length)>0)){let Y;if(de!=null&&de.addID)Y=de==null?void 0:de.addID;else{let Be=JSON.stringify(U);Be=Be.replace(/[^a-zA-Z0-9]/g,""),Y=Pr(Be)}f[Y]?JSON.stringify(f[Y]).length<JSON.stringify(U).length&&(f[Y]=Object.assign({},JSON.parse(JSON.stringify(U)))):f[Y]=U,de.addID=Y,de==null||delete de.addressJSON}}catch{Z("ERROR_SPENDCALC_ADDRESSJSON",t)}if(Xe&&typeof Xe=="number"&&(Xe=e.statusMapping?e.statusMapping[Xe]:Xe),e!=null&&e.updateOrderTotalAtLastWhenZero&&De===0){for(let U of(Fa=e.updateOrderTotalAtLastWhenZero)==null?void 0:Fa.add)try{let Y=M(Fe,U);typeof Y=="string"&&(Y=Y.replace(",","")),Y=parseFloat(Y),!isNaN(Y)&&Y>0&&(De+=Y)}catch{Z("ERROR_SPENDCALC_ADD",t)}for(let U of e.updateOrderTotalAtLastWhenZero.subtract)try{let Y=M(Fe,U);typeof Y=="string"&&(Y=Y.replace(",","")),Y=parseFloat(Y),!isNaN(Y)&&Y>0&&(De-=Y)}catch{Z("ERROR_SPENDCALC_SUB",t)}}if(e.updateStatusAtLast){if(De!=0){try{De=parseFloat(M(Fe,e.updateStatusAtLast.totalAmount)),De*=e.pidPriceConvert}catch{Z("ERROR_SPENDCALC_STATATLAST",t)}for(let U of de.itemDetails)U.status="DELIVERED"}else if(De===0)if(Xe==="CANCELLED")for(let U of de.itemDetails)U.status="CANCELLED";else Xe="RETURNED"}if(Xe&&e.invalidStatus.includes(Xe.trim().toLowerCase())&&(De=0),Xe=Xe?{orderStatus:Xe}:{},typeof Xe=="string"&&!e.invalidStatus.includes(Xe.trim().toLowerCase())&&(De||Z("ERROR_ORDERTOTAL",t)),De=De<0?0:De,e.multiCurr&&(de!=null&&de.curr)&&(u[lt][de==null?void 0:de.curr]?u[lt][de==null?void 0:de.curr]+=De:u[lt][de==null?void 0:de.curr]=De),d[lt].totalSpent+=De,d[lt].details.push({orderId:mt,orderDate:it,orderTotal:De,orderDetails:de,marketPlace:p[mt]||"Unknown",...Xe}),c&&lt<=r)return{orderJSON:d,orderCount:h,curr:{domCurr:y,curArr:k},quarterWiseCur:u,addressMap:f}}catch(Fe){Z(JSON.stringify(Fe),t)}e!=null&&e.orderDelay&&await qc((e==null?void 0:e.orderDelay)||1500)}}try{if(e.dataExtractor.outerOrderList){let B=M(N,e.dataExtractor.outerOrderList);for(let Q in B){let G=B[Q],C=M(G,e.dataExtractor.orderList),fe=await Pe(C);if(c&&Object.keys(d).length&&lt<=r)return fe}}else{let B=M(N,e.dataExtractor.orderList)||N;e.dataExtractor.groupOrders&&(B=gl(B,e==null?void 0:e.groupKeys,e==null?void 0:e.itemKeys,t));let Q=await Pe(B);if(c&&Object.keys(d).length&&lt<=r)return Q}}catch{Z("ERROR_SPENDCALC_ORDERLIST",t)}Xs("page_end",t,o);let qe=eu((Te=ht[o][t])==null?void 0:Te.page_start,(se=ht[o][t])==null?void 0:se.page_end);if(Rt("per_page_call",t,o,parseFloat(qe)),Rt("page_per_count",t,o),!e.ignoreZeroOrders&&pe==0||e.pageEndCheck&&M(N,e.pageEndCheck.jsonPath)==e.pageEndCheck.equalTo||ve)break}catch{Rt("spend_failed",t,o);break}if(!e.dontBreakOuter&&ve)break}catch{Rt("spend_failed",t,o);break}e.multiCurr&&(k=Object.keys(I),y=l||((Ee=Object.entries(I||{}).reduce((j,N)=>(N==null?void 0:N[1])>((j==null?void 0:j[1])||0)?N:j,[null,0]))==null?void 0:Ee[0])),e!=null&&e.timeSpend&&(await ap(e==null?void 0:e.timeSpend,t,i,a,s,o,d,r),h=ja[o])}catch(Je){Rt("spend_failed",t,o),R("calculateSpend",Je),ec(t,Je.message)}return{orderJSON:d,orderCount:h,curr:{domCurr:y,curArr:k},quarterWiseCur:u,addressMap:f}}async function kl(e,t,r,i,a){try{let s=i,o=new Set;e.length||o.add("No_Data");for(let l of e)try{let c=JSON.parse(l==null?void 0:l.details);if(!Array.isArray(c)||c.length===0)o.add(`No_Spend_${l==null?void 0:l.quarter}`);else for(let d of c){let f=Array.isArray(s==null?void 0:s.orderLevel)?s==null?void 0:s.orderLevel.filter(k=>!d.hasOwnProperty(k)||!d[k]):[];for(let k of f)o.add(k);let p=d==null?void 0:d.orderDetails;(!p||!Object.keys(p).length&&s.orderDetails)&&o.add("orderDetails");let u=Array.isArray(s==null?void 0:s.orderDetails)?s==null?void 0:s.orderDetails.filter(k=>!p.hasOwnProperty(k)||!p[k]):[];for(let k of u)o.add(k);let I=p==null?void 0:p.itemDetails;if(!I||!Array.isArray(I)||I.length===0&&s.itemLevel)o.add("itemDetails");else for(let k of I){let y=Array.isArray(s==null?void 0:s.itemLevel)?s==null?void 0:s.itemLevel.filter(b=>!k.hasOwnProperty(b)||!k[b]):[];for(let b of y)o.add(b)}}}catch{}for(let l of o){let c={pos:t,spend_id:r,missing_keys_report:`${l}_${t}`};Rt("spend_missing_key",t,a),await ge("SpendCalcExtractMissing",c),await ur({eventID:77,errorSource:"spendMonitoring",errorDetails:c})}try{for(let l of Tt[t]){let c={pos:t,spend_id:r,missing_keys_report:`${l}_${t}`,[`${l}_${t}_count`]:Tt[t][l]};Rt("spend_missing_key",t,a),await ge("SpendCalcExtractMissing",c),await ur({eventID:77,errorSource:"spendMonitoring",errorDetails:c})}}catch{}Tt[t]={}}catch{}}async function xl(e,t,r){try{let a={ext_id:await x.getItem("ext_id"),stage:"spend_clicked",spendId:e,pos:t},s=await fetch("https://ext1.buyhatke.com/extension-apis/analytics/track/Spend_Lens/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(s=await s.json(),s!=null&&s.id){let o=s==null?void 0:s.id;Rt(`${e}~${o}~APILOGS`,t,r)}return{}}catch{}}let dt={};async function En(e,t,r,i=!0){try{let a=await x.getItem("ext_id"),s=await x.getItem("ext_auth");i&&typeof i=="string"&&i.includes("checkout")&&(t=a);let o=await fetch(`https://ext1.buyhatke.com/spend-apis/spend-calc/logFailedResponse?extId=${a}&extAuth=${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({failedResponse:e,spendId:t,pos:r,allTime:i})});return 1}catch{return 0}}setInterval(async()=>{try{dt={}}catch{}},5*60*1e3);async function op(e,t,r,i,a,s,o,l=!1,c=""){try{let d=await Al(e,r,t);if(d.redirectUrl)return d;let{totalSpent:f,lastQuarter:p,spendId:u,totalOrders:I,domCurr:k}=d;if(c&&(p=c),!u||isNaN(u))return Rt("spend_id_not_found",e,o),0;await xl(u,e,o),Tt[e]||(Tt[e]={});let{additionalSpend:y,data:b,additionalOrders:h,curArr:m=[],addressMap:A={}}=await Il(t,e,p,i,a,s,o,k,l),P=dt[e];if(P&&delete dt[e],y===0&&P)if(f==0||!p||p=="2000_0"||t.defaultQuarter&&p==t.defaultQuarter)try{await En(P,u,e,!0)}catch{}else try{await En(P,u,e,!1)}catch{}return t!=null&&t.missingConfig&&await kl(b,e,u,t==null?void 0:t.missingConfig,o),await _l(u,b,m,A),delete ja[o],delete na[o],{totalSpent:f+y,totalOrders:h+I,domCurr:k,lastQuarter:p}}catch(d){return Rt("spend_failed",e,o),R("spendCalculate",d),delete ja[o],delete na[o],0}}function lp(e){return ja[e]||0}function cp(e){return na[e]||[]}async function up(){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let e=`https://ext1.buyhatke.com/spend-apis/spend-calc/updateAutoSync?extId=${w.ext_id}&extAuth=${w.ext_auth}`,r=await(await fetch(e)).json();return r.status==1?r.data:{}}catch(e){return R("updateAutoSync",e),{}}}async function dp(e,t){try{return await(await fetch(e,t)).text()}catch{}}const pp=15,br={};async function fp(e,t,r,i,a=""){try{const s=String(i),o=`${s}_${t}`;if(br[o])return;br[o]=!0;let l=await x.getItem(r)||{};l[s]||(l[s]={}),l[s][t]||(l[s][t]=[]);const c=l[s][t];if(e!=null&&e.prev&&!(c.findIndex(I=>I.key===e.prev)!==-1)){delete br[o];return}const d=Date.now(),f=a?`${a}~${d}`:d,p=c.findIndex(u=>u.key===(e==null?void 0:e.key));p!==-1?c[p].ts=f:(c.push({key:e==null?void 0:e.key,ts:f}),c.length>pp&&c.shift()),l[s][t]=c,await x.setItem(r,l),delete br[o]}catch{delete br[`${i}_${t}`]}}async function vl(e){try{let t=new Date,r=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()).getTime(),i=`https://search-new.bitbns.com/extension/configs-spendCalc/prodNew/${e}.json?rand=${r}`,a=await fetch(i);return a.status>=400&&a.status<599?null:(a=await a.json(),a)}catch(t){return R("getSpendConfig",t),null}}async function Al(e,t,r){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");const i={pos:e,usernameObj:t};let a=`https://ext1.buyhatke.com/spend-apis/spend-calc/getQuarters?extId=${w.ext_id}&extAuth=${w.ext_auth}`,o=await(await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).json(),l=r.defaultQuarter?r.defaultQuarter:"2000_0";if(o.status==0){if(o.redirectUrl)return{redirectUrl:o.redirectUrl};throw new Error("Something went wrong")}let{spendId:c,lastQuarter:d,totalSpent:f,totalOrders:p,domCurr:u}=o.data;return d=d?d.endsWith("_3")?`${parseInt(d.split("_")[0])+1}_0`:`${d.split("_")[0]}_${parseInt(d.split("_")[1])+1}`:l,{lastQuarter:d,spendId:c,totalSpent:f,totalOrders:p,domCurr:u}}catch(i){return R("getSpendSummary",i),{}}}async function Tl(e,t){const r=new TextEncoder,i=r.encode(t),a=await crypto.subtle.importKey("raw",i,{name:"PBKDF2"},!1,["deriveKey"]),s=crypto.getRandomValues(new Uint8Array(16)),o=await crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:1e5,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!1,["encrypt"]),l=r.encode(e),c=crypto.getRandomValues(new Uint8Array(12)),d=await crypto.subtle.encrypt({name:"AES-GCM",iv:c},o,l),f=new Uint8Array(s.byteLength+c.byteLength+d.byteLength);return f.set(s,0),f.set(c,s.byteLength),f.set(new Uint8Array(d),s.byteLength+c.byteLength),btoa(Array.from(f).map(p=>String.fromCharCode(p)).join(""))}async function _l(e,t,r={},i={},a=!1){try{let{keyEnc:s,keyTime:o}=await chrome.storage.local.get(["keyEnc","keyTime"]),l=Date.now();o=o||0;let c=Math.floor((l-o)/1e3);(!s||!o||c>21600)&&await Gl();let d=await chrome.storage.local.get(["keyEnc","keyTime"]);if(s=d.keyEnc,o=d.keyTime,t){let f=`https://ext1.buyhatke.com/spend-apis/spend-calc/orderHistory/v2?extId=${w.ext_id}&extAuth=${w.ext_auth}&time=${o}`,p={spendId:e,data:t};r&&(p.currency=r),i&&(p.addressDetails=i),a&&(p.isBusiness=a);const u=await Tl(JSON.stringify(p),s);let I=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({raw:u})});return!0}}catch(s){R("pushSpendData",s)}return!1}async function hp(){try{let e=new Date,r=`https://search-new.bitbns.com/extension/configs-ext/prod/DittoScrapConfig.json?rand=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r);return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(e){return R("getDittoScrapConfig",e),""}}async function yp(e,t){try{if(e)return tc(e,t)}catch(r){return R("getSearchHTML",r),""}}async function mp(e,t){try{let r="https://search-new.bitbns.com/buyhatke/sendDittoSearchGlobal",i={"Content-Type":"application/json"};if(t.pid&&t.pos&&e){let s=await fetch(r,{method:"POST",headers:i,body:JSON.stringify({data:e,currData:t})});if(s.status>=400&&s.status<=599)throw new Error("status: "+s.status);return s=await s.json(),s;J(await s.json())}return""}catch(r){return R("sendDittoSearchData",r),""}}async function wp(e,t,r,i,a,s,o){try{let l="https://search-new.bitbns.com/buyhatke/sendExactData",c={"Content-Type":"application/json"};if(r&&t&&e){let f=await fetch(l,{method:"POST",headers:c,body:JSON.stringify({exactData:e,pos:t,pid:r,prod:i,price:a,image:s,src:o})});if(f.status>=400&&f.status<=599)throw new Error("status: "+f.status);f=await f.json(),J(await f.json())}return""}catch(l){return R("sendDittoSearchData",l),""}}async function fo(e){try{let{pid:t,pos:r,prod:i,price:a}=e,s=`https://search-new.bitbns.com/buyhatke/getProductCategorization?pid=${t}&pos=${r}`,o=await fetch(s);return o.status>=400&&o.status<599?"":(o=await o.json(),o)}catch(t){return R("sendDittoSearchData",t),""}}function fa(e){if(e.method=="POST"||e.method=="GET"||e.method=="PUT"){if(JSON.stringify(e).indexOf("BUYHATKE")>-1||JSON.stringify(e).indexOf("buyhatke")>-1)Ia=1;else if(jt&&Object.keys(jt).length)try{for(let t in jt)if(jt.hasOwnProperty(t))try{let r=t.split("~")[0],i=t.split("~")[1],a=r.replace(/\*/g,".*").replace(/\//g,"\\/");new RegExp(a).test(e.url)&&e.tabId==i&&(Ia=1)}catch{}}catch{}Ea++,ia=e}}async function ha(e){if(e.method=="POST"||e.method=="PUT"||e.method=="GET")if(e.requestBody!=null){let t="";if(e.requestBody.hasOwnProperty("raw")){const r=new Uint8Array(e.requestBody.raw[0].bytes);t=new TextDecoder("utf-8").decode(r)}else t=JSON.stringify(e.requestBody);if(t.indexOf("BUYHATKE")>-1||t.indexOf("buyhatke")>-1)Ia=1;else if(jt&&Object.keys(jt).length)try{for(let r in jt)if(jt.hasOwnProperty(r))try{let i=r.split("~")[0],a=r.split("~")[1],s=i.replace(/\*/g,".*").replace(/\//g,"\\/");new RegExp(s).test(e.url)&&e.tabId==a&&(Ia=1)}catch{}}catch{}Ea++,Qa=t}else Ea++,Qa="NULL"}var ks={};async function ti(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();ks=await(await fetch("https://search-new.bitbns.com/extension/configs-coupons/prod/ALL_CONFIG_COUPON.json?rand="+t)).json()}catch(e){R("getACSiteDetails",e),J("Error in getACSiteDetails ",e)}}ti();setInterval(()=>{ti()},12*60*60*1e3);var Lr={},ai={},Ar={};let Nn={};async function ri(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();const r="https://search-new.bitbns.com/extension/configs-coupons/prod/ALL_CONFIG.json";let i=await fetch(r+"?rand="+t),a=!1;if(i.ok)try{let s=await i.json();s&&Object.keys(s).length>0?(Lr=s,a=!0):a=!1}catch{a=!1}a||(t=Date.now(),i=await fetch(r+"?rand="+t),i.ok&&(Lr=await i.json()))}catch(e){R("getSiteDetails",e),J("Error in getSiteDetails ",e)}}async function bp(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();Ar=await(await fetch("https://search-new.bitbns.com/extension/configs-coupons/prod/REGION_CONFIG.json?rand="+t)).json()}catch(e){R("getMultiRegionConfig",e),J("Error in getMultiRegionConfig ",e)}}async function Ip(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();Nn=await(await fetch("https://search-new.bitbns.com/extension/configs-ext/prod/shortenedUrlConfig.json?rand="+t)).json()}catch(e){R("getShortenedUrlConfig",e),J("Error in getShortenedUrlConfig ",e)}}async function si(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();ai=await(await fetch("https://search-new.bitbns.com/extension/configs-ext/prod/blockUI.json?rand="+t)).json()}catch(e){R("getBlockUISiteDetails",e),J("Error in getBlockUISiteDetails ",e)}}ri();si();setInterval(()=>{ri(),si()},12*60*60*1e3);async function Sl(){try{for(let e in bn){let{name:t,events:r,errorMessage:i}=bn[e],a=await x.getItem(t)||{};for(let s in a){let o=a[s];for(let l in o){let c={message:i,pos:parseInt(l)},d=o[l]||[];d.sort((b,h)=>{let m=typeof b.ts=="string"&&b.ts.includes("~")?Number(b.ts.split("~")[1]):b.ts,A=typeof h.ts=="string"&&h.ts.includes("~")?Number(h.ts.split("~")[1]):h.ts;return m-A});let f=Date.now(),p=!1,u=[],I={},k={};for(let b of d)if(typeof b.ts=="string"&&b.ts.includes("~")){const[h,m]=b.ts.split("~");I[b.key]=Number(m),k[b.key]=h}else I[b.key]=b.ts;let y=r[0].key;if(k[y]&&(c.orderId=k[y]),!I[y]){p=!0;continue}for(let b=1;b<r.length;b++){let h=r[b],m=r.find(S=>S.key===h.prev);if(!m)continue;let A=I[m.key],P=I[h.key];if(k[m.key]&&(c.orderId=k[m.key]),P&&A)if(P-A<=h.TTL){p=!0;break}else{await ge(`${t}Error`,c),p=!0;break}else if(A&&!P)if(f-A>h.TTL){await ge(`${t}Error`,c),p=!0;break}else u=d}p?delete o[l]:o[l]=u}Object.keys(o).length===0?delete a[s]:a[s]=o}await x.setItem(t,a)}}catch{}}Sl();setInterval(async()=>{await Sl()},60*1e3);async function Pl(){var e;try{let t=await x.getItem("ext_id"),r=await x.getItem("SCMonitorData"),i=JSON.parse(r??"{}");for(let a of Object.keys(i))try{let s=i[a];for(let o of s)try{let l={[a]:{stages:[]}},c=[],d={},f={};for(let p of o)try{if(typeof(p==null?void 0:p.stage)=="string"&&((e=p==null?void 0:p.stage)!=null&&e.includes("APILOGS")))try{let u=p==null?void 0:p.stage.split("~");f.spendId=parseInt(u[0]),f.id=parseInt(u[1]),f.ext_id=t,f.pos=parseInt(a)}catch{}else((p==null?void 0:p.stage)=="per_page_call"||(p==null?void 0:p.stage)=="time_taken")&&(d[p==null?void 0:p.stage]=parseFloat(p==null?void 0:p.count)),c.push(p)}catch{}f.stages=d,l[a].stages=c,l.ext_id=t,await fetch("https://ext1.buyhatke.com/extension-apis/analytics/track/Spend_Lens",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),Object.keys(f.stages).length>1&&await fetch("https://ext1.buyhatke.com/extension-apis/analytics/track/Spend_Lens/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})}catch{}}catch{}await x.removeItem("SCMonitorData")}catch{}}Pl();setInterval(async()=>{await Pl()},25*60*1e3);var Aa={};async function qr(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();Aa=await(await fetch("https://search-new.bitbns.com/extension/configs-coupons/prod/REJECT_SITES.json?rand="+t)).json()}catch(e){R("rejectSiteDetails",e),J("Error in rejectSiteDetails ",e)}}qr();setInterval(()=>{qr()},12*60*60*1e3);let Ds=new Map,Er=[],ho=Date.now();async function Ol(){const e=Date.now();if(!(e-ho<5*60*1e3||Er.length===0))try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth"),await fetch(`https://ext1.buyhatke.com/extension-apis/logMismatchedPos?extId=${w.ext_id}&extAuth=${w.ext_auth}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mismatches:Er})}),ho=e,Er=[]}catch{}}async function gp(e){var t;try{let r=e,i=(t=new URL(r))==null?void 0:t.hostname;r=r.split("?")[0],Object.keys(ks).length==0&&await ti(),Object.keys(Aa).length==0&&await qr();for(const a in Aa)if(e.startsWith(a))return"";for(let a in ks){const s=ks[a];for(let o of s.url)if(new RegExp(o.replace(/\./g,"\\.")).test(r)){if(s.notmatch&&s.notmatch.some(f=>new RegExp(f.replace(/\./g,"\\.")).test(r)))continue;let c=r.split("https://");if(c.length>1&&(r=c[1]),!r.startsWith(o))try{Ds.has(i)||(Ds.set(i,!0),Er.push({hostname:i,ACpos:a}),Ol())}catch{}return parseInt(a)}}return""}catch(r){return R("getACPOS",r),""}}async function Dt(e,t){var r;try{let i=e,a=(r=new URL(i))==null?void 0:r.hostname;i=i.split("?")[0],Object.keys(Lr).length==0&&await ri(),Object.keys(Ar).length==0&&await bp(),Object.keys(ai).length==0&&await si(),Object.keys(Aa).length==0&&await qr();for(let s=0;s<Aa.length;s++){const o=Aa[s];if(e.startsWith(o))return""}for(let s in Lr)if(new RegExp(s).test(i)){let l=Lr[s],c=i.split("https://");if(c.length>1&&(i=c[1]),!i.startsWith(s))try{Ds.has(a)||(Ds.set(a,!0),Er.push({hostname:a,pos:l}),Ol())}catch{}if(Ar.hasOwnProperty(`${l}`)){try{const d=await chrome.tabs.sendMessage(t,{action:"getRegion",config:Ar[`${l}`]});if(d&&d.region){let f=Ar[`${l}`].options;for(let p in f)if(d.region===p)return l=f[p],l}}catch{}return""}return l===2&&e.includes("marketplace=HYPERLOCAL")&&(l=25848),l===63&&e.includes("almBrandId=ctnow")&&(l=25846),l}return""}catch(i){return R("getPos",i),""}}let Ir=[];async function Dl(){try{if(Ir.length!=0)return Ir;const t=await fetch("https://search-new.bitbns.com/extension/configs-ext/prod/topSitesRecentlyVisited.json",{method:"GET"});if(!t.ok)return Ir=[2,63,111,2191,7376,8976,71,2190,7209,6068,1830,57],"";const r=await t.json();Ir=Object.keys(r)}catch{Ir=[2,63,111,2191,7376,8976,71,2190,7209,6068,1830,57]}}Dl();let nn={};async function kp(e){try{if(isNaN(e)||e==0)return{status:1,data:{}};if(nn[e])return nn[e];let t=`https://search-new.bitbns.com/buyhatke/getPosDetails?pos=${e}`,r=await fetch(t);return r.status>=400&&r.status<599?"":(r=await r.json(),nn[e]=r,r)}catch(t){return R("getSiteLogo",t),""}}async function yo(e){try{let t=ai.sitesToBlock||{};return t.hasOwnProperty(e.toString())&&t[e]}catch{return!1}}async function xp(e){try{let t=await x.getItem("ext_id"),r=await x.getItem("ext_auth"),i=`https://ext1.buyhatke.com/spend-apis/extSavings/extSavings?extId=${t}&extAuth=${r}`;return(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).status===200?200:400}catch(t){R("savings POST failure",t)}}async function vp(e){try{const r=Array.isArray(e)?JSON.stringify(e):String(e||"[]");w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var t=`https://ext1.buyhatke.com/extension-apis/sendSpecsApple?extId=${w.ext_id}&extAuth=${w.ext_auth}`;const i="varArr="+encodeURIComponent(r);await Ae(t,"POST",i,"formData")}catch{}}async function Ap(e,t){try{let r=e?e[Object.keys(e)[0]]:void 0;if(r===void 0||typeof r!="object"||r===null||Object.keys(r).length===0)return"";let o=await fetch("https://ext1.buyhatke.com/extension-apis/general/sendFilters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pos:t,details:e})});return""}catch{}}async function Tp(e){try{let{keyEnc:t,keyTime:r}=await chrome.storage.local.get(["keyEnc","keyTime"]),i=Date.now();r=r||0;let a=Math.floor((i-r)/1e3);(!t||!r||a>21600)&&await Gl();let s=await chrome.storage.local.get(["keyEnc","keyTime"]);t=s.keyEnc,r=s.keyTime;let o=`https://ext1.buyhatke.com/extension-apis/postUpdateNew?extId=${w.ext_id}&extAuth=${w.ext_auth}&time=${r}`;const l=await Tl(JSON.stringify(e),t);return(await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({raw:l})})).status===200?200:400}catch(t){R("cart POST failure",t)}}async function Ll(e,t,r){try{let i=e.replace("PLACEHOLDER_FLIP_ENDPOINT",is),a=await fetch(i,t);a.status>300&&(is=is==="1"?"2":"1",i=e.replace("PLACEHOLDER_FLIP_ENDPOINT",is),a=await fetch(i,t));let s={status:a.status,ok:a.ok};return r?s.body=await a.text():s.body=await a.json(),s}catch{}}async function _p(e,t,r){try{let i=JSON.stringify(r.options);i=i.replace("PLACEHOLDER0",e),i=i.replace("PLACEHOLDER1",t),i=JSON.parse(i);let s=(await Ll(r.url,i,!1)).body,o=r.priceDataListKey,l=M(s,o),c=1e15;for(let d of l){let f=r.innerPriceDataKey,p=M(d,f);p=parseFloat(p),isNaN(c)||(c=Math.min(p,c))}return c<=0||c>=1e15?0:c}catch{return-1}}async function Sp(e){try{let i=await fetch("https://utility.buyhatke.com/extension-savings/postLiveData",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);return""}catch{}}async function Pp(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let t=`https://api.buyhatke.com/autocoupon-apis/updateCouponStatus?extId=${w.ext_id}&extAuth=${w.ext_auth}`,i=await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);return""}catch(t){return R("updateCouponStatus",t),""}}async function Op(e){try{return await uh(e),""}catch(t){return R("ACTSMonitor",t),""}}async function Dp(e){try{return e.eventID=16,await Yl(e),""}catch(t){return R("AcMonitor",t),""}}async function Lp(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let t=`https://api.buyhatke.com/autocoupon-apis/checkoutScrap?extId=${w.ext_id}&extAuth=${w.ext_auth}`;e.ext_id=w.ext_id;let r=JSON.stringify(e),a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:r});if(a.status>=400&&a.status<=599)throw new Error("status: "+a.status);return""}catch(t){return R("sendCheckoutScrap",t),""}}async function Ep(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let t=`https://api.buyhatke.com/autocoupon-apis/voucherScrap?extId=${w.ext_id}&extAuth=${w.ext_auth}`,r=JSON.stringify(e),a=await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:r});if(a.status>=400&&a.status<=599)throw new Error("status: "+a.status);return""}catch(t){return R("sendVoucherScrap",t),""}}const Np=(e,t,r=!1)=>{const i=r?(26-t)%26:t,a=i>0?i:26+i%26;return[...e].map((s,o)=>{const l=e.charCodeAt(o);return l>=65&&l<=90?String.fromCharCode((l-65+a)%26+65):l>=97&&l<=122?String.fromCharCode((l-97+a)%26+97):s}).join("")};async function Mp(e){try{let t=Np(e,Td),r=await(x.getItem("popHash")||JSON.parse(x.getItem("popHash")==null)?{}:await x.getItem("popHash"));r[t]!=null?r[t]++:r[t]=1,await x.setItem("popHash",JSON.stringify(r))}catch(t){R("incPopCounter",t),J(t)}}async function El(){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let e=await JSON.parse(x.getItem("popHash")==null?"{}":x.getItem("popHash"));if(Object.keys(e).length==0)return"";let t=`https://ext1.buyhatke.com/extension-apis/popcount?extId=${w.ext_id}&extAuth=${w.ext_auth}`,i=await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);return i.ok&&(i=await i.json(),i.status==1&&await x.removeItem("popHash")),""}catch{return""}}El();setInterval(El,15*60*1e3);async function Rp(){try{J("I am here");let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime();return await(await fetch("https://search-new.bitbns.com/extension/configs-coupons/prod/scrapSiteDetails.json?rand="+t)).json()}catch(e){return R("getHTMLScrapSites",e),""}}async function jp(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let t=`https://api.buyhatke.com/autocoupon-apis/htmlscrap?extId=${w.ext_id}&extAuth=${w.ext_auth}`,i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);return""}catch(t){return R("sendScrapHTML",t),""}}let Mn={};setInterval(function(){Mn={}},3600*1e3);async function Up(e){try{if(!e||Mn[e])return[];let t=new Date,r=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()).getTime(),i=`https://search-new.bitbns.com/extension/configs-coupons/prod/category_${e}.json?rand=${r}`,a=await fetch(i);return a.status==404&&(Mn[e]=1),a.status>=400&&a.status<599?[]:(a=await a.json(),a)}catch(t){return R("getCategoryConfig",t),[]}}async function $p(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let t=`https://ext1.buyhatke.com/extension-apis/specsCrawl?extId=${w.ext_id}&extAuth=${w.ext_auth}`,i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);return J(await i.json()),""}catch(t){return R("sendCategoryCrawl",t),""}}async function Jp(){try{let e=await x.getItem("referralDataSource"),t=parseInt(Math.random()*100);if(e&&e.source)return;if(t>5)return;let r=await x.getItem("ext_id"),i=await x.getItem("ext_auth"),s=await(await fetch(`https://settings.buyhatke.com/extension-settings/fetchSource?ext_id=${r}&ext_auth=${i}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json();if(s.success==!0){let o={source:s.source,uniqcode:""};await x.setItem("referralDataSource",o)}else throw new Error("logging failed !");return""}catch(e){return R("referralData",e),J(e),""}}Jp();async function ls(e,t,r){try{let i=navigator.userAgent||navigator.vendor||window.opera;/android/i.test(i)?r=0:r==0?r=1:r=0,w.ext_id=await x.getItem("ext_id"),w.referralDataSource=await x.getItem("referralDataSource");let a={source:e,uniqcode:t};w.referralDataSource||(await x.setItem("referralDataSource",a),w.referralDataSource=a);let s=`https://compare.buyhatke.com/extension_referral/getdata?extID=${w.ext_id}&extAuth=`+w.ext_auth,l=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...a,fromMobile:r})});if(l.status>=400&&l.status<=599)throw new Error("status: "+l.status);return J(await l.json()),""}catch(i){return R("referralData",i),J(i),""}}async function Fp(e){try{w.ext_id=await x.getItem("ext_id");let t=e.url.split("//")[1];return t=t.split("/")[0],""}catch(t){return R("getAffCouponsNew",t),""}}let mo=[];async function Bp(e){try{if(!e||mo.includes(e))return"";let t=new Date,r=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()).getTime(),i=`https://search-new.bitbns.com/extension/configs-coupons/prod/couponScrap_${e}.json?rand=${r}`,a=await fetch(i);return a.status===404&&mo.push(e),a.status>=400&&a.status<599?"":(a=await a.json(),a)}catch{return""}}async function Hp(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let t=`https://api.buyhatke.com/autocoupon-apis/updateCouponScrap?extId=${w.ext_id}&extAuth=${w.ext_auth}`,i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);return""}catch(t){return R("sendCouponScrap",t),""}}async function Vp(e){try{let t=`https://search-new.bitbns.com/buyhatke/deals?prod=${encodeURIComponent(e.prod)}&brand=${encodeURIComponent(e.brand)}&price=${e.price}&category=${encodeURIComponent(e.category)}&pid=${encodeURIComponent(e.pid)}&pos=${encodeURIComponent(e.pos)}`,r=await fetch(t);if(r.status>=400&&r.status<=599)throw new Error("status: "+r.status);return r=await r.json(),r}catch(t){return R("getFeeds",t),""}}function Rn(e){try{qa={};for(let t=0;t<e.length;t++){let r=e[t].pid,i=e[t].position,a=`${r}*~*${i}`;qa[a]=1}}catch(t){R("updateWatchListMap",t)}}let cs=[];async function Wp(e){try{Math.random()<yl&&(cs=e.map(r=>({pid:r.PID,link:r.productLink,position:r.sitePosition,entry_id:Math.floor(Math.random()*100)+1,link_id:1e3})),cs.length>0&&await jn(cs,"stale"))}catch{cs=[]}}async function Nl(){try{let e=await x.getItem("autoAlert");const t=Date.now();e?t-e>=864e5&&(await x.setItem("autoAlert",t),await Fr(!0),await jn(Ye)):(await x.setItem("autoAlert",t),await Fr(!0),await jn(Ye))}catch(e){R("Error checking autoAlertScrape",e)}}async function jn(e,t=null){var r,i,a,s,o;try{for(let l=0;l<e.length;l++){let c=(r=e[l])==null?void 0:r.pid,d=(i=e[l])==null?void 0:i.position,f=(a=e[l])==null?void 0:a.link_id,p=(s=e[l])==null?void 0:s.entry_id,u=(o=e[l])==null?void 0:o.link,I=w.ext_id,k=w.ext_auth;if(!(!u||!d||!c))try{let y=await fetch(u);if(!y.ok)throw new Error(`Error fetching product at ${u}: ${y.statusText}`);if(y.status>=400&&y.status<=599)throw new Error(`Product at ${u} returned error status: ${y.status}`);y=await y.text();const b={productID:c,productPOS:d,productLinkID:f,productEntryID:p,productLink:u,clientExtId:I,clientExtAuth:k,fetchedHTML:y};t==="stale"&&(b.comparisonFlag=!0),Jn||await Fr(!0);let h=Jn+"/spidy/watchPriceResponse";await Kp(b,h),await new Promise(m=>setTimeout(m,3e3))}catch(y){R("error in fetching HTML : ",y);continue}}}catch(l){R("error in autoAlert_feedData:",l)}}async function Kp(e,t){let i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok)throw new Error(`Error during POST request to ${t}: ${i.statusText}`)}async function zp(e){try{let t=new Date,r=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()).getTime(),i=`https://search-new.bitbns.com/extension/configs-coupons/prod/wishlist_${e}.json?rand=${r}`,a=await fetch(i);return a.status>=400&&a.status<599?"":(a=await a.json(),a)}catch(t){return R("getScrapConfigWishlist",t),""}}async function Zp(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let t=[];for(let s=0;s<e.length;s++){e[s].extid=w.ext_id,e[s].extauth=w.ext_auth;let o=e[s].pid,l=e[s].pos,c=`${o}*~*${l}`;qa[c]||t.push(e[s])}if(t.length==0)return"";let a=await fetch("https://api.buyhatke.com/paapi/priceAlertWishlist",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"data="+encodeURIComponent(JSON.stringify(t))});if(a.status>=400&&a.status<=599)throw new Error("status: "+a.status);return a.status==200&&(t.length>20?setTimeout(Ft,2e4):Ft()),""}catch(t){return R("sendWishListData",t),""}}var Ml={};function Xp(e){var t=e.split("#~#"),r=t[2],i=t[1],a=t[0],s={};s.bread=i,s.pos=r,Ml[a]=s}function Yp(e){var t=e.split("#~#"),r=t[2],i=t[1],a=t[0],s=Ml[a];if(s){var o=s.bread,l=s.pos;(r!=l||i!=o)&&i!=""&&o!=""&&r!=0&&l!=0&&Qp(i,r,o,l)}}async function Qp(e,t,r,i){try{var a="https://compare.buyhatke.com/extension/scm.php",s=a;myRand=parseInt(Math.random()*999999999999999);var o=s+"?rand="+myRand+"&bread="+encodeURIComponent(e)+"&pos="+t+"&bread_act="+encodeURIComponent(r)+"&pos_act="+i,l=await Ae(s,"GET",null)}catch(c){R("sendMatchFound",c),J("Error sendMatchFound ",c)}}async function Gp(e){try{w.existingSales=await x.getItem("existingSales");var t=w.existingSales;t=JSON.parse(t);for(var r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)if(t[r][i].code==e)return t[r][i].time}catch(a){R("getStartTime",a),J("Error getStartTime ",a)}return 0}async function Cp(e){try{w.checkedArray=await x.getItem("checkedArray");var t=w.checkedArray;return t=JSON.parse(t),t[e]===!0?1:0}catch(r){R("getSubsStatus",r),J("Error getSubsStatus ",r)}}async function qp(e){try{let t=to||[],r={};for(let i=0;i<t.length;i++){let a=t[i],s=0,o=a.offer_id?a.offer_id:"",l=a.frequency?a.frequency:12;if(l=l*60*60*1e3,!o)continue;if((a.posToShow?a.posToShow:[]).includes(e.pos)){if(r=await x.getItem("goodiesInStore"),r)if(r=JSON.parse(r),r[o]){let d=new Date().getTime();r[o]+l<=d&&(s=1)}else s=1;else s=1,r={};if(s&&(a.bread_arr||a.url_reg_arr||a.price_range)&&(s=ef(a,e)),a.toShow=s,r!=null&&r[o]||(r[o]=0),s==1)return r[o]=new Date().getTime(),await x.setItem("goodiesInStore",JSON.stringify(r)),a}}return{}}catch{return{}}}function ef(e,t){try{if(!e.bread_arr&&!e.url_reg_arr&&!e.price_range)return 1;let{pos:r,url:i,bread:a,price:s}=Js(t);a&&(a=a.trim()),s&&parseFloat(s)>0&&!isNaN(parseFloat(s))?s=parseFloat(s):s=0;let o=e!=null&&e.url_reg_arr?e==null?void 0:e.url_reg_arr:[],l=e!=null&&e.bread_arr?e==null?void 0:e.bread_arr:[],c=e!=null&&e.price_range?e==null?void 0:e.price_range:{},d=0,f=0;if(c.min&&c.max&&(d=parseFloat(c.min),f=parseFloat(c.max)),l.length>0&&l.includes(a)){if(c.min&&c.max&&(s<d||s>f))return 0}else if(l.length>0){let p=!1;for(const u of l)if(a.startsWith(u)){p=!0;break}if(p){if(c.min&&c.max&&(s<d||s>f))return 0}else return 0}else{if(l.length>0&&!l.includes(a))return 0;if(o.length>0)for(let p=0;p<o.length;p++){let u=new RegExp(o[p]);if(i&&!u.test(i))return 0}}return 1}catch{return 1}}function tf(e){let t=[],r=Object.keys(ct);for(let i=0;i<r.length;i++)r[i]==e&&(t=ct[e]);return t}function Rl(e={}){var c,d,f,p,u,I;let{pos:t,url:r,bread:i,price:a}=Js(e),s=t,o=[],l=Object.keys(ct);i&&(i=i.trim()),a&&parseFloat(a)>0&&!isNaN(parseFloat(a))?a=parseFloat(a):a=0;for(let k=0;k<l.length;k++)if(l[k]==s)for(let y=0;y<ct[s].length;y++){let b=ct[s][y].offer_id?ct[s][y].offer_id:0,h=(c=ct[s][y])!=null&&c.url_reg_arr?(d=ct[s][y])==null?void 0:d.url_reg_arr:[],m=(f=ct[s][y])!=null&&f.bread_arr?(p=ct[s][y])==null?void 0:p.bread_arr:[],A=(u=ct[s][y])!=null&&u.price_range?(I=ct[s][y])==null?void 0:I.price_range:{},P=0,S=0;if(A.min&&A.max&&(P=parseFloat(A.min),S=parseFloat(A.max)),m.length>0&&m.includes(i))A.min&&A.max&&a>=P&&a<=S&&(Nr(s+"~"+b),xs(s+"~"+b,e)==1&&(o=ct[s][y]));else if(m.length>0){let v=!1;for(const _ of m)if(i.startsWith(_)){v=!0;break}v&&A.min&&A.max&&a>=P&&a<=S&&(Nr(s+"~"+b),xs(s+"~"+b,e)==1&&(o=ct[s][y]))}else if(h.length>0)for(let v=0;v<h.length;v++){let _=new RegExp(h[v]);h[v]&&_&&_.test(r)&&(Nr(s+"~"+b),xs(s+"~"+b,e)==1&&(o=ct[s][y]))}}return o}function Js(e){let t=e.pos?e.pos:-1,r=e.url?e.url:"",i=e.bread?e.bread:"",a=e.price?e.price:0;return{pos:t,url:r,bread:i,price:a}}function af(e={}){let{pos:t}=Js(e),r=t,i=Rl(r),a=parseInt(new Date().getTime()/1e3);i&&i.start&&i.end&&i.url&&i.title&&i.image&&i.text&&i.start<=a&&i.end>=a&&_t.notifyPAOffers(i.image,i.title,i.text,i.url,"offerNotification-"+r,"offerNotification-"+r)}function xs(e,t={}){var r=new Date;Js(t),r=r.getDate();let i=0,a=0;Tr[e]&&(a=Tr[e]);let s=Math.floor(Date.now()/1e3);if(s-a>86400){let c=e+"vis";var o=Math.floor(Yt[c]);if(c.split("vis").length>1){c=c.split("vis")[0];let d=c+"push";var l=Math.floor(Yt[d]);s-l>1800&&s-a>86400&&o-s<240&&o-s>-100&&(Tr[e]=s,Yt[d]=s,i=1,af(t),x.setItem("visitedDet",JSON.stringify(Yt)),x.setItem("globalPushDet",JSON.stringify(Tr)))}}return i}function wo(e){var t="/legacy/assets/1.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){rf(e)},100)}function rf(e){var t="2.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){sf(e)},100)}function sf(e){var t="3.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){nf(e)},100)}function nf(e){var t="4.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){of(e)},100)}function of(e){var t="5.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){lf(e)},100)}function lf(e){var t="6.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){cf(e)},100)}function cf(e){var t="7.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){uf(e)},100)}function uf(e){var t="8.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){df(e)},100)}function df(e){var t="9.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){pf(e)},100)}function pf(e){var t="10.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){ff(e)},100)}function ff(e){var t="11.png";chrome.action.setIcon({tabId:e,path:t}),window.setTimeout(function(){hf(e)},100)}function hf(e){var t="12.png";chrome.action.setIcon({tabId:e,path:t})}async function yf(e,t,r,i,a,s,o){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth"),w.flagBL=await x.getItem("flagBL"),w.actBL=await x.getItem("actBL");var l,c,d,f=http[2*r],p=http[2*r+1],u=i;if(s.split("isbn=").length>1){c=s.split("isbn=")[1],c=c.split("~*~*")[0];var I="search="+encodeURIComponent(e)+"&isbn="+encodeURIComponent(c),k="https://compare.buyhatke.com/example_ext.php";l=1,d=0}else if(s.split("isapparel=").length>1){c=s.split("isapparel=")[1];var I="search="+encodeURIComponent(e),k="https://compare.buyhatke.com/apparelsSearch.php";d=1,l=0}else{d=0;var I="search="+encodeURIComponent(e)+"&data="+encodeURIComponent(s),k="https://compare.buyhatke.com/exampleNewExt.php";l=0,c=0}if(e!="")var y=a.split("/")[2];var b=await Ae(k,"POST",I,"formData");if(h){if((t==NaN||t=="NaN")&&(t=0),l==0&&d==0){var k="https://compare.buyhatke.com/updates10.php?searchText="+encodeURIComponent(e)+"&price="+t+"&ext_id="+w.ext_id+"&auth_val="+w.ext_auth+"&pos="+o;w.flagBL==1&&o==63?k+="&mainFL=1&ext_id="+w.ext_id:w.actBL<10&&o==63&&(k+="&mainFL=1")}else if(d==1)var k="https://compare.buyhatke.com/updates_app.php?searchText="+encodeURIComponent(e)+"&price="+t+"&ext_id="+w.ext_id+"&auth_val="+w.ext_auth;else{var k="https://compare.buyhatke.com/updates_ext.php?searchText="+encodeURIComponent(e)+"&isbn="+c+"&ext_id="+w.ext_id+"&auth_val="+w.ext_auth;(w.flagBL==1&&o==63||w.actBL<10&&o==63)&&(k+="&mainFL=1")}var h=await Ae(k,"GET",null)}}catch(m){R("handleQueries",m),J("Error in handleQueries ",m)}}var Yt={},Tr={};async function mf(){let e=await x.getItem("visitedDet"),t=await x.getItem("globalPushDet");e&&(Yt=JSON.parse(e)),t&&(Tr=JSON.parse(t))}mf();function Nr(e){var t=e+"vis",r=e+"push";Yt[t]||(Yt[t]=0,Yt[r]=0),Yt[t]=Math.floor(Date.now()/1e3),x.setItem("visitedDet",JSON.stringify(Yt))}async function wf(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var t="https://compare.buyhatke.com/extension/registerEnd.php",r="ext_id="+w.ext_id+"&auth_val="+w.ext_auth+"&website="+e,i=await Ae(t,"POST",r,"formData");i&&bd(i)}catch(a){R("registerEND",a),J("Error registerEND ",a)}}function Un(e){switch(e){case 2:return{pairPos:0,currPos:0};case 7:return{pairPos:31,currPos:31};case 900:return{pairPos:26,currPos:26};case 22:return{pairPos:13,currPos:13};case 1:return{pairPos:-1,currPos:-1};case 422:return{pairPos:15,currPos:15};case 425:return{pairPos:12,currPos:12};case 1e3:return{pairPos:20,currPos:20};case 333:return{pairPos:19,currPos:19};case 71:return{pairPos:9,currPos:9};case 291:return{pairPos:32,currPos:32};case 1037:return{pairPos:35,currPos:35};case 401:return{pairPos:14,currPos:14};case 921:return{pairPos:17,currPos:17};case 37:return{pairPos:21,currPos:21};case 429:return{pairPos:18,currPos:18};case 57:return{pairPos:23,currPos:23};case 1005:return{pairPos:27,currPos:27};case 67:return{pairPos:22,currPos:22};case 428:return{pairPos:28,currPos:28};case 469:return{pairPos:16,currPos:16};case 431:return{pairPos:24,currPos:24};case 902:return{pairPos:30,currPos:30};case 45:return{pairPos:29,currPos:29};case 62:return{pairPos:33,currPos:33};case 441:return{pairPos:36,currPos:36};case 901:return{pairPos:25,currPos:25};case 471:return{pairPos:34,currPos:34};case 929:return{pairPos:51,currPos:51};case 1578:return{pairPos:44,currPos:44};case 63:return{pairPos:1,currPos:3};case 111:return{pairPos:2,currPos:5};case 1556:return{pairPos:40,currPos:40};case 50:return{pairPos:3,currPos:4};case 31:return{pairPos:311,currPos:311};case 129:return{pairPos:4,currPos:1};case 421:return{pairPos:5,currPos:2};case 4:return{pairPos:6,currPos:6};case 99:return{pairPos:7,currPos:7};case 13:return{pairPos:10,currPos:10};case 98:return{pairPos:11,currPos:11};case 1331:return{pairPos:38,currPos:38};default:return{pairPos:e,currPos:e}}}const Mr=new Map,ni=6e5;async function ii(e,t){try{Mr.has(t)||Mr.set(t,new Map);const r=Mr.get(t);let i=e.filter(s=>{const o=r.get(s);return o?Date.now()-o.ts>ni?(r.delete(s),!0):!1:!0});if(i.length>0){let s=await fetch("https://ext1.buyhatke.com/extension-apis/thunder/getPidData",{headers:{"Content-Type":"application/json"},body:JSON.stringify({pos:t,pids:i}),method:"POST"});if(s=await s.json(),!s.status)return[];s=s.data,Object.entries(s).forEach(([o,l])=>{o=o.split(":")[1];try{l=JSON.parse(l)}catch{}o&&r.set(o,{data:l,ts:Date.now()})})}return e.map(s=>{const o=r.get(s);return o?{pid:s,...o.data}:null}).filter(Boolean)}catch{return[]}}function bf(){const e=Date.now();for(const[t,r]of Mr.entries()){for(const[i,a]of r.entries())e-a.ts>ni&&r.delete(i);r.size===0&&Mr.delete(t)}}setInterval(()=>{try{bf()}catch{}},ni);const _r=new Map;async function If(){if(_r.size===0)return;let e=null;try{e=await ei()}catch{}let t=Array.from(_r.values());if(e&&!isNaN(e.scoreThreshold)&&!isNaN(e.pointsThreshold)&&(t=t.filter(a=>a.totalScore>=e.scoreThreshold&&a.points>=e.pointsThreshold),e.sendPairOff&&(t=t.filter(a=>a.isCurrent==!0))),t.length===0){_r.clear();return}const i={extId:await x.getItem("ext_id"),dealScores:t,platform:0};try{const a=await fetch("https://ext1.buyhatke.com/extension-apis/dealsBurst/sendDeals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});let s;try{s=await a.json()}catch(o){console.error("Failed to parse response JSON:",o,"Response status:",a.status);return}a.ok&&s.status===1&&_r.clear()}catch{}}setInterval(If,3e5);async function gf(e,t,r,i,a){try{let s=await ii(e,t);if(!s||s.length===0)return{};s=s[0];let o=s==null?void 0:s.avg,l=s==null?void 0:s.avg1mon,c=s==null?void 0:s.avgbbd,d=s==null?void 0:s.min,f=s==null?void 0:s.min6,p=(s==null?void 0:s.pnt)||0,u=[o,l,c,d,f];(!o||o===0)&&(o=l||0),(!f||f===0)&&(f=d||0);let I,k,y,b,h;const m=30,A=25,P=20,S=15,v=10;let _=0,T=0;for(let Ee=0;Ee<u.length;Ee++)u[Ee]&&u[Ee]!=0&&(_+=u[Ee],T++);let E=0;T>=1&&(E=(_/T).toFixed(2));let g=2;for(let Ee=0;Ee<u.length;Ee++)if(u[Ee]&&u[Ee]!=0&&E!=0&&(u[Ee]>1.01*E||u[Ee]<.9*E)){g=1;break}!c||c===0?(I=0,k=36,y=29,b=21,h=14):r<=1.05*c&&r>o?(I=30,k=0,y=31,b=23,h=16):(I=m,k=A,y=P,b=S,h=v);const O=c>0?Math.max(0,(r-c)/c*100):10,$=Math.max(0,1-O/10),K=o>0?Math.max(0,(l-o)/o*100):20,z=Math.max(0,1-K/20),F=d>0?Math.max(0,(r-d)/d*100):10,L=Math.max(0,1-F/10),D=f>0?Math.max(0,(r-f)/f*100):10,V=Math.max(0,1-D/10),ae=o>0?Math.max(0,(o-r)/o*100):0,te=Math.min(1,ae/30),ne=Math.floor(I*$/g),q=Math.floor(k*z/g),re=Math.floor(y*L/g),ue=Math.floor(b*V/g),Te=Math.floor(h*te/g),se=ne+q+re+ue+Te;if(e&&e.length>0&&se>0){const Ee=e[0],Je=`${t}:${Ee}`;_r.set(Je,{pid:Ee,pos:t,totalScore:se,price:r,oos:i,points:p,isCurrent:a})}return{saleScore:ne,pumpScore:q,allTimeLowScore:re,sixMonthLowScore:ue,threeMonthAvgScore:Te,totalScore:parseFloat(se.toFixed(0))}}catch{return{}}}let Jr=new Map;function kf(e,t){try{JSON.parse(e).forEach(i=>{let a=Jr.get(t);a||(a=new Map,Jr.set(Number(t),a));const s=a.get(i.pid),o={prod:i.prod,image:i.image,price:i.price,timestamp:Date.now()};let l=!1;s?(s.timestamp=Date.now(),s.prod!==i.prod&&(s.prod=i.prod),s.image!==i.image&&(s.image=i.image),s.price!==i.price&&(s.price=i.price)):a.set(i.pid,{prod:i.prod,image:i.image,price:i.price,timestamp:Date.now()})})}catch{}}function xf(e=30){const r=Date.now()-e*60*1e3;for(const[i,a]of Jr.entries()){for(const[s,o]of a.entries())o.timestamp<r&&a.delete(s);a.size===0&&Jr.delete(i)}}function vf(e,t){t=Un(t).pairPos;const i=Jr.get(Number(t));return i&&i.get(e)||null}setInterval(async()=>{try{xf()}catch{}},10*60*1e3);async function Af(){if(Zt.length===0)return;let e;try{e=await x.getItem("ext_id")}catch{return}if(!e)return;const t=[...Zt];Zt.length=0;const r={extId:e,platform:0,redirections:t};try{const i=await fetch("https://ext1.buyhatke.com/extension-apis/general/redirectionInfo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});let a;try{a=await i.json()}catch{Zt.unshift(...t);return}i.ok&&a.status==1||Zt.unshift(...t)}catch{Zt.unshift(...t)}}function Tf(e,t){try{if(!t)return;const{landingPid:r,redirectedPid:i}=t;if(!r||!i||r===i)return;Zt.push({pos:e,landingPid:r,redirectedPid:i,ts:Date.now()})}catch{}}function _f(){const e=Date.now();for(let t=Zt.length-1;t>=0;t--)try{e-Zt[t].ts>1*60*60*1e3&&Zt.splice(t,1)}catch{}}setInterval(Af,5*60*1e3);setInterval(_f,15*60*1e3);async function Fs(e){if(!e)return null;let t=null;try{for(const r in e){const i=e[r];if(t=await new Promise(a=>{zo(i,r,s=>a(s))}),t)break}}catch{}if(!t)return null;try{const r=decodeURIComponent(t);return JSON.parse(r).preferredStore||null}catch{}}async function le(e,t){try{if(t==6660&&(e=await Ko(e),!e))return;let a;try{let s=e;try{s=JSON.parse(s)}catch{}if(Array.isArray(s)&&s.length>0){for(const l of s)try{if(!l.storeId&&l.storeIdFromCookie){const c=await Fs(l.storeIdFromCookie);c&&(l.storeId=c,delete l.storeIdFromCookie)}}catch{}const o=s.some(l=>l.qCom==1);o&&(s=s.filter(l=>l.qCom==1&&l.price&&l.storeId)),a=o?"true":"false",e=JSON.stringify(s)}}catch{}kf(e,t),w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var r="https://ext1.buyhatke.com/extTest/sendPair",i="pids="+encodeURIComponent(e)+"&pos="+t+"&ext_id="+w.ext_id+"&ext_auth="+w.ext_auth+"&qComm="+encodeURIComponent(a);await Ae(r,"POST",i,"formData")}catch(a){R("sendPairs",a),J("error in sendPairs ",a)}}async function ce(e,t,r=""){try{if(t==6660&&(e=await Ko(e,"sendCurr",r),!e))return;let s;if(typeof e=="string"?s=JSON.parse(e):typeof e=="object"&&(s=e),ut&&ut.length>0)try{for(let l=0;l<ut.length;l++){const c=ut[l],[d,f,p,u,I,k]=c.split("~");if(parseInt(d)==t&&f==s.pid){for(let y of ut){let[b,h,m,A,P,S]=y.split("~"),v=s==null?void 0:s.quantity.replace(/\s/g,"");if(b==d&&h==f&&S==v){s.storeId=p,s.spin=P;break}}s.storeId=p;break}if(d==t&&I==s.pid){s.storeId=p,s.pid=f,s.spin=I;break}}}catch{}try{if(Qt&&(s!=null&&s.pid)&&(s!=null&&s.spin)){let l=Qt[s.pid];if(l&&l.variants&&l.variants.length>0){s.variants=[];for(let c of l.variants)c!=s.spin&&s.variants.push(`${s.pid}~${c}`)}}else if(Qt&&(s!=null&&s.pid)){let l=Qt[s.pid];l&&l.variants&&l.variants.length>0&&(s.variants=[...l.variants])}}catch{}if(!s.storeId&&s.storeIdFromCookie){const l=await Fs(s.storeIdFromCookie);l&&(s.storeId=l,delete s.storeIdFromCookie)}if(s.qCom===1&&!s.storeId)return;let o=s.qCom===1;e=JSON.stringify(s),w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var i="https://ext1.buyhatke.com/extTest/sendCurrent",a="details="+encodeURIComponent(e)+"&pids="+encodeURIComponent("[]")+"&pos="+t+"&ext_id="+w.ext_id+"&ext_auth="+w.ext_auth+"&qComm="+encodeURIComponent(o);await Ae(i,"POST",a,"formData")}catch(s){R("sendCurrent",s),J("error in sendCurrent ",s)}}async function Sf(e){try{await Ae("https://search-new.bitbns.com/buyhatke/amazVariants","POST",{variants:e},"json")}catch{}}async function Mt(e){try{let t="";if(w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth"),e.length>1e3)return;e.split("~*").length>1?(e=e.split("~*"),t=e[1],e=e[0]):t=w.ext_id,await ge("AnalyticsSent",{cid:w.ext_id,uid:w.ext_id,cs:encodeURIComponent(t),tid:"UA-21447924-6",dp:e,cm:"apnese"})}catch(t){R("sendAnalyticsData",t),J("Error sendAnalyticsData",t)}}async function Kt(e,t,r,i,a,s){try{w.flagBL=await x.getItem("flagBL"),w.flagBL==1&&a==63&&(e==58||e==61);var o="https://api.buyhatke.com/monitor/",l="";t==5?l="&club_id="+a+"&success="+r+"&msg="+i:t==2?l="&club_id="+a+"&msg="+i:t==4?l="&club_id="+a+"&success="+r+"&msg="+i+"&start="+s:t==3&&(l="&club_id="+a+"&success="+r+"&msg="+i);var c="event_id="+e+"&event_type="+t+l;let d=await Ae(o,"POST",c,"formData");J("Resp sendAnalyticsData ",d)}catch(d){R("sendMonitorReqBG",d),J("Error sendMonitorReqBG",d)}}async function Ae(e,t,r,i="requestPayload"){try{let s=Date.now();if(t=="POST")var a=await fetch(e,{method:"POST",headers:{"Content-Type":i=="formData"?"application/x-www-form-urlencoded":i==="json"?"application/json":"application/text"},body:r&&typeof r!="string"&&Object.keys(r).length>0?JSON.stringify(r):r});else var a=await fetch(e);a.status>=400&&a.status<=599&&typeof a.url=="string"&&(a.url=a.url.split("?")[0]);let o=await a.text(),l=Date.now()-s;return parseFloat(l/1e3)>2&&await fh({eventID:15,responseTime:l,url:e}),o}catch(s){return typeof e=="string"&&(e=e.split("?")[0]),J("error makePostFetch ",{url:e,parameters:r,error:s}),""}}async function Ft(){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let e="ext_id="+w.ext_id+"&auth_val="+w.ext_auth,t=await Ae("https://api.buyhatke.com/paapi/showAlerts","POST",e,"formData");return t&&(Ye=JSON.parse(t),Rn(Ye)),Ye}catch(e){return R("checkStatus2",e),J("error checkStatus2 ",e),""}}function us(e,t){var r=e.length;if(r)for(;r--;){var i=e[r];i.tabID==t&&e.splice(r,1)}}async function Pf(e){try{w.saleStarted=await x.getItem("saleStarted"),w.specialTab=await x.getItem("specialTab"),w.saleStarted==1&&e==w.specialTab&&(await x.setItem("specialTab",""),await Ls())}catch(t){R("checkSpeciaTab",t),J("Error checkSpecialTab ",t)}}async function Of(){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var e=await x.getItem("bankBox1"),t=await x.getItem("bankBox2"),r=await x.getItem("bankBox3"),i=await x.getItem("bankBox4");if(e!=""||t!=""||r!=""||i!="")var a="https://api.buyhatke.com/extension/saveBankExt.php",s="ext_id="+w.ext_id+"&auth_val="+w.ext_auth,o=await Ae(a,"POST",s,"formData")}catch(l){R("saveBankUsers",l),J("Error saveBankUsers ",l)}}Of();async function Ls(){try{if(w.timeRemaining=await x.getItem("timeRemaining"),w.flashSale=await x.getItem("flashSale"),w.saleStarted=await x.getItem("saleStarted"),w.timeRemaining<12e4&&w.timeRemaining>-12e4)var e=2e3;else var e=4e4;setTimeout(Ls,e);var t=new Array,r=w.flashSale?JSON.parse(w.flashSale):[];if(r.length){for(let i=0;i<r.length;i++)r[i].value==1&&(newURL=r[i].url);w.saleStarted==1&&chrome.tabs.query({},async function(i){for(var a=0,s=0;s<i.length;s++){var o=i[s].url,l=newURL;a==0&&o.split(l).length>1&&(a=1,await x.setItem("specialTab",i[s].id))}a==0&&(await x.setItem("specialTab",""),Ls())})}}catch(i){R("getSpecia",i),J("Error getSpecial ",i)}}Ls();Gi=Gi.join("");async function Na(e,t){try{let r={method:e.method};if(e.headers&&e.headers!==""&&e.headers!=="{}"&&(r.headers=e.headers),e.method==="POST"){if(e.reqType===2)r.body=JSON.stringify(e.postFields);else if(e.reqType===1)try{r={...r,...JSON.parse(e.postFields)}}catch{r={...r,...e.postFields}}}const i=await fetch(t,r);if(e.reqType&&e.reqType==11||e.reqType&&e.reqType==11)return i.url;if(i.status>=400&&i.status<=599)throw new Error(`HTTP error! status: ${i.status}`);return await i.text()}catch{return""}}function Df(e){return e.trim().replace(/\s+/g,"+").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/,/g,"%2C")}function ds(e,t,r){return new Promise(function(i,a){if(e.compareShoppingFlag){let c=t.placeholders[0];c=Df(c),t.placeholders[0]=c}let s=JSON.stringify(e);for(var o=0;o<=r.length;o++){var l="PLACEHOLDER"+o;s=s.replace(l,r[o])}i(JSON.parse(s))})}async function Lf(e){return new Promise(async function(t,r){var d;if(typeof e.dontFetch<"u"&&e.dontFetch==!0){if(typeof e.isJSON<"u"&&e.isJSON==!0||parseInt(e.isJSON)==1)var i=!0;else var i=!1;let f={job_id:e.job_id,method:e.method||"GET",base_url:e.url,postFields:e.postFields||"",headers:e.headers||"",reqType:e.reqType||0,isJSON:i,countPH:((d=e.placeholders)==null?void 0:d.length)||0,secondRequestFlag:!!(e!=null&&e.secondRequestFlag),url2:e.url2||"",placeholders2:e.placeholders2||"",responseIndex:e.responseIndex||0,compareShoppingFlag:e.compareShoppingFlag||0},p=e.placeholders||[],u=e.placeholders2||[];ds(f,e,p).then(I=>{if(f.responseIndex>0)return ds(I,I,u).then(k=>{t(k)});t(I)}).catch(function(I){R("changePlaceHolder",I)})}else{if(typeof e.jobIDOrig<"u"&&e.jobIDOrig.trim()!="")var a=e.jobIDOrig;else var a=e.job_id;var s="dcc"+a,o=await x.getItem(s);if(Zf(),o==""||o==null||o=="{}"||Object.keys(o).length==0){var l="http://s3-ap-southeast-1.amazonaws.com/jobdet/"+a+".txt";let f=await Ae(l,"GET",null);f&&(f=JSON.parse(f),await x.setItem(s,JSON.stringify(f)),ds(f,e).then(function(p){t(p)}).catch(function(p){R("changePlaceHolder",p)}))}else{var c=await x.getItem(s);c=JSON.parse(c),ds(c,e).then(function(f){t(f)}).catch(function(f){R("changePlaceHolder",f)})}}})}async function Ef(e){try{Lt||(Lt=await _a());let t=e.split('role="list"');if(t.length<2)return"";let a=t[1].split('jsname="QdNh2e"')[0];const s=new RegExp(ml.join("|"),"i"),o=a.match(s);if(!o)return"";const c=a.slice(0,o.index).match(/search[^\s"]+/g),d=c?c[c.length-1]:null;return d?`${Lt}/${d}`.replaceAll(";","&"):""}catch{return""}}async function jl(e){try{Lt||(Lt=await _a());const t=e.split('role="list"');if(t.length<2)return"";const a=t[1].split('jsname="QdNh2e"')[0],s=new RegExp(wl.join("|"),"i"),o=a.match(s);if(!o)return"";const c=a.slice(0,o.index).match(/search[^\s"]+/g),d=c?c[c.length-1]:null;return d?`${Lt}/${d}`.replaceAll(";","&"):""}catch{return""}}async function gr(e,t,r){try{const i=new URLSearchParams(t).toString(),a=`${e}${i}`;let s=await fetch(a,{method:"GET",redirect:"follow"});s=await s.text();let l=s.split(")]}'")[1];if(l=JSON.parse(l),l=l.ProductDetailsResult,r)return l;let c=l[34][0][0],d=l[81];d=d[0][0];for(let f=0;f<d.length;f++)c&&(d[f][22][2]=c);return d}catch{}}const Jt=(e,t,r=0,i="")=>{if(!e||typeof e!="string")return i;try{const a=e.split(t);return a&&a.length>r?a[r].trim():i}catch{return i}};async function Nf(e,t){try{let r=e.split('jsname="uVFeEd"');if(r.length>0)for(let i=0;i<r.length;i++)r[i].includes("& more")&&(t[i]=!0)}catch{}}async function Mf(e,t){var r;try{let i=new Set,a={};await Nf(e,a);let s=e.match(/value="([^"]+)"\s+name="ei"/),o=s?s[1]:"",l=Jt(e,'</li></div><div class="Ez5pwe"',0,"");l=Jt(l,'class="I8iMf"',1,"");let c=Jt(Jt(e,";opi=",1,""),'">'),d=Jt(Jt(e,"sca_esv=",1,""),"&"),f=Jt(Jt(e,'data-pvo="',1,""),'"'),p=Jt(Jt(e,"udm=",1,""),"&"),u=Jt(Jt(e,"data-csiid=",1,""),'"'),I=0,k={},y=[];for(let L in a)y.push(parseInt(L));let b=e.split("(function(){var m=")[1];b=b.split(";var a=m")[0],b=JSON.parse(b);let h=Object.keys(b).length;const m="EgsItqvzARDGqeXhAw",A=!0,P=0,S=((r=t==null?void 0:t.placeholders)==null?void 0:r[0])||"",v=S,_="jspb";let T=0;const E=10;Lt||(Lt=await _a());const g=`${Lt}/async/oapv?`,O={},$=[];for(const L in b)try{let D=b[L];if(!Array.isArray(D))continue;if(D.length>10&&typeof D[9]=="string"&&D[9].includes("PC_")){let V=D[1],ae=D[5],te=D[3],ne=D[9];V&&ae&&te&&ne&&$.push(L)}}catch{continue}const K=[],z=$.slice(0,3);K.push(...z);const F=$.slice(3);if(F.length>0){const L=F.sort(()=>Math.random()-.5),D=L.slice(0,Math.min(E-z.length,L.length));K.push(...D)}for(const L of K)try{let D=k[L],V=b[L],ae=V[1],te=V[5],ne=V[3],q=V[9],re=V[0],ue=V[6],Te=3,se=!0,Ee=1;O[L]={},T=0;let Je=[`catalogid:${ae}`,`gpcid:${te}`,`headlineOfferDocid:${ne}`,`rds:${q}`];re&&Je.push(`imageDocid:${re}`),Je.push(`pvo:${Te}`,`isp:${se}`,`localAnnotatedOfferId:${Ee}`,`sori:${T}`,`mno:${E}`,`query:${v}`,`gl:${P}`,`mid:${ue}`,"pvt:hg",`_fmt:${_}`,`pvf:${m}`);let Se=Je.join(","),We={ei:o,hl:"en",opi:c,sca_esv:d,udm:p,yv:"3",q:S,async_context:"MORE_STORES",cs:"1",async:Se};const st=await gr(g,We,!0);if(!st||st.length===0)break;let ve=st[71];if(ve&&Array.isArray(ve))for(const j of ve)Array.isArray(j)&&j[0]&&i.add(j[0]);const Ke=(j,N,X,ie)=>{if(j)for(const H of j){if(H[0].toLowerCase().includes(X.toLowerCase()))continue;let me=H[2],pe=H[0],Pe=H[4];!["color","skip"].includes(ie)&&!me||Pe&&pe&&(N[pe]=Pe)}};if(ve=="null"||ve==null||ve===void 0||!Array.isArray(ve)){O[L].nv||(O[L].nv={});for(let j=0;j<=2;j++)try{let N=[`catalogid:${ae}`,`gpcid:${te}`,`headlineOfferDocid:${ne}`,`rds:${q}`];re&&N.push(`imageDocid:${re}`),N.push(`pvo:${Te}`,`isp:${se}`,`localAnnotatedOfferId:${Ee}`,`sori:${T}`,`mno:${E}`,`query:${v}`,`gl:${P}`,`mid:${ue}`,"pvt:hg",`_fmt:${_}`),Se=N.join(","),T===0&&(Se=Se.replace(",sori:0,mno:10","")),We.async=Se;const X=await gr(g,We,!1);if(!X||X.length===0)break;O[L].nv[j]=X,j==0&&(T+=3),j==1&&(T+=10)}catch{}}else if(ve&&ve.length==1)try{let j=ve[0][1],N={};Ke(j,N,"Any","skip");for(const X in N){T=0;let ie=N[X];O[L].ov||(O[L].ov={}),O[L].ov[X]||(O[L].ov[X]={});let H={...We},me=H.async;me=me.replace("pvf:EgsItqvzARDGqeXhAw",`pvf:${ie}`),me=me+",isVariantOrFilterChange:true",H.async_context="VARIANT_OR_FILTER_CHANGE",H.async=me;for(let pe=0;pe<=2;pe++)try{me=me.replace(",pvt:hg",",pvt:a"),T===0&&(me=me.replace(",sori:0,mno:10","")),!me.includes("sori")&&T>0&&(me=me+`,sori:${T},mno:${E}`),me=me.replace(/sori:\d+/,`sori:${T}`).replace(/mno:\d+/,`mno:${E}`),H.async=me;const Pe=await gr(g,H,!1);if(!Pe||Pe.length===0)break;O[L].ov[X][pe]=Pe,pe===0&&(T+=3),pe===1&&(T+=10)}catch{}}}catch{}else if(ve&&ve.length>1){let j=["Carrier","RAM"],N=[],X={};const ie=ve.find(H=>Array.isArray(H)&&(H[0].toLowerCase()==="colour"||H[0].toLowerCase()==="color"));if(ie&&ie.length>1)N=ie[1];else{const H=ve.find(me=>Array.isArray(me)&&!j.some(pe=>me[0].toLowerCase().includes(pe.toLowerCase())));H&&(N=H[1])}Ke(N,X,"Any","color");for(const H in X){T=0;let me={},pe=[];O[L].tv||(O[L].tv={}),O[L].tv[H]||(O[L].tv[H]={});let Pe=X[H],qe={...We},B=qe.async;B=B.replace(/pvf:[a-zA-Z0-9]+/,`pvf:${Pe}`),B=B+",isVariantOrFilterChange:true",qe.async_context="VARIANT_OR_FILTER_CHANGE",qe.async=B;const Q=await gr(g,qe,!0);let G=Q&&Q[71];if(G){const C=G.find(fe=>{if(!Array.isArray(fe))return!1;const we=fe[0].toLowerCase();return!j.some(Pt=>we.includes(Pt.toLowerCase()))&&!(we==="colour"||we==="color")});C?pe=C[1]:pe=[]}Ke(pe,me,"Any","");for(const C in me){T=0;let fe=me[C];O[L].tv[H][C]||(O[L].tv[H][C]={});let we={...We},Re=we.async;Re=Re.replace(/pvf:[a-zA-Z0-9]+/,`pvf:${fe}`),Re=Re+",isVariantOrFilterChange:true",we.async_context="VARIANT_OR_FILTER_CHANGE";for(let Ge=0;Ge<=2;Ge++)try{Re=Re.replace(",pvt:hg",",pvt:a"),T===0&&(Re=Re.replace(",sori:0,mno:10","")),!Re.includes("sori")&&T>0&&(Re=Re+`,sori:${T},mno:${E}`),Re=Re.replace(/sori:\d+/,`sori:${T}`).replace(/mno:\d+/,`mno:${E}`),we.async=Re;const Pt=await gr(g,we,!1);if(!Pt||Pt.length===0)break;O[L].tv[H][C][Ge]=Pt,Ge===0&&(T+=3),Ge===1&&(T+=10)}catch{}}}}}catch{}return{resp:JSON.stringify(O)||"",filters:Array.from(i)}}catch(i){throw i}}async function bo(e,t=0){try{let r=e.split('class="iXEZD" data-sh-gr="line"');if(r.length<=t+1)return"";let a=r[t+1].split(">Compare prices from");if(a.length<1)return"";let o=a[0].split('href="')[1];if(!o)return"";o=Lt+o;let l=o.replaceAll(";","&");if(!l)return"";let c=await fetch(l,{method:"GET",redirect:"follow"});return c=await c.text(),c}catch{return""}}let $n=0,on=0;var Jn="";let Io=1,go=0;async function Fr(e=!1){try{Object.keys(Is).length==0&&await Cn(),on=await x.getItem("userCountry"),Is.hasOwnProperty(on)&&($n=Is[on]);let o=await x.getItem("ext_id"),l=await x.getItem("ext_auth"),c=await x.getItem("version"),d="isReadyExt";e&&(d="isReadyAlert");let f="https://utility.buyhatke.com/spidy/"+d+"?rand="+parseInt(Math.random()*999999999999999)+"&ext_id="+o+"&ext_auth="+l+"&version="+c,u=await fetch(f,{method:"GET",headers:{"Content-Type":"application/json","client-id":"2378",uid:"1"}});if(u.status>=400&&u.status<=599)throw new Error("status: "+u.status);if(u=await u.json(),u&&u.success&&!e){var t=u.user_id,r=u.callResp,i=u.callDist,a=u.schedule_id,s=u.ipAvail;s&&a!=0&&i!=""&&r!=""&&(Wf(i,r,t,a,$n),Io==1&&(Io=0,await Kl(),await zl()),go++,go%20===0&&await rh(),await Br(),await Br(!0))}else u&&u.success&&e&&(Jn=u.callResp)}catch(o){J("Error in cmm ",o)}}async function Rf(e,t){var l,c;const r=crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2,15),i=(t==null?void 0:t.data)||{};let a=((l=i==null?void 0:i.gtm_details)==null?void 0:l.alternate_id)||"",s=((c=i==null?void 0:i.gtm_details)==null?void 0:c.category)||"",o=(i==null?void 0:i.tenant_ids)||[];return s&&typeof s=="string"&&s.includes("/")&&(s=s.split("/")[0].toUpperCase()),{...e,method:"POST",postFields:{identifier:r,to_pincode:"400020",customer_details:{},articles:[{article_id:a,vertical:s,lookup_inventory:!0,tenant_ids:o,merchant_id:null,package_dimension:{}}]},headers:{"x-application-token":"qO2p_wQkq","x-oms-application-id":"5ea6821b3425bb07c82a25c1"},reqType:2}}async function jf(e){try{let t=await fetch(e);if(t=await t.text(),t=t.split(")]}'"),t.length>0){let r=t[1];r=JSON.parse(r),r=r[0];for(let i=0;i<r.length;i++){let a=r[i];if(a.length>3&&(a=a[3],a.du)){let s=a.du;s=Lt+s,await fetch(s)}}}}catch{}}function Ma(e,t){var i;let r=(i=new RegExp(`"${e}":([^,}\\]]+)`).exec(t))==null?void 0:i[1];return r&&r.startsWith('"')&&r.endsWith('"')?r.slice(1,-1):r}async function oi(){try{let e=await(await fetch(Gr)).text(),t=Ma("SNlM0e",e),r=Ma("cfb2h",e),i=Ma("oPEP7c",e),a=await(await fetch(Os)).text(),s=Ma("Cu8aXb",a);return s===!0||s==="true"?await chrome.storage.local.set({histProtected:!0}):await chrome.storage.local.set({histProtected:!1}),i&&!i.includes("@gmail.com")||s===!0||s==="true"?(await chrome.storage.local.set({chEn:!0}),!1):{atValue:t,blValue:r}}catch{}}async function Uf(){return{accept:"text/event-stream","accept-language":"en-GB,en-US;q=0.9,en;q=0.8","content-type":"application/json","user-agent":navigator.userAgent}}async function $f(e){let t=await(await fetch(e)).text(),r=Ma("SNlM0e",t),i=Ma("cfb2h",t);if(Ma("oPEP7c",t),!r||!i)throw"BARD_EMPTY_RESPONSE";return{atValue:r,blValue:i}}function ko(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():""}function Ul(e,t={},r=!0){let i=Object.keys(t);if(i.length===0)return e;let a=e;/:[a-zA-Z]/.test(e)&&e.split("/").forEach(s=>{if(s.startsWith(":")){let o=s.slice(1);a=a.replace(s,t[o]),delete t[o]}}),a+="?";for(let s of i){let o=t[s];o&&(o=r?encodeURIComponent(o):o,a+=`${s}=${o}&`)}return a.slice(0,-1)}function $l(){return Math.floor(Math.random()*9e5)+1e5}function Jf(e){let t=JSON.parse(e.split(`
`)[3]),r=JSON.parse(t[0][2]);if(!r)throw"BARD_EMPTY_RESPONSE";let i=r[4][0][1][0],a=r[4][0][4]||[];for(let s of a){let[o,l,c]=s;i=i.replace(c,`[![${o[4]}](${o[0][0]})](${l[0][0]})`)}return{text:i,ids:[...r[1],r[4][0][0]]}}async function Jl(e){try{let t=e;t.requestParams||(t.requestParams=await oi());let{requestParams:r,contextIds:i}=t,a="GzXR5e",s=Ul(lr,{rpcids:a,"source-path":"/",bl:r.blValue,_reqid:$l().toString(),rt:"c"}),o=[i[0]],l=[[[a,JSON.stringify(o),null,"generic"]]],c=await fetch(s,{method:"POST",body:new URLSearchParams({at:r.atValue,"f.req":JSON.stringify(l)})})}catch{}}setInterval(async()=>{try{const{chCO:e}=await chrome.storage.local.get("chCO");if(Array.isArray(e)&&e.length>0){for(let t of e)await Jl(t);await chrome.storage.local.remove("chCO")}}catch{}},30*1e3);function Ff(e,t){return[[[e,`[[null,null,null,null,null,null,null,["bard"]],["${t}"]]`,null,"generic"]]]}let wa=2,vs=2;async function Br(e=!1){var t,r;try{let i;if(e?i=!Sn||!_n||!gs:i=!Gr||!lr||!Cr||!Os||!gs||!Pn,i&&await _a(),e&&wa<=0){wa=0;return}if(!e&&vs<=0){vs=0;return}const a=e?_n:Os,s=e?Sn:lr,o=e?'class="ds:3"':'class="ds:4"';let l=await fetch(a);l=await l.text();let c=l;l=l.split(o)[1].split(");<\/script>")[0],l=l.split("AF_initDataCallback(")[1],l=l.split("data:[[[")[1],l="[[["+l.split(", sideChannel:")[0],l=JSON.parse(l),l=l[0];let f="TmdDAd";for(const p of l)try{let u=(t=p[9][0])==null?void 0:t.toLowerCase(),I=p[7][0];if(!(gs.some(_=>u.includes(_==null?void 0:_.toLowerCase()))||((r=I==null?void 0:I.toLowerCase())==null?void 0:r.includes("shopping"))))continue;let y=p[5],b={};b.requestParams=await $f(a);let{requestParams:h,contextIds:m}=b;y=Ff(f,y);let S="f.req%3D%5B%5B%5B%22TmdDAd%22%2C%22%5B%5Bnull%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%2C%5B%22bard%22%5D%5D%2C%5B%22%3CplaceHolder%3E%22%5D%5D%22%2Cnull%2C%22generic%22%5D%5D%5D%26at%placeHolder2%3A1752069513611%26".replace("%3CplaceHolder%3E",encodeURIComponent(y)).replace("placeHolder2",encodeURIComponent(h.atValue));const v=`f.req=${encodeURIComponent(JSON.stringify(y))}&at=${encodeURIComponent(h.atValue)}&`;await fetch(`${Pn}?rpcids=TmdDAd&source-path=%2Fproduct%2Fgemini&f.sid=-1498784379978768824&bl=boq_footprintsmyactivityuiserver_20250706.11_p0&hl=en&soc-app=712&soc-platform=1&soc-device=1&_reqid=269324&rt=c`,{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9,hi;q=0.8","content-type":"application/x-www-form-urlencoded;charset=UTF-8","x-same-domain":"1"},body:v,method:"POST",mode:"cors",credentials:"include"})}catch{}e?wa-=1:(await chrome.storage.local.set({cpHC:0}),vs-=1)}catch{}}function Fn(e){return e.replace(/(\d+\.)/g,`
$1`)}function Bn(e){return e.replace(/\*\*(.*?)\*\*/g,"**$1**")}async function Es(e){try{vs+=1;let t=null;t||(t=ko());let r={};r.requestParams=await oi(),r.requestParams&&await chrome.storage.local.set({chEn:!1});let i=(await chrome.storage.local.get("chEn")).chEn;if((await chrome.storage.local.get("chEn")).chEn)return;let a,{requestParams:s}=r,o=null;o||(o={contextIds:[],previousResponses:[]}),o.contextIds.length===0&&(o.contextIds=[ko()]);let l=JSON.stringify(o.contextIds),d=`Our previous conversation:
---
${o.previousResponses.map((S,v)=>`[user]: ${S.prompt}
[bard]: ${S.response}`).join(`
`)}
---
[user]: ${e}`,f=Ul(Cr,{bl:s.blValue,__reqid:$l().toString(),rt:"c"}),p=[null,JSON.stringify([[d,0,l,a?[[[a,1],n.image.name]]:[]],null,["","",""]])],{cpHC:u=0}=await chrome.storage.local.get("cpHC");await chrome.storage.local.set({cpHC:u+1}),await chrome.storage.local.set({chFs:Date.now(),chRC:!1});const I={"f.req":JSON.stringify(p)};s.atValue&&(I.at=s.atValue);let k=await(await fetch(f,{method:"POST",body:new URLSearchParams(I)})).text(),{text:y,ids:b}=Jf(k);r.contextIds=b;let h=(await chrome.storage.local.get("chCO")).chCO||[];h.push(r),await chrome.storage.local.set({chCO:h}),o.contextIds=b,o.previousResponses.push({userPrompt:e,response:y});const m=JSON.parse(k.split(`
`)[3]),P=JSON.parse(m[0][2])[4][0][4]||[];for(let S of P){let[v,_,T]=S;const E=v[0][0],g=_[0][0],O=T;y=y.replace(O,`<img src="${E}" alt="${O}" /><a href="${g}">Source</a>`)}return setTimeout(async()=>{await Jl(r);let{cpHC:S=1}=await chrome.storage.local.get("cpHC");S=Math.max(0,S-1),await chrome.storage.local.set({cpHC:S}),S===0&&await chrome.storage.local.set({chRC:!0})},1e3),y=Fn(y),y=Bn(y),await chrome.storage.local.set({chEn:!1}),y}catch{return{loginError:!0}}}async function Bf(e){try{On||await _a();let t=Array.isArray(e)?e[0]:e;typeof t!="string"&&(t=String(t));let r=await Uf();const i=await fetch(On,{method:"POST",headers:r,body:JSON.stringify({params:{language:"en-US",timezone:"Asia/Calcutta",search_focus:"internet",sources:["web"],mode:fl,model_preference:hl,prompt_source:"user",query_source:"home",is_incognito:!0,dsl_query:t,skip_search_enabled:!0,version:pl},query_str:t})});if(!i.ok)throw new Error(`error: ${i.status}`);return await Hf(i)}catch(t){throw t}}async function Hf(e){let t;try{const r=e.body.getReader(),i=new TextDecoder("utf-8");let a="",s=!1,o=null,l=[],c=!1,d=!1;const f=y=>typeof y=="string"?y:y&&typeof y.text=="string"?y.text:"",p=y=>{if(!(!y||!y.op)&&(y.op==="add"||y.op==="replace")&&typeof y.path=="string"){if(y.path==="/answer"&&typeof y.value=="string")o=y.value;else if(y.path.startsWith("/chunks/")){const b=Number(y.path.slice(8));Number.isNaN(b)||(l[b]=f(y.value))}}},u=y=>{const b=y.replace(/\r\n/g,`
`).split(`
`).filter(m=>m&&m[0]!==":"&&m.startsWith("data:")).map(m=>m.slice(5).trimStart()).join(`
`);if(!b)return;if(b==="[DONE]"){d=!0;return}let h;try{h=JSON.parse(b)}catch{return}if(Array.isArray(h.blocks))for(const m of h.blocks){const A=m.markdown_block;if(A){if(Array.isArray(A.chunks)){const S=Number(A.chunk_starting_offset);Number.isFinite(S)?A.chunks.forEach((v,_)=>{l[S+_]=f(v)}):A.progress==="DONE"?l=A.chunks.map(f):A.chunks.forEach(v=>l.push(f(v)))}typeof A.answer=="string"&&(o=A.answer),A.progress==="DONE"&&(c=!0)}const P=m.diff_block;if(P&&Array.isArray(P.patches))for(const S of P.patches)p(S)}typeof h.output_text=="string"&&!o&&l.push(h.output_text),(h.final_sse_message===!0||h.final===!0)&&(d=!0)},I=()=>{clearTimeout(t),t=setTimeout(async()=>{try{await r.cancel()}catch{}throw new Error("Stream timeout")},4e4)};for(I();!s;){const{value:y,done:b}=await r.read();if(s=b,y){I(),a+=i.decode(y,{stream:!0}).replace(/\r\n/g,`
`);let h;for(;(h=a.indexOf(`

`))!==-1;){const m=a.slice(0,h);a=a.slice(h+2),u(m)}if((c||d)&&(o||l.some(m=>m!=null)))break}}if(a+=i.decode(),a){a=a.replace(/\r\n/g,`
`);let y,b=!1;for(;(y=a.indexOf(`

`))!==-1;){const h=a.slice(0,y);a=a.slice(y+2),b=!0,u(h)}!b&&a.trim()&&u(a)}let k=c&&o?o:l.filter(Boolean).join("")||o||"";return k=k.replace(/\[\d+\]/g,""),typeof Fn=="function"&&(k=Fn(k)),typeof Bn=="function"&&(k=Bn(k)),clearTimeout(t),k}catch{return t&&clearTimeout(t),""}}function Vf(e){try{let t=e.replace(/\\x([0-9A-Fa-f]{2})/g,(r,i)=>String.fromCharCode(parseInt(i,16)));return decodeURIComponent(t.replace(/\+/g," "))}catch{return e}}setInterval(async()=>{try{const{chFs:e,chRC:t}=await chrome.storage.local.get(["chFs","chRC"]);!t&&e&&Date.now()-e>30*1e3&&(await Br(),await chrome.storage.local.set({chRC:!0}))}catch(e){console.warn("Interval hide check failed:",e)}},20*1e3);async function Wf(e,t,r,i,a){var o;try{let l="";if(a?l=await Ae(e+"/spidyDistGlob","POST","user_id="+r+"&schedule_id="+i+"&country="+a,"formData"):l=await Ae(e+"/spidyDist","POST","user_id="+r+"&schedule_id="+i,"formData"),l){try{l=JSON.parse(l)}catch{return}if(!l.success)return;var s=l.data;let c=JSON.parse(JSON.stringify(s));const d=await Lf(s);let f=await Na(d,d.base_url),p=f;if((d.job_id=="CBKLT_272"||d.job_id=="PD17E_340")&&f.includes("No image at the URL.")){wa+=1;try{if(d.job_id=="PD17E_340"){await oi();let{histProtected:m}=await chrome.storage.local.get({histProtected:!1});if(m)return}let b=d.base_url.split("url=")[1];b=b.split("?")[0];let h=`https://search-new.bitbns.com/buyhatke/proxyImg?url=${b}`;d.base_url=d.base_url.replace(/(url=)[^&]+/,`$1${encodeURIComponent(h)}`),f=await Na(d,d.base_url)}catch{}}let u="";if(d.compareShoppingFlag){wa+=1;let b=(o=p==null?void 0:p.toLowerCase())==null?void 0:o.includes("compare prices"),h;if(b)try{let S=10,v=f,_=v.split('class="iXEZD" data-sh-gr="line"'),T;f="";for(let E=0;E<3;E++)E<_.length-1&&(T=await bo(v,E),E===0?f+=T+`****CompareUiFlag=${b}#####`:f+=T+"****nextResponse***");for(let E=3;E<S;E++)if(_.length>1){let g=Math.floor(Math.random()*(_.length-1))+3;g<_.length&&(T=await bo(v,g),f+=T+"****nextResponse***")}}catch{}else{h=await Mf(f,c);let{resp:S,filters:v}=h;f=S+`****CompareUiFlag=${b}*******filters=>${JSON.stringify(v)}***`}let m="";const A=/<input\s+value="([^"]+)"\s+name="ei"/i,P=p.match(A);if(P&&P[1]&&(m=P[1]),m){let S=Lt+`/complete/search?q&cp=0&client=products-cc&xssi=t&gs_pcrt=2&ds=sh&hl=en-IN&authuser=0&pq=redmi&psi=${m}&dpr=2`;await jf(S)}}else if(d!=null&&d.secondRequestFlag){wa+=1;let b=await jl(f),h=await Ef(f);b&&(u=await As(b)),h&&(f=await As(h))}else if(d!=null&&d.responseIndex&&d.responseIndex>0&&d.job_id=="O1WGQ_144")try{let b=JSON.parse(f),h=await Rf(d,b),m=await Na(h,h.url2);f=f+"***Second-Response***"+m}catch{}else if(d!=null&&d.responseIndex&&d.responseIndex>0){let b=await Na(d,d.url2);d.responseIndex==2?f=b:d.responseIndex==3&&(f+="***Second-Response***"+b)}else if((d==null?void 0:d.job_id)=="PD17E_340"){wa+=1;let P=f.split("(function(){var p={astyp:'folsrch'")[1].split(",wfpe:false,wfve:false}")[0].split("url:")[1].split("'")[1].split("'")[0];P=Vf(P);let S=Lt+P;f=await As(S)}let I=(d==null?void 0:d.responseIndex)||0;I==0?f+=`spidy-scrapping-url=>${d.base_url}`:I>0&&(f+=`spidy-scrapping-url=>${d.url2}`);for(let b=0;b<s.placeholders.length;b++)f+="**UrlParam"+b+"**"+s.placeholders[b];u&&(f+=`**exact-html=>${u}`);let k="job_id="+s.job_id+"&entry_id="+s.entry_id+"&batch="+s.batch+"&response="+encodeURIComponent(f)+"&user_id="+r+"&schedule_id="+i;typeof d.isJSON<"u"&&d.isJSON==!0?k+="&isJSON=true":k+="&isJSON=false",k+="&hash="+s.hash,(d.compareShoppingFlag||s.job_id=="CBKLT_272"||s.job_id=="FD8EQ_330"||s.job_id=="MIIXY_329"||s.job_id=="IFUDF_327"||s.job_id=="RV9TN_328"||s.job_id=="VW3HB_326")&&(wa+=1,t="https://ext1.buyhatke.com");const y=t+"/spidy/response";await Ae(y,"POST",k,"formData")}else J("data ",l," type ",l.success)}catch(l){R("distributor",l),J("Error in distributor ",l)}finally{await Br(),await Br(!0)}}let Fl=5*4e4;$n&&(Fl=2*5e4);Fr();setInterval(async function(){await Fr()},Fl);setInterval(async function(){try{await Nl()}catch(e){R("Error in interval function",e)}},2*60*60*1e3);setTimeout(async function(){try{await Nl()}catch(e){R("Error in interval function",e)}},60*1e3);async function Bl(){try{if(w.timeRemaining=await x.getItem("timeRemaining"),w.timeRemaining<6e4&&w.timeRemaining>-12e4)var e=5e3;else var e=3e4;setTimeout(Bl,e),w.mostSensitive=await x.getItem("mostSensitive"),w.specialTab=await x.getItem("specialTab"),w.mostSensitive==1&&w.specialTab!=""&&chrome.tabs.update(parseInt(w.specialTab),{selected:!0})}catch(t){R("checkMonitorSensitive",t),J("Error in checkMonitoeSensitive ",t)}}Bl();async function Kf(e){try{w.blockList=await x.getItem("blockList");var t=w.blockList;if(t.trim()!="")t=JSON.parse(t),t.push(e),await x.setItem("blockList",JSON.stringify(t));else{var r=[];r.push(e),await x.setItem("blockList",JSON.stringify(r))}}catch(i){R("addToBlockList",i),J("Error addToBlockList ",i)}}async function zf(e){try{w.blockList=await x.getItem("blockList");var t=w.blockList;if(t.trim()!=""){t=JSON.parse(t);for(var r=[],i=0;i<t.length;i++)t[i]==e||r.push(t[i])}await x.setItem("blockList",JSON.stringify(r))}catch(a){R("removeFromBlockList",a),J("Error removeFromBlockList ",a)}}async function Zf(){try{let o=await x.getAllItems();var e=0,t,r;for(r in o)o.hasOwnProperty(r)&&(t=o[r]?(o[r].length+r.length)*2:0,e+=t);var i=(e/1024).toFixed(2);if(parseFloat(i)>4500)for(var a=Object.keys(o),s=0;s<a.length;s++)a[s].startsWith("dcc")&&(delete o[a[s]],J("Deleting ",a[s]),await x.removeItem(a[s]))}catch(o){R("deleteLocalS",o),J("Error in deleteLocalS ",o)}}async function Xf(e,t,r){try{let i=await St(e,t,r);return await(i==null?void 0:i.text())}catch{}}let Hn={};function Yf(e){const t={imageUrl:"image",pid:"PID",prodUrl:"link",pos:"position",site_logo:"site_image"};return e.map(r=>{const i={};for(let[a,s]of Object.entries(r)){const o=t[a]||a;i[o]=s}return i})}setInterval(function(){Hn={}},15*60*1e3);const xo=new Set(["fetchBlinkitSearch","fetchFlipkartMinutes","fetchBigBasketSearch","fetchInstamartSearch","fetchAmazonSearch","fetchJioMartSearch","fetchZeptoSearch","fetchDMartSearch","fetchPrice","findSimilar","findSimilarBulk"]);let et={totalRequests:1,responsesReceived:1,currentRequestId:null};const li=3e5,ln=15e4,Rr=new WeakMap;function Vn(e,t=li){if(!e)return;const r=Rr.get(e);r&&clearTimeout(r);const i=setTimeout(()=>{try{e.disconnect()}catch{}Rr.delete(e)},t);Rr.set(e,i)}function vo(e){const t=Rr.get(e);t&&(clearTimeout(t),Rr.delete(e))}function Hl(e,t=li){Vn(e,t);const r=()=>vo(e),i=(a=t)=>Vn(e,a);return e.onDisconnect.addListener(()=>vo(e)),{beginWork:r,finishWork:i}}async function Qf(){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth"),J("ext_id",w.ext_id),J("ext_auth",w.ext_auth),chrome.runtime.onConnect.addListener(async function(e){var i;J("Starting for port ",e.name);const t=Hl(e),r=(a,s=li)=>{e.onMessage.addListener(async(...o)=>{t.beginWork();try{await a(...o)}finally{t.finishWork(s)}})};if(e.name=="searchPayloadDataNew"+e.sender.tab.id)r(async function(a){if(J("here14",a),a.messageData!=""){w.flagBL=await x.getItem("flagBL"),w.actBL=await x.getItem("actBL");var s=JSON.parse(a.messageData),o="query="+encodeURIComponent(s.query)+"&price="+s.price+"&ext_id="+w.ext_id+"&pos="+s.pos+"&ext_auth="+w.ext_auth+"&original="+s.original+"&PID="+s.PID;(w.flagBL==1&&s.pos==63||w.actBL<10&&s.pos==63)&&(o+="&mainFL=1");var l=parseInt(s.category),c="",d="";switch(l){case 0:c="https://compare.buyhatke.com/mobFrontEnd.php",d="https://compare.buyhatke.com/updates10.php";break;case 1:c="https://compare.buyhatke.com/exampleExtCat.php",d="https://compare.buyhatke.com/updatesNew.php";break}var a=await Ae(c,"POST",o);a=a.trim();var f=a;if(a!=""&&l==0&&(a=JSON.parse(a)),l!=0||a.length>0&&a[0].error&&a[0].error==1){var c=d+"?searchText="+encodeURIComponent(s.original)+"&price="+s.price+"&ext_id="+w.ext_id+"&auth_val="+w.ext_auth+"&pos="+s.pos+"&PID="+s.PID;(w.flagBL==1&&s.pos==63||w.actBL<10&&s.pos==63)&&(c+="&mainFL=1");var a=await Ae(c,"GET",null);try{e.postMessage({dataBack:a})}catch{}}else try{e.postMessage({dataBack:f})}catch{}}},ln);else if(e.name=="searchPayloadDataTest"+e.sender.tab.id)r(async function(a){var l;if(J("here15",a),a.messageData!=""){let c=a.messageData.split("~*~*"),d=c[0],f=c[1],p=c[2],u=c[3],I=c[5],k=c[6];var s;s="PID="+u+"&pos="+p,J(s);let y="https://search-new.bitbns.com/buyhatke/comparePrice?"+s;var o=await Ae(y,"GET",s);let b=new URLSearchParams(s),h=b.get("PID"),m=b.get("pos");if(o){if(o=o.trim(),!JSON.parse(o).data.length){let P={pid:u,prod:k,price:f,pos:p},S={};const v=await fo({pid:u,prod:k,price:f,pos:p});(v==null?void 0:v.status)==1&&(S=v);const _=await lo(),T=(l=S==null?void 0:S.categoryObject)==null?void 0:l.subCatId;if(!(T!=null&&_.hasOwnProperty(String(T)))){let g=await Tn(h,m),O=Yf(g.data);g.data=O,g.dittoPromoteFlag=!0,o=JSON.stringify(g)}}try{e.postMessage({dataBack:o})}catch{}}else try{e.postMessage({dataBack:""})}catch{}}},ln);else if(e.name=="searchPayloadData"+e.sender.tab.id){r(async function(a){try{J("here16",a),e.postMessage({dataBack:null});return}catch{}if(a.messageData!=""){w.flagBL=await x.getItem("flagBL"),w.actBL=await x.getItem("actBL"),name=a.messageData;var d=name.split("~*~*"),s=parseInt(d[2]),o=d[3],l="",c=d[0];name.split("moreData=").length>1&&(l=name.split("moreData=")[1],name=name.split("moreData=")[0]);var d=name.split("~*~*"),f=parseFloat(d[1]);name=d[0];var p=name.split("-");name=p.join(" ");var u=0,I,k,y,b=name.trim(),h=f;newSearchOn=0,myID=e.sender.tab.id,tabId=e.sender.tab.id,tabID=e.sender.tab.id,urlMerchant=e.sender.tab.url;var m=0;if(l.split("isapparel=").length>1){k=l.split("isapparel=")[1];var A="search="+encodeURIComponent(b),P="https://compare.buyhatke.com/apparelsSearch.php";y=1,I=0}else{w.sourceInstall=await x.getItem("sourceInstall"),y=0,m=1;var A="search="+encodeURIComponent(b)+"&data="+encodeURIComponent(l),A="query="+encodeURIComponent(b)+"&price="+h+"&PID="+o+"&pos="+s+"&source="+w.sourceInstall;w.flagBL==1&&s==63?A+="&mainFL=1&ext_id="+w.ext_id:w.actBL<10&&s==63&&(A+="&mainFL=1");var P="https://graph.bitbns.com/searchTest5.php?"+A;I=0,newSearchOn=1,k=0}if(m==1)var a=await Ae(P,"GET",A);else var a=await Ae(P,"POST",A);if((a.trim()==""||a.trim().length<100||a.trim==null)&&Kt(61,2,0,"product comparison  error for pid "+o+" and website position "+s,s,0),s!=1&&newSearchOn==0){w.flagBL=await x.getItem("flagBL"),w.actBL=await x.getItem("actBL"),w.sourceInstall=await x.getItem("sourceInstall");var a=req.responseText;if((h==NaN||h=="NaN")&&(h=0),I==0&&y==0){var P="https://compare.buyhatke.com/updates10.php?searchText="+encodeURIComponent(b)+"&price="+h+"&ext_id="+w.ext_id+"&auth_val="+w.ext_auth+"&pos="+s+"&PID="+o+"&source="+w.sourceInstall;(w.flagBL==1&&s==63||w.actBL<10&&s==63)&&(P+="&mainFL=1")}else if(y==1)var P="https://compare.buyhatke.com/updates_app.php?searchText="+encodeURIComponent(b)+"&price="+h+"&ext_id="+w.ext_id+"&auth_val="+w.ext_auth+"&PID="+o+"&source="+w.sourceInstall;else{var P="https://compare.buyhatke.com/updates_ext.php?searchText="+encodeURIComponent(b)+"&isbn="+k+"&ext_id="+w.ext_id+"&auth_val="+w.ext_auth+"&PID="+o+"&source="+w.sourceInstall;(w.flagBL==1&&s==63||w.actBL<10&&s==63)&&(P+="&mainFL=1")}var a=await Ae(P,"GET",A);if(y==1){wo(myID);try{e.postMessage({dataBack:a})}catch{}}else{var S=JSON.parse(a),v;S!=null?(v=S.length,S=S.sort(function(T,E){return T.price-E.price})):v=0,wo(myID);try{e.postMessage({dataBack:a})}catch{}}}else try{e.postMessage({dataBack:a})}catch{}}});return}else e.name=="getAPIdetails"+e.sender.tab.id?r(async function(a){if(J("here17",a),a.messageData!=""){var s=a.messageData.split("~*"),l=s[0],o=s[1];o=parseInt(o);var l=JSON.parse(l)}Du(l[0].api).then(function(c){var d=c;Xu(l[0].api).then(function(f){try{e.postMessage({header:d,postData:f})}catch{}})})},ln):(i=e.name)!=null&&i.includes("buyhatke-chatAssistant")?r(async function(a){try{if(chrome.runtime.lastError&&console.error(chrome.runtime.lastError),a.type=="chatAssist-userMessage"){let s=await cm(a==null?void 0:a.queryId,(a==null?void 0:a.actionId)??0,(a==null?void 0:a.retryCount)??0,(a==null?void 0:a.userQuery)??"",a.productDetails,a.language,a.aiResponse);e.postMessage({type:a.type,mydata:{...s,aiResponse:a.aiResponse}});return}else if(a.type=="chatAssist-getAllSites"){Hr.length==0&&await mc(),e.postMessage({type:a.type,mydata:{getAllSitesData:Hr}});return}else if(a.type=="chatAssist-getPriceGraphPoint"){const s=await Ts(a.pid,a.pos);e.postMessage({type:a.type,mydata:{priceGraphData:s}});return}else if(a.type=="chatAssist-getCompareList"){const s=await wc(a.pos,a.pid);e.postMessage({type:a.type,mydata:{compareData:s}});return}else if(a.type=="chatAssist-setPriceAlert"){const s=await bc(a.productData,a.productData.price);e.postMessage({type:a.type,mydata:s});return}else if(a.type==="chatAssist-sendFeedback"){const s=await lm(a.data);e.postMessage({type:a.type,mydata:s});return}else if(a.type.startsWith("chatHistory-")){const{type:s,mydata:o}=a,{key:l,value:c}=o||{};let d;if(s.startsWith("chatHistory-")&&(d=s.split("-")[1]),d){let f,p;try{switch(d){case"get":f=await as.get(l);break;case"set":await as.set(l,c),f="success";break;case"delete":await as.delete(l),f="success";break;case"clear":await as.clear(),f="success";break}}catch(u){console.error(`Error in IndexedDB operation '${d}':`,u)}e.sender&&e.postMessage({type:s,mydata:f,error:p})}}}catch(s){console.error(s);return}}):e.name=="othersPayloadData"+e.sender.tab.id?r(async function(a){if(J("Msg got ",a),a.messageData!=""){var s=a.messageData.split("~*");J("MSG",a.messageData),s[1]==43&&J("pehle arr",mr);var o=s[0],l=s[1];if(l=parseInt(l),J("command got ",l),l==43&&J("OOSDATA",a),l==11){try{e.postMessage({dataBack:""})}catch{}return}try{o=JSON.parse(o)}catch{}if(l==101){if(J("Trying to fetch if offer is applicable for this website",s,o),o.length>0&&o[0].pos&&_s[o[0].pos])if(Nr(o[0].pos),xs(o[0].pos)==1){let D=tf(o[0].pos);e.postMessage({dataBack:D})}else e.postMessage({dataBack:[]});else e.postMessage({dataBack:[]});return}if(l==102){if(J("Trying to fetch if offer is applicable for this website",s,o),o.length>0&&o[0].pos&&_s[o[0].pos]){let L=Rl(o[0]);L?e.postMessage({dataBack:L}):e.postMessage({dataBack:[]})}else e.postMessage({dataBack:[]});return}if(l==103){if(o.length>0&&o[0].pos){let L=await qp(o[0]);L&&Object.keys(L).length>0?e.postMessage({dataBack:L}):e.postMessage({dataBack:{}})}else e.postMessage({dataBack:{}});return}switch(l){case 1:var m="https://graph.bitbns.com/getPredictedData.php";break;case 2:var m="https://compare.buyhatke.com/dealsAPI/pidToList.php";break;case 3:var m="https://api.buyhatke.com/dealsAPI/pidToListAmaz.php";break;case 4:var m="https://compare.buyhatke.com/dealsAPI/pidToListSnap.php";break;case 5:var m="https://compare.buyhatke.com/dealsAPI/pidToListMyn.php";break;case 6:var m="https://compare.buyhatke.com/dealsAPI/pidToListJab.php";break;case 7:var m="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/getAutoCoupons.php";break;case 8:var m="https://ext1.buyhatke.com/amazon/sendPIDs.php";return;case 9:var m="https://api.buyhatke.com/compare/extension/userLog.php";break;case 10:var m="https://api.buyhatke.com/couponConfig/saveExtCoupons";break;case 11:var m="https://compare.buyhatke.com/pushRaw.php";break;case 12:var m="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/extCpnStatusTest.php";break;case 13:var m="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/bestCpnLike.php";break;case 14:var m="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/pickExtCoupons.php";break;case 15:var m="https://api.buyhatke.com/couponConfig/saveExtCoupons";break;case 16:var m="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/savePepperBread.php";break;case 17:var m="https://compare.buyhatke.com/wishlist3/api/scrapWishList.php";break;case 18:var m="https://compare.buyhatke.com/dealAPICat.php";break;case 19:var m="https://compare.buyhatke.com/reviewBack/submitMobile.php";break;case 20:J("Entered command 20");var m="http://54.179.157.216/api/count/update";return;case 21:var m="https://ext1.buyhatke.com/amazon/lightDeals.php";break;case 22:var m="https://ext1.buyhatke.com/php/counter.php";break;case 23:var m="https://ext1.buyhatke.com/dump-1";if(w.register=await x.getItem("register"),w.register!=1){try{e.postMessage({dataBack:""})}catch{}return}break;case 24:var m="https://t.buyhatke.com/referr/f2.php";break;case 25:var m="http://extmain.buyhatke.com/checkout";break;case 26:var d=o[0].siteid,m="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/v1/configs/"+d+".json";break;case 31:var d=o[0].siteid,m="https://api.buyhatke.com/coupons/PickCoupon/FreshC/v1/configs/"+d+".json";break;case 27:var c=o[0].host,m="https://api.buyhatke.com/couponConfig/checkConfig?domain="+c;break;case 41:var d=o[0].siteid,m="https://api.buyhatke.com/couponConfig/checkCOConfig/?pos="+d;break;case 28:var m="https://t.buyhatke.com/universalLog/";try{await ge("UniversalLog",o[0])}catch{}return;case 29:var m="https://compare.buyhatke.com/logger/bread.php";break;case 30:var m="https://graph.bitbns.com/extAPIs/getDropDetails";break;case 32:var m="https://search-new.bitbns.com/autocoupon-apis/getSideBarCoupons";break;case 33:var m="http://supercrawler.buyhatke.com/recommendation/fetchAPICopy.php";break;case 34:var m="https://api.buyhatke.com/paapi/updatePriceAlert";break;case 35:var m="https://api.buyhatke.com/couponsAPI/likeDislike";break;case 36:var m="https://compare.buyhatke.com/extension/pushBrand.php";break;case 37:var m="https://compare.buyhatke.com/extension/feedbacks.php";break;case 38:var m="https://api.buyhatke.com/coupons/PickCoupon/FreshCoupon/saveAppliedCoupons.php";break;case 39:var m="https://api.buyhatke.com/couponsAPI/add_cpn";break;case 40:var m="https://t.buyhatke.com/thankyou.php";break;case 43:var m="https://api.buyhatke.com/paapi/showStockAlerts";break;case 44:var m="https://api.buyhatke.com/paapi/stockAlert";break;case 46:var d=o[0].site_id,m="https://compare.buyhatke.com/extension/configs/oosAlert/"+d+".json";break;case 47:var m="https://compare.buyhatke.com/unwantedDomains.json?rand="+parseInt(Math.random()*99999);break;case 50:var m="https://graph.bitbns.com/getPopular.php";break;case 51:var m="https://graph.bitbns.com/getMin.php";break;case 1234:var m="https://ext1.buyhatke.com/fcheck-1";break;case 1235:var m="https://ext1.buyhatke.com/buscheck-1";break;case 1236:var m="https://ext1.buyhatke.com/hotelscheck-1";break;case 1237:var m="https://ext1.buyhatke.com/moviescheck-1";break;case 1701:var m="https://ext1.buyhatke.com/couponTracking-1";break;case 1240:var m="https://compare.buyhatke.com/autocoupon-contest/check_winner.php";break;case 100:wt=0,await x.setItem("ext_email",o[0].email),await x.setItem("verifiedExt",0),await x.setItem("timeEmailAdded",parseInt(new Date().getTime()/1e3));var m="https://compare.buyhatke.com/extension/addEmailExt.php";break;case 200:wt=0;var m="https://compare.buyhatke.com/wishlist3/api/createWishList.php";break;case 400:wt=0;var m="https://compare.buyhatke.com/wishlist3/api/deleteWL.php";break;case 500:wt=0;var m="https://compare.buyhatke.com/wishlist3/api/delFromWish.php";break;case 600:wt=0;var m="https://compare.buyhatke.com/wishlist3/api/addProd2Wish.php";break;case 700:wt=0;var m="https://compare.buyhatke.com/wishlist3/api/modifyTags.php";break;case 800:wt=0;var m="https://compare.buyhatke.com/wishlist3/api/editWL.php";break;case 900:wt=0;var m="https://compare.buyhatke.com/wishlist3/api/scrapWishList.php";break;case 1e3:if(wt=1,o[0].selectSiteWish){var f=o[0].selectSiteWish.trim();if(f!=""&&f.split("flipkart.com/wishlist").length>1)flipWishListURL(f).then(function(L){try{e.postMessage({dataBack:L})}catch{}Dr()});else if(f!=""&&f.split("snapdeal.com/mywishlist").length>1||f!=""&&f.split("snapdeal.com/wishlist").length>1)snapWishList(f).then(function(L){try{e.postMessage({dataBack:L})}catch{}Dr()});else if(f!=""&&f.split("amazon.in").length>1&&f.split("wishlist/").length>1||f.split("amzn.in/").length>1){f.split("/ref=").length>1&&(f=f.split("/ref="),f=f[0].trim()),f.split("?").length>1&&(f=f.split("?"),f=f[0].trim()),f.split("#").length>1&&(f=f.split("#"),f=f[0].trim()),f.split("&").length>1&&(f=f.split("&"),f=f[0].trim());var p=f.length-1;f.substr(p,1)=="/"&&(f=f.substring(0,p)),amazWishList(f).then(function(L){try{e.postMessage({dataBack:L})}catch{}Dr()})}else try{e.postMessage({dataBack:""})}catch{}return}break;case 1100:if(wt=1,o[0].setMinAlertURL){try{var v=`ext_id=${w.ext_id}&auth_val=${w.ext_auth}&link_id=${o[0].link_id}&platform=${o[0].platform}&price_not=${o[0].price_not}`,u=await Ae(o[0].setMinAlertURL.trim(),"POST",v,"formData");u&&e.postMessage({dataBack:u})}catch{}return}break;case 1200:if(wt=1,o[0].removePriceAlert){var I=o[0].removePriceAlert.trim(),k=o[0].showAlert.trim(),y=o[0].link_id,b=parseInt(Math.random()*999999999999999),v=`ext_id=${w.ext_id}&auth_val=${w.ext_auth}&link_id=${y}`,h=await Ae(I+"?rand="+b,"POST",v,"formData");if(h){var u=await Ae(k+"?rand="+b,"POST",`ext_id=${w.ext_id}&auth_val=${w.ext_auth}`,"formData");if(u){u==null|u=="null"&&(u="[]");try{Ye=await JSON.parse(u),Rn(Ye)}catch{Ye=u,Rn(Ye)}try{e.postMessage({dataBack:JSON.stringify(Ye)})}catch{}}}return}break;case 1300:wt=1,submitDataEBAY(o,"submitData.php").then(async function(L){await x.setItem("bankBox1",o[0].Bank),await x.setItem("bankBox2",o[1].Acc),await x.setItem("bankBox3",o[2].Branch),await x.setItem("bankBox4",o[3].IFSC);try{e.postMessage({dataBack:L})}catch{}});return;case 1400:wt=1,submitDataEBAY(o,"submitData.php").then(async function(L){submitEbay=o,await x("myName",o[0].Name),await x("phoneNo",o[1].Phone),await x("emailEbay",o[2].email);try{e.postMessage({dataBack:L})}catch{}});return;case 1500:wt=1,submitDataEBAY(o,"submitPP.php").then(async function(L){await x("submittedPaisa",o[0].PP);try{e.postMessage({dataBack:L})}catch{}});return;case 1600:wt=1;try{w.mywishlist=await x.getItem("mywishlist"),e.postMessage({dataBack:w.mywishlist})}catch{}return;case 1700:wt=0;var m="https://compare.buyhatke.com/wishlist3/api/wlCoverPic.php";break;case 1800:try{e.postMessage({dataBack:In})}catch{}return}var A,P;w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth"),A=w.ext_id,P=w.ext_auth;var S=o,v="";l!=28&&l!=1&&l!=51&&l!=50&&l!=32?v="ext_id="+A+"&auth_val="+P:l!=1&&(v="type=log&indexName=interest_centers&logName=info");for(var _=S.length,T=0,E=0;E<_;E++){var g=S[E];for(var O in g){var $=O,K=S[E][O];$=="pos"&&(T=K),$=="cpnData"||$=="interests"||$=="variants"||l==40?v+="&"+$+"="+encodeURIComponent(JSON.stringify(K)):v+="&"+$+"="+K}}w.flagBL=await x.getItem("flagBL"),w.actBL=await x.getItem("actBL"),l==1&&w.flagBL==1&&T==63?v+="&mainFL=1":l==1&&w.actBL<10&&T==63&&(await x.setItem("actBL",parseInt(w.actBL)+1),v+="&mainFL=1"),l==7&&xd(S[0].pos,S[0].site_url,S[0].affiliate_name,e.sender.tab.id);let F="";if(l==1||l==51||l==50||l==32){if(l===1&&Xi.includes(T)){const L=v.split("~");if(T=="25622"){let V=new URLSearchParams(L[0]).get("pid"),ae=L[2],te=ut.find(ne=>{let q=ne.split("~");if(q.length<6)return!1;let re=q[0],ue=q[1],Te=q[4],se=q[5];return re==T&&se==ae&&(ue==V||Te==V)});if(te){let ne=te.split("~"),q=ne[2],re=ne[4],ue=`${V}~false~${ae}`,Te=`${re}~${q}`;v=v.replace(ue,Te)}}else if(v.includes("~false")){let V=new URLSearchParams(v.split("~")[0]).get("pid");if(T=="6660")try{const q=V.split("/").pop();q&&(V=q);let re=nr.get(V),ue=re==null?void 0:re.articleId,Te=!1;if(ue){let se=$a.get(ue);Te=se==null?void 0:se.flag}Te?v=v.replace(T,"25850"):v=v.replace("~false","")}catch{}let ae=`${T}~${V}~`,te=ut.find(ne=>ne.startsWith(ae));if(te){let ne=te.split("~")[2];v=v.replace("~false",`~${ne}`)}}else v.includes("~")||(v=v+"~"+tu)}m=m+"?"+v,F=await Ae(m,"GET",v)}else l==27||l==26||l==31||l==41||l==46||l==47?F=await Ae(m,"GET",v):(J("mai yaha hu"),J("parameters",v),l==43&&J("url",m),F=await Ae(m,"POST",v,"formData"),l==43&&(In=F));if(J(l," => req text",F),F){J("mat aaa idhar");try{e.postMessage({dataBack:F})}catch(L){J("err",L)}l==26&&Au(F),l==31&&Tu(F),l==41&&Ou(F,o[0].siteid),l==27&&_u(F,o[0].host),l==46&&Su(F,o[0].site_id),l==47&&(Pu(F),F=JSON.stringify(F)),l==24&&(F=F.trim(),F=parseInt(F),isNaN(F)||Cf(F))}if(l==43||l==44){if(l==43)try{var z=JSON.parse(F);z.status==1&&typeof z.data<"u"&&(J("dataWatchOOS",z),mr=z.data,J("HERERRERERERER ",mr))}catch(L){J("Error in command 43 ",L)}try{J("sending back ",F),e.postMessage({dataBack:F})}catch(L){J("Error in command 43 port  ",L)}}else try{e.postMessage({dataBack:""})}catch{}}}):e.name=="couponsPayloadData"?r(async function(a){if(J("here18",a),a.couponsPayloadData!=""){var s=a.couponsPayloadData.split("~*"),c=s[0],o=s[1],l=s[2],c=JSON.parse(c),d,f;d=w.ext_id,f=w.ext_auth;for(var p="https://api.buyhatke.com/coupons/cpnSideBar/"+l,u=c,I="ext_id="+d+"&auth_val="+f+"&webID="+o,k=u.length,y=0;y<k;y++){var b=u[y];for(var h in b){var m=h,A=u[y][h];I+="&"+m+"="+A}}if(mytext=await Ae(p,"POST",I,"formData"),mytext)try{e.postMessage({dataBack:mytext})}catch{}}}):e.name.indexOf("buyhatke")>-1?r(async function(a){var o,l;J("here19",a);let s="";switch(a.type){case"keepActive":e.postMessage({type:a.type,mydata:s});break;case"getCouponsList":s=await sl(a),e.postMessage({type:a.type,mydata:s});break;case"getConfig":s=await Od(a.pos,a.devicetype),e.postMessage({type:a.type,pos:a.pos,mydata:s});break;case"getRequest":J("Here at getRequest "),Ia=0,ia="",Qa="",Ea=0,ot.webRequest.onBeforeRequest.hasListener(ha)&&ot.webRequest.onBeforeRequest.removeListener(ha),ot.webRequest.onBeforeSendHeaders.hasListener(fa)&&ot.webRequest.onBeforeSendHeaders.removeListener(fa),jt[`${a.api}~${e.sender.tab.id}`]||(jt[`${a.api}~${e.sender.tab.id}`]=1),ot.webRequest.onBeforeRequest.addListener(ha,{urls:[a.api]},["requestBody"]),ot.webRequest.onBeforeSendHeaders.addListener(fa,{urls:[a.api]},["requestHeaders"]);async function c(){if(Ia==1&&Ea%2==0){ot.webRequest.onBeforeRequest.removeListener(ha),ot.webRequest.onBeforeSendHeaders.removeListener(fa);try{e.postMessage({type:a.type,mydata:{headers:ia,body:Qa}})}catch(u){J("error here ",u)}}else setTimeout(c,500)}await c();break;case"getResponse":J("Here at getResponse "),Ia=0,ia="",Qa="",Ea=0,ot.webRequest.onHeadersReceived.hasListener(fa)&&ot.webRequest.onHeadersReceived.removeListener(fa),ot.webRequest.onResponseStarted.hasListener(ha)&&ot.webRequest.onResponseStarted.removeListener(ha),jt[`${a.api}~${e.sender.tab.id}`]||(jt[`${a.api}~${e.sender.tab.id}`]=1),ot.webRequest.onHeadersReceived.addListener(fa,{urls:[a.api]},["responseHeaders"]),ot.webRequest.onResponseStarted.addListener(ha,{urls:[a.api]},["responseHeaders"]);async function d(){if(Ia==1&&Ea%2==0){ot.webRequest.onHeadersReceived.removeListener(fa),ot.webRequest.onResponseStarted.removeListener(ha);try{e.postMessage({type:a.type,mydata:{headers:ia,body:Qa}}),delete jt[`${a.api}~${e.sender.tab.id}`]}catch(u){J("error here ",u)}}else setTimeout(c,500)}await d();break;case"getCurrentUrl":s=await getCurrentUrl();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getSiteLogo":s=await kp(a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getPOS":s=await Dt(a.url,e.sender.tab.id);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"giftVoucher-getConfig":s=await Nd(a.data.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"isBlockUISite":s=await yo(a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getACPOS":s=await gp(a.url);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendForSpecExtraction":s=await vp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"postTotalSavings":s=await xp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"postUpdate":s=await Tp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"filterData":s=await Ap(a.data,a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"postSavingsAlert":s=await Sp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getCartConfig":s=await Ed(a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getHeadersFromAPI":s=await Zu(a.url);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"checkCartConfigExistence":s=await no(a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"checkSavingSites":s=await no(a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getScrapConfig":s=await Ja(a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"updateStaleProducts":s=await Wp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getPlatformETAConfig":s=await yt();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getGroceryPriceConfig":s=await la();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getGroceryAddToCartConfig":s=await Ta();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getAddressSuggestionConfig":s=await Yr();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getPlatformSearchConfig":s=await Gt();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getDeliveryConfig":s=await io();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getAllGroceryConfig":s=await io();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendStoreData":s=await _d();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getEtConfig":s=await Rd(a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"createFlightQuerySearch":s=await Ud(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"pollFlight":s=await $d(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getProductCategory":s=await fo(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getTurkCountries":s=await Jd();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getUserCountry":s=await x.getItem("userCountry");try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getPriceComparison":s=await Bd(a.pid,a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"checkToCallPriceComparisonFunction":s=await oo(a.url);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"CheckToCallACUntrustFunction":s=await jd(a.hostname);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getDittoScrapConfig":s=await hp(a);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getSearchHTML":s=await yp(a.data,a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendExactData":s=await wp(a.exactData,a.pos,a.pid,a.prod,a.price,a.image,a.src);try{e.postMessage({type:a.type,mydata:s})}catch{}case"getExactHtml":s=await As(a.exactUrl);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendDittoSearchData":s=await mp(a.data,a.currData);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getCurrencyMap":s=await ul();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getElectronicProduct":s=await lo();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getElectronicCategories":s=await Fd();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getSkuForSearch":s=await qn();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"fireEvent":s=await ge(a.eventName,a.params);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"reloadTab":try{Iu(a.tabId),s="Tab reloaded",e.postMessage({type:a.type,mydata:s})}catch{}break;case"logErrorMonitorData":s=await ur(a.params);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"logError":s=await R(a.funcName,a.err);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"firePageViewEvent":s=await ku(a.eventName,a.hostName,a.otherParams);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getDittoSearchData":s=await Tn(a.pid,a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getDittoSearchDataGlobal":s=await Vd(a.pid,a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"checkIfSpendLive":s=await Xa(a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"spendCalculateCart":s=await Il(a.siteConfig,a.pos,a==null?void 0:a.lastQuarter,a.cookie,a.localStorage,a.domMap,e.sender.tab.id,"",a==null?void 0:a.calculateLatest);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"spendCalculate":try{rt[e.sender.tab.id]||(rt[e.sender.tab.id]=a==null?void 0:a.spendMapAnalyticsCnt),ht[e.sender.tab.id]||(ht[e.sender.tab.id]=a==null?void 0:a.spendMapAnalyticsTime)}catch{}s=await op(a.pos,a.siteConfig,a.username,a.cookie,a.localStorage,a.domMap,e.sender.tab.id,a==null?void 0:a.calculateLatest,a==null?void 0:a.lastQuarter),s.spendMapAnalyticsCnt=rt[e.sender.tab.id],s.spendMapAnalyticsTime=ht[e.sender.tab.id],delete rt[e.sender.tab.id],delete ht[e.sender.tab.id];try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"zeptoOrderJSON":ra[e.sender.tab.id]||(ra[e.sender.tab.id]={},ra[e.sender.tab.id].orderJSON=a==null?void 0:a.orderJSON,ra[e.sender.tab.id].orderAPIArr=a==null?void 0:a.orderAPIArr);let f={};try{f=await uu(e.sender.tab.id,a==null?void 0:a.pos)}catch{}if(ra[e.sender.tab.id].orderJSON)for(let u of ra[e.sender.tab.id].orderJSON)try{let I=u==null?void 0:u.orderId;f[I]&&(u.orderDetails=f[I]),(o=f[I])!=null&&o.refundAmt&&(u.orderTotal-=(l=f[I])==null?void 0:l.refundAmt)}catch{}s=ra[e.sender.tab.id].orderJSON;try{e.postMessage({type:a.type,mydata:s})}catch{}delete ra[e.sender.tab.id];break;case"getSpendConfig":s=await vl(a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"setTimeId":try{rt[e.sender.tab.id]||(rt[e.sender.tab.id]=a==null?void 0:a.spendMapAnalyticsCnt),ht[e.sender.tab.id]||(ht[e.sender.tab.id]=a==null?void 0:a.spendMapAnalyticsTime)}catch{}s=await xl(a==null?void 0:a.spendId,a==null?void 0:a.pos,e.sender.tab.id),s.spendMapAnalyticsCnt=rt[e.sender.tab.id],s.spendMapAnalyticsTime=ht[e.sender.tab.id],delete rt[e.sender.tab.id],delete ht[e.sender.tab.id];try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getCheckoutAnalytics":s=bn;try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getUsernameFromSW":s=await Xf(a==null?void 0:a.pos,a==null?void 0:a.url,a==null?void 0:a.body);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"responseFromSW":s=await dp(a==null?void 0:a.url,a==null?void 0:a.payload);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getSpendSummary":s=await Al(a.pos,a.username,a.siteConfig);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"pushSpendData":await kl(a==null?void 0:a.data,a==null?void 0:a.pos,a==null?void 0:a.spendId,a==null?void 0:a.siteConfig,e.sender.tab.id),s=await _l(a.spendId,a.data,a==null?void 0:a.curArr,a==null?void 0:a.addressMap,a==null?void 0:a.isBusiness);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getOrdersScrapedCount":s=lp(e.sender.tab.id);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getProductsScrapedArr":s=cp(e.sender.tab.id);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getUserUsedSpendCount":s=await Ah();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"updateAutoSync":s=await up();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getExtIdAuth":s=await yh();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"spendErrorLog":s=await ec(a.pos,a.error);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendAndClearSpendApiLogs":s=await vu(a.spendLogs);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"updateCouponStatus":s=await Pp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"ACMonitor":s=await Dp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getACAnalyticsId":s=await Pd(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"ACTSMonitor":s=await Op(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"checkoutScrap":s=await Lp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"voucherScrap":s=await Ep(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"Popularity":s=await Mp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getHTMLScrapSites":s=await Rp();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendScrapHTML":s=await jp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendCategoryCrawl":s=await $p(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getCategoryConfig":s=await Up(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getBankPosConfig":s=await Dd();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getTurkFlagCurrencies":s=await Ld();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getAffCouponsNew":s=await Fp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getCpnCollectionConfig":s=await Bp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendCouponScrap":s=await Hp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getFeeds":s=await Vp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"extID":w.ext_id=await x.getItem("ext_id"),s=w.ext_id;try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendWishlistData":s=await Zp(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getScrapConfigWishlist":s=await zp(a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendCurrentMonitorData":s=await oh(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"featureMonitorData":s=await lh(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"countMonitor":await Yl(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"errorMonitor":await ur(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getRequestToAny":let p=await Ae(a.data,"GET","");try{e.postMessage({type:a.type,mydata:p})}catch{}break;case"groceryCheckout":await hh(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getResponseFromBackground":s=await Ll(a.url,a.options,a.isText);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"fetchReferralCode":s=await ac();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"verifyReferral":s=await _h(a.referralCode);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getFlipkartLowestSellerPrice":s=await _p(a.prodCode,a.currPincode,a.config);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getSocialProofData":s=await Sh();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendFeedBackData":s=await Ph(a.likeNewUI,a.comment,a.source,a.url);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"checkEmailVerified":md();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"checkLogin":s=await Oh();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"handleLogin":s=await Dh();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getCookiesFromBackground":s=await ui(a.url,a.name);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getStoreIdFromCookiesBackground":s=await Fs(a.storeIdSelector);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"setExtensionCookie":s=await Vh(a.name,a.value,a.days);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"checkTelegramConnectStatus":s=await Lh();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getTelegramBotUrl":s=await jh();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendAmazonVariants":s=await Sf(a.arr);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendPidsForThunder":s=await ii(a.arr,a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getDataFromSendPairCache":s=await vf(a.pid,a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getDealScore":s=await gf(a.arr,a.pos,a.currentPrice,a.oos,a.isCurrent);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getAdCreatives":s=await Eh(a.id);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"trackImpressionPixel":s=await Nh(a.params);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"trackClickPixel":s=await Mh(a.params);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"fireExternalAdPixel":s=await Rh(a.url);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getPriceData":s=await Uh(a.priceMap);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getTopSitesRecentlyViewedList":s=await Dl();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"sendSpendZeroResponse":s=await En(a.failedResponse,a.spendId,a.pos,a.allTime);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getSaleInfo":s=await $h();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getOffersData":s=await Jh(a.pos,a.offerIds);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"upsertOffers":s=await Fh(a.pos,a.offers);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getVoucherChoices":s=await um(a.pos);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getVoucherDenominationChoices":s=await dm(a.pos,a.amount,a.voucherChoice);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"giftVoucher-getCookie":s=await wm(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"giftVoucher-apiCall":s=await bm(a.data);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"checkLoginGiftVoucher":s=await Im();try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"checkIsAllowedGiftVoucher":s=await gm(a==null?void 0:a.params);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"createGiftVoucher":s=await pm(a==null?void 0:a.params);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"createPaymentGiftVoucher":s=await fm(a==null?void 0:a.params);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"paymentStatusGiftVoucher":s=await hm(a==null?void 0:a.orderId);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"cancelGiftVouchers":s=await mm(a==null?void 0:a.orderId);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"getValidGiftVouchersList":s=await ym(a==null?void 0:a.orderId);try{e.postMessage({type:a.type,mydata:s})}catch{}break;case"pidRedirectionInfo":Tf(a==null?void 0:a.pos,a==null?void 0:a.info);break;default:w.ext_id=await x.getItem("ext_id"),s=w.ext_id;try{e.postMessage({type:"DEFAULT",mydata:"Unhandle default response from BG"})}catch{}break}}):J("Unhandled port request ",e)}),chrome.tabs.onUpdated.addListener(async function(e,t,r){var i="12.png",a=r.url,s=e;us(Qs,s),us(Ys,s);var o=0;let l=await Dt(r.url,e);if(l&&l!=""&&l!=null){var i=Cc,c=0;o=1}else var i=Gc,d=2,c=0;(!Hn[e]||o==1)&&(Hn[e]=!0,chrome.action.setIcon({tabId:e,path:i}))}),chrome.tabs.onRemoved.addListener(async function(e){J("here21",e),Pf(e),us(Qs,e),us(Ys,e);let t=`lastUrl_${e}`;try{(await chrome.storage.local.get(t))[t]!==void 0&&(await chrome.storage.local.remove(t),J(`Cleaned up lastUrl storage for tab ${e}`))}catch(r){J(`Error checking/removing lastUrl storage for tab ${e}:`,r)}}),chrome.runtime.onMessage.addListener(function(e,t,r){async function i(){try{if(J("entered ",e),(xo.has(e.action)||e.action==="findSimilar"||e.action==="findSimilarBulk"||e.action==="fetchSuggestions")&&Ur(),xo.has(e.action)&&e.isNewSearch){let O=(await chrome.storage.local.get("platformConnections")).platformConnections||{};et={totalRequests:Object.values(O).filter(K=>K.connected).length,responsesReceived:0,currentRequestId:null}}if(Object.keys(w).length==0){r({farewell:"",status:!1});return}if(e.action==="getAddress")return Xh(e.lat,e.lon).then(g=>r({success:!0,address:g})).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="storeLocation")return chrome.storage.local.set({userLocation:{latitude:e.latitude,longitude:e.longitude,timestamp:Date.now()}},()=>{r({success:!0})}),!0;if(e.action==="getLocation")return chrome.storage.local.get(["userLocation"],g=>{r(g.userLocation||null)}),!0;if(e.action==="fetchPrice")return Ny(e.pid,e.platform,e.variant).then(g=>{r({success:!0,data:g})}).catch(g=>{r({success:!1,error:g.message})}),!0;if(e.action==="AddToCartHelper")return Wy(e.product,e.platform).then(g=>{r(g)}).catch(g=>{r({success:!1,error:g.message})}),!0;if(e.action==="ClearInstamartCartState")return clearInstamartCartState().then(()=>r({success:!0,message:"State cleared."})).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="fetchSuggestions")return Ur(),Yh(e.query).then(g=>{let O=Qh(g);r({success:!0,suggestions:O})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="fetchAddressSuggestions")return Wh(e.query).then(g=>{let O=Zh(g);r({success:!0,suggestions:O})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="fetchAddressInfoManual")return Kh(e.address).then(async g=>{let O=await zh(g,e.address);r({success:!0,suggestions:O})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="fetchBlinkitSearch")return Gh(e.query,e.latitude,e.longitude,e.offset,e.sessionRequestId,e.isNewSearch,e.onlyForSuggestion,e.alternativeKey).then(g=>{r(g)}).catch(g=>{ma("blinkit"),r({success:!1,error:g.message})}),!0;if(e.action==="fetchFlipkartMinutes")return Ch(e.query,e.sessionRequestId,e.isNewSearch,e.onlyForSuggestion,e.alternativeKey).then(g=>{r(g)}).catch(g=>{ma("flipkart_minutes"),r({success:!1,error:g.message})}),!0;if(e.action==="fetchInstamartSearch")return qh(e.query,e.latitude,e.longitude,e.sessionRequestId,e.isNewSearch,e.onlyForSuggestion,e.alternativeKey).then(g=>{r(g)}).catch(g=>{ma("instamart"),r({success:!1,error:g.message})}),!0;if(e.action==="fetchBigBasketSearch")return ey(e.query,e.sessionRequestId,e.isNewSearch,e.onlyForSuggestion,e.alternativeKey).then(g=>{r(g)}).catch(g=>{ma("bigbasket"),r({success:!1,error:g.message})}),!0;if(e.action==="fetchAmazonSearch")return ay(e.query,e.originalUrl,e.sessionRequestId,e.isNewSearch,e.onlyForSuggestion,e.alternativeKey).then(g=>{r(g)}).catch(g=>{ma("amazon"),r({success:!1,error:g.message})}),!0;if(e.action==="fetchAmazonAddresses")return Ao().then(g=>{r({success:!0,data:{addressList:g}})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="getAmazonAddressList")return Ao().then(g=>{r({success:!0,data:g})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="fetchAmazonETA")return Ly(e.addressId).then(g=>{r({success:!0,data:g})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="getAmazonSettings")return hc(["amazonAddressId","amazonBrandId"]).then(g=>r({success:!0,data:g})).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="fetchJioMartSearch")return ry(e.query,e.sessionRequestId,e.isNewSearch,e.onlyForSuggestion,e.alternativeKey).then(g=>{r(g)}).catch(g=>{ma("jiomart"),r({success:!1,error:g.message})}),!0;if(e.action==="fetchZeptoSearch")return ty(e.query,e.sessionRequestId,e.isNewSearch,e.onlyForSuggestion,e.alternativeKey).then(g=>{r(g)}).catch(g=>{ma("zepto"),r({success:!1,error:g.message})}),!0;if(e.action==="fetchDMartSearch")return sy(e.query,e.latitude,e.longitude,e.sessionRequestId,e.isNewSearch,e.onlyForSuggestion,e.alternativeKey).then(g=>{r(g)}).catch(g=>{ma("dmart"),r({success:!1,error:g.message})}),!0;if(e.action==="fetchZeptoStoreInfo")return dy(e.latitude,e.longitude).then(g=>{r({success:!0,data:g})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="fetchZeptoETA")return py(e.storeId,e.latitude,e.longitude,e.userId).then(g=>{r({success:!0,data:g})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="fetchBlinkitETA")return fy(e.latitude,e.longitude).then(g=>{r({success:!0,data:g})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="fetchInstamartETA")return Bs(e.latitude,e.longitude).then(g=>{r({success:!0,data:g})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="fetchBBNOWEta")return my(e.latitude,e.longitude).then(g=>{r(g==="BB_NOT_DELIVERABLE"?{success:!1,error:"BB_NOT_DELIVERABLE"}:{success:!0,data:g})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="fetchDmartEta")return rc(e.latitude,e.longitude).then(g=>{r({success:!0,data:g})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="fetchFlipkartMinutesETA")return gy(e.latitude,e.longitude).then(g=>{g=="FLIPKART_MINUTES_ETA_NOT_FOUND"?r({success:!1,error:g}):r({success:!0,data:g})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="fetchJioMartETA")return vy(e.latitude,e.longitude).then(g=>{r({success:!0,data:g})}).catch(g=>r({success:!1,error:g.message})),!0;if(e.action==="checkJioMartAuth")return Wn(!1).then(g=>{r({success:!0,authData:g,hasValidAuth:!!g.authToken})}).catch(g=>{g.message==="JIOMART_LOGIN_REQUIRED"?r({success:!1,error:g.message,requiresLogin:!0}):r({success:!1,error:g.message,requiresLogin:!1})}),!0;if(e.action==="connectJioMartWithTab")return Wn(!0).then(g=>{r({success:!0,authData:g,hasValidAuth:!!g.authToken})}).catch(g=>{g.message==="JIOMART_LOGIN_REQUIRED"?r({success:!1,error:g.message,requiresLogin:!0}):r({success:!1,error:g.message,requiresLogin:!1})}),!0;if(e.action==="closeJioMartTabs")return chrome.tabs.query({url:"*://www.jiomart.com/*"},g=>{g.forEach(O=>{try{chrome.tabs.remove(O.id),Ms===O.id&&(Ms=null)}catch{}}),r({success:!0,closedTabs:g.length})}),!0;if(e.action==="findSimilar")return Ur(),ny({pid:e.pid,missingPlatforms:e.missingPlatforms,sourcePlatformPos:e.sourcePlatformPos},e.requestId).then(g=>{r({success:!0,data:g})}).catch(g=>{r({success:!1,error:g.message})}),!0;if(e.action==="findSimilarBulk")return iy(e.payload,e.requestId).then(g=>{r({success:!0,data:g})}).catch(g=>{r({success:!1,error:g.message})}),!0;if(e.method=="getLocalStorage")r({data:w});else if(e.getCurPosition){var a=e.getCurPosition.siteName.toUpperCase(),s=0;for(var o in siteCurrentPosition)if(a.split(o).length>1){s=1,r({result:siteCurrentPosition[o]});break}s==0&&r({result:"0~"})}else if(e.extractConfig)er[e.extractConfig.siteid]!=null?r({result:er[e.extractConfig.siteid].configData}):r({result:"empty"});else if(e.checkStatus)ar[e.checkStatus.host]!=null?r({result:ar[e.checkStatus.host].status}):r({result:"empty"});else if(e.getConfigOOS)Ra[e.getConfigOOS.site_id]!=null?r({result:Ra[e.getConfigOOS.site_id].config}):r({result:"empty"});else if(e.removeDomains)typeof sa<"u"&&typeof sa.domains<"u"&&sa.domains!=""&&Object.keys(sa).length>0?r({result:sa.domains}):r({result:"empty"});else if(e.extractCheckoutConfig)tr[e.extractCheckoutConfig.siteid]!=null?r({result:tr[e.extractCheckoutConfig.siteid].configData}):r({result:"empty"});else if(e.checkCheckoutStatus)rr[e.checkCheckoutStatus.siteid]!=null?r({result:rr[e.checkCheckoutStatus.siteid].status}):r({result:"empty"});else if(e.config_api)ws.push(e.config_api),r({result:"finished"}),chrome.webRequest.onBeforeRequest.addListener(Bo,{urls:ws},["requestBody"]),chrome.webRequest.onBeforeSendHeaders.addListener(Ho,{urls:ws},["requestHeaders"]);else if(typeof e.showPrivacyPagePopup<"u"){let g=JSON.parse(e.showPrivacyPagePopup??"{}"),O=(g==null?void 0:g.url)??"",$=(g==null?void 0:g.id)??"",K=await Dt(O,$),z=await oo(O);if(K&&K!=""&&K!=null){let F=await yo(K);r(F?{farewell:!0}:{farewell:!1})}else r(z?{farewell:!1}:{farewell:!0})}else if(typeof e.data<"u"){var l=e.data.split("~*~*"),c=l[0],d=l[1],f=l[2],p=l[3],u=l[4],I=l[5];let g=l[6],O=l[7];try{let K=parseInt(O,10);if(Xi.includes(K)){let z=String(O),F=ut.find(L=>L.startsWith(z+"~"));if(F){let L=F.split("~"),D=L[1],V=L[2];g=D+"~"+V}}}catch{}let $=l[8];var k="https://api.buyhatke.com/paapi/priceAlert",y="prod="+encodeURIComponent(c)+"&price="+d+"&price_set="+$+"&image="+encodeURIComponent(f)+"&url="+encodeURIComponent(p)+"&pos="+u+"&pid="+g+"&sitepos="+encodeURIComponent(O)+"&ext_id="+w.ext_id+"&auth_val="+w.ext_auth;try{let K=await Ae(k,"POST",y,"formData");Kt(63,5,1,"set price alert success for site "+u+" and url "+p,u,0),r({farewell:K})}catch(K){R("setPriceAlertError",K),Kt(63,5,-1,"set price alert error for site "+u+" and url "+p,u,0),r({farewell:"error"})}}else if(typeof e.search<"u"){name=e.search;var m=name.split("~*~*"),b=parseInt(m[2]),h="";name.split("moreData=").length>1&&(h=name.split("moreData=")[1],name=name.split("moreData=")[0]);var m=name.split("~*~*"),A=parseFloat(m[1]);name=m[0];var P=name.split("-");name=P.join(" ");for(var o=0;kn[o]!=0;)o++;kn[o]=1;var S=o;yf(name.trim(),A,o,t.tab.id,t.tab.url,h,b)}else if(typeof e.sendTabID<"u")r({farewell:t.tab.id});else if(typeof e.sendOptionCookie<"u")r({farewell:{ext_id:w.ext_id,ext_id_bh:w.ext_id,ext_auth:w.ext_auth,ext_auth_bh:w.ext_auth}});else if(typeof e.sendSourceInstall<"u")r({farewell:w.sourceInstall});else if(typeof e.submitTabID<"u")Xp(e.submitTabID),r({farewell:t.tab.id});else if(typeof e.checkTabID<"u")Yp(e.checkTabID),r({farewell:t.tab.id});else if(typeof e.checkSubscription<"u")r({farewell:Cp(e.checkSubscription)});else if(typeof e.sendStartTime<"u")r({farewell:Gp(e.sendStartTime)});else if(typeof e.tabAssignedHash<"u")r({farewell:w.tabAssignedHash});else if(typeof e.sendTabIDF<"u")r({farewell:t.tab.id});else if(typeof e.visitedEcomm<"u")Nr(e.visitedEcomm),r({farewell:"OK"});else if(e.monitorStart){let g=e.monitorStart;Kt(118,4,1,encodeURIComponent("ac start pair event  "+g),g,1)}else if(e.monitorEnd){let g=e.monitorEnd,O=g.split("~")[0],$=g.split("~")[1];Kt(118,4,1,encodeURIComponent("ac end pair event "+O+" using coupon "+$),O,-1)}else if(e.monitorEndFail){let g=e.monitorEndFail;Kt(118,4,-1,"ac end pair event no applied coupon "+g,g,-1)}else if(e.couponDisplayStart){let g=e.couponDisplayStart;Kt(121,4,1,encodeURIComponent("ac icon display start "+g),g,1)}else if(e.couponDisplayEnd){let g=e.couponDisplayEnd;Kt(121,4,1,encodeURIComponent("ac icon display end "+g),g,-1)}else if(e.interceptorWorkingStart){let g=e.interceptorWorkingStart;Kt(119,4,1,encodeURIComponent("interceptor working start event"+g),g,1)}else if(e.interceptorWorkingEnd){let g=e.interceptorWorkingEnd;Kt(119,4,1,encodeURIComponent("interceptor working end event"+g),g,-1)}else if(typeof e.showPush<"u")Ui[e.showPush]||(Ui[e.showPush]=1),r({farewell:"OK"});else if(typeof e.getMIFlashSale<"u")r({farewell:w.flashSale});else if(typeof e.sendSalesData<"u")r({farewell:"Done"}),await x.setItem("checkedArray",e.sendSalesData);else if(typeof e.getbhList<"u")typeof w.hashBL>"u"||w.hashBL==""||Object.keys(w.hashBL).length==0?r({farewell:""}):r({farewell:w.hashBL});else if(typeof e.sendbhList<"u")typeof w.hashBL>"u"||w.hashBL==""||Object.keys(w.hashBL).length==0?r({farewell:""}):(Id(w.hashBL),r({farewell:""}));else if(typeof e.clearbhList<"u")r({farewell:""}),await x.setItem("hashBL",""),await x.setItem("flagBL",0);else if(typeof e.email<"u")typeof w.ext_email>"u"||w.ext_email==""||Object.keys(w.ext_email).length==0?r({farewell:"No"}):r({farewell:w.ext_email});else if(typeof e.execJioSale<"u")t.tab.id,r({farewell:""});else if(typeof e.extName<"u")r({farewell:chrome.runtime.id});else if(typeof e.getTypesCurrent<"u")r({farewell:w.subsTypeSelected});else if(typeof e.setNotifType<"u")r({farewell:""}),await x.setItem("subsTypeSelected",e.setNotifType);else if(typeof e.subsType<"u")r({farewell:w.subsTypeSelected});else if(e.searchTesting)r({farewell:w.searchTesting});else if(typeof e.matchExists<"u")r({farewell:matchSelected});else if(typeof e.extId<"u")r({farewell:w.ext_id});else if(typeof e.fetchFeatures<"u")r({farewell:w.features_json});else if(typeof e.ext_auth<"u")r({farewell:w.ext_auth});else if(e.type=="GET_CURRENT_TAB")r({status:!0,id:t.tab.id,url:t.tab.url});else if(typeof e.regisDone<"u")r({status:!0}),await x.setItem("register",1);else if(typeof e.getCoupons<"u")e.getCoupons==2?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=111&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("http://www.myntra.com/?utm_source=buyhutke&utm_medium=aff")}):e.getCoupons==1?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=50&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("http://www.jabong.com/")}):e.getCoupons==3?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=129&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("http://www.snapdeal.com/?utm_source=aff_prog")}):e.getCoupons==4?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=1&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("http://www.ebay.in/")}):e.getCoupons==7?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=421&source=extension&ext1=pushA&ext2="+w.ext_id+"&link="+encodeURIComponent("http://www.shopclues.com/appliances-5/breakfast-appliances-offers.html?utm_medium=notification")}):e.getCoupons==10?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=99&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("http://www.infibeam.com/")}):e.getCoupons==8?chrome.tabs.create({url:"http://track.in.omgpm.com/?AID=368059&PID=11256&CID=3954200&MID=387804&r=http://shopping.indiatimes.com/"}):e.getCoupons==9?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=4&source=extension&ext1=auto-coupon&ext2="+w.ext_id+encodeURIComponent("http://www.homeshop18.com/?it_category=AP&it_action=WB-HSLOGO&it_label=AP-HSLOGO-140609131400-PR-WB-OT-MR-HS18_HomeShop18Logo&it_value=0")}):e.getCoupons==13?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=1289&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link=https%3A%2F%2Fwww.cleartrip.com"},function(g){}):e.getCoupons==15?chrome.tabs.create({url:"http://track.in.omgpm.com/?AID=368059&PID=9629&CID=3944269&MID=348512"}):e.getCoupons==16?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=1352&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link=http%3A%2F%2Fwww.dominos.co.in"}):e.getCoupons==17?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=1293&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("http://www.yatra.com/")}):e.getCoupons==18?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?tagType="+w.setTagType+"&pos=63&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("http://www.amazon.in/")}):e.getCoupons==19?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=1000&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("http://www.fabfurnish.com/")}):e.getCoupons==20?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=57&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("http://www.lenskart.com/")}):e.getCoupons==22?chrome.tabs.create({url:"https://track.in.omgpm.com/?AID=368059&PID=8422&CID=3944299&MID=218153"}):e.getCoupons==24?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=333&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("https://www.pepperfry.com/")}):e.getCoupons==26?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=429&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("http://www.zivame.com/")}):e.getCoupons==28?chrome.tabs.create({url:"https://t.buyhatke.com/Navigation/?pos=426&source=extension&ext1=auto-coupon&ext2="+w.ext_id+"&link="+encodeURIComponent("http://www.bluestone.com/")}):e.getCoupons==32&&chrome.tabs.create({url:"http://track.in.omgpm.com/?AID=368059&PID=10859&CID=3944292&MID=478605"}),chrome.tabs.update(parseInt(t.tab.id),{selected:!0}),od(e.getCoupons,t.tab.id);else if(!(typeof e.getCouponsData<"u")){if(typeof e.getDeals<"u")ld(e.getDeals,t.tab.id);else if(!(typeof e.pids<"u")){if(typeof e.processDONE<"u")wf(e.processDONE);else if(typeof e.savings<"u")wd(e.savings);else if(!(typeof e.pidsAmaz<"u")){if(!(typeof e.pidsMyn<"u")){if(!(typeof e.pidsJab<"u")){if(!(typeof e.pidsSnap<"u")){if(typeof e.pairsFlip<"u")le(e.pairsFlip,0);else if(typeof e.pairsGeneralise<"u"){let g=e.pairsGeneralise.actPos,{pairPos:O,currPos:$}=Un(g);le(e.pairsGeneralise.data,O)}else if(typeof e.currentGeneralise<"u"){let g=e.currentGeneralise.actPos,{pairPos:O,currPos:$}=Un(g);ce(e.currentGeneralise.data,$,t.tab.id)}else if(typeof e.dp<"u")Mt(e.dp);else if(typeof e.pairsPrettySecrets<"u")le(e.pairsPrettySecrets,433);else if(typeof e.pairsLandmark<"u")le(e.pairsLandmark,31);else if(typeof e.pairsPur<"u")le(e.pairsPur,26);else if(typeof e.pairsKoovs<"u")le(e.pairsKoovs,13);else if(typeof e.pairsEbay<"u")le(e.pairsEbay,-1);else if(typeof e.pairss19<"u")le(e.pairss19,15);else if(typeof e.pairsZovi<"u")le(e.pairsZovi,12);else if(typeof e.pairsFab<"u")le(e.pairsFab,20);else if(typeof e.pairsPepp<"u")le(e.pairsPepp,19);else if(typeof e.pairsCroma<"u")le(e.pairsCroma,9);else if(typeof e.pairsABOF<"u")le(e.pairsABOF,1850);else if(typeof e.pairsRediff<"u")le(e.pairsRediff,32);else if(typeof e.pairsRediffB<"u")le(e.pairsRediffB,35);else if(typeof e.pairsIndiatimes<"u")le(e.pairsIndiatimes,14);else if(typeof e.pairsHk<"u")le(e.pairsHk,17);else if(typeof e.pairsJewels<"u")le(e.pairsJewels,21);else if(typeof e.pairsZivame<"u")le(e.pairsZivame,18);else if(typeof e.pairsLens<"u")le(e.pairsLens,23);else if(typeof e.pairsZoom<"u")le(e.pairsZoom,27);else if(typeof e.pairsWatch<"u")le(e.pairsWatch,22);else if(typeof e.pairsDone<"u")le(e.pairsDone,28);else if(typeof e.pairsCilory<"u")le(e.pairsCilory,16);else if(typeof e.pairsTrendin<"u")le(e.pairsTrendin,24);else if(typeof e.pairsChumbak<"u")le(e.pairsChumbak,30);else if(typeof e.pairsShop<"u")le(e.pairsShop,29);else if(typeof e.pairsIndia<"u")le(e.pairsIndia,33);else if(typeof e.pairsNaap<"u")le(e.pairsNaap,36);else if(typeof e.pairsPaytm<"u")le(e.pairsPaytm,1429);else if(typeof e.pairsFree<"u")le(e.pairsFree,25);else if(typeof e.pairsCross<"u")le(e.pairsCross,34);else if(typeof e.pairsBaby<"u")le(e.pairsBaby,51);else if(typeof e.pairsBas<"u")le(e.pairsBas,44);else if(typeof e.curDataBas<"u")ce(e.curDataBas,44);else if(typeof e.pairsNGal<"u")le(e.pairsNGal,430);else if(typeof e.curDataNGal<"u")ce(e.curDataNGal,430);else if(typeof e.curDataPrettySecrets<"u")ce(e.curDataPrettySecrets,433);else if(typeof e.curDataFlip<"u")ce(e.curDataFlip,0);else if(typeof e.curDataAMS<"u")ce(e.curDataAMS,40);else if(typeof e.curDataBaby<"u")ce(e.curDataBaby,51);else if(typeof e.curDataPaytm<"u")ce(e.curDataPaytm,1429);else if(typeof e.curDataFree<"u")ce(e.curDataFree,25);else if(typeof e.curDataCross<"u")ce(e.curDataCross,34);else if(typeof e.curDataIndia<"u")ce(e.curDataIndia,33);else if(typeof e.curDataNaap<"u")ce(e.curDataNaap,36);else if(typeof e.curDataLandmark<"u")ce(e.curDataLandmark,31);else if(typeof e.curDataShop<"u")ce(e.curDataShop,29);else if(typeof e.curDataChumbak<"u")ce(e.curDataChumbak,30);else if(typeof e.curDataLens<"u")ce(e.curDataLens,23);else if(typeof e.curDataPur<"u")ce(e.curDataPur,26);else if(typeof e.curDataDone<"u")ce(e.curDataDone,28);else if(typeof e.curDataZoom<"u")ce(e.curDataZoom,27);else if(typeof e.curDataWatch<"u")ce(e.curDataWatch,22);else if(typeof e.curDataTrendin<"u")ce(e.curDataTrendin,24);else if(typeof e.curDataZovi<"u")ce(e.curDataZovi,12);else if(typeof e.curDataAMB<"u")ce(e.curDataAMB,1828);else if(typeof e.curDataNykaa<"u")ce(e.curDataNykaa,1830);else if(typeof e.curDataZansaar<"u")ce(e.curDataZansaar,1975);else if(typeof e.curDataEbay<"u")ce(e.curDataEbay,-1);else if(typeof e.curDataClovia<"u")ce(e.curDataClovia,1973);else if(typeof e.curDataMebel<"u")ce(e.curDataMebel,1972);else if(typeof e.curDataFNY<"u")ce(e.curDataFNY,1819);else if(typeof e.curDataLime<"u")ce(e.curDataLime,424);else if(typeof e.curDataUrbanLad<"u")ce(e.curDataUrbanLad,1827);else if(typeof e.curDataJewels<"u")ce(e.curDataJewels,21);else if(typeof e.curDataIndiatimes<"u")ce(e.curDataIndiatimes,14);else if(typeof e.curDataRediff<"u")ce(e.curDataRediff,32);else if(typeof e.curDataZivame<"u")ce(e.curDataZivame,18);else if(typeof e.curDataRediffB<"u")ce(e.curDataRediffB,35);else if(typeof e.curDataCilory<"u")ce(e.curDataCilory,16);else if(typeof e.curDatas19<"u")ce(e.curDatas19,15);else if(typeof e.curDataKoovs<"u")ce(e.curDataKoovs,13);else if(typeof e.curDataHS18<"u")ce(e.curDataHS18,6);else if(typeof e.curDataCroma<"u")ce(e.curDataCroma,9);else if(typeof e.curDataABOF<"u")ce(e.curDataABOF,1850);else if(typeof e.curDataInfi<"u")ce(e.curDataInfi,7);else if(typeof e.curDataFab<"u")ce(e.curDataFab,20);else if(typeof e.curDataPepp<"u")ce(e.curDataPepp,19);else if(typeof e.curDataHk<"u")ce(e.curDataHk,17);else if(typeof e.curDataSnap<"u")ce(e.curDataSnap,1);else if(typeof e.curDataShopClues<"u")ce(e.curDataShopClues,2);else if(typeof e.curDataAmaz<"u")ce(e.curDataAmaz,3);else if(typeof e.curDataJab<"u")ce(e.curDataJab,4);else if(typeof e.curDataShein<"u")ce(e.curDataShein,2362);else if(typeof e.curDataBanggood<"u")ce(e.curDataBanggood,2364);else if(typeof e.curDataVeromoda<"u")ce(e.curDataVeromoda,4423);else if(typeof e.curDataAdidas<"u")ce(e.curDataAdidas,2097);else if(typeof e.curDataDecathlon<"u")ce(e.curDataDecathlon,2335);else if(typeof e.curData2gud<"u")ce(e.curData2gud,6031);else if(typeof e.curDataMyvishal<"u")ce(e.curDataMyvishal,2372);else if(typeof e.curDataTatacliq<"u")ce(e.curDataTatacliq,2190);else if(typeof e.curDataAjio<"u")ce(e.curDataAjio,2191);else if(typeof e.curDataNykFas<"u")ce(e.curDataNykFas,6068);else if(typeof e.curDataPlumG<"u")ce(e.curDataPlumG,6069);else if(typeof e.curDataVoo<"u")ce(e.curDataVoo,2266);else if(typeof e.curDataMrVoo<"u")ce(e.curDataMrVoo,2267);else if(typeof e.curDataNetmeds<"u")ce(e.curDataNetmeds,2238);else if(typeof e.curData1mg<"u")ce(e.curData1mg,2237);else if(typeof e.curDataBook<"u")ce(e.curDataBook,311);else if(typeof e.curDataAcad<"u")ce(e.curDataAcad,1585);else if(typeof e.curDataSapnaonline<"u")ce(e.curDataSapnaonline,451);else if(typeof e.curDataNNNow<"u")ce(e.curDataNNNow,2192);else if(typeof e.curDataMyn<"u")ce(e.curDataMyn,5);else if(typeof e.curDataFn<"u")ce(e.curDataFn,11);else if(typeof e.pairsAmaz<"u")le(e.pairsAmaz,1);else if(typeof e.pairsMyn<"u")le(e.pairsMyn,2);else if(typeof e.pairsAMS<"u")le(e.pairsAMS,40);else if(typeof e.pairsJab<"u")le(e.pairsJab,3);else if(typeof e.pairsShein<"u")le(e.pairsShein,2362);else if(typeof e.pairsBanggood<"u")le(e.pairsBanggood,2364);else if(typeof e.pairsVeromoda<"u")le(e.pairsVeromoda,4423);else if(typeof e.pairsAdidas<"u")le(e.pairsAdidas,2097);else if(typeof e.pairsDecathlon<"u")le(e.pairsDecathlon,2335);else if(typeof e.pairs2gud<"u")le(e.pairs2gud,6031);else if(typeof e.pairsMyvishal<"u")le(e.pairsMyvishal,2372);else if(typeof e.pairsTatacliq<"u")le(e.pairsTatacliq,2190);else if(typeof e.pairsAjio<"u")le(e.pairsAjio,2191);else if(typeof e.pairsNykFas<"u")le(e.pairsNykFas,6068);else if(typeof e.pairsPlumG<"u")le(e.pairsPlumG,6069);else if(typeof e.pairsVoo<"u")le(e.pairsVoo,2266);else if(typeof e.pairsMrVoo<"u")le(e.pairsMrVoo,2267);else if(typeof e.pairsNetmeds<"u")le(e.pairsNetmeds,2238);else if(typeof e.pairs1mg<"u")le(e.pairs1mg,2237);else if(typeof e.pairsBook<"u")le(e.pairsBook,311);else if(typeof e.pairsAcad<"u")le(e.pairsAcad,1585);else if(typeof e.pairsSapnaonline<"u")le(e.pairsSapnaonline,451);else if(typeof e.pairsNNNow<"u")le(e.pairsNNNow,2192);else if(typeof e.pairsSnap<"u")le(e.pairsSnap,4);else if(typeof e.pairsFn<"u")le(e.pairsFn,11);else if(typeof e.pairsShopClues<"u")le(e.pairsShopClues,5);else if(typeof e.pairsHS18<"u")le(e.pairsHS18,6);else if(typeof e.pairsInfi<"u")le(e.pairsInfi,7);else if(typeof e.pairsNykaa<"u")le(e.pairsNykaa,1830);else if(typeof e.pairsZansaar<"u")le(e.pairsZansaar,1975);else if(typeof e.pairsClovia<"u")le(e.pairsClovia,1973);else if(typeof e.addToBlockList<"u")Kf(e.addToBlockList);else if(typeof e.removeFromBlockList<"u")zf(e.removeFromBlockList);else if(typeof e.getBlockList<"u")w.blockList!==void 0&&w.blockList!=""&&w.blockList!="null"&&w.blockList!="[]"&&w.blockList!="{}"&&Object.keys(w.blockList).length!=0?r({farewell:w.blockList}):r({farewell:"[]"});else if(typeof e.setTagType<"u")r({farewell:"[]"}),e.setTagType==1||e.setTagType=="1"?await x.setItem("setTagType",1):await x.setItem("setTagType","");else if(typeof e.getSessionKeyMMTInt<"u")r({farewell:Co});else if(typeof e.pairsMebel<"u")le(e.pairsMebel,1972);else if(typeof e.pairsFNY<"u")le(e.pairsFNY,1819);else if(typeof e.pairsLime<"u")le(e.pairsLime,424);else if(typeof e.pairsAMB<"u")le(e.pairsAMB,1828);else if(typeof e.pairsUrbanLad<"u")le(e.pairsUrbanLad,1827);else if(typeof e.removeURL<"u"){let g=e.removeURL,O=kd(g);O&&r({farewell:O})}else if(typeof e.removeOOS<"u"){let g=e.removeOOS,O=gd(g);O&&r({farewell:O})}else if(typeof e.detailArray<"u")Ye!=null&&Ye!="null"?r({farewell:Ye}):r({farewell:[]});else if(typeof e.offersArray<"u")hs!=null&&hs!="null"?(r({farewell:hs}),parseInt(104*Math.random())==1):r({farewell:[]});else if(typeof e.userSetting<"u")J("userSetting was called ",w.featuresArray),r({farewell:w.featuresArray});else if(typeof e.hashTable<"u")r({farewell:Qs});else if(typeof e.resultsTable<"u")r({farewell:Ys});else if(typeof e.watchListArray<"u")r({farewell:Ye});else if(typeof e.watchlistMap<"u")r({farewell:qa});else if(typeof e.updateWatchlist<"u")Ye=e.updateWatchlist,r({farewell:"success"});else if(typeof e.updateWatchlistMap<"u")qa=e.updateWatchlistMap,r({farewell:"success"});else if(typeof e.updateWatchlistMapKeyWise<"u"){let g=Object.keys(e.updateWatchlistMapKeyWise)[0],O=Object.values(e.updateWatchlistMapKeyWise)[0];qa[g]=O,r({farewell:"success"})}else if(typeof e.hasGiven<"u")Ji=e.hasGiven,r({farewell:"success"}),await x.setItem("hasGiven",Ji);else if(typeof e.userName<"u")Bi=e.userName,r({farewell:"success"}),await x.setItem("userName",Bi);else if(typeof e.reqSent<"u")Fi=e.reqSent,r({farewell:"success"}),await x.setItem("reqSent",Fi);else if(typeof e.userID<"u")ru=e.userID,r({farewell:"success"});else if(typeof e.updateIsVerified<"u")isVerified=e.isVerified,r({farewell:"success"}),await x.setItem("isVerified",isVerified);else if(typeof e.isVerified<"u")r({farewell:w.isVerified});else if(typeof e.updateWatchListArray<"u")Ye=e.updateWatchListArray,r({farewell:"success"});else if(typeof e.watchStockAlert<"u")J("Watch Stock Alert response sent",mr),r({farewell:mr});else if(typeof e.ixigoVar<"u")r({farewell:w.lastTime});else if(typeof e.ixigoVarSet<"u")w.lastTime=e.ixigoVarSet;else if(typeof e.sentClient_Id<"u"){if(w.tokenSent==0){await x.setItem("tokenSent",1);var v=e.sentClient_Id;try{await ge("UniversalLog",{client_id:v,type:"info",action:"UPDATE_DATA",value:"extension",dev_id:w.ext_id,token:w.pushToken})}catch{}}}else if(typeof e.eccomVisit<"u")w.visited==""||w.visited==null||isNaN(w.visited)?await x.setItem("visited",1):await x.setItem("visited",parseInt(w.visited)+1),w.visited==3;else if(typeof e.saleArray<"u")r({farewell:Yu});else if(typeof e.saleVariables<"u")r({farewell:w.saleStarted});else if(typeof e.saleDate<"u")r({farewell:w.saleDate});else if(typeof e.sendNewPush<"u")Ad(),r({farewell:"OK"});else if(typeof e.refreshedYet<"u")r({farewell:w.refreshedYet+"~"+w.refreshedYetServer});else if(typeof e.getCurrentOffset<"u")r({farewell:w.diffTime});else if(typeof e.getInstructions<"u")r({farewell:w.instructions});else if(typeof e.getFlashSalesData<"u")r({farewell:w.existingSales});else if(typeof e.getCheckedSales<"u")r({farewell:w.checkedArray});else if(typeof e.subscribedFor<"u"){var l=JSON.parse(w.saleArray);l.length==0?r({farewell:"NONE"}):r({farewell:w.subscribedFor})}else if(typeof e.setSaleVariables<"u")r({farewell:"Success"}),await x.setItem("saleStarted",2),await x.setItem("saleFinished",5),await x.setItem("mostSensitive",0);else if(typeof e.setRefreshedYet<"u")r({farewell:"Success"}),await x.setItem("refreshedYet",1);else if(typeof e.ext_id<"u")r({farewell:w.ext_id+"~"+w.ext_auth});else if(typeof e.addEmail<"u"){await x.setItem("ext_email",e.addEmail);var k="https://compare.buyhatke.com/extension/addEmailExt.php",y="email="+encodeURIComponent(e.addEmail)+"&ext_id="+w.ext_id+"&auth_val="+w.ext_auth,_=await Ae(k,"POST",y,"formData")}}}}}}}if(e.message=="user_details"){var T=[];T=[{ext_id:w.ext_id,auth_val:w.ext_auth,email:encodeURIComponent(w.ext_email)}],T=JSON.stringify(T),r({farewell:T})}else if(e.message=="check_email_verified")w.verifiedExt&&w.verifiedExt=="1"&&dd(0),r({farewell:w.verifiedExt});else if(e.message=="alertList")r({identity:Ye});else if(e.message=="getVersion")r({farewell:w.version});else if(e.message=="featuresArray")r({farewell:w.featuresArray});else if(e.message=="importWL")r({farewell:w.wishListJson});else if(e.message=="getAddress")r({farewell:w.addressarray});else if(e.updateImportWL)r({farewell:"OK"}),await x.setItem("wishListJson",e.updateImportWL);else if(e.updateAddressArray)r({farewell:"OK"}),await x.setItem("addressarray",e.updateAddressArray);else if(e.actionFeaturesArr)r({farewell:"OK"}),await x.setItem("featuresArray",e.actionFeaturesArr);else if(e.actionCreateWishList)r({identity:"OK"}),await x.setItem("mywishlist",mywishlist);else if(e.actionMyWishList)r({farewell:"OK"}),await x.setItem("mywishlist",e.actionMyWishList);else if(e.message=="getEbayDetails"){var E=w.bankBox1+"~*~"+w.bankBox2+"~*~"+w.bankBox3+"~*~"+w.bankBox4+"~*~"+w.phoneNo+"~*~"+w.emailEbay+"~*~"+w.myName;r({farewell:E})}else if(e.updateWL)r({farewell:"OK"}),await x.setItem("mywishlist",e.updateWL);else if(e.updatePushNot)r({farewell:"OK"}),await x.setItem("pushNotStore",e.pushNotStore);else if(e.updatePromo)r({farewell:"OK"}),await x.setItem("promoPushArray",e.updatePromo);else if(e.message=="clearPushNot")r({farewell:"OK"}),await x.setItem("pushNotStore","");else if(e.message=="getPromoDetails")r({farewell:w.promoPushArray});else if(e.message==="openTab"&&e.url)chrome.tabs.create({url:e.url});else if(e.message=="getPriceAlertsInit")if(Ye!=null&&Ye!=null&&Ye!="null"){let g=await Ft();r({farewell:g||[]})}else r({farewell:"[]"});else e.message=="getPushNot"&&r({farewell:w.pushNotStore})}catch(g){R("addlistener",g),J("Error at addListener ",g),r({status:!1})}}return i(),!0})}catch(e){R("checkIcons",e),J("Error at checkIcons ",e)}}Qf();chrome&&chrome.notifications&&chrome.notifications.onButtonClicked&&chrome.notifications.onButtonClicked.addListener(function(e,t){if(J("here9 ",e),ir[e]!==void 0){var r=ir[e].listeners.onButtonClicked;_t.destroyNotification(e,r(t))}else Ci[e]&&t==0?(targetURL=Ci[e],Mt("button-clicked-"+qs[e])):t==1?(targetURL="https://compare.buyhatke.com/options/",Mt("button-unsubscribed-"+qs[e])):targetURL="",targetURL!=""?chrome.tabs.create({url:targetURL}):Mt("button-error-"+qs[e]),chrome.notifications.clear(e,function(){})});chrome&&chrome.notifications&&chrome.notifications.onClosed&&chrome.notifications.onClosed.addListener(async function(e,t){var i,a;if(J("here10 ",e),ir[e]!==void 0){var r=(a=(i=ir[e])==null?void 0:i.listeners)==null?void 0:a.onClosed;_t.destroyNotification(e,r(t))}await ge("notiClosed")});chrome&&chrome.notifications&&chrome.notifications.onClicked&&chrome.notifications.onClicked.addListener(yd);async function Vl(){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");var e="https://compare.buyhatke.com/options/flashSaleNew.json",t="ext_id="+w.ext_id+"&auth_val="+w.ext_auth,r=await Ae(e,"GET",t);r!=""&&r.trim()!="Authentication Failed!"&&JSON.parse(r).length!=0&&await x.setItem("existingSales",r)}catch(i){R("getFlashSales",err),J("Error getFlashSale ",i)}}Vl();setTimeout(async()=>{await Vl()},12e3*3600);async function Wl(){try{w.existingSales=await x.getItem("existingSales")||"[]",w.checkedArray=await x.getItem("checkedArray")||"{}",w.openTimeHash=await x.getItem("openTimeHash")||"{}",w.tabAssignedHash=await x.getItem("tabAssignedHash")||"{}";let e=w.existingSales,t=w.checkedArray,r=w.openTimeHash,i=w.tabAssignedHash;try{e=e?JSON.parse(e):[]}catch(a){console.error("Error parsing existingSales:",a),e=[]}try{t=t?JSON.parse(t):{}}catch(a){console.error("Error parsing checkArray:",a),t={}}try{r=r?JSON.parse(r):{}}catch{r={}}try{i=i?JSON.parse(i):{}}catch{i={}}Array.isArray(e)||(e=[]);for(let a=0;a<e.length;a++)if(Array.isArray(e[a]))for(let s=0;s<e[a].length;s++){const o=e[a][s];if(!o||!o.code||!o.time||!o.url)continue;const l=o.code;if(t[l]===!0){const c=o.time*1e3-Math.round(+new Date);if(c<6e5&&c>-3e5){const d=`${o.time}~${l}`;r[d]||(await chrome.windows.create({url:o.url},async function(f){var u,I,k,y;let p=((I=(u=f==null?void 0:f.tabs)==null?void 0:u[0])==null?void 0:I.url)||"";p=p.split("~#")[1]||d,i[p]=(y=(k=f==null?void 0:f.tabs)==null?void 0:k[0])==null?void 0:y.id,await x.setItem("tabAssignedHash",JSON.stringify(i))}),r[d]=!0)}}}await x.setItem("openTimeHash",JSON.stringify(r))}catch(e){R("checkFlashSales",e)}}Wl();setTimeout(async function(){await Wl()},5e3);async function Gf(){try{var e="https://compare.buyhatke.com/getCookie.php",t=await Ae(e,"GET",null);t&&await x.setItem("sourceInstall",t)}catch(r){R("checkSource",r),J("Error checkSource ",r)}}Gf();async function Cf(e){try{var t=w.features_json;t=JSON.parse(t),t[e]=1,await x.setItem("features_json",JSON.stringify(t))}catch(r){R("features1",r),J("Error features1 ",r)}}function qf(e){try{return new URL(e),!0}catch{return!1}}async function eh(e){try{Object.keys(Nn).length==0&&await Ip();let t,r;try{r=new URL(e).hostname.replace(/^www\./,"")}catch{return e}let i=Nn[r];if(i||(i={}),i.hasOwnProperty("urlSuffix")&&(e=e+i.urlSuffix),i.hasOwnProperty("urlPrefix")&&(e=i.urlPrefix+e),i.hasOwnProperty("replaceConfig"))for(let c of i.replaceConfig)try{e=e.replaceAll(c.replace,c.replaceWith)}catch{}let a=await fetch(e),s=a.url,o=await a.text(),l=i.pidFromResponse?o:s;if(i.hasOwnProperty("urlRegex")){let c=i.urlRegex;for(let d of c)try{let f=1;d.hasOwnProperty("match")&&(f=d.match);let p;if(d.hasOwnProperty("global")?p=l.match(new RegExp(d.regex,"g"))[f]:p=l.match(new RegExp(d.regex))[f],p!=null&&p!=""){l=p;break}}catch{}}return l&&qf(l)?(l=encodeURIComponent(l),l.trim()):e}catch{return e}}async function th(){try{let e=[],r=await fetch("https://ext1.buyhatke.com/extension-apis/fetchUrls");if(r.status>=400&&r.status<=599)throw new Error("status: "+r.status);if(r=await r.json(),r.status==0)return;let i=r.urls;i=await JSON.parse(i);let a;for(let l=0;l<i.length;l++){const{id:c,url:d}=i[l];let f="";try{a=await eh(d)}catch{}e.push({id:c,pid:a})}const o=await fetch("https://ext1.buyhatke.com/extension-apis/getPIDSfromURL",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(e){R("getPIDFromUrl",e),J(e)}}setInterval(async()=>{await th()},60*60*1e3);async function ah(){try{let t=await fetch("https://ext1.buyhatke.com/extension-apis/fetchUrlForDeals");if(t.status>=400&&t.status<=599)throw new Error("status: "+t.status);if(t=await t.json(),!t||t.status!=="success"||!t.url)return;let r;try{if(r=await fetch(t.url,{method:"GET",redirect:"follow"}),!r.ok)return;let i=await r.text();const s=await fetch("https://4c8a9e7a.buyhatke.com/spidy/telegramDeals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:t.url,id:t.id,pos:t.pos,html:i})})}catch{}}catch(e){R("getPriceFromURL",e),J(e)}}setInterval(async()=>{await ah()},2*60*60*1e3);async function rh(){var e,t;try{(!Dn||!Ln)&&await _a();let r=await fetch(Dn);if(r=await r.json(),!r){await x.setItem("isLoggedIn",!1);return}if(r!=null&&r.user&&((t=(e=r==null?void 0:r.user)==null?void 0:e.subscription_tier)!=null&&t.includes(Ln))){await x.setItem("isLoggedIn",!0);return}else{await x.setItem("isLoggedIn",!1);return}return}catch{return}}async function sh(){try{let e=await x.getItem("ext_id"),t=await x.getItem("ext_auth");if(!await x.getItem("isLoggedIn"))return;let i=`https://settings.buyhatke.com/extension-settings/fURLP?ext_id=${e}&ext_auth=${t}`,a=await fetch(i);if(a.status>=400&&a.status<=599)throw new Error("status: "+a.status);if(a=await a.json(),!a||a.status!=1||!a.id||!a.jid||!a.data)return;let s=a.id,o=a.jid,l=a.append,c=a.data,d=c;if(l==1){let p=`https://search-new.bitbns.com/extension/configs-ext/prod/jobs/job${o}.txt`,u=await fetch(p);if(u.status>=400&&u.status<=599)throw new Error("status: "+u.status);u=await u.text(),d=u+c}let f;try{if(f=await Bf(d),!f)return;const u=await fetch("https://settings.buyhatke.com/extension-settings/sendPNewVP",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id,job_id:a.jid,response:f})})}catch{}}catch(e){J(e)}}setInterval(async()=>{await sh()},1*60*60*1e3);async function nh(){try{let e=await x.getItem("ext_id"),t=await x.getItem("ext_auth"),r=`https://settings.buyhatke.com/extension-settings/fetchURL?ext_id=${e}&ext_auth=${t}`,i=await fetch(r);if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);if(i=await i.json(),i.status==0)return;let a=JSON.parse(i.urls),{id:s,pid:o,pos:l,image:c}=a[0],d=await tc(c,l),f=await jl(d);if(f){let I=await fetch(f);I=await I.text(),I&&(d+="**exact-html=>"+I)}postData={id:s,pid:o,pos:l,html:d};const u=await fetch("https://ext1.buyhatke.com/extension-apis/sendDittoHTML",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(postData)})}catch(e){R("fetchURLS",e),J(e)}}setInterval(async()=>{await nh()},4*60*60*1e3);async function Kl(){try{(!Gr||!lr||!Cr)&&await _a();let e=(await chrome.storage.local.get("chEn")).chEn;if(e&&await Es("Check if ready?"),e)return;let t=await x.getItem("ext_id"),r=await x.getItem("ext_auth"),i=`https://settings.buyhatke.com/extension-settings/fetchPNewV2?ext_id=${t}&ext_auth=${r}`,a=await fetch(i);if(a.status>=400&&a.status<=599)throw new Error("status: "+a.status);if(a=await a.json(),a.status==0)return;let s=a.id,o=a.jid,l=a.append,c=a.data,d=c;if(l==1){let k=`https://search-new.bitbns.com/extension/configs-ext/prod/jobs/job${o}.txt`,y=await fetch(k);if(y.status>=400&&y.status<=599)throw new Error("status: "+y.status);y=await y.text(),d=y+c}let f=await Es([d]);const I=await fetch("https://settings.buyhatke.com/extension-settings/sendPNewV2",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s,j_id:o,data:f})})}catch(e){J(e)}}setInterval(async()=>{await Kl()},1*60*60*1e3);setInterval(async()=>{await zl()},1*60*60*1e3);async function zl(){try{(!Gr||!lr||!Cr)&&await _a();let e=(await chrome.storage.local.get("chEn")).chEn;if(e&&await Es("Check if ready?"),e)return;let t=await x.getItem("ext_id"),r=await x.getItem("ext_auth"),i=`https://settings.buyhatke.com/extension-settings/fetchPNewV2chat?ext_id=${t}&ext_auth=${r}`,a=await fetch(i);if(a.status>=400&&a.status<=599)throw new Error("status: "+a.status);if(a=await a.json(),a.status==0)return;let s=a.id,o=a.jid,l=a.append,c=a.data,d=c;if(l==1){let k=`https://search-new.bitbns.com/extension/configs-ext/prod/jobs/job${o}.txt`,y=await fetch(k);if(y.status>=400&&y.status<=599)throw new Error("status: "+y.status);y=await y.text(),d=y+c}let f=await Es([d]);const I=await fetch("https://settings.buyhatke.com/extension-settings/sendPNewV2chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s,j_id:o,data:f})})}catch(e){J(e)}}async function ih(){try{let e=await x.getItem("currentMonitorData"),t=JSON.parse(e??"[]");if(t.length>0){let r=`https://ext1.buyhatke.com/extension-apis/currentMonitor?extId=${w.ext_id}&extAuth=${w.ext_auth}`,i=await fetch(r,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)});return i.ok&&(i=await i.json(),i.status==1&&await x.removeItem("currentMonitorData")),""}}catch(e){return R("clearCurrentMonitorData",e),J(e),""}}setInterval(async()=>{await ih()},1e3*60*5);async function oh(e){try{let t=await x.getItem("currentMonitorData"),r=JSON.parse(t??"[]");r.push(e),await x.setItem("currentMonitorData",JSON.stringify(r))}catch(t){return R("setCurrentMonitorData",t),J(t),""}}async function Zl(){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let e=await x.getItem("featureMonitorData"),t=JSON.parse(e??"[]");if(t.length>0){let r=`https://ext1.buyhatke.com/extension-apis/featureMonitor?extId=${w.ext_id}&extAuth=${w.ext_auth}`,i=await fetch(r,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)});return i.ok&&(i=await i.json(),i.status==1&&await x.removeItem("featureMonitorData")),""}}catch(e){return R("clearFeatureMonitorData",e),J(e),""}}Zl();setInterval(async()=>{await Zl()},1e3*60*5);async function lh(e){try{let t=await x.getItem("featureMonitorData"),r=JSON.parse(t??"[]");r.push(e),await x.setItem("featureMonitorData",JSON.stringify(r))}catch(t){return R("setFeatureMonitorData",t),J(t),""}}async function ch(){let e=await x.getItem("ext_id"),t=await x.getItem("ext_auth"),r="ext_id="+e+"&auth_val="+t;In=await Ae("https://api.buyhatke.com/paapi/showStockAlerts","POST",r,"formData")}ch();async function uh(e){try{let t=await x.getItem("ACTSMonitorData"),r=JSON.parse(t??"[]");r.push(e),x.setItem("ACTSMonitorData",JSON.stringify(r))}catch(t){return R("setACTSMonitorData",t),J(t),""}}async function dh(e,t){try{const r={};for(const o of e)if(o.clubID&&o.ACanalytics){const l=o.clubID;r[l]||(r[l]=[]),r[l].push(o.ACanalytics)}const i={ext_id:String(t)};for(const o of Object.keys(r)){const l={};for(const d of r[o])Object.keys(d).forEach(f=>{const p=f;l[p]||(l[p]=0),l[p]+=d[f]||0});const c=Object.keys(l).map(d=>({stage:d,count:l[d]}));i[o]={stages:c}}const a=await fetch("https://ext1.buyhatke.com/extension-apis/analytics/track/Auto_Coupon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok)throw new Error(`API call failed for pos ${pos}: HTTP ${a.status}`);const s=await a.json();if(s.status!=1)throw new Error(`API call failed for pos ${pos}: Response ${JSON.stringify(s)}`);return}catch{return}}async function ph(e,t){try{for(const r of e)if(r.clubID&&r.ACAnalyticsValue){const i=r.clubID,a=r.ACAnalyticsValue,s={};a.each_coupon_apply!==void 0&&(s.each_coupon_apply=a.each_coupon_apply),a.time_taken!==void 0&&(s.time_taken=a.time_taken),a.event_type!==void 0&&(s.event_type=a.event_type),a.savings!==void 0&&(s.savings=a.savings);const o={ext_id:t,pos:i,...a.id!==void 0&&{id:a.id},stages:s};try{const l=await fetch("https://ext1.buyhatke.com/extension-apis/analytics/track/Auto_Coupon/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!l.ok||(await l.json()).status!=1)continue}catch{continue}}return}catch{return}}async function Xl(){try{let e=await x.getItem("ext_id"),t=await x.getItem("ACTSMonitorData"),r=JSON.parse(t??"[]");if(r.length>0)try{await dh(r,e),await ph(r,e),await x.removeItem("ACTSMonitorData")}catch{await x.removeItem("ACTSMonitorData")}}catch(e){return R("clearACTSMonitorData",e),J(e),""}}Xl();setInterval(Xl,30*60*1e3);async function Yl(e){try{let t=await x.getItem("countMoniorData"),r=JSON.parse(t??"[]");r.push(e),x.setItem("countMoniorData",JSON.stringify(r))}catch(t){return R("setCountMonitorData",t),J(t),""}}async function Ql(){try{let e=await x.getItem("countMoniorData"),t=JSON.parse(e??"[]");t.length>0&&await ci("https://ext1.buyhatke.com/monitoring-system/monitor/count/listen",t)==1&&x.removeItem("countMoniorData")}catch(e){return R("clearCountMonitorData",e),J(e),""}}Ql();setInterval(Ql,30*60*1e3);async function R(e,t,r=void 0){let i={funcName:e,error:t.message?t.message:t.error,url:r},a={eventID:12,errorSource:"service_worker",errorDetails:JSON.stringify(i)};await ur(a)}async function ur(e){try{let t=await x.getItem("errorMonitorData"),r=JSON.parse(t??"[]");r.push(e),x.setItem("errorMonitorData",JSON.stringify(r))}catch(t){return R("logMonitorData",t),J(t),""}}async function Gl(){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let t=await(await fetch(`https://ext1.buyhatke.com/spend-apis/verification/keyEnc?extId=${w.ext_id}&extAuth=${w.ext_auth}`)).json();t.status&&t.keyEnc&&t.keyTime&&await chrome.storage.local.set({keyEnc:t.keyEnc,keyTime:t.keyTime})}catch{}}async function Cl(){try{let e=await x.getItem("errorMonitorData"),t=JSON.parse(e??"[]");t.length>0&&await ci("https://ext1.buyhatke.com/monitoring-system/monitor/errorlog/listen",t)==1&&x.removeItem("errorMonitorData")}catch(e){return R("clearErrorMonitorData",e),J(e),""}}Cl();setInterval(Cl,30*60*1e3);async function fh(e){try{let t=await x.getItem("apiMonitorData"),r=JSON.parse(t??"[]");r.push(e),x.setItem("apiMonitorData",JSON.stringify(r))}catch(t){return R("monitorApiResponseTime",t),J(t),""}}async function ql(){try{let e=await x.getItem("apiMonitorData"),t=JSON.parse(e??"[]");t.length>0&&await ci("https://ext1.buyhatke.com/monitoring-system/monitor/responsetime/listen",t)==1&&x.removeItem("apiMonitorData")}catch{return""}}ql();setInterval(ql,30*60*1e3);async function ci(e,t){try{if(!Array.isArray(t))throw Error("Please Provide errEventData in correct Format");t={data:t};let r=await Ae(e,"POST",t,"json");if(r=JSON.parse(r),r.status==1)return r.status;throw Error(r.msg)}catch{throw Error("Error in calling API")}}async function hh(e){try{await fetch("https://ext1.buyhatke.com/extension-apis/groceryCheckout?siteName="+e)}catch{}}async function yh(){try{let e=await x.getItem("ext_id"),t=await x.getItem("ext_auth");return{extId:e,extAuth:t}}catch{return{extId:"",extAuth:""}}}async function ec(e,t){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let r=`https://ext1.buyhatke.com/spend-apis/spend-logs/logError?extId=${w.ext_id}&extAuth=${w.ext_auth}`,i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pos:e,error:t})})}catch(r){R("spendErrorLog",r)}}async function As(e){try{const r=await fetch(e,{method:"GET"});if(!r.ok)throw new Error("Network response was not ok "+r.statusText);return await r.text()}catch{}}async function tc(e,t){try{let r=await ul(),i="en-IN";r.hasOwnProperty(t)&&(i=r[t].countryCode);let a=await fetch("https://search-new.bitbns.com/buyhatke/getDittoSearchDomain",{method:"GET"});a=await a.json();let o=`${a.domain}/uploadbyurl?url=${e}?q=70&re=df&st=1722243143407&vpw=1413&vph=331&ep=gisbubu&hl=${i}`;const l=await fetch(o,{method:"GET",redirect:"follow"});if(!l.ok)throw new Error("Network response was not ok "+l.statusText);return await l.text()}catch{}}async function mh(e,t){try{let r=await fetch("https://blinkit.com/v2/services/secondary-data?filter=new_offer,show_product_group_sharing,is_new_user,cart_ab_test_variant,city_id,sku_auto_add,cart_banner_image,show_referral_login,product_sku_limit&offers_last_visit_ts=0",{headers:{app_client:"consumer_web",app_version:"52434332",lat:e,lon:t}});return r=await r.json(),r.analytics_properties.merchant_id}catch{return""}}async function wh(e,t){try{let i=await fetch("https://www.swiggy.com/api/instamart/home/select-location",{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36"},body:JSON.stringify({data:{lat:e,lng:t}})});return i=await i.json(),i.data.storeId}catch{return""}}async function bh(e,t){try{let r=await fetch(`https://api.zepto.co.in/api/v1/config/layout/?latitude=${e}&longitude=${t}&page_type=HOME&version=v2&show_new_eta_banner=true`,{headers:{Appversion:"11.0.0-WEB"}});return r=await r.json(),r.storeServiceableResponse.storeId}catch{return""}}async function Ih(e){var t,r;try{let i={...Qr.zepto_place_id_api},a=i.url.replace("{place_id}",encodeURIComponent(e)),s=await Na(i,a),o=JSON.parse(s);return(r=(t=o==null?void 0:o.result)==null?void 0:t.geometry)!=null&&r.location?{latitude:o.result.geometry.location.lat,longitude:o.result.geometry.location.lng}:{}}catch{return{}}}async function gh(e,t){var r;try{let i={...Qr.zepto_geocode},a=i.url.replace("{latitude}",encodeURIComponent(e)).replace("{longitude}",encodeURIComponent(t)),s=await Na(i,a),o=JSON.parse(s);return((r=o==null?void 0:o.results)==null?void 0:r.length)>0?{placeId:o.results[0].place_id,address:o.results[0].formatted_address}:{}}catch{return{}}}async function kh(e){try{let{latitude:t,longitude:r,place_id:i}=e,a=!1;if(!t&&!r){if(!i)return;let p=await Ih(i);t=p.latitude,r=p.longitude,a=!0}let s=await gh(t,r),{placeId:o,address:l}=s,c=await mh(t,r),d=await wh(t,r),f=await bh(t,r);return{blinkitStoreId:c,instamartStoreId:d,zeptoStoreId:f,placeId:o,latitude:t,longitude:r,updateLatLong:a,address:l}}catch{return{}}}async function xh(e){try{let t={...Qr.address_suggestion},r=t.url.replace("{query}",encodeURIComponent(e));const i=await Na(t,r);return JSON.parse(i)}catch{return[]}}async function vh(){try{let e=Math.random()<.5?1:2;Object.keys(Qr).length==0&&await dl();let t=await x.getItem("version");switch(e){case 1:let r=`https://ext1.buyhatke.com/extension-apis/fetchLocationInfo?version=${t}`,i=await fetch(r);if(i.status>=400&&i.status<=599)throw new Error("status: "+i.status);if(i=await i.json(),i.status==0)return;let a=i.data;a=JSON.parse(a);let s=a.id,o=await kh(a);if(!o)return;let{placeId:l,latitude:c,longitude:d,updateLatLong:f,address:p}=o,u={id:s,storeIds:{blinkitStoreId:o.blinkitStoreId,instamartStoreId:o.instamartStoreId,zeptoStoreId:o.zeptoStoreId},placeId:l,latitude:c,longitude:d,updateLatLong:f,address:p};await fetch(`https://ext1.buyhatke.com/extension-apis/insertStoreIds?version=${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});break;case 2:let I=`https://ext1.buyhatke.com/extension-apis/fetchPlaceName?version=${t}`,k=await fetch(I);if(k.status>=400&&k.status<=599)throw new Error("status: "+k.status);if(k=await k.json(),k.status==0)return;let y=k.data;y=JSON.parse(y);let{id:b,query:h}=y,m=await xh(h),A={idQuery:b,address_suggestions:m};await fetch(`https://ext1.buyhatke.com/extension-apis/insertSuggestions?version=${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(A)});break}}catch(e){R("getPIDFromUrl",e),J(e)}}async function Ah(){try{let e=await fetch("https://ext1.buyhatke.com/spend-apis/googleAnalytics/events/spendButtonClicked");if(e.status>=400&&e.status<=599)throw new Error("status: "+e.status);return e=await e.json(),e.data.count||9}catch(e){return R("Error in getUserUsedSpendCount",e),9}}async function ac(){try{let e=await x.getItem("ext_id"),t=await x.getItem("ext_auth"),r=await fetch(`https://ext1.buyhatke.com/spend-apis/referrals/getReferralCode?extId=${e}&extAuth=${t}`);if(r.status>=400&&r.status<=599)throw new Error("status: "+r.status);let i=await r.json();if(i.status&&i.data){let{code:a}=i.data;return a}else return""}catch(e){return R("Error in fetchReferralCode",e),""}}async function Th(){try{let e=await x.getItem("ext_id"),t=await x.getItem("ext_auth"),r=await fetch(`https://ext1.buyhatke.com/spend-apis/referrals/getReferralInfo?extId=${e}&extAuth=${t}`);if(r.status>=400&&r.status<=599)throw new Error("status: "+r.status);return await r.json()}catch(e){return R("Error in getReferralInfo",e),{status:0,err:"Something went wrong."}}}const _h=async e=>{try{if(!e)return{status:0,err:"Referral code is empty"};const t=new URLSearchParams,r="https://ext1.buyhatke.com/spend-apis/referrals/setReferral";let i=await x.getItem("ext_id"),a=await x.getItem("ext_auth");t.append("extId",i),t.append("extAuth",a),t.append("code",e);const s=await fetch(r,{method:"POST",body:t,headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"})});return s.ok?await s.json():{status:0,err:(s==null?void 0:s.statusText)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}};async function Sh(){try{const e=await x.getItem("ext_id"),t=await x.getItem("ext_auth"),r=await x.getItem("userCountry")??"India";let i="https://ext1.buyhatke.com/extension-apis/savings-api/socialProofData";e&&t&&(i=i+`?country=${r}`);const a=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)return{status:0,err:(a==null?void 0:a.statusText)||"Something went wrong."};const s=await a.json();return s.status==1?s:{status:0,err:(s==null?void 0:s.msg)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}}async function Ph(e,t,r,i){try{const a=await x.getItem("ext_id"),s=await x.getItem("ext_auth");let o="https://ext1.buyhatke.com/extension-apis/feedback/sendFeedback";const l=new URLSearchParams;l.append("type","1"),l.append("platform","0"),l.append("extId",a),l.append("extAuth",s),l.append("value",e),t&&l.append("comment",t),r&&l.append("source",r),i&&l.append("url",i);const c=await fetch(o,{method:"POST",body:l,headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"})});return c.ok?await c.json():{status:0,err:(c==null?void 0:c.statusText)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}}async function Oh(){try{const e=await x.getItem("ext_id"),t=await x.getItem("ext_auth"),r=await fetch(`https://ext1.buyhatke.com/spend-apis/login/loggedIn?extId=${e}&extAuth=${t}`,{method:"GET"});return r.ok?await r.json():{status:0,err:(r==null?void 0:r.statusText)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}}async function Dh(){try{const t=await fetch("https://ext1.buyhatke.com/spend-apis/login/gLogin",{method:"POST"});return t.ok?await t.json():{status:0,err:(t==null?void 0:t.statusText)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}}async function Lh(){try{const e=await x.getItem("telegramConnectData");if(e&&e.connectStatus)return{status:1,data:e};const t=await x.getItem("ext_id"),r=await x.getItem("ext_auth");let i=`https://ext1.buyhatke.com/extension-apis/telegramBot/connectStatus?extId=${t}&extAuth=${r}&platform=0`;const a=await fetch(i,{method:"GET"});if(!a.ok)return{status:0,err:(a==null?void 0:a.statusText)||"Something went wrong."};const s=await a.json();return s.status&&s.data.connectStatus&&x.setItem("telegramConnectData",s.data),s}catch{return{status:0,err:"Something went wrong."}}}async function Eh(e){try{const t=`https://search-new.bitbns.com/buyhatkeAdStatic/ads/adsList?slotId=${e}`,r=await fetch(t,{method:"GET"});return r.ok?await r.json():{status:0,err:(r==null?void 0:r.statusText)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}}async function Nh(e){try{const t=await x.getItem("ext_id"),r=await x.getItem("ext_auth"),i=await x.getItem("userCity"),a={...e,extId:t,location:i||""},o=await fetch("https://search-new.bitbns.com/buyhatkeAdDashboard/track/impression",{method:"POST",body:JSON.stringify(a),headers:new Headers({"Content-Type":"application/json"})});return o.ok?await o.json():{status:0,err:(o==null?void 0:o.statusText)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}}async function Mh(e){try{const t=await x.getItem("ext_id"),r=await x.getItem("ext_auth"),i=await x.getItem("userCity"),a={...e,extId:t,location:i||""},o=await fetch("https://search-new.bitbns.com/buyhatkeAdDashboard/track/click",{method:"POST",body:JSON.stringify(a),headers:new Headers({"Content-Type":"application/json"})});return o.ok?await o.json():{status:0,err:(o==null?void 0:o.statusText)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}}async function Rh(e){if(!e)return;const t="0",r="",i=Date.now()+Math.floor(Math.random()*1e9),a=e.replace("${GDPR}",t).replace("${GDPR_CONSENT_78}",r).replace("[CACHEBUSTER]",i.toString());fetch(a,{method:"GET",mode:"no-cors"})}async function jh(){try{const e="https://t.me/Buyhatke_Alert_bot",t=await x.getItem("ext_id"),r=await x.getItem("ext_auth"),i=`extId=${t}##extAuth=${r}##platform=0`,a=btoa(i);return`${e}?start=${a}`}catch{return"https://t.me/Buyhatke_Alert_bot"}}async function Uh(e){try{const t="https://search-new.bitbns.com/buyhatke/thunder/priceData",r=JSON.stringify({param:e}),i=await fetch(t,{method:"POST",body:r,headers:new Headers({"Content-Type":"application/json"})});return i.ok?await i.json():{status:0,err:(i==null?void 0:i.statusText)||"Something went wrong."}}catch{return{}}}async function $h(){try{const e=new Date,r=`https://search-new.bitbns.com/extension/configs-ext/prod/sale.json?randFlag=${new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime()}`,i=await fetch(r,{method:"GET"});return i.ok?await i.json():{}}catch(e){return R("Error in getSaleInfo",e),{}}}async function Jh(e,t){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");const r="https://search-new.bitbns.com/buyhatke/offers/getOffersData",i={ext_id:w.ext_id,ext_auth:w.ext_auth,pos:e,offerIds:t},a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});return a.ok?await a.json():(R(`getOffersData: HTTP error! status: ${a.status}`),{})}catch(r){return R(`Error in getOffersData: ${r.message}`),{}}}async function Fh(e,t){try{const r="https://search-new.bitbns.com/buyhatke/offers/upsert";w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");const i={ext_id:w.ext_id,ext_auth:w.ext_auth,pos:e,offers:t},a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});return a.ok?await a.json():(R(`upsertOffers: HTTP error! status: ${a.status}`),{})}catch(r){return R(`Error in upsertOffers: ${r.message}`),{}}}setInterval(async()=>{await vh()},30*60*1e3);self.addEventListener("error",e=>{R("Unhandled exception:",e)});setInterval(()=>{Ot=null},6*60*60*1e3);setInterval(async()=>{try{await ge("ExtensionRunning",{})}catch{}},10*60*1e3);setTimeout(async()=>{try{await ge("ExtensionRunning",{})}catch{}},5e3);async function Bh(){try{let e=await x.getItem("ext_id"),t=await x.getItem("ext_auth");if((await(await fetch(`https://settings.buyhatke.com/extension-settings/updateSettings?ext_id=${e}&ext_auth=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json()).success!=!0)throw new Error("logging failed !")}catch(e){R("persistMode",e)}}async function Hh(){try{let e=await x.getItem("ext_id"),t=await x.getItem("ext_auth"),i=await(await fetch(`https://settings.buyhatke.com/extension-settings/fetchSettings?ext_id=${e}&ext_auth=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json();if(i.success==!0)Us=i.flag;else throw new Error("logging failed !")}catch(e){R("fetchMode",e)}}async function Vh(e,t,r){try{const i=Math.floor(Date.now()/1e3)+r*24*60*60;await chrome.cookies.set({url:"https://buyhatke.com/",name:e,value:t,domain:".buyhatke.com",path:"/",expirationDate:i,secure:!0,httpOnly:!1,sameSite:"no_restriction"})}catch{}}async function ui(e="https://buyhatke.com",t="triggerSpend"){try{return await new Promise(i=>{chrome.cookies.get({url:e,name:t},a=>{i((a==null?void 0:a.value)??"")})})??""}catch{return""}}async function Wh(e){var t,r,i,a,s,o;try{let l=(t=Le==null?void 0:Le.uber)==null?void 0:t.useSecondApiForDetails,c=l?(r=Le==null?void 0:Le.uber)==null?void 0:r.suggestionApiSecond:(i=Le==null?void 0:Le.uber)==null?void 0:i.suggestionApi;c||(await Yr(),l=(a=Le==null?void 0:Le.uber)==null?void 0:a.useSecondApiForDetails,l?c=(s=Le==null?void 0:Le.uber)==null?void 0:s.suggestionApiSecond:c=(o=Le==null?void 0:Le.uber)==null?void 0:o.suggestionApi);let d={query:e||""},f=b=>{if(typeof b=="string")return b.replace(/{{(\w+)}}/g,(h,m)=>d[m]!==void 0?d[m]:"");if(Array.isArray(b))return b.map(h=>f(h));if(typeof b=="object"&&b!==null){let h={};for(let m in b)h[m]=f(b[m]);return h}return b},p=f(c==null?void 0:c.headers),u=f(c==null?void 0:c.body),I=f(c==null?void 0:c.url);const k=await fetch(I,{method:c==null?void 0:c.method,headers:p,body:JSON.stringify(u),mode:"cors",credentials:"include"});if(!k.ok)throw new Error(`HTTP error! status: ${k.status}`);return await k.json()}catch(l){throw l}}async function Kh(e){var t,r;try{let i=(t=Le==null?void 0:Le.uber)==null?void 0:t.detailsApi;i||(await Yr(),i=(r=Le==null?void 0:Le.uber)==null?void 0:r.detailsApi);let a={uniqueId:(e==null?void 0:e.uniqueId)||"",provider:(e==null?void 0:e.apiMode)||""},s=p=>{if(typeof p=="string")return p.replace(/{{(\w+)}}/g,(u,I)=>a[I]!==void 0?a[I]:"");if(Array.isArray(p))return p.map(u=>s(u));if(typeof p=="object"&&p!==null){let u={};for(let I in p)u[I]=s(p[I]);return u}return p},o=s(i==null?void 0:i.headers),l=s(i==null?void 0:i.body),c=s(i==null?void 0:i.url);const d=await fetch(c,{method:i==null?void 0:i.method,headers:o,body:JSON.stringify(l),mode:"cors",credentials:"include"});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);return await d.json()}catch(i){throw i}}async function zh(e,t){try{let r=[],i=null;if(e&&e.data&&Array.isArray(e.data.candidates))return r=e.data.candidates.map(a=>({uniqueId:a.id||"",primaryText:a.addressLine1||"",secondaryText:a.addressLine2||"",apiMode:a.provider||"google_places"})).slice(0,8),{suggestions:r};if(e&&e.data&&e.data.lat&&e.data.long){const a=e.data,s=a.lat,o=a.long,l=a.fullAddress?a.fullAddress.match(/\b\d{6}\b/):null,c=l?l[0]:"";i={lat:s,long:o,pincode:c,address:t.primaryText};try{let f=(await new Promise((p,u)=>{chrome.storage.local.get("userLocation",I=>{if(chrome.runtime.lastError)return u(chrome.runtime.lastError);p(I)})})).userLocation||{address:null,latitude:null,longitude:null,timestamp:Date.now()};f.address=t.primaryText,f.latitude=parseFloat(s),f.longitude=parseFloat(o),f.pincode=c,f.timestamp=Date.now(),await new Promise((p,u)=>{chrome.storage.local.set({userLocation:f},()=>{if(chrome.runtime.lastError)return u(chrome.runtime.lastError);p()})})}catch{}return{location:i}}}catch{}return{suggestions:[],location:null}}function Zh(e){let t=[],r=[];return e&&e.data&&(Array.isArray(e.data)?r=e.data:Array.isArray(e.data.candidates)&&(r=e.data.candidates)),t=r.map(i=>({uniqueId:i.id||"",primaryText:i.addressLine1||"",secondaryText:i.addressLine2||"",apiMode:i.provider||"uber_places"})).slice(0,8),t}async function Xh(e,t){var r,i,a,s;try{let o=(r=Le==null?void 0:Le.blinkit)==null?void 0:r.addressApi;o||(await Yr(),o=(i=Le==null?void 0:Le.blinkit)==null?void 0:i.addressApi);let l={latitude:String(e),longitude:String(t)},c=I=>{if(typeof I=="string")return I.replace(/{{(\w+)}}/g,(k,y)=>l[y]!==void 0?l[y]:"");if(Array.isArray(I))return I.map(k=>c(k));if(typeof I=="object"&&I!==null){let k={};for(let y in I)k[y]=c(I[y]);return k}return I},d=c(o==null?void 0:o.url),f=c(o==null?void 0:o.headers),u=await(await fetch(d,{method:o==null?void 0:o.method,headers:f,body:null,mode:"cors",credentials:"include"})).json();if((a=u==null?void 0:u.location_info)!=null&&a.formatted_address&&((s=u==null?void 0:u.location_info)!=null&&s.postal_code)){let I=u.location_info.formatted_address,k=u.location_info.postal_code,y={address:I,latitude:e,longitude:t,pincode:k,timestamp:Date.now()};return await chrome.storage.local.set({userLocation:y}),I}}catch{return null}}async function Ut(e,t,r){try{let i=e,a=await fetch(i,{headers:t,body:JSON.stringify(r),method:"POST",mode:"cors",credentials:"include"});return a.status>300&&(e.includes("1.rome")?e=e.replace("1.rome","2.rome"):e.includes("2.rome")&&(e=e.replace("2.rome","1.rome")),i=e,a=await fetch(i,{headers:t,body:JSON.stringify(r),method:"POST",mode:"cors",credentials:"include"})),a}catch{}}async function Yh(e){var t,r;try{let i=(t=Le==null?void 0:Le.flipkartMinutes)==null?void 0:t.suggestionApi;i||(await Yr(),i=(r=Le==null?void 0:Le.flipkartMinutes)==null?void 0:r.suggestionApi);let a=Date.now(),s={query:e,timestamp:String(a)},o=u=>{if(typeof u=="string")return u.replace(/{{(\w+)}}/g,(I,k)=>s[k]!==void 0?s[k]:"");if(Array.isArray(u))return u.map(I=>o(I));if(typeof u=="object"&&u!==null){let I={};for(let k in u)I[k]=o(u[k]);return I}return u},l=o(i==null?void 0:i.url),c=o(i==null?void 0:i.headers),d=o(i==null?void 0:i.body);return await(await Ut(l,c,d,i==null?void 0:i.method)).json()}catch(i){throw i}}function Qh(e){let t=[];return e.RESPONSE&&e.RESPONSE.suggestions&&(t=e.RESPONSE.suggestions.filter(r=>r.type==="AUTOSUGGEST_QUERY_WIDGET").map(r=>{var s,o,l,c,d,f;const i=r.data.component.value,a=((l=(o=(s=r.data)==null?void 0:s.component)==null?void 0:o.action)==null?void 0:l.originalUrl)||((f=(d=(c=r.data)==null?void 0:c.component)==null?void 0:d.action)==null?void 0:f.url)||"";return{title:i.title,backFill:i.backFill,type:i.type,imageUrl:i.imageUrl.replace("{@width}","96").replace("{@height}","96").replace("{@quality}","100"),contentType:i.contentType,originalUrl:a}}).slice(0,8)),t}async function Gh(e,t,r,i=0,a=null,s=!1,o=!1,l=null){try{const c=await Ty(e,t,r,i),f=(await x.getItem("allStoresId")||{}).blinkit||"";return await Ct("blinkit",c,a,s,f,e,o,"",l,!1)}catch(c){throw c}}async function Ch(e,t=null,r=!1,i=!1,a=null){try{const s=await _y(e),l=(await x.getItem("allStoresId")||{}).flipkart_minutes||"";return await Ct("flipkart_minutes",s,t,r,l,e,i,"",a,!1)}catch(s){throw s}}async function qh(e,t=null,r=null,i=null,a=!1,s=!1,o=null){try{const l=await Hy(e,t,r),d=(await x.getItem("allStoresId")||{}).instamart||"";return await Ct("instamart",l,i,a,d,e,s,"",o,!1)}catch(l){throw l}}async function ey(e,t=null,r=!1,i=!1,a=null){try{const s=await Sy(e),l=(await x.getItem("allStoresId")||{}).bigbasket||"";return await Ct("bigbasket",s,t,r,l,e,i,"",a,!0)}catch(s){throw s}}async function ty(e,t=null,r=!1,i=!1,a=null){try{const s=await Py(e),l=(await x.getItem("allStoresId")||{}).zepto||"";return await Ct("zepto",s,t,r,l,e,i,"",a,!1)}catch(s){throw s}}async function ay(e,t,r=null,i=!1,a=!1,s=null){try{const o=await Oy(e,t),c=(await x.getItem("allStoresId")||{}).amazon_now||"";return await Ct("amazon",o,r,i,c,e,a,"",s,!1)}catch(o){throw o}}async function ry(e,t=null,r=!1,i=!1,a=null){try{const s=await Ey(e),l=(await x.getItem("allStoresId")||{}).jiomart||"",c=await x.getItem("jiomartRegionCode")||"";return await Ct("jiomart",s,t,r,l,e,i,c,a,!1)}catch(s){throw s}}async function sy(e,t=null,r=null,i=null,a=!1,s=!1,o=null){var l,c;try{let d="10677",f=await chrome.storage.local.get(["userLocation"]);if(t=(l=f.userLocation)==null?void 0:l.latitude,r=(c=f.userLocation)==null?void 0:c.longitude,t&&r){const u=await rc(t,r);u&&u.storeId&&(d=u.storeId)}const p=await oy(e,d);return await Ct("dmart",p,i,a,d,e,s,"",o,!1)}catch(d){throw d}}async function ny(e,t){try{return e!=null&&e.pid&&Array.isArray(e==null?void 0:e.missingPlatforms)&&(e==null?void 0:e.sourcePlatformPos)!==void 0?await Ct("findSimilar",e,t,!1,null,null):null}catch(r){throw r}}async function iy(e,t){try{if(e){let r=`findSimilarBulk_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return await Ct("findSimilarBulk",e,t,!1,"","",!1,"",r,!1)}return null}catch(r){throw r}}async function oy(e,t="10677"){var r,i;try{let a=(r=he==null?void 0:he.dmart)==null?void 0:r.searchApi;a||(await Gt(),a=(i=he==null?void 0:he.dmart)==null?void 0:i.searchApi);let o={encodedQuery:encodeURIComponent(e||""),storeId:String(t)},l=I=>{let y=JSON.stringify(I).replace(/{{(\w+)}}/g,(b,h)=>o[h]||"");return JSON.parse(y)},c=l(a==null?void 0:a.url),d=l(a==null?void 0:a.headers),f=l(a==null?void 0:a.referrer),p=await fetch(c,{method:a==null?void 0:a.method,headers:d,referrer:f,mode:"cors",credentials:"include"});p.ok||await ge("grocerySearchAPIError",{pos:7006});let u=await p.json();return{raw:u,data:u}}catch{await ge("grocerySearchAPIError",{pos:7006})}}async function ly(e,t){var r,i;try{let a=(r=W==null?void 0:W.dmart)==null?void 0:r.slotApi;a||(await yt(),a=(i=W==null?void 0:W.dmart)==null?void 0:i.slotApi);const s={storeId:String(e),pincode:String(t)},o=p=>{const I=JSON.stringify(p).replace(/{{(\w+)}}/g,(k,y)=>s[y]||"");return JSON.parse(I)},l=o(a==null?void 0:a.headers),c=o(a==null?void 0:a.url);return await(await fetch(c,{method:a.method,headers:l})).json()}catch{return null}}async function rc(e,t){try{let r=await cy(e,t);return r||(await ge("groceryETA_APIError",{pos:7006}),null)}catch{return await ge("groceryETA_APIError",{pos:7006}),null}}async function cy(e,t){let r=await uy(e,t);if(!r)return null;let i=await ly(r.storeId,r.pincode),a=r.pincode;if(chrome.storage.local.set({dmartPincode:a}),i&&Array.isArray(i.slots)){let s=i.slots.find(o=>o.type==="SHP");if(s&&s.timeSlot)return{storeId:r.storeId,timeSlot:s.timeSlot}}return{storeId:r.storeId,timeSlot:null}}async function uy(e,t){var r,i;try{let a=(r=W==null?void 0:W.dmart)==null?void 0:r.storeInfoApi;a||(await yt(),a=(i=W==null?void 0:W.dmart)==null?void 0:i.storeInfoApi);let s={latitude:String(e),longitude:String(t)},o=y=>{let h=JSON.stringify(y).replace(/{{(\w+)}}/g,(m,A)=>s[A]||"");return JSON.parse(h)},l=o(a.headers),c=o(a.url),d=o(a.body),p=await(await fetch(c,{method:a.method,headers:l,body:JSON.stringify(d)})).json(),u=(y,b)=>b.split(".").reduce((h,m)=>(h||{})[m],y),I=u(p,a.responseMapping.storeId),k=u(p,a.responseMapping.pincode);return I&&k?(chrome.storage.local.get(["allStoresId"],y=>{let b=y.allStoresId||{};b.dmart=I,chrome.storage.local.set({allStoresId:b},()=>{})}),{storeId:I,pincode:k}):null}catch{return null}}async function dy(e,t){try{let r=W==null?void 0:W.zepto;r||(await yt(),r=W==null?void 0:W.zepto);let i=r==null?void 0:r.storeInfoApi,a={};if(r!=null&&r.authConfig)for(let[p,u]of Object.entries(r.authConfig)){let I="";for(let k of u)if(k.type==="cookie"){let y=await oa(k.domain,k.name);if(y){I=y.value;break}}a[p]=I}let s={latitude:String(e),longitude:String(t),accessToken:a.accessToken||""},o=p=>{let I=JSON.stringify(p).replace(/{{(\w+)}}/g,(k,y)=>s[y]||"");return JSON.parse(I)},l=o(i==null?void 0:i.headers),c=o(i==null?void 0:i.url),d=await fetch(c,{method:i==null?void 0:i.method,headers:l,mode:"cors"});return!d.ok&&d.status===400?{error:"ZEPTO_LOGIN_REQUIRED",login_url:"https://www.zepto.com/account"}:await d.json()}catch(r){throw r}}async function py(e,t,r){try{let i=W.zepto;if(i||(await yt(),i=W==null?void 0:W.zepto),e)chrome.storage.local.get(["allStoresId"],p=>{let u=p.allStoresId||{};u.zepto=e,chrome.storage.local.set({allStoresId:u},()=>{})}),await chrome.storage.local.set({zeptoStoreId:e});else throw new Error("ZEPTO_STORE_ID_MISSING");const a={};if(i.authConfig)for(const[p,u]of Object.entries(i.authConfig)){let I="";for(const k of u)if(k.type==="cookie"){const y=await oa(k.domain,k.name);if(y){I=y.value;break}}a[p]=I}const s={storeId:String(e),latitude:String(t),longitude:String(r),...a},o=p=>{const I=JSON.stringify(p).replace(/{{(\w+)}}/g,(k,y)=>s[y]||"");return JSON.parse(I)},l=o(i.headers),c=o(i.url),d=await fetch(c,{method:i.method,headers:l,mode:"cors"});if(!d.ok)throw d.status===400?(await ge("groceryETA_APIError",{pos:7907}),new Error("ZEPTO_LOGIN_REQUIRED")):new Error(`HTTP error! status: ${d.status}`);return await d.json()}catch{await ge("groceryETA_APIError",{pos:7907})}}async function fy(e,t){var r,i;try{let a=W==null?void 0:W.blinkit;a||(await yt(),a=W==null?void 0:W.blinkit);let s={latitude:String(e),longitude:String(t),token:"null"},o=p=>{let I=JSON.stringify(p).replace(/{{(\w+)}}/g,(k,y)=>s[y]||"");return JSON.parse(I)},l=o(a.headers),c=o(a.url),d=await fetch(c,{method:a.method,headers:l,referrer:"https://blinkit.com/",mode:"cors",credentials:"include"});d.ok||await ge("groceryETA_APIError",{pos:7740});let f=await d.json();if(a!=null&&a.responseMapping&&((r=a==null?void 0:a.responseMapping)!=null&&r.storeIdPath)){let p=(i=a==null?void 0:a.responseMapping)==null?void 0:i.storeIdPath.split(".").reduce((u,I)=>(u||{})[I],f);p&&chrome.storage.local.get(["allStoresId"],u=>{let I=u.allStoresId||{};I.blinkit=p,chrome.storage.local.set({allStoresId:I},()=>{})})}return f}catch{await ge("groceryETA_APIError",{pos:7740})}}chrome.tabs.onRemoved.addListener(e=>{e===Xt&&(Xt=null)});function sc(e){var t,r,i,a,s;try{if(!e||!e.success||!e.success.configs)throw new Error("Invalid response structure");const o=e.success.configs;let l=null,c=null;const d=((t=o.IM_PAGE_CONFIGS)==null?void 0:t.configInfo)||[];for(const p of d)if((i=(r=p==null?void 0:p.card)==null?void 0:r.podDetails)!=null&&i.podId){l=p.card.podDetails.podId;break}const f=((a=o.IM_TOOL_BAR)==null?void 0:a.configInfo)||[];for(const p of f){const u=(s=p==null?void 0:p.card)==null?void 0:s.sla;if(u!=null&&u.value&&(u!=null&&u.unit)){c={value:u.value,unit:u.unit};break}}return{storeId:l,eta:c}}catch{return null}}function ka(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function Ns(){const e="0123456789abcdef";let t="";for(let r=0;r<16;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}async function Bs(e,t){let r=Ns(),i=ka(),a=ka(),s=W==null?void 0:W.instamart;s||(await yt(),s=W==null?void 0:W.instamart);let o=s==null?void 0:s.homeApi,l=(s==null?void 0:s.retryDelays)||[400,600,1e3];try{let c={latitude:String(e),longitude:String(t),uniqueId:r,tid:i,sid:a},d=k=>{if(typeof k=="string")return k.replace(/{{(\w+)}}/g,(y,b)=>c[b]!==void 0?c[b]:"");if(Array.isArray(k))return k.map(y=>d(y));if(typeof k=="object"&&k!==null){let y={};for(let b in k)y[b]=d(k[b]);return y}return k},f=d(o==null?void 0:o.queryParams),p=new URLSearchParams(f).toString(),u=`${o==null?void 0:o.baseUrl}?${p}`,I=d(o==null?void 0:o.headers);for(let k=0;k<=5;k++)try{let y=await fetch(u,{method:o==null?void 0:o.method,headers:I,body:null,mode:"cors",credentials:"include"}),b=y.status,h,m=!1;try{h=await y.json(),m=!0}catch{m=!1}if(b===401||b===429||b===500||!m)if(k<5){await new Promise(P=>setTimeout(P,l[k]));continue}else return await cn(e,t);if(!y.ok)return null;let A=sc(h);return A&&A.storeId?(chrome.storage.local.get(["allStoresId"],P=>{let S=P.allStoresId||{};S.instamart=A.storeId,chrome.storage.local.set({allStoresId:S},()=>{})}),A):A&&A.eta?A:(await ge("groceryETA_APIError",{pos:25622}),null)}catch{if(k<5)await new Promise(b=>setTimeout(b,l[k]));else return await cn(e,t)}}catch{return await ge("groceryETA_APIError",{pos:25622}),await cn(e,t)}}async function cn(e,t){try{let r=W==null?void 0:W.instamart;r||(await yt(),r=W==null?void 0:W.instamart);const i={latitude:String(e),longitude:String(t)},a=f=>{const u=JSON.stringify(f).replace(/{{(\w+)}}/g,(I,k)=>i[k]||"");return JSON.parse(u)},s=a(r.headers),o=a(r.url),l=a(r.body),c=null;async function d(f){if(f<=0)return c;try{let p=await fetch(o,{method:r.method,headers:s,body:JSON.stringify(l),mode:"cors",credentials:"include"});if(!p.ok){if(f===3&&(p.status===401||p.status===403||p.status>=500))try{await Ka(),await new Promise(y=>setTimeout(y,3e3))}catch{}return await new Promise(y=>setTimeout(y,2e3)),d(f-1)}const u=await p.text();if(!u||u.trim()===""){if(f===10)try{await Ka(),await new Promise(y=>setTimeout(y,3e3))}catch{}return await new Promise(y=>setTimeout(y,2e3)),d(f-1)}let I;try{I=JSON.parse(u)}catch{if(f===10)try{await Ka(),await new Promise(b=>setTimeout(b,3e3))}catch{}return await new Promise(b=>setTimeout(b,2e3)),d(f-1)}if(I.stack===null&&I.statusCode==="ERR_NON_2XX_3XX_RESPONSE"){if(f===10||f===7||f===3)try{await Ka(),await new Promise(y=>setTimeout(y,3e3))}catch{}return await new Promise(y=>setTimeout(y,2e3)),d(f-1)}if(!I.data){if(f===3)try{await Ka(),await new Promise(y=>setTimeout(y,3e3))}catch{}return await new Promise(y=>setTimeout(y,2e3)),d(f-1)}const k=sc(I);return k&&k.storeId?(chrome.storage.local.get(["allStoresId"],y=>{let b=y.allStoresId||{};b.instamart=k.storeId,chrome.storage.local.set({allStoresId:b},()=>{})}),k):k&&k.eta?k:c}catch{if(f===10)try{await Ka(),await new Promise(u=>setTimeout(u,3e3))}catch{}return await new Promise(u=>setTimeout(u,3e3)),d(f-1)}}try{return await d(10)}catch{return c}}catch{}}function hy(e){if(!Array.isArray(e)||e.length===0)return null;const t=r=>{if(!r||typeof r!="string")return 1/0;const[i,a]=r.trim().split(" "),s=parseInt(i,10);if(isNaN(s)||!a)return 1/0;const o=a.toLowerCase(),l={mins:1,min:1,m:1,minutes:1,hrs:60,hr:60,hour:60,hours:60,day:1440,days:1440};for(const[c,d]of Object.entries(l))if(o.includes(c))return s*d;return 1/0};return e.reduce((r,i)=>{const a=t(i.eta),s=t(r.eta);return a<s?i:r},e[0]).sa_id}async function yy(e){var t,r,i,a;try{let s=(t=W==null?void 0:W.bigbasket)==null?void 0:t.doorApi;s||(await yt(),s=(r=W==null?void 0:W.bigbasket)==null?void 0:r.doorApi);const o={csrfToken:e},l=y=>{const h=JSON.stringify(y).replace(/{{(\w+)}}/g,(m,A)=>o[A]||"");return JSON.parse(h)},c=l(s.headers),d=l(s.url);let p=await(await fetch(d,{headers:c,body:null,method:s.method,credentials:"include"})).json(),u=p==null?void 0:p.sa_list,I=hy(u);I&&chrome.storage.local.get(["allStoresId"],y=>{let b=y.allStoresId||{};b.bigbasket=I,chrome.storage.local.set({allStoresId:b},()=>{})});let k=null;if(p&&(p!=null&&p.door_section)&&((i=p==null?void 0:p.door_section)!=null&&i.doors)){let y=(a=p==null?void 0:p.door_section)==null?void 0:a.doors;for(let b=0;b<y.length;b++)if(y[b].id===10){y[b].eta&&y[b].eta.eta_message&&(k=y[b].eta.eta_message);break}}return k}catch(s){throw s}}async function nc(){var e,t;try{let r=(e=W==null?void 0:W.bigbasket)==null?void 0:e.initialApi;return r||(await yt(),r=(t=W==null?void 0:W.bigbasket)==null?void 0:t.initialApi),await fetch(r.url,{headers:r.headers,method:r.method,credentials:"include"})}catch{}}async function my(e,t){try{await nc();let r=await oa(".bigbasket.com","csrftoken"),i="";if(r!=null&&r.value&&(i=await wy(r.value,e,t)),i==""||i==null||i===void 0||typeof i=="object"&&Object.keys(i).length===0){let a=await Sd(2268,e,t);return a!=null&&a.store_id&&chrome.storage.local.get(["allStoresId"],s=>{let o=s.allStoresId||{};o.bigbasket=a.store_id,chrome.storage.local.set({allStoresId:o},()=>{})}),"Available"}else{if(i!=null&&i.notServiceable||(i==null?void 0:i.serviceable)===!1)return"BB_NOT_DELIVERABLE";let a=await yy(r.value);if(a)return a;await ge("groceryETA_APIError",{pos:2268});return}}catch{await ge("groceryETA_APIError",{pos:2268})}}async function wy(e,t,r){var i,a,s,o;try{let l=(i=W==null?void 0:W.bigbasket)==null?void 0:i.serviceableApi;l||(await yt(),l=(a=W==null?void 0:W.bigbasket)==null?void 0:a.serviceableApi);const c={latitude:String(t),longitude:String(r),csrfToken:e},d=k=>{const b=JSON.stringify(k).replace(/{{(\w+)}}/g,(h,m)=>c[m]||"");return JSON.parse(b)},f=d(l==null?void 0:l.headers),p=d(l==null?void 0:l.url);let u=await fetch(p,{headers:f,body:null,method:l.method,credentials:"include"});if(u.status!==200)return"";let I=await u.json();return((o=(s=I==null?void 0:I.errors)==null?void 0:s[0])==null?void 0:o.code_str)=="SERVE4056"?{notServiceable:!0,message:I==null?void 0:I.errors[0].display_msg,pincode:I.errors[0].pincode}:I}catch(l){throw l}}async function by(e,t){var r,i;try{let a=W==null?void 0:W.flipkartMinutes;a||(await yt(),a=W==null?void 0:W.flipkartMinutes);let s={latitude:e,longitude:t},o=b=>{let m=JSON.stringify(b).replace(/{{(\w+)}}/g,(A,P)=>s[P]||"");return JSON.parse(m)};await fetch(a==null?void 0:a.warmupApi.url,{method:a==null?void 0:a.warmupApi.method,mode:a==null?void 0:a.warmupApi.mode,credentials:a==null?void 0:a.warmupApi.credentials});let l=o(a==null?void 0:a.homepageApi.url),c=o(a==null?void 0:a.locationApi.headers),d=o(a==null?void 0:a.locationApi.body),f=o(a==null?void 0:a.locationApi.url);await Ut(f,c,d);let p=o(a==null?void 0:a.homepageApi.headers),u=o(a==null?void 0:a.homepageApi.body),I=await Ut(l,p,u),k=I?await I.json():null;((i=(r=k==null?void 0:k.RESPONSE)==null?void 0:r.slots)==null?void 0:i.length)==0&&(I=await Ut(l,p,u),k=await I.json()),await ky(e,t);let y=Iy(k);return y?`${y}`:(await ge("groceryETA_APIError",{pos:25848}),"FLIPKART_MINUTES_ETA_NOT_FOUND")}catch{await ge("groceryETA_APIError",{pos:25848})}}function Iy(e){var r,i,a,s,o,l,c,d,f,p;let t=(r=e==null?void 0:e.RESPONSE)==null?void 0:r.slots;if(!Array.isArray(t))return null;for(let u of t){let I=(s=(a=(i=u==null?void 0:u.widget)==null?void 0:i.data)==null?void 0:a.dlsData)==null?void 0:s.default_fk_address_bar_sub_layouts_sla_callout_minutes_1;if((o=I==null?void 0:I.value)!=null&&o.label_0&&((l=I==null?void 0:I.value)!=null&&l.label_1)){let k=(d=(c=I.value.label_0)==null?void 0:c.value)==null?void 0:d.text,y=(p=(f=I.value.label_1)==null?void 0:f.value)==null?void 0:p.text;if(k!==void 0&&y!==void 0)return`${k} ${y}`}}return null}async function gy(e,t){try{return await by(e,t)}catch{}}async function ky(e,t){var r,i,a,s,o,l;try{let c=W==null?void 0:W.flipkartMinutes;c||(await yt(),c=W==null?void 0:W.flipkartMinutes);let d={latitude:e,longitude:t},f=S=>{let _=JSON.stringify(S).replace(/{{(\w+)}}/g,(T,E)=>d[E]||"");return JSON.parse(_)};await fetch(c==null?void 0:c.warmupApi.url,{method:c==null?void 0:c.warmupApi.method,mode:c==null?void 0:c.warmupApi.mode,credentials:c==null?void 0:c.warmupApi.credentials});let p=f(c==null?void 0:c.homepageApi.url),u=f(c==null?void 0:c.homepageApi.headers),I=f(c==null?void 0:c.homepageApi.body),k=f(c==null?void 0:c.locationApi.headers),y=f(c==null?void 0:c.locationApi.body),b=f(c==null?void 0:c.locationApi.url);(await Ut(locationUrl,k,y)).ok;let m=await Ut(p,u,I);if(!m.ok)return;let A=await m.json();((i=(r=A==null?void 0:A.RESPONSE)==null?void 0:r.slots)==null?void 0:i.length)==0&&(m=await Ut(p,u,I),A=await m.json());let P=(l=(o=(s=(a=A==null?void 0:A.RESPONSE)==null?void 0:a.pageData)==null?void 0:s.trackingContext)==null?void 0:o.meta)==null?void 0:l.storeId;P&&chrome.storage.local.get(["allStoresId"],S=>{let v=S.allStoresId||{};v.flipkart_minutes=P,chrome.storage.local.set({allStoresId:v},()=>{})})}catch{return""}}function ic(){let e=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){let i=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(r=="x"?i:i&3|8).toString(16)})}function xy(e){var p,u,I,k,y,b;if(!e||!e.result)return"";const t=e.result,r=((u=(p=t.pininfo)==null?void 0:p.master_codes)==null?void 0:u.GROCERIES)||((I=t.storeInfo)==null?void 0:I.region_code)||"",i=((k=t.storeInfo)==null?void 0:k.store_code)||"",a=((b=(y=t.pininfo)==null?void 0:y.master_codes)==null?void 0:b.ALCOHOL)===null,s='attributes.status:ANY("active")',o='(attributes.mart_availability:ANY("JIO", "JIO_WA"))',l='(attributes.seller_ids:ANY("1") OR attributes.vertical_code:ANY("LOCALSHOPS"))',c=`(attributes.available_regions:ANY("${r}", "${r}"))`,d=`((attributes.inv_stores_1p:ANY("${i}")))`;let f=`${s} AND ${o} AND ${l} AND ${c} AND ${d}`;return a&&(f+=' AND ( NOT attributes.vertical_code:ANY("ALCOHOL"))'),f}async function vy(e,t){var r,i,a,s,o,l,c,d,f,p,u,I,k;try{let y=W==null?void 0:W.jiomart;y||(await yt(),y=W==null?void 0:W.jiomart);let h=((r=(await chrome.storage.local.get("userLocation")).userLocation)==null?void 0:r.pincode)||"",m=ic(),A={latitude:String(e),longitude:String(t),pincode:String(h),uuid:String(m)},P=ve=>{let j=JSON.stringify(ve).replace(/{{(\w+)}}/g,(N,X)=>A[X]||"");return JSON.parse(j)},S=P(y==null?void 0:y.headers),v=P(y==null?void 0:y.url),_=await fetch(v,{headers:S,referrer:y.referrer,body:null,method:y.method,mode:"cors",credentials:"include"});_.ok||await ge("groceryETA_APIError",{pos:25850});let T=await _.json(),E=xy(T);await chrome.storage.local.set({jiomartFilterPayload:E});let g=(i=T==null?void 0:T.result)==null?void 0:i.storeInfo;if(g){let ve=g.store_code;ve&&chrome.storage.local.get(["allStoresId"],j=>{let N=j.allStoresId||{};N.jiomart=ve,chrome.storage.local.set({allStoresId:N},()=>{})});let Ke=g.region_code;Ke&&chrome.storage.local.set({jiomartRegionCode:Ke},()=>{})}let $=((c=(l=(o=(s=(a=T==null?void 0:T.result)==null?void 0:a.promiseInfo)==null?void 0:s.result)==null?void 0:o.vertical)==null?void 0:l.GROCERIES)==null?void 0:c.stores)[0],K=$.display_message||$.secondary_display_message,z=(I=(u=(p=(f=(d=T==null?void 0:T.result)==null?void 0:d.promiseInfo)==null?void 0:f.result)==null?void 0:p.vertical)==null?void 0:u.GROCERIES)==null?void 0:I.global_display_message;if(K&&K.trim()!==""){if(K.toLowerCase().startsWith("delivery in")){let ve=K.match(/delivery in (\d+) to (\d+) mins/i);if(ve)return{eta:`In ${ve[1]} - ${ve[2]} mins`}}return{eta:K}}if(z&&z.trim()!==""){if(z.toLowerCase().startsWith("delivery in")){let ve=z.match(/delivery in (\d+) to (\d+) mins/i);if(ve)return{eta:`In ${ve[1]} - ${ve[2]} mins`}}return{eta:z}}if($.secondary_display_message)return{eta:$.secondary_display_message};let F=(k=$.delivery_promise)==null?void 0:k.formatted;!F||!F.min||F.max;let L=F.min.match(/(\d{2}\s+\w+),\s*(\w+)\s*-\s*(\d{2}:\d{2})/),D=L[1],V=L[2],ae=L[3],te=F.max.match(/(\d{2}:\d{2})/)[1],q={Sunday:"Sun",Monday:"Mon",Tuesday:"Tue",Wednesday:"Wed",Thursday:"Thu",Friday:"Fri",Saturday:"Sat"}[V]||V.slice(0,3),re=new Date,ue=new Date(`${D} ${re.getFullYear()}`),Te=new Date(re);Te.setDate(re.getDate()+1);let Ee=ue.getDate()===Te.getDate()&&ue.getMonth()===Te.getMonth()?"Tom":q,Je=ve=>{let[Ke,j]=ve.split(":").map(Number),N=Ke>=12?"PM":"AM";return Ke=Ke%12||12,`${Ke}${N}`},Se=Je(ae),We=Je(te);return{eta:`${Ee} ${Se}-${We}`}}catch{await ge("groceryETA_APIError",{pos:25850})}}let Ms=null;chrome.tabs.onRemoved.addListener(e=>{e===Ms&&(Ms=null)});let kr=null,ps=null;async function Wn(){if(kr)return kr;try{const e=await chrome.storage.local.get(["jiomartAuthData"]);if(e.jiomartAuthData){const{authToken:t,timestamp:r}=e.jiomartAuthData,i=30*24*60*60*1e3;if(t&&Date.now()-r<i)return e.jiomartAuthData;t&&await chrome.storage.local.remove(["jiomartAuthData"])}}catch{}kr=new Promise(async(e,t)=>{try{const r=new Promise((c,d)=>{const f=(p,u,I)=>p.action==="JIOMART_TOKEN_RESPONSE"?(chrome.runtime.onMessage.removeListener(f),p.success&&p.data.authToken?c(p.data):d(new Error("JIOMART_LOGIN_REQUIRED")),!1):!0;chrome.runtime.onMessage.addListener(f),setTimeout(()=>{chrome.runtime.onMessage.removeListener(f),d(new Error("Timeout: JioMart content script did not respond."))},15e3)});let i=null;const a=await chrome.tabs.query({url:"*://www.jiomart.com/*"});if(a.length>0)i=a[0].id;else{if(ps)try{i=(await chrome.tabs.get(ps)).id}catch{ps=null}i||(i=(await chrome.tabs.create({url:"https://www.jiomart.com/",active:!1})).id,ps=i)}(await chrome.tabs.get(i)).status!=="complete"&&await new Promise((c,d)=>{const f=setTimeout(()=>{chrome.tabs.onUpdated.removeListener(p),d(new Error("Timeout waiting for tab to load"))},1e4),p=(u,I)=>{u===i&&I.status==="complete"&&(chrome.tabs.onUpdated.removeListener(p),clearTimeout(f),c())};chrome.tabs.onUpdated.addListener(p)});try{chrome.tabs.sendMessage(i,{action:"GET_JIOMART_TOKEN"})}catch{}const l={...await r,timestamp:Date.now()};await chrome.storage.local.set({jiomartAuthData:l}),e(l)}catch(r){t(r)}finally{kr=null}});try{return await kr}catch{return{authToken:"",pin:"560034",storecode:"TM3D",userid:"160342590",hasValidAuth:!1}}}async function Ay(){var e,t;try{let r=(e=he==null?void 0:he.blinkit)==null?void 0:e.warmupApi;r||(await Gt(),r=(t=he==null?void 0:he.blinkit)==null?void 0:t.warmupApi),(await fetch(r==null?void 0:r.url,{method:r==null?void 0:r.method,headers:r==null?void 0:r.headers,mode:"cors",credentials:"include"})).ok}catch{}}async function Ty(e,t,r,i=0){var a,s,o,l,c,d,f,p,u,I,k;try{let y=he==null?void 0:he.blinkit;y||(await Gt(),y=he==null?void 0:he.blinkit);let b=await chrome.storage.local.get(["userLocation"]),h=((a=b==null?void 0:b.userLocation)==null?void 0:a.latitude)||t,m=((s=b==null?void 0:b.userLocation)==null?void 0:s.longitude)||r;await Ay();let A=(l=(o=y==null?void 0:y.authConfig)==null?void 0:o.deviceId)==null?void 0:l.fallback;if(((d=(c=y==null?void 0:y.authConfig)==null?void 0:c.deviceId)==null?void 0:d.source)==="cookie"){let K=await oa(y.authConfig.deviceId.domain,y.authConfig.deviceId.name);K&&(A=K.value)}let P={query:e,offset:String(i??0),latitude:String(h??""),longitude:String(m??""),deviceId:A},S=K=>{let F=JSON.stringify(K).replace(/{{(\w+)}}/g,(L,D)=>P[D]||"");return JSON.parse(F)},v=S((f=y==null?void 0:y.searchApi)==null?void 0:f.queryParams),_=new URLSearchParams(v),T=`${(p=y==null?void 0:y.searchApi)==null?void 0:p.baseUrl}?${_.toString()}`,E=S((u=y==null?void 0:y.searchApi)==null?void 0:u.headers),g=S((I=y==null?void 0:y.searchApi)==null?void 0:I.referrer),O=await fetch(T,{method:(k=y==null?void 0:y.searchApi)==null?void 0:k.method,headers:E,referrer:g,mode:"cors"});return O.ok||await ge("grocerySearchAPIError",{pos:7740}),await O.json()}catch{await ge("grocerySearchAPIError",{pos:7740})}}async function _y(e){var t,r,i,a,s,o,l,c,d,f,p,u,I;try{let k=he==null?void 0:he.flipkartMinutes;k||(await Gt(),k=he==null?void 0:he.flipkartMinutes);let y=encodeURIComponent(e||""),b=(_,T)=>{if(typeof _=="string")return _.replace(/{{(\w+)}}/g,(E,g)=>T[g]!==void 0?T[g]:"");if(Array.isArray(_))return _.map(E=>b(E,T));if(typeof _=="object"&&_!==null){let E={};for(let g in _)E[g]=b(_[g],T);return E}return _},h={encodedQuery:y},m=b((t=k==null?void 0:k.searchApi)==null?void 0:t.url,h),A=b((r=k==null?void 0:k.searchApi)==null?void 0:r.headers,h),P=b((i=k==null?void 0:k.searchApi)==null?void 0:i.body,h),S=await Ut(m,A,P,(a=k==null?void 0:k.searchApi)==null?void 0:a.method);S.ok||await ge("grocerySearchAPIError",{pos:25848});let v=await S.json();if(((o=(s=v==null?void 0:v.RESPONSE)==null?void 0:s.slots)==null?void 0:o.length)==0){let _=await chrome.storage.local.get(["userLocation"]),T=(l=_==null?void 0:_.userLocation)==null?void 0:l.latitude,E=(c=_==null?void 0:_.userLocation)==null?void 0:c.longitude,g={latitude:T,longitude:E},O=b((d=k==null?void 0:k.locationApi)==null?void 0:d.url,g),$=b((f=k==null?void 0:k.locationApi)==null?void 0:f.headers,g),K=b((p=k==null?void 0:k.locationApi)==null?void 0:p.body,g);await Ut(O,$,K,(u=k==null?void 0:k.locationApi)==null?void 0:u.method),S=await Ut(m,A,P,(I=k==null?void 0:k.searchApi)==null?void 0:I.method),v=await S.json()}return{raw:v,data:v}}catch(k){throw await ge("grocerySearchAPIError",{pos:25848}),k}}async function Sy(e){var t,r;try{let i=(t=he==null?void 0:he.bigbasket)==null?void 0:t.searchApi;i||(await Gt(),i=(r=he==null?void 0:he.bigbasket)==null?void 0:r.searchApi);let s={encodedQuery:encodeURIComponent(e||"")},o=p=>{if(typeof p=="string")return p.replace(/{{(\w+)}}/g,(u,I)=>s[I]!==void 0?s[I]:"");if(Array.isArray(p))return p.map(u=>o(u));if(typeof p=="object"&&p!==null){let u={};for(let I in p)u[I]=o(p[I]);return u}return p},l=o(i==null?void 0:i.url),c=o(i==null?void 0:i.headers),d=await fetch(l,{method:i==null?void 0:i.method,headers:c,mode:"cors",credentials:"include"});return d.ok||await ge("grocerySearchAPIError",{pos:2268}),{mode:"fallback",data:await d.json()}}catch{await ge("grocerySearchAPIError",{pos:2268})}}let Xt=null;async function Ka(){const e="https://www.swiggy.com/instamart?entryId=1234&entryName=mainTileEntry4&v=1";try{if(Xt)try{return await chrome.tabs.reload(Xt),Xt}catch{Xt=null}return Xt=(await chrome.tabs.create({url:e,active:!1})).id,Xt}catch{}}async function Py(e){var t,r,i;try{let a=he==null?void 0:he.zepto;a||(await Gt(),a=he==null?void 0:he.zepto);let s=a==null?void 0:a.searchApi,{zeptoStoreId:o}=await chrome.storage.local.get(["zeptoStoreId"]),l=o||((t=a==null?void 0:a.defaults)==null?void 0:t.storeId),c=await oa((r=a==null?void 0:a.auth)==null?void 0:r.cookieDomain,(i=a==null?void 0:a.auth)==null?void 0:i.cookieName),d=c?c.value:"",f={query:e,storeId:l,accessToken:d},p=h=>{if(typeof h=="string")return h.replace(/{{(\w+)}}/g,(m,A)=>f[A]!==void 0?f[A]:"");if(Array.isArray(h))return h.map(m=>p(m));if(typeof h=="object"&&h!==null){let m={};for(let A in h)m[A]=p(h[A]);return m}return h},u=p(s==null?void 0:s.headers),I=p(s==null?void 0:s.body),k=p(s==null?void 0:s.url),y=await fetch(k,{method:s==null?void 0:s.method,headers:u,body:JSON.stringify(I),mode:"cors",credentials:"include"});y.ok||await ge("grocerySearchAPIError",{pos:7907});const b=await y.json();return{raw:b,data:b}}catch{await ge("grocerySearchAPIError",{pos:7907})}}async function Oy(e,t){var r,i;try{let a=(r=he==null?void 0:he.amazon)==null?void 0:r.searchApi;a||(await Gt(),a=(i=he==null?void 0:he.amazon)==null?void 0:i.searchApi);const{location:s,addressId:o,brandId:l,isServiceable:c}=await oc();let f={encodedKeyword:encodeURIComponent(e||""),brandId:String(l||"")},p=h=>{if(typeof h=="string")return h.replace(/{{(\w+)}}/g,(m,A)=>f[A]!==void 0?f[A]:"");if(Array.isArray(h))return h.map(m=>p(m));if(typeof h=="object"&&h!==null){let m={};for(let A in h)m[A]=p(h[A]);return m}return h},u=p(a==null?void 0:a.url),I=p(a==null?void 0:a.headers),k=p(a==null?void 0:a.referrer);const y=await fetch(u,{method:a==null?void 0:a.method,credentials:"include",headers:I,mode:"cors",referrer:k});return y.ok||await ge("grocerySearchAPIError",{pos:25847}),{searchJson:await y.json()}}catch{await ge("grocerySearchAPIError",{pos:25847})}}async function oc(){var s,o;const e=await hc(["amazonAddressId","amazonBrandId"]),t=(e==null?void 0:e.amazonBrandId)||"qqfsWw9RkO";let r=(e==null?void 0:e.amazonAddressId)||"",i=null;if(!r){const l=await fetch("https://www.amazon.in/portal-migration/hz/glow/get-location-label?storeContext=amazontez&pageType=amazontez&actionSource=tez-glow",{method:"GET",credentials:"include",headers:{accept:"*/*"},mode:"cors",referrer:"https://www.amazon.in/"});if(!l.ok)throw new Error(`Amazon location label failed: ${l.status}`);i=await l.json(),r=((s=i==null?void 0:i.customerIntent)==null?void 0:s.addressId)||((o=i==null?void 0:i.selectedDestination)==null?void 0:o.destinationValue)||"",r&&await tm({amazonAddressId:r,amazonBrandId:t})}return{location:i,addressId:r,brandId:t,isServiceable:""}}async function Ao(){var e,t,r;try{const i=await fetch("https://www.amazon.in/portal-migration/hz/glow/get-location-label?storeContext=amazontez&pageType=amazontez&actionSource=tez-glow",{method:"GET",credentials:"include",headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin"},mode:"cors"});i.ok;const s=(await i.json()).validationToken,o=await fetch("https://www.amazon.in/portal-migration/hz/glow/get-address-selections-view-model?storeContext=amazontez&pageType=amazontez&actionSource=tez-glow",{method:"GET",credentials:"include",headers:{accept:"*/*","accept-language":"en-US,en;q=0.9,tr;q=0.8","anti-csrftoken-a2z":s,"device-memory":"8",downlink:"10",dpr:"2",ect:"4g",priority:"u=1, i","return-to-url":"/tez/browse/home?qcbrand=qqfsWw9RkO&ref=nav_cs_dsk_grfl_stfr_at&",rtt:"50","sec-ch-device-memory":"8","sec-ch-dpr":"2","sec-ch-ua":'"Not;A=Brand";v="99", "Google Chrome";v="139", "Chromium";v="139"',"sec-ch-ua-mobile":"?1","sec-ch-ua-platform":'"Android"',"sec-ch-ua-platform-version":'"6.0"',"sec-ch-viewport-width":"917","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"917"},mode:"cors"});o.ok;const l=await o.json();let c=[],d=((e=l==null?void 0:l.features)==null?void 0:e.AddressList)||((t=l==null?void 0:l.features)==null?void 0:t.AddressListWithGluxAssets);if(d){let f;try{f=JSON.parse(d)}catch{f={}}(r=f==null?void 0:f.addressSection)!=null&&r.addressList&&(c=f.addressSection.addressList)}return await oc(),!c||c.length===0?{error:"AMAZON_LOGIN_REQUIRED",login_url:"https://www.amazon.in/ap/signin?openid.pape.preferred_auth_policies=SinglefactorWithPossessionChallenge&openid.pape.max_auth_age=900&openid.return_to=https%3A%2F%2Fwww.amazon.in%2Fap%2Fcnep%3Fie%3DUTF8%26orig_return_to%3Dhttps%253A%252F%252Fwww.amazon.in%252Fyour-account%26openid.assoc_handle%3Dinflex%26pageId%3Dinflex&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=inflex&openid.mode=checkid_setup&openid.ns.pape=http%3A%2F%2Fspecs.openid.net%2Fextensions%2Fpape%2F1.0&intercept=false&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0"}:c}catch{}}async function Dy(e){return new Promise(t=>{chrome.tabs.create({url:e,active:!1,index:0},r=>{let i=(a,s)=>{a===r.id&&s.status==="complete"&&(chrome.tabs.onUpdated.removeListener(i),t(a))};chrome.tabs.onUpdated.addListener(i)})})}async function lc(e,t){var r,i,a;try{let s=await x.getItem("userLocation")||{},o=Number(s.latitude),l=Number(s.longitude);if(!s||isNaN(o)||isNaN(l))return null;let c=await x.getItem("amazonStoreData");if(c&&c.storeId){let T=Number(c.lat),E=Number(c.lon),g=Math.abs(o-T)<1e-6,O=Math.abs(l-E)<1e-6;if(g&&O)return c.storeId}let f=await Dy("https://www.amazon.in/");if(!f)return null;let p=(r=W==null?void 0:W.amazon)==null?void 0:r.storeIdApi;p||(await yt(),p=(i=W==null?void 0:W.amazon)==null?void 0:i.storeIdApi);const u={brandId:e,csrfToken:t},I=T=>{const g=JSON.stringify(T).replace(/{{(\w+)}}/g,(O,$)=>u[$]||"");return JSON.parse(g)},k=I(p==null?void 0:p.headers),y=I(p==null?void 0:p.url),b=I(p==null?void 0:p.body),h={method:p.method,credentials:"include",headers:k,body:JSON.stringify(b),mode:"cors"},m=await cr(f,{action:"callAPIFromDOM",data:{eachUrl:y,eachOptions:h}});if(!m||!m.success)return await chrome.tabs.remove(f),null;const A=m.result.result,P=JSON.parse(A),S=(a=p==null?void 0:p.responseMapping)==null?void 0:a.storeIdPath.split(".").reduce((T,E)=>(T||{})[E],P);await chrome.storage.local.set({amazonStoreId:S});let _=(await chrome.storage.local.get(["allStoresId"])).allStoresId||{};return _.amazon_fresh=S,await chrome.storage.local.set({allStoresId:_}),await chrome.tabs.remove(f),await x.setItem("amazonStoreData",{storeId:S,lat:Number(s.latitude),lon:Number(s.longitude)}),S}catch{return null}}async function cc(){var e,t,r,i;try{let a=(e=W==null?void 0:W.amazon)==null?void 0:e.csrfApi,s=(t=W==null?void 0:W.amazon)==null?void 0:t.brandId;(!a||!s)&&(await yt(),a=(r=W==null?void 0:W.amazon)==null?void 0:r.csrfApi,s=(i=W==null?void 0:W.amazon)==null?void 0:i.brandId);const o={brandId:s},c=(p=>{const I=JSON.stringify(p).replace(/{{(\w+)}}/g,(k,y)=>o[y]||"");return JSON.parse(I)})(a.headers);return(await(await fetch(a.url,{headers:c,referrer:`https://www.amazon.in/tez/browse/home?qcbrand=${s}&ref=nav_cs_dsk_grfl_stfr_at&`,method:a.method,mode:"cors",credentials:"include"})).json()).data.CSRFToken}catch{return null}}async function Ly(e){var t,r,i,a,s,o;try{let l=(t=W==null?void 0:W.amazon)==null?void 0:t.brandId,c=(r=W==null?void 0:W.amazon)==null?void 0:r.etaApi;(!c||!l)&&(await yt(),c=(i=W==null?void 0:W.amazon)==null?void 0:i.etaApi,l=(a=W==null?void 0:W.amazon)==null?void 0:a.brandId);let d=await cc(),f=await lc(l,d),p={brandId:l,storeId:f,addressId:e},u=m=>{let P=JSON.stringify(m).replace(/{{(\w+)}}/g,(S,v)=>p[v]||"");return JSON.parse(P)},I=u(c.headers),k=u(c.url),y=await fetch(k,{method:c.method,credentials:"include",headers:I,mode:"cors"});y.ok||await ge("groceryETA_APIError",{pos:25847});const b=await y.json();let h=null;if((s=b==null?void 0:b.data)!=null&&s.preOrderETAResponse){const m=b.data.preOrderETAResponse;if(m.constraints&&m.constraints.length>0){const A=m.constraints[0];if(A.constraintType==="HARD"&&A.constraintName==="OUTSIDE_STORE_HOURS"){const P=(o=A.extraData)==null?void 0:o.openingTime;if(P){const S=new Date(parseInt(P)),v=new Date,_=new Date;_.setDate(v.getDate()+1);const T=S.toDateString()===v.toDateString(),E=S.toDateString()===_.toDateString();T?h=`Opens at ${S.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`:E?h=`Opens tomorrow at ${S.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`:h=`Opens ${S.toLocaleDateString("en-US",{weekday:"short",hour:"numeric",minute:"2-digit",hour12:!0})}`}else h="Store currently closed"}}else if(m.minETA&&m.maxETA)h=`${m.minETA}-${m.maxETA} ${m.timeUnit||"mins"}`;else if(m.relativeMinEtaInSeconds!==void 0&&m.relativeMaxEtaInSeconds!==void 0){const A=Math.round(m.relativeMinEtaInSeconds/60),P=Math.round(m.relativeMaxEtaInSeconds/60);A===P?h=` ${A} mins`:h=` ${A}-${P} mins`}}return h||(h=(b==null?void 0:b.eta)||(b==null?void 0:b.deliveryTime)||(b==null?void 0:b.estimatedDelivery)||"Available"),{etaText:h,raw:b}}catch(l){return await ge("groceryETA_APIError",{pos:25847}),{etaText:"Not Available",raw:null,error:l}}}async function Ey(e){try{let t=he==null?void 0:he.jiomart;t||(await Gt(),t=he==null?void 0:he.jiomart);let r=t==null?void 0:t.searchApi,{jiomartFilterPayload:i}=await chrome.storage.local.get("jiomartFilterPayload"),a=i||"",s=(t==null?void 0:t.visitorId)||"anonymous-d142bb96-79fb-4005-93f9-5b582ebd07c4",o={query:e||"",filterPayload:a,visitorId:s},l=I=>{if(typeof I=="string")return I.replace(/{{(\w+)}}/g,(k,y)=>o[y]!==void 0?o[y]:"");if(Array.isArray(I))return I.map(k=>l(k));if(typeof I=="object"&&I!==null){let k={};for(let y in I)k[y]=l(I[y]);return k}return I},c=l(r==null?void 0:r.headers),d=l(r==null?void 0:r.body),f=l(r==null?void 0:r.url),p=await fetch(f,{method:r==null?void 0:r.method,mode:"cors",credentials:"include",headers:c,body:JSON.stringify(d)});return p.ok||await ge("grocerySearchAPIError",{pos:25850}),await p.json()}catch(t){throw await ge("grocerySearchAPIError",{pos:25850}),t}}async function Ny(e,t,r){try{let i=null;switch(t.toLowerCase()){case"blinkit":i=await My(e);break;case"flipkart":case"flipkart_minutes":i=await Ry(e);break;case"amazon":case"amazon_fresh":case"amazonNow":i=await jy(e);break;case"zepto":i=await Uy(e);break;case"instamart":case"swiggy":i=await $y(e,r);break;case"jiomart":i=await Jy(e);break;case"bigbasket":case"bbnow":case"bbNow":i=await Fy(e);break;case"dmart":i=await By(e,r);break;default:}return i}catch{}}async function My(e){var t,r,i,a,s,o,l,c,d,f,p,u,I,k,y,b,h,m,A,P,S,v,_,T;try{let E=(t=Ie==null?void 0:Ie.blinkit)==null?void 0:t.priceApi;E||(await la(),E=(r=Ie==null?void 0:Ie.blinkit)==null?void 0:r.priceApi);let g=await chrome.storage.local.get(["userLocation"]),O=((i=g==null?void 0:g.userLocation)==null?void 0:i.latitude)||"28.465204",$=((a=g==null?void 0:g.userLocation)==null?void 0:a.longitude)||"77.06159",K={pid:String(e),latitude:String(O),longitude:String($)},z=ne=>{if(typeof ne=="string")return ne.replace(/{{(\w+)}}/g,(q,re)=>K[re]!==void 0?K[re]:"");if(Array.isArray(ne))return ne.map(q=>z(q));if(typeof ne=="object"&&ne!==null){let q={};for(let re in ne)q[re]=z(ne[re]);return q}return ne},F=z(E==null?void 0:E.url),L=z(E==null?void 0:E.headers),D=await fetch(F,{method:E==null?void 0:E.method,headers:L,body:null,mode:"cors",credentials:"include"});if(!D.ok)throw new Error(`HTTP error! status: ${D.status}`);let V=await D.json(),ae=(d=(c=(l=(o=(s=V==null?void 0:V.response)==null?void 0:s.page_level_components)==null?void 0:o.sticky)==null?void 0:l.footer_snippets)==null?void 0:c[0])==null?void 0:d.data,te=((I=(u=(p=(f=ae==null?void 0:ae.atc_actions_v2)==null?void 0:f.default)==null?void 0:p[0])==null?void 0:u.add_to_cart)==null?void 0:I.cart_item)||((h=(b=(y=(k=ae==null?void 0:ae.rfc_actions_v2)==null?void 0:k.default)==null?void 0:y[0])==null?void 0:b.remove_from_cart)==null?void 0:h.cart_item);if((!te||te.price===0)&&((P=(A=(m=V==null?void 0:V.response)==null?void 0:m.page_level_components)==null?void 0:A.widgets)!=null&&P.length)){let ne=(S=V.response.page_level_components.widgets[0])==null?void 0:S.data;te=((T=(_=(v=ne==null?void 0:ne.product_details)==null?void 0:v.product_meta)==null?void 0:_[0])==null?void 0:T.cart_item)||te}if(te&&String(te.product_id)===String(e))return{product_id:te.product_id,price:te.price,mrp:te.mrp,platform:"blinkit",oos:te.inventory==0?1:0}}catch{}}async function Ry(e){var t,r,i,a,s,o,l,c,d,f,p,u,I,k,y,b,h,m,A,P,S,v,_,T,E,g,O,$,K,z,F,L,D,V,ae,te,ne,q,re,ue,Te,se,Ee,Je,Se,We,st,ve,Ke;try{let j=(t=Ie==null?void 0:Ie.flipkartMinutes)==null?void 0:t.priceApi;j||(await la(),j=(r=Ie==null?void 0:Ie.flipkartMinutes)==null?void 0:r.priceApi);let X=(await chrome.storage.local.get(["userPincode"])||{}).userPincode||"560034",ie={pid:String(e),pincode:String(X)},H=He=>{if(typeof He=="string")return He.replace(/{{(\w+)}}/g,(Ne,ke)=>ie[ke]!==void 0?ie[ke]:"");if(Array.isArray(He))return He.map(Ne=>H(Ne));if(typeof He=="object"&&He!==null){let Ne={};for(let ke in He)Ne[ke]=H(He[ke]);return Ne}return He},me=H(j==null?void 0:j.url),pe=H(j==null?void 0:j.headers),Pe=H(j==null?void 0:j.body),qe=await Ut(me,pe,Pe);qe.ok;let B=await qe.json();if(!((i=B==null?void 0:B.RESPONSE)!=null&&i.slots)||B.RESPONSE.slots.length===0){const He=await chrome.storage.local.get(["userLocation"]);if(He!=null&&He.userLocation){const{latitude:Ne,longitude:ke}=He.userLocation,Me="https://1.rome.api.flipkart.com/4/location/update",Oe={...ia,"x-user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1 FKUA/msite/0.0.1/ucweb/Mobile"};await Ut(Me,Oe,{geoLocation:{latitude:Ne,longitude:ke},addressInfo:{pincode:"560068",city:"Bangalore Division",state:"Karnataka",addressLine1:"random"}}),qe=await Ut(me,pe,Pe),B=await qe.json()}}let Q=null,G=null,C=null;const fe=(l=(o=(s=(a=B==null?void 0:B.RESPONSE)==null?void 0:a.pageData)==null?void 0:s.pageContext)==null?void 0:o.trackingDataV2)==null?void 0:l.serviceable,we=(f=(d=(c=B==null?void 0:B.RESPONSE)==null?void 0:c.pageData)==null?void 0:d.pageContext)==null?void 0:f.pricing;let Re=(I=(u=(p=B==null?void 0:B.RESPONSE)==null?void 0:p.pageData)==null?void 0:u.pageContext)==null?void 0:I.listingId;const Ge=((b=(y=(k=B==null?void 0:B.RESPONSE)==null?void 0:k.pageData)==null?void 0:y.pageContext)==null?void 0:b.availabilityStatus)||((P=(A=(m=(h=B==null?void 0:B.RESPONSE)==null?void 0:h.pageData)==null?void 0:m.pageContext)==null?void 0:A.pls)==null?void 0:P.availabilityStatus)||((E=(T=(_=(v=(S=B==null?void 0:B.RESPONSE)==null?void 0:S.pageData)==null?void 0:v.pageContext)==null?void 0:_.trackingDataV2)==null?void 0:T.productStatus)==null?void 0:E.toUpperCase());C=((z=(K=($=(O=(g=B==null?void 0:B.RESPONSE)==null?void 0:g.pageData)==null?void 0:O.pageContext)==null?void 0:$.trackingContext)==null?void 0:K.meta)==null?void 0:z.storeId)||((V=(D=(L=(F=B==null?void 0:B.RESPONSE)==null?void 0:F.pageData)==null?void 0:L.pageContext)==null?void 0:D.trackingDataV2)==null?void 0:V.hyperlocalShopIds[0])||null,(ae=we==null?void 0:we.finalPrice)!=null&&ae.value&&(we!=null&&we.mrp)&&(Q=we.finalPrice.value,G=we.mrp);let Pt="";if((Ge==="OUT_OF_STOCK"||Ge==="OUT OF STOCK")&&(Pt=1),Q===null||G===null){const He=(te=B==null?void 0:B.RESPONSE)==null?void 0:te.slots;if(He&&Array.isArray(He)){const Ne=He.find(ke=>{var Me,Oe,Ze;return((Me=ke.widget)==null?void 0:Me.type)==="PRODUCT_PRICE_SUMMARY"&&((Ze=(Oe=ke.widget)==null?void 0:Oe.tracking)==null?void 0:Ze.productId)===e});if(Ne){const ke=(q=(ne=Ne.widget.data)==null?void 0:ne.pricing)==null?void 0:q.value;if(ke){const Me=(re=ke.prices)==null?void 0:re.find(Oe=>Oe.priceType==="MRP");if(G=Me==null?void 0:Me.value,(ue=ke.finalPrice)!=null&&ue.value)Q=ke.finalPrice.value;else if(Array.isArray(ke.prices)){const Oe=ke.prices.find(Ze=>Ze.strikeOff===!1);Oe&&(Q=Oe.value)}}}}C=((Se=(Je=(Ee=(se=(Te=B==null?void 0:B.RESPONSE)==null?void 0:Te.pageData)==null?void 0:se.pageContext)==null?void 0:Ee.trackingContext)==null?void 0:Je.meta)==null?void 0:Se.storeId)||((Ke=(ve=(st=(We=B==null?void 0:B.RESPONSE)==null?void 0:We.pageData)==null?void 0:st.pageContext)==null?void 0:ve.trackingDataV2)==null?void 0:Ke.hyperlocalShopIds[0])||null}return G==null||Q===null?{product_id:e,price:0,mrp:0,oos:1,listingId:Re,platform:"flipkart",storeId:C||null}:{product_id:e,price:parseFloat(Q),mrp:parseFloat(G),listingId:Re,platform:"flipkart",oos:Pt,storeId:C||null}}catch{return null}}async function jy(e){var t,r,i,a;try{let s=Ie==null?void 0:Ie.amazon;s||(await la(),s=Ie==null?void 0:Ie.amazon);let o=s==null?void 0:s.priceApi,l=s==null?void 0:s.brandId,c={pid:String(e),brandId:String(l)},d=b=>{if(typeof b=="string")return b.replace(/{{(\w+)}}/g,(h,m)=>c[m]!==void 0?c[m]:"");if(Array.isArray(b))return b.map(h=>d(h));if(typeof b=="object"&&b!==null){let h={};for(let m in b)h[m]=d(b[m]);return h}return b},f=d(o==null?void 0:o.url),p=d(o==null?void 0:o.headers),u=d(o==null?void 0:o.referrer);const I=await fetch(f,{method:o==null?void 0:o.method,headers:p,referrer:u,mode:"cors",credentials:"include"});I.ok;const k=await I.json(),y=(r=(t=k==null?void 0:k.data)==null?void 0:t.miniDpPageResponse)==null?void 0:r[0];if(y&&y.asin===e){const b=(i=y==null?void 0:y.buyingPrice)==null?void 0:i.amount,h=(a=y==null?void 0:y.listPrice)==null?void 0:a.amount,m=y==null?void 0:y.offerId;return typeof b!="number"||typeof h!="number"?{product_id:y.asin,price:0,mrp:0,oos:1,platform:"amazon"}:{product_id:y.asin,price:b,mrp:h,platform:"amazon",offerId:m}}else return{product_id:"DUMMY",price:0,mrp:0,oos:1,platform:"amazon"}}catch{return null}}async function Uy(e){var t,r;try{let i=(t=Ie==null?void 0:Ie.zepto)==null?void 0:t.priceApi;i||(await la(),i=(r=Ie==null?void 0:Ie.zepto)==null?void 0:r.priceApi);let a={pid:String(e)},s=S=>{if(typeof S=="string")return S.replace(/{{(\w+)}}/g,(v,_)=>a[_]!==void 0?a[_]:"");if(Array.isArray(S))return S.map(v=>s(v));if(typeof S=="object"&&S!==null){let v={};for(let _ in S)v[_]=s(S[_]);return v}return S},o=s(i==null?void 0:i.url),l=s(i==null?void 0:i.headers);const c=await fetch(o,{method:i==null?void 0:i.method,headers:l});c.ok;let d=await c.text(),f=new RegExp(`"id":"(${e})"`),p=d.match(f),u=/"discountedSellingPrice":(\d+)/,I=d.match(u),k=d.match(/"outOfStock":(\w+)/),y=/"mrp":(\d+)/,b=d.match(y);if(!p||!I||!b)return{product_id:e,price:null,mrp:null,platform:"zepto",oos:1,discontinued:!0};let h=p[1],m=parseFloat(I[1])/100,A=parseFloat(b[1])/100,P=k&&k[1]==="true"?1:0;return{product_id:h,price:m,mrp:A,oos:P,platform:"zepto"}}catch{return null}}async function $y(e,t){var r,i,a,s,o,l,c,d,f,p,u;try{let I=Ie==null?void 0:Ie.instamart;I||(await la(),I=Ie==null?void 0:Ie.instamart);let k=!!(I!=null&&I.priceApiNew),y=k?I.priceApiNew:I==null?void 0:I.priceApi,b=(I==null?void 0:I.retryDelays)||[400,600,1e3,1500,1800,2e3,2200,2500,3e3];if(!y)return null;let h=await chrome.storage.local.get(["userLocation"]),m=(r=h.userLocation)==null?void 0:r.latitude,A=(i=h.userLocation)==null?void 0:i.longitude,S=(a=(await chrome.storage.local.get(["allStoresId"])).allStoresId)==null?void 0:a.instamart;if(!S&&m&&A){let z=await Bs(m,A);S=z==null?void 0:z.storeId,S&&chrome.storage.local.set({instamartStoreId:S})}S=S;let v=S,T=JSON.stringify({pods:[{pod_id:S,sla:6,priority:1,serviceability_status:3,item_fulfilment_priority:1}]})+(k?"":"7"),E=btoa(T),g={latitude:String(m||""),longitude:String(A||""),storeId:String(S),secondaryStoreId:String(v),metaInfoEncoded:E,tid:typeof ka=="function"?ka():"",sid:typeof ka=="function"?ka():"",uniqueId:typeof Ns=="function"?Ns():"",pid:String(e),variant:String(t||e)},O=z=>{if(typeof z=="string")return z.replace(/{{(\w+)}}/g,(F,L)=>g[L]!==void 0?g[L]:"");if(typeof z=="object"&&z!==null){let F=Array.isArray(z)?[]:{};for(let L in z)F[L]=O(z[L]);return F}return z},$=O(y.headers),K="";if(k){let z=O(y.queryParams),F=new URLSearchParams(z).toString();K=`${y.baseUrl}?${F}`}else K=O(y.url);for(let z=0;z<=b.length;z++){let F=await fetch(K,{method:y.method||"GET",headers:$,referrer:O(y.referrer)||void 0});if(k&&F.status===429&&z<b.length){await new Promise(ue=>setTimeout(ue,b[z]));continue}if(!F.ok)return null;let L=await F.json();if((L==null?void 0:L.statusCode)===1||(L==null?void 0:L.statusMessage)==="Product not found")return{product_id:e,price:null,mrp:null,platform:"instamart",oos:1,discontinued:!0};let D=k?(s=L==null?void 0:L.success)==null?void 0:s.cards:(o=L==null?void 0:L.data)==null?void 0:o.cards,V=D==null?void 0:D.find(ue=>{var Te,se;return((se=(Te=ue==null?void 0:ue.card)==null?void 0:Te.card)==null?void 0:se["@type"])==="type.googleapis.com/swiggy.gandalf.widgets.v2.GridWidget"}),ae=(f=(d=(c=(l=V==null?void 0:V.card)==null?void 0:l.card)==null?void 0:c.gridElements)==null?void 0:d.infoWithStyle)==null?void 0:f.items;if(!ae||ae.length===0)return null;let te=ae[0],ne=(p=te==null?void 0:te.analytics)==null?void 0:p.context;if(ne)try{ne=(u=JSON.parse(ne))==null?void 0:u.itemId}catch{}let q=te.variations;if(!q)return null;let re=q.map(ue=>{var Te,se,Ee,Je,Se;return{product_id:e,weight:ue.quantityDescription,price:parseInt(((se=(Te=ue.price)==null?void 0:Te.offerPrice)==null?void 0:se.units)||0,10),mrp:parseInt(((Je=(Ee=ue.price)==null?void 0:Ee.mrp)==null?void 0:Je.units)||0,10),oos:((Se=ue.cartAllowedQuantity)==null?void 0:Se.allowedQuantity)>0?0:1,spinId:ue.spinId,itemId:ne,platform:"instamart"}});if(t){const ue=To(t),Te=re.find(se=>To(se.weight)===ue);if(Te)return[Te]}return re}}catch{return null}}async function Jy(e){var t,r;try{let i=(t=Ie==null?void 0:Ie.jiomart)==null?void 0:t.priceApi;i||(await la(),i=(r=Ie==null?void 0:Ie.jiomart)==null?void 0:r.priceApi);let s=(await chrome.storage.local.get(["userPincode"])).userPincode||"400020",o={pid:String(e),pincode:String(s)},l=y=>{if(typeof y=="string")return y.replace(/{{(\w+)}}/g,(b,h)=>o[h]!==void 0?o[h]:"");if(Array.isArray(y))return y.map(b=>l(b));if(typeof y=="object"&&y!==null){let b={};for(let h in y)b[h]=l(y[h]);return b}return y},c=l(i==null?void 0:i.url),d=l(i==null?void 0:i.headers),f=new AbortController,p=setTimeout(()=>f.abort(),8e3),u=await fetch(c,{method:i==null?void 0:i.method,headers:d,signal:f.signal});clearTimeout(p),u.ok;let I=await u.json(),k=I==null?void 0:I.data;if((I==null?void 0:I.status)==="success"&&(k==null?void 0:k.product_code)==e){let y=k.selling_price,b=k.mrp,m=typeof k.available_at_3p_seller=="boolean"&&k.available_at_3p_seller||typeof k.available_at_3p_seller=="string"&&k.available_at_3p_seller.trim()!==""?0:1;if(typeof y!="number"||typeof b!="number")throw new Error("Invalid price or MRP values extracted from JioMart.");return{product_id:k.product_code,price:y,mrp:b,platform:"jiomart",oos:m}}else if((I==null?void 0:I.status)==="failure"&&Array.isArray(I==null?void 0:I.data)&&I.data.length===0)return{product_id:e,price:null,mrp:null,platform:"jiomart",oos:1,discontinued:!0}}catch{return null}}async function Fy(e,t){var r,i,a,s;try{let o=(r=Ie==null?void 0:Ie.bigbasket)==null?void 0:r.priceApi;o||(await la(),o=(i=Ie==null?void 0:Ie.bigbasket)==null?void 0:i.priceApi);let l={pid:String(e),variant:String(t||"")},c=y=>{if(typeof y=="string")return y.replace(/{{(\w+)}}/g,(b,h)=>l[h]!==void 0?l[h]:"");if(Array.isArray(y))return y.map(b=>c(b));if(typeof y=="object"&&y!==null){let b={};for(let h in y)b[h]=c(y[h]);return b}return y},d=c(o==null?void 0:o.url),f=c(o==null?void 0:o.headers),p=await fetch(d,{method:o==null?void 0:o.method,headers:f});p.ok;let u=await p.text(),I=[],k=u.match(/<script id="__NEXT_DATA__"[^>]*>(.*?)<\/script>/s);if(k&&k[1])try{let y=JSON.parse(k[1]),b=(s=(a=y==null?void 0:y.props)==null?void 0:a.pageProps)==null?void 0:s.productDetails;b!=null&&b.children&&Array.isArray(b.children)&&b.children.forEach(h=>{var _,T,E,g,O,$;let m=parseFloat((E=(T=(_=h.pricing)==null?void 0:_.discount)==null?void 0:T.prim_price)==null?void 0:E.sp),A=parseFloat((O=(g=h.pricing)==null?void 0:g.discount)==null?void 0:O.mrp),P=(($=h.availability)==null?void 0:$.avail_status)=="000"?1:0,S=h.w,v=h.id;!isNaN(m)&&!isNaN(A)&&S&&v&&I.push({product_id:v,weight:S,price:m,mrp:A,oos:P,platform:"bigbasket"})})}catch{}return I.length===0?{product_id:e,price:null,mrp:null,platform:"bigbasket",oos:1}:I}catch{return[]}}async function By(e,t){var r,i,a,s,o,l,c,d,f;try{let p=Ie==null?void 0:Ie.dmart;p||(await la(),p=Ie==null?void 0:Ie.dmart);let u={pid:String(e),selectedProd:String(t)},I=($,K)=>{if(typeof $=="string")return $.replace(/{{(\w+)}}/g,(z,F)=>K[F]!==void 0?K[F]:"");if(Array.isArray($))return $.map(z=>I(z,K));if(typeof $=="object"&&$!==null){let z={};for(let F in $)z[F]=I($[F],K);return z}return $},k=I((r=p==null?void 0:p.htmlApi)==null?void 0:r.url,u),y=await fetch(k,{method:(i=p==null?void 0:p.htmlApi)==null?void 0:i.method});if(!y.ok)throw new Error(`HTTP error! status: ${y.status}`);let h=(await y.text()).match(/<script id="__NEXT_DATA__"[^>]*>(.*?)<\/script>/s);if(!h||!h[1])throw new Error("__NEXT_DATA__ script not found in DMart response.");let A=JSON.parse(h[1]).buildId;if(!A)throw new Error("buildId not found in __NEXT_DATA__.");let P={...u,buildId:String(A)},S=I((a=p==null?void 0:p.dataApi)==null?void 0:a.url,P),v=await fetch(S,{method:(s=p==null?void 0:p.dataApi)==null?void 0:s.method});v.ok;let _=await v.json(),T=(f=(d=(c=(l=(o=_==null?void 0:_.pageProps)==null?void 0:o.pdpData)==null?void 0:l.dynamicPDP)==null?void 0:c.data)==null?void 0:d.productData)==null?void 0:f.sKUs;if(!T||!Array.isArray(T)||T.length===0)return{product_id:t,price:0,mrp:0,oos:1,platform:"dmart"};let E=T.find($=>$.skuUniqueID===t);if(!E)throw new Error(`Product with SKU ID ${t} not found in DMart.`);let g=parseFloat(E.priceSALE),O=parseFloat(E.priceMRP);return isNaN(g)||isNaN(O),{product_id:E.skuUniqueID,price:g,mrp:O,platform:"dmart"}}catch{return null}}function To(e){return e?String(e).toLowerCase().replace(/\u00d7/gi," x ").replace(/x/gi," x ").replace(/\*/g," x ").replace(/\s*-\s*/g," - ").replace(/\s+/g," ").trim():""}chrome.tabs.onRemoved.addListener(e=>{e===Xt&&(Xt=null)});async function Hy(e,t=null,r=null){let i=he==null?void 0:he.instamart;i||(await Gt(),i=he==null?void 0:he.instamart);let a=i==null?void 0:i.searchApi,s=Ns(),o=ka(),l=ka(),c=(i==null?void 0:i.retryDelays)||[1e3],d=i==null?void 0:i.defaultStoreId;try{if(t&&r){const v=await Bs(t,r);v&&v.storeId&&(d=v.storeId,v.eta)}let f=d,p=d==="1392080"?"1392660":d;const I=JSON.stringify({pods:[{pod_id:d,sla:7,priority:1,bucket_id:"",serviceability_status:3,item_fulfilment_priority:1}]})+"7",k=btoa(I);let y={latitude:String(t),longitude:String(r),storeId:String(d),secondaryStoreId:String(p),metaInfoEncoded:k,tid:o,sid:l,uniqueId:s,query:e},b=v=>{if(typeof v=="string")return v.replace(/{{(\w+)}}/g,(_,T)=>y[T]!==void 0?y[T]:"");if(Array.isArray(v))return v.map(_=>b(_));if(typeof v=="object"&&v!==null){let _={};for(let T in v)_[T]=b(v[T]);return _}return v},h=b(a==null?void 0:a.queryParams),m=new URLSearchParams(h).toString(),A=`${a==null?void 0:a.baseUrl}?${m}`,P=b(a==null?void 0:a.headers),S=b(a==null?void 0:a.body);for(let v=0;v<=8;v++)try{const _=await fetch(A,{method:a==null?void 0:a.method,headers:P,body:JSON.stringify(S)});let T=_.status,E,g=!1;try{E=await _.json(),g=!0}catch{g=!1}if(T===401||T===429||T===500||!g)if(v<c.length){await new Promise(O=>setTimeout(O,c[v]));continue}else return await fs(e,t,r);return _.ok?E:await fs(e,t,r)}catch{if(v<c.length)await new Promise(T=>setTimeout(T,c[v]));else return await ge("grocerySearchAPIError",{pos:25622}),await fs(e,t,r)}}catch{return await ge("grocerySearchAPIError",{pos:25622}),await fs(e,t,r)}}async function fs(e,t=null,r=null){try{const i=t?String(t):"12.909511",a=r?String(r):"77.6320296";let s="1392080";if(t&&r)try{const p=await Bs(t,r);p&&p.storeId&&(s=p.storeId)}catch{}const c=`https://disc.swiggy.com/api/v1/instamart/search?lat=${i}&lng=${a}&pod_id=${s}&sec_pod_id=1392660&meta_info=eyJwb2RzIjpbeyJwb2RfaWQiOiIxMzg2MDkwIiwic2xhIjo4LCJwcmlvcml0eSI6MSwiYnVja2V0X2lkIjoiMSIsInNlcnZpY2VhYmlsaXR5X3N0YXR1cyI6MywiaXRlbV9mdWxmaWxtZW50X3ByaW9yaXR5IjoxLCJnZF9zdGF0ZSI6MX0seyJwb2RfaWQiOiIxMzkyMDgwIiwic2xhIjo5LCJwcmlvcml0eSI6MiwiYnVja2V0X2lkIjoiMSIsInNlcnZpY2VhYmlsaXR5X3N0YXR1cyI6MywiaXRlbV9mdWxmaWxtZW50X3ByaW9yaXR5IjoyLCJnZF9zdGF0ZSI6MX0seyJwb2RfaWQiOiIxMzkyNjYwIiwic2xhIjoxMywicHJpb3JpdHkiOjIsImJ1Y2tldF9pZCI6IjEiLCJzZXJ2aWNlYWJpbGl0eV9zdGF0dXMiOjMsIml0ZW1fZnVsZmlsbWVudF9wcmlvcml0eSI6MywiZ2Rfc3RhdGUiOjF9XX0%3D&page_name=search`;return await(await fetch(c,{method:"POST",headers:{Host:"disc.swiggy.com","screen-name":"store-menu-search-instamart","user-agent":"Swiggy-Android",tid:"81b0ed3c-b253-40a2-b546-93912dda77f8",sid:"o6qdfd66-601a-4fd7-b17d-68e1a05420ad","version-code":"1567","app-version":"4.96.2","os-version":"12",accessibility_enabled:"false",swuid:"0c2926fee71d273e",deviceid:"0c2926fee71d273e","x-network-quality":"EXCELLENT","pl-version":"117","cache-control":"no-store",latitude:i,longitude:a,"current-latitude":i,"current-longitude":a,accept:"application/json","content-type":"application/json; charset=utf-8"},body:JSON.stringify({apply_intelligent_search:0,augmentation_context:{operations:["AUGMENTATION_OPERATION_QUERY_SPELL_CORRECTION"]},contextual_discovery_shown:0,page_type:"PAGE_TYPE_INSTAMART_AUTO_SUGGEST_PAGE",pre_search_tag_flag:0,query:e,selected_suggestion_metadata:""})})).json()}catch(i){return{stack:[],statusCode:500,message:i.message}}}let Ce=null,ya=0,Kn=!1,jr=null,xa=new Map;const un=10,_o=1e3,Vy=2*60*1e3;async function uc(e,t,r=null){try{if(!await Ur()||!Ce||Ce.readyState!==WebSocket.OPEN)return;let a=w.ext_id,s=w.ext_auth,o=await chrome.storage.local.get(["platformConnections"]);const l={type:e,data:t,extId:a,extAuth:s,connectedStore:o};r&&(l.requestId=r),Ce.send(JSON.stringify(l)),Rs()}catch{}}function Ct(e,t,r=null,i=!1,a="",s="",o=!1,l,c=null,d=!1){return new Promise(async(f,p)=>{try{let u=w.ext_id,I=w.ext_auth,k=await chrome.storage.local.get(["platformConnections"]);if(!await Ur()||!Ce||Ce.readyState!==WebSocket.OPEN)return;let b;r?(b=r,et.currentRequestId=b):i?(b=`search_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,et.currentRequestId=b):(b=et.currentRequestId,b||(b=`search_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,et.currentRequestId=b));const h=`${b}_${e}`;xa.set(h,{resolve:f,reject:p,requestType:e,alternativeKey:c});const m={type:e,isNewSearch:i,requestId:b,storeId:a,searchQuery:s,onlyForSuggestion:o,regionCode:l,alternativeKey:c,extId:u,extAuth:I,connectedStore:k,getFromDB:d};e==="findSimilarBulk"?(m.payload=t,m.alternativeKey||(m.alternativeKey=`findSimilarBulk_${Date.now()}_${Math.random().toString(36).substr(2,9)}`)):m.data=t,Ce.send(JSON.stringify(m)),Rs(),setTimeout(()=>{if(xa.has(h)){const{reject:A}=xa.get(h);xa.delete(h),A(new Error(`WebSocket parsing timeout for ${e}`))}},2*60*1e3)}catch{}})}function Rs(){jr&&clearTimeout(jr),jr=setTimeout(()=>{Ce&&Ce.readyState===WebSocket.OPEN&&(Kn=!0,Ce.close(1e3,"Idle timeout"),Ce=null)},Vy)}function Ur(){return new Promise(e=>{if(Ce&&Ce.readyState===WebSocket.OPEN){e(!0);return}(!Ce||Ce.readyState===WebSocket.CLOSED)&&zn();const t=(r=0)=>{Ce&&Ce.readyState===WebSocket.OPEN?e(!0):r<10?setTimeout(()=>t(r+1),500):e(!1)};t()})}function ma(e){et.totalRequests>=0&&(et.responsesReceived++,et.responsesReceived>=et.totalRequests&&(uc("finish",{message:"All clusters received, some sources may have failed."},et.currentRequestId),et={totalRequests:0,responsesReceived:0,currentRequestId:null}))}function zn(){if(!(Ce&&Ce.readyState===WebSocket.CONNECTING))try{Ce=new WebSocket("https://quick.buyhatke.com/"),Ce.onopen=()=>{ya=0,Kn=!1,Rs()},Ce.onclose=e=>{if(Ce=null,jr&&clearTimeout(jr),!Kn&&e.code!==1e3&&ya<un){const t=_o*Math.pow(2,ya);ya++,setTimeout(zn,t)}else ya>=un},Ce.onerror=e=>{},Ce.onmessage=e=>{Rs();try{const t=JSON.parse(e.data);if(t.type==="pong")return;if(t.requestId&&t.type){const r=`${t.requestId}_${t.type}`;if(xa.has(r)){const{resolve:i,reject:a}=xa.get(r);if(xa.delete(r),t.status==="success"){let s=!1;et.totalRequests>0&&et.currentRequestId===t.requestId&&et.responsesReceived>=et.totalRequests&&(s=!0);const o={success:!0,type:t.type,isSearchSessionComplete:s,responseReceived:et.responsesReceived+1,totalResponse:et.totalRequests,alternativeKey:t.alternativeKey};if(t.type==="findSimilar")o.similarProducts=t.similarProducts||{},o.sourceProduct=t.sourceProduct||null,o.variantId=t.variantId||null,o.clusters=[],o.totalProductCount=0,o.clusterCount=0;else if(t.type==="findSimilarBulk"){if(o.data=t.data||{},!o.alternativeKey&&t.requestId){const l=`${t.requestId}_findSimilarBulk`,c=xa.get(l);c&&c.alternativeKey?o.alternativeKey=c.alternativeKey:o.alternativeKey=`findSimilarBulk_${t.requestId}`}if(!o.data||Object.keys(o.data).length===0)o.data={},o.success=!1;else{let l=!1;for(let[c,d]of Object.entries(o.data)){for(let[f,p]of Object.entries(d||{}))if(Array.isArray(p)&&p.length>0){l=!0;break}if(l)break}l||(o.data={},o.success=!1)}}else o.clusters=t.clusters||[],o.totalProductCount=t.totalProductCount||0,o.clusterCount=t.clusterCount||0;i(o),et.totalRequests>=0&&t.type!=="findSimilar"&&t.type!=="findSimilarBulk"&&(et.responsesReceived++,et.responsesReceived>=et.totalRequests&&(uc("finish",{message:"All clusters received from all sources."},et.currentRequestId),et={totalRequests:0,responsesReceived:0,currentRequestId:null}))}else a(new Error(t.message||"Server error"))}}else t.type}catch{}}}catch{if(ya<un){const t=_o*Math.pow(2,ya);ya++,setTimeout(zn,t)}}}async function Wy(e,t){try{let r=null;switch(t.toLowerCase()){case"blinkit":r=await Ky(e);break;case"flipkart":case"flipkart_minutes":r=await Qy(e);break;case"amazon":case"amazon_fresh":case"amazonNow":r=await qy(e);break;case"zepto":Array.isArray(e)?r=await Zy(e):r=await pc(e);break;case"instamart":case"swiggy":r=await Sr(e);break;case"jiomart":r=await em(e);break;case"bigbasket":case"bbnow":case"bbNow":r=await Xy(e);break;case"dmart":r=await Yy(e);break;default:}return r}catch{return null}}async function Ky(e){var t,r,i,a,s,o,l,c,d,f;try{let p=_e==null?void 0:_e.blinkit;p||(await Ta(),p=_e==null?void 0:_e.blinkit);let u=p==null?void 0:p.bulkCartApi,I=p==null?void 0:p.auth;!e||!Array.isArray(e)||e.length;let k=await oa((t=I==null?void 0:I.deviceIdCookie)==null?void 0:t.domain,(r=I==null?void 0:I.deviceIdCookie)==null?void 0:r.name),y=(k==null?void 0:k.value)||"",b=await oa((i=I==null?void 0:I.tokenCookie)==null?void 0:i.domain,(a=I==null?void 0:I.tokenCookie)==null?void 0:a.name),h=(b==null?void 0:b.value)||"",m=await chrome.storage.local.get(["userLocation"]),A=((s=m==null?void 0:m.userLocation)==null?void 0:s.latitude)||"",P=((o=m==null?void 0:m.userLocation)==null?void 0:o.longitude)||"",S={latitude:String(A),longitude:String(P),deviceId:String(y),accessToken:String(h)},v=F=>{if(typeof F=="string")return F.replace(/{{(\w+)}}/g,(L,D)=>S[D]!==void 0?S[D]:"");if(Array.isArray(F))return F.map(L=>v(L));if(typeof F=="object"&&F!==null){let L={};for(let D in F)L[D]=v(F[D]);return L}return F},_=v(u==null?void 0:u.headers),T=v(u==null?void 0:u.url);const E=e.map(F=>{var L,D,V;return{product_id:((D=(L=F.product)==null?void 0:L.pid)==null?void 0:D.toString())||((V=F==null?void 0:F.id)==null?void 0:V.toString())||"",quantity:F.quantity||F.qty||1}}).filter(F=>F.product_id);E.length;const g=E.reduce((F,L)=>F+L.quantity,0),O={cart_value:1232,show_share_cart_preview:!0,total_items:g,items:E},$=await fetch(T,{method:u==null?void 0:u.method,headers:_,body:JSON.stringify(O)});if(!$.ok)throw new Error(`HTTP error ${$.status}`);const K=await $.json();let z=null;if(K.actions&&K.actions.length>0){for(const F of K.actions)if(F.type==="qd_open_generic_bottom_sheet"&&((f=(d=(c=(l=F.qd_open_generic_bottom_sheet)==null?void 0:l.bottom_button)==null?void 0:c.click_action)==null?void 0:d.cart_share_intent_shown)!=null&&f.deeplink_url)){const D=F.qd_open_generic_bottom_sheet.bottom_button.click_action.cart_share_intent_shown.deeplink_url.match(/&link=([^&]+)/);if(D&&D[1]){z=decodeURIComponent(D[1]);break}}}return{success:!0,data:K,deeplinkUrl:z,message:z?`Open this URL on your mobile device to add ${g} item${g===1?"":"s"} to your Blinkit cart!`:null,itemsCount:E.length,totalItems:g}}catch(p){return{success:!1,error:p.message}}}function zy(e){const t=new Map;for(const r of e){const i=r.id||r.productUrl;if(i)if(t.has(i)){const a=t.get(i),s=a.quantity||a.qty||1,o=r.quantity||r.qty||1;a.quantity=s+o,t.set(i,a)}else{const a=r.quantity||r.qty||1;t.set(i,{...r,quantity:a})}}return Array.from(t.values())}const Zn=new Set,dc=6e4;chrome.runtime.onConnect.addListener(e=>{e.name==="ATC_PROGRESS_PORT"&&(Hl(e,dc),Zn.add(e),e.onDisconnect.addListener(()=>{Zn.delete(e)}))});function js(e){for(const t of Zn)try{Vn(t,dc),t.postMessage(e)}catch{}}async function Zy(e){const t=zy(e),r=[];for(const[i,a]of t.entries())try{i>0&&await new Promise(l=>setTimeout(l,500));const s=await pc(a),o={...s,product:a};r.push(o);try{js({type:"ADD_TO_CART_ITEM_PROGRESS",payload:{platform:"zepto",result:o}})}catch{}s.success}catch(s){const o={success:!1,id:a.id,error:s.message,product:a};r.push(o);try{js({type:"ADD_TO_CART_ITEM_PROGRESS",payload:{platform:"zepto",result:o}})}catch{}}return r}async function pc(e){let t=null;const r=new Promise((i,a)=>{const s=(o,l)=>{o.action==="ZEPTO_CART_ADD_RESULT"&&o.tabId===t&&(chrome.runtime.onMessage.removeListener(s),o.success&&i(o.data))};chrome.runtime.onMessage.addListener(s),setTimeout(()=>{chrome.runtime.onMessage.removeListener(s)},4e4)});try{const i=(e==null?void 0:e.quantity)||(e==null?void 0:e.qty)||1;t=(await chrome.tabs.create({url:e.productUrl,active:!1})).id,await new Promise((o,l)=>{const c=setTimeout(()=>l(new Error("Page Load Timeout")),2e4),d=(f,p,u)=>{f===t&&p.status==="complete"&&(clearTimeout(c),chrome.tabs.onUpdated.removeListener(d),o())};chrome.tabs.onUpdated.addListener(d)}),await new Promise(o=>setTimeout(o,300)),chrome.tabs.sendMessage(t,{action:"ADD_ZEPTO_TO_CART",quantity:i,tabId:t}).catch(()=>{});const s=await r;return await new Promise(o=>setTimeout(o,200)),await chrome.tabs.remove(t),{success:!0,data:s,product:e}}catch(i){if(t)try{await chrome.tabs.remove(t)}catch{}return{success:!1,error:i.message,product:e}}}async function Xy(e){var t,r,i,a;try{let s=_e==null?void 0:_e.bigbasket;s||(await Ta(),s=_e==null?void 0:_e.bigbasket);let o=s==null?void 0:s.cartApi,l=s==null?void 0:s.auth;await nc();let c="";if(l){let b=await oa(l.cookieDomain,l.cookieName);c=b.value}let d=crypto.randomUUID(),f={csrfToken:c,tracker:d},p=b=>{if(typeof b=="string")return b.replace(/{{(\w+)}}/g,(h,m)=>f[m]!==void 0?f[m]:"");if(Array.isArray(b))return b.map(h=>p(h));if(typeof b=="object"&&b!==null){let h={};for(let m in b)h[m]=p(b[m]);return h}return b},u=p(o==null?void 0:o.headers),I=p(o==null?void 0:o.url);const k=await fetch(I,{method:o==null?void 0:o.method,headers:u,referrer:o==null?void 0:o.referrer,body:JSON.stringify({prod_id:(e==null?void 0:e.pid)||(e==null?void 0:e.id),qty:(e==null?void 0:e.quantity)||(e==null?void 0:e.qty)||1,_bb_client_type:"web",first_atb:1}),credentials:"include"});k.ok;const y=await k.json();return y.errors&&Array.isArray(y.errors)&&y.errors.length>0&&y.errors.some(h=>{let m=h.code||h.code_str||"";return m===400||m===500||m==="CART400"||m==="CART500"})?{success:!1,error:((t=y.errors[0])==null?void 0:t.display_msg)||((r=y.errors[0])==null?void 0:r.msg)||"Failed to add to cart",errors:y.errors,data:y}:y.status==="OK"||y.response&&y.response.sku?{success:!0,data:y,product:e}:y.errors&&Array.isArray(y.errors)&&y.errors.length>0?{success:!1,error:((i=y.errors[0])==null?void 0:i.display_msg)||((a=y.errors[0])==null?void 0:a.msg)||"Failed to add to cart",errors:y.errors,data:y}:{success:!0,data:y,product:e}}catch(s){return{success:!1,error:s.message}}}async function Yy(e){var t,r,i;try{let a=_e==null?void 0:_e.dmart;a||(await Ta(),a=_e==null?void 0:_e.dmart);let s=a==null?void 0:a.cartApi,o=a==null?void 0:a.auth;const l=Array.isArray(e)?e:[e];let c=await chrome.storage.local.get(["allStoresId"]),d=((t=c==null?void 0:c.allStoresId)==null?void 0:t.dmart)||"10677",f="";if(o){let E=await oa(o.cookieDomain,o.cookieName);if(E)try{let g=decodeURIComponent(E.value);f=JSON.parse(g).dm_token||""}catch{}}let p=new Date,u=E=>String(E).padStart(2,"0"),I=`${p.getFullYear()}${u(p.getMonth()+1)}${u(p.getDate())}_${u(p.getHours())}${u(p.getMinutes())}${u(p.getSeconds())}`,k=`w-${I}`,b=`${"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(E){let g=Math.random()*16|0;return(E=="x"?g:g&3|8).toString(16)})}||S-${I}||${d}`,h=btoa(b),m={dmToken:f,storeId:String(d),dInfo:k,requestId:h},A=E=>{if(typeof E=="string")return E.replace(/{{(\w+)}}/g,(g,O)=>m[O]!==void 0?m[O]:"");if(Array.isArray(E))return E.map(g=>A(g));if(typeof E=="object"&&E!==null){let g={};for(let O in E)g[O]=A(E[O]);return g}return E},P=A(s==null?void 0:s.headers),S=A(s==null?void 0:s.url);const v=l.map(E=>({productId:String((E==null?void 0:E.pid)||(E==null?void 0:E.id)),quantity:String((E==null?void 0:E.quantity)||(E==null?void 0:E.qty)||1)})),_=await fetch(S,{method:s==null?void 0:s.method,mode:"cors",credentials:"omit",headers:P,body:JSON.stringify({orderItem:v})});_.ok;const T=await _.json();if(T.orderItem&&Array.isArray(T.orderItem)&&T.orderItem.some(g=>(g==null?void 0:g.error_code)||(g==null?void 0:g.status)==="400"||(g==null?void 0:g.status)==="500")){let g=T.orderItem.filter($=>!$.error_code&&$.orderItemId),O=T.orderItem.filter($=>$.error_code||$.status==="400"||$.status==="500");return g.length>0?{success:!0,data:T,products:l,partialSuccess:!0,successfulItems:g,failedItems:O,message:`${g.length} item(s) added, ${O.length} item(s) failed`}:{success:!1,error:((r=O[0])==null?void 0:r.message)||((i=O[0])==null?void 0:i.error_code)||"Failed to add to cart",errors:O,data:T}}return T.orderId&&T.x_itemsInCart?{success:!0,data:T,products:l}:T.x_orderTotal||T.orderItem&&T.orderItem.some(E=>E.orderItemId)?{success:!0,data:T,products:l}:{success:!1,error:"Failed to add to cart - no success indicators in response",data:T}}catch(a){return{success:!1,error:a.message}}}async function Sr(e,t=0){var l,c,d;const i=[200,300,400,500,600];let a=_e==null?void 0:_e.instamart;a||(await Ta(),a=_e==null?void 0:_e.instamart);let s=a==null?void 0:a.cartApi,o=a==null?void 0:a.defaults;try{const f=Array.isArray(e)?e:[e],p=ic(),u=[],I=new Set;for(const g of f){const O=(g==null?void 0:g.quantity)||(g==null?void 0:g.qty)||1;let $=parseInt(g==null?void 0:g.storeId)||parseInt(g==null?void 0:g.store_id);Number.isFinite($)||($=o==null?void 0:o.storeId),$&&Number.isFinite($)&&I.add($);const K=(g==null?void 0:g.spinId)||(g==null?void 0:g.spin)||((l=g==null?void 0:g.variationData)==null?void 0:l.spin),z=(g==null?void 0:g.itemId)||(g==null?void 0:g.id),L={productId:(g==null?void 0:g.pid)||(g==null?void 0:g.productId)||(g==null?void 0:g.id),quantity:O,tradeFreebie:!1,spin:K,shipmentIdV2:p,itemId:z,meta:{type:"structure",storeId:$,freebie:!1,isGiftBag:!1},serviceLine:(o==null?void 0:o.serviceLine)||"INSTAMART"};u.push(L)}const k=Array.from(I),y=k.length>0?k[0]:(o==null?void 0:o.storeId)||null;if(k.length===0&&!y)return{success:!1,error:"No valid store ID found",data:null,message:"Failed to add items to cart - no valid store ID available",results:f.map(g=>({success:!1,product:g,error:"No valid store ID",message:"Failed to add product to cart"})),retryCount:0};const b={contactlessDelivery:!1,deliveryType:(o==null?void 0:o.deliveryType)||"INSTANT",owner:(o==null?void 0:o.owner)||"APP",preferredAddressId:null,ageConsentProvided:!1,useGiftBagPackaging:!1,useReusablePackaging:!1,incognitoCart:!1,includeConsents:["PHARMA"],primaryStoreId:y,storeIds:k.length>0?k:[y]},h={data:{items:u,cartMetaData:b,cartType:(o==null?void 0:o.serviceLine)||"INSTAMART"},source:"userInitiated",cartAnalyticsMetaInfo:{actionType:"SYNC_CART"}},m=await fetch(s==null?void 0:s.url,{method:s==null?void 0:s.method,mode:"cors",credentials:"include",headers:s==null?void 0:s.headers,body:JSON.stringify(h)});if(!m.ok)return t<5?(await new Promise(g=>setTimeout(g,i[t])),await Sr(e,t+1)):{success:!1,error:`HTTP ${m.status}: Request failed`,data:null,message:"Failed to add items to cart due to HTTP error",results:f.map(g=>({success:!1,product:g,error:`HTTP ${m.status}`,message:"Failed to add product to cart"})),retryCount:t};let A;try{A=await m.json()}catch{return t<5?(await new Promise(O=>setTimeout(O,i[t])),await Sr(e,t+1)):{success:!1,error:"Invalid JSON response",data:null,message:"Failed to parse response from server",results:f.map(O=>({success:!1,product:O,error:"Invalid JSON response",message:"Failed to add product to cart"})),retryCount:t}}const P=(A==null?void 0:A.statusCode)===0,S=((d=(c=A==null?void 0:A.data)==null?void 0:c.data)==null?void 0:d.items)||[];if(!Array.isArray(S)&&t<5)return await new Promise(g=>setTimeout(g,i[t])),await Sr(e,t+1);const _=f.map(g=>{const O=(g==null?void 0:g.pid)||(g==null?void 0:g.productId)||(g==null?void 0:g.id),$=S.find(K=>{var F;return((F=K==null?void 0:K.metadata)==null?void 0:F.product_id)===O});return{success:!!$,product:g,addedItem:$||null,error:$?null:"Item not added to cart (possibly out of stock)",message:$?"Product added successfully":"Failed to add product to cart"}}),T=_.every(g=>g.success),E=_.some(g=>g.success);return{success:T,allItemsAdded:T,someItemsAdded:E,addedCount:_.filter(g=>g.success).length,totalRequested:f.length,data:A,results:_,message:T?"All items added to cart successfully!":E?`Partial success: ${_.filter(g=>g.success).length}/${f.length} items added`:"Failed to add items to cart",retryCount:t}}catch(f){if(t<5)return await new Promise(u=>setTimeout(u,i[t])),await Sr(e,t+1);const p=Array.isArray(e)?e:[e];return{success:!1,error:f.message||"Unknown error occurred",data:null,message:"Failed to add items to cart due to error",results:p.map(u=>({success:!1,product:u,error:f.message||"Unknown error",message:"Failed to add product to cart"})),retryCount:t}}}async function Qy(e){let t=[];if(Array.isArray(e))t=e;else if(e&&typeof e=="object")t=[e];else return{success:!0,platform:"flipkart",results:[],message:"No products provided."};if(t.length===0)return{success:!0,platform:"flipkart",results:[],message:"No products provided."};let r=[],i=!0;const a=await Gy(t);if(!a.success)return{success:!1,platform:"flipkart",results:r,error:a.error||"Initial bulk add failed."};for(const s of t)if((s.qty||s.quantity||1)>1){const l=await Cy(s),c={...l,product:s,message:l.success?"Quantity updated successfully.":"Failed to update quantity."};r.push(c);try{js({type:"ADD_TO_CART_ITEM_PROGRESS",payload:{platform:"flipkart",result:c}})}catch{}l.success||(i=!1)}else{const l={success:!0,product:s,message:"Added successfully (Qty 1 via bulk add)."};r.push(l);try{js({type:"ADD_TO_CART_ITEM_PROGRESS",payload:{platform:"flipkart",result:l}})}catch{}}return{success:i,platform:"flipkart",results:r,message:i?"All products successfully added/updated.":"Some product quantities failed to update."}}async function fc(e,t){try{try{if(t.body){let i=JSON.parse(t.body);if(e.includes("/api/1/action/view")){let a=i.actionRequestContext.upsertRequest.cartContext}}}catch{}let r=await fetch(e,t);if(r.status>300){let i=e;e.includes("1.rome")?e=e.replace("1.rome","2.rome"):e.includes("2.rome")&&(e=e.replace("2.rome","1.rome")),e!==i&&(r=await fetch(e,t))}return r}catch{return null}}async function Gy(e){try{let t=_e==null?void 0:_e.flipkartMinutes;t||(await Ta(),t=_e==null?void 0:_e.flipkartMinutes);let r=t==null?void 0:t.bulkAddApi;if(!e||!Array.isArray(e)||e.length===0)return{success:!1,error:"Invalid or empty products array provided"};const i=e.map(p=>p.itemId||p.listingId).filter(Boolean),a={};e.forEach(p=>{const u=p.itemId||p.listingId;u&&(a[u]={productId:p.id||p.pid,quantity:1,cashifyDiscountApplied:!1,vulcanDiscountApplied:!1,shopListId:null,shopListItemId:null,previousQuantity:0})});const s={browseContext:{marketplace:"HYPERLOCAL",listings:i},browseCartContext:{cartContext:a,pageType:"Product"}};let o=p=>typeof p=="string"?p:typeof p=="object"&&p!==null?{...p}:p,l=o(r==null?void 0:r.headers),c=o(r==null?void 0:r.url);const d=await fc(c,{method:r==null?void 0:r.method,headers:l,body:JSON.stringify(s),mode:"cors",credentials:"include"});return d.ok,{success:!0,data:await d.json()}}catch(t){return{success:!1,error:t.message}}}async function Cy(e){try{let t=_e==null?void 0:_e.flipkartMinutes;t||(await Ta(),t=_e==null?void 0:_e.flipkartMinutes);let r=t==null?void 0:t.updateApi;const i=e.itemId??e.listingId,a=e.qty||e.quantity||1;if(!i)throw new Error("Product is missing required Listing ID (itemId/listingId).");const s={actionRequestContext:{upsertRequest:{cartContext:{[i]:{productId:(e==null?void 0:e.pid)||(e==null?void 0:e.id),quantity:a,cashifyDiscountApplied:!1,vulcanDiscountApplied:!1}}},pageUri:"/viewcart?marketplace=HYPERLOCAL&sm=HYPERLOCAL",pageNumber:1,type:"CART_UPDATE_ITEM",userContext:{}}};let o=u=>typeof u=="string"?u:typeof u=="object"&&u!==null?{...u}:u,l=o(r==null?void 0:r.headers),c=o(r==null?void 0:r.url);const d=await fc(c,{method:r==null?void 0:r.method,headers:l,body:JSON.stringify(s),mode:"cors",credentials:"include"});d.ok;const f=await d.json(),p=f==null?void 0:f.RESPONSE;return p&&p.errorMessage?{success:!1,error:p.errorMessage,data:f}:{success:!0,data:f}}catch(t){return{success:!1,error:t.message}}}async function qy(e){var t;try{let r=_e==null?void 0:_e.amazon;r||(await Ta(),r=_e==null?void 0:_e.amazon);let i=r==null?void 0:r.cartApi,a=await chrome.storage.local.get("amazonBrandId"),s=(a==null?void 0:a.amazonBrandId)||(r==null?void 0:r.defaultBrandId),o=await cc();const l=await lc(s,o),c=(e==null?void 0:e.offerId)||((t=e==null?void 0:e.cartMeta)==null?void 0:t.offerId)||e.offer_id||e.offer||"",d=e.pid||e.PID||e.id,f=(e==null?void 0:e.quantity)||(e==null?void 0:e.qty)||1,p=e.itemId||"",u=e.searchKeyword||"";let I={brandId:String(s),csrfToken:String(o),storeId:String(l),asin:String(d),offerId:String(c),quantity:String(f),itemId:String(p),searchKeyword:String(u)},k=P=>{if(typeof P=="string")return P.replace(/{{(\w+)}}/g,(S,v)=>I[v]!==void 0?I[v]:"");if(Array.isArray(P))return P.map(S=>k(S));if(typeof P=="object"&&P!==null){let S={};for(let v in P)S[v]=k(P[v]);return S}return P},y=k(i==null?void 0:i.headers),b=k(i==null?void 0:i.body),h=k(i==null?void 0:i.url);const m=await fetch(h,{method:i==null?void 0:i.method,headers:y,body:JSON.stringify(b),credentials:"include",mode:"cors"});return m.ok,{success:!0,data:{...await m.json(),offerId:c}}}catch(r){return{success:!1,error:r.message}}}async function em(e){var t;try{const r=await Wn();!r||!r.hasValidAuth||r.authToken;let i=parseInt(e==null?void 0:e.sellerId)||1;const a=Date.now();let s=(e==null?void 0:e.quantity)||(e==null?void 0:e.qty)||1;const l=`https://www.jiomart.com/mst/rest/v1/5/cart/add_item?product_code=${(e==null?void 0:e.pid)||(e==null?void 0:e.id)}&qty=${s}&seller_id=${i}&n=${a}`,c=await fetch(l,{method:"GET",mode:"cors",credentials:"include",headers:{accept:"application/json, text/javascript, */*; q=0.01","accept-language":"en-US,en;q=0.9",authtoken:r.authToken,pin:r.pin,priority:"u=0, i",regions:'{"groceries":"2852"}',"sec-ch-ua":'"Chromium";v="140", "Not=A?Brand";v="24", "Google Chrome";v="140"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin",storecode:r.storecode,userid:r.userid,"x-requested-with":"XMLHttpRequest"},referrer:"https://www.jiomart.com/?tab=low-price-guarantee"});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const d=await c.json();return d&&(d==null?void 0:d.status)==="fail"?{success:!1,error:((t=d.reason)==null?void 0:t.reason_eng)||"JioMart failed to add item",data:d}:{success:!0,data:d,productId:e==null?void 0:e.pid,quantity:e==null?void 0:e.quantity}}catch(r){return{success:!1,error:r.message}}}function hc(e){return new Promise(t=>{chrome.storage.local.get(e,r=>t(r||{}))})}function tm(e){return new Promise(t=>{chrome.storage.local.set(e,()=>t(!0))})}async function oa(e,t){try{let r=await new Promise(i=>{chrome.cookies.getAll({domain:e},a=>i(a))});if(r.length>0){let i=r.find(a=>a.name===t);return i||null}else return null}catch{return null}}setInterval(function(){Us==!1&&Hh()},8*3600*1e3);let So=0,yc=0;async function am(){So=new Date().getTime()/1e3;debugger;new Date().getTime()/1e3-So>2&&(Us=!0,await x.setItem("debugMod2",!0),await Bh(),clearInterval(yc))}async function rm(){let e=await x.getItem("debugMod2");e&&e===!0?Us=!0:yc=setInterval(function(){am()},5*1e3)}rm();let Hr={};async function mc(){try{let e=new Date,t=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()).getTime(),r=await fetch(`https://ext1.buyhatke.com/spend-apis/sitesList/getAllSites?platform=0?rand=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok){Hr={};return}const i=await r.json();i.status&&i.data.posList&&(Hr=i.data.posList)}catch(e){R("getAllSites",e)}}mc();function Nt(e){try{if(typeof e!="string")return"";const t=/((https?:\/\/|www\.)[^\s/$.?#].[^\s]*)/gi,r=e.match(t);return r?r[0]:""}catch(t){return console.log(t),""}}async function xt(e){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let t=await fetch(`https://ext1.buyhatke.com/extension-apis/chatBot/fetchProductDetails?extId=${w.ext_id}&extAuth=${w.ext_auth}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})});return t=await t.json(),console.log(t),(t==null?void 0:t.status)==1?t.data||{}:{}}catch(t){return console.log(t),{}}}async function Ts(e,t){var r,i,a;try{let s=await fetch(`https://graph.bitbns.com/getPredictedData.php?type=log&indexName=interest_centers&logName=info&pos=${t}&pid=${e}&mainFL=1`,{headers:{accept:"*/*","accept-language":"en-GB,en-US;q=0.9,en;q=0.8"},method:"GET"});s=await s.text();let o=[],l=s.split("~*~*");for(let c=0;c<l.length-1;c++){let d=l[c].split("~")[0],f=l[c].split("~")[1],u=d.split(" ")[0].split("-"),I=u[0],k=u[1]-1,y=u[2],b=new Date(parseInt(I),parseInt(k),parseInt(y)).toISOString();o.push({x:b,y:parseFloat(f)})}return{pointMap:o,days:(r=l[l.length-1])==null?void 0:r.split("&~&~")[1],weeks:(i=l[l.length-1])==null?void 0:i.split("&~&~")[2],months:(a=l[l.length-1])==null?void 0:a.split("&~&~")[3]}}catch(s){return console.log(s),{}}}async function wc(e,t){try{let r=`https://search-new.bitbns.com/buyhatke/comparePrice?PID=${t}&pos=${e}`,i=await fetch(r,{method:"GET"});return i.status>=400&&i.status<599?"":(i=await i.json(),i)}catch(r){return R("getCompareList",r),{status:0,err:r.msg||"Something went wrong"}}}function sm(e){if(typeof e!="string")return null;const t=/\b\d{1,3}(?:,\d{3})*(?:\.\d+)?\b|\b\d+(?:\.\d+)?\b/,r=e.match(t);if(r){const i=parseFloat(r[0].replace(/,/g,""));return isNaN(i)?null:i}return null}async function xr(){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");let e=await fetch("https://ext1.buyhatke.com/spend-apis/details/getActiveSites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({extId:w.ext_id,extAuth:w.ext_auth,platform:0})});return e=await e.json(),(e==null?void 0:e.data)||{}}catch(e){return console.log(e),{}}}async function nm({phone:e,email:t,pos:r,month:i,uniqueId:a}){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");const s={"Content-Type":"application/x-www-form-urlencoded"},o=new URLSearchParams;o.append("username",JSON.stringify({phone:e,email:t,uniqueId:a})),o.append("pos",r),o.append("month",i),o.append("extId",w.ext_id),o.append("extAuth",w.ext_auth),o.append("platform","0");const c=await(await fetch("https://ext1.buyhatke.com/spend-apis/details/getMonthWiseSpend",{method:"POST",headers:s,body:o})).json();return(c==null?void 0:c.data)||{}}catch(s){return console.error(s),{}}}function im(e){const t=new Date;t.setMonth(t.getMonth()+e);const r=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0");return`${r}-${i}`}async function om(e,t){try{w.ext_id=await x.getItem("ext_id"),w.ext_auth=await x.getItem("ext_auth");const r=new URLSearchParams;r.append("extId",w.ext_id),r.append("extAuth",w.ext_auth),r.append("pos",t.toString()),r.append("username",JSON.stringify(e)),r.append("platform","0");const a=await(await fetch("https://ext1.buyhatke.com/spend-apis/details/getTopMonthlySpendPOST",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:r})).json();return(a==null?void 0:a.data)||{}}catch(r){return console.error("Error fetching top monthly spend:",r),{}}}const dn=async(e,t,r)=>{try{const i=im(r);let a=0,s=0,o=[];for(let l of e[t]){let d=(await nm({...l,pos:t,month:i})).arr||[];d=d.map(f=>({...f,pos:t,currency:l.currency})),a+=d.reduce((f,p)=>f+p.price,0),s+=d.length,o.push(...d)}return{totalMonthSpend:a,totalMonthOrders:s,topSpends:o.sort((l,c)=>c.price-l.price).slice(0,5)}}catch(i){return console.error("Error in getMonthlySpendSummary:",i),{totalMonthSpend:0,totalMonthOrders:0,topSpends:[]}}},bc=async(e,t)=>{try{return!e.prod||!e.pid||!e.price?void 0:await(await fetch(`https://api.buyhatke.com/paapi/priceAlert?extId=${w.ext_id}&extAuth=${w.ext_auth}`,{method:"POST",body:`prod=${encodeURI(e.prod)}&price=${e.price}&price_set=${t||e.price}&image=${encodeURI(e.image)}&url=${encodeURI(e.url||e.link)}&pos=${e.position||e.pos}&pid=${e.pid}&sitepos=${e.position||e.pos}&ext_id=${w.ext_id}&auth_val=${w.ext_auth}`,headers:{"Content-Type":"application/x-www-form-urlencoded"}})).json()}catch(r){return{status:0,err:r.msg||"Something went Wrong"}}},lm=async e=>{var t;try{const r=w.ext_id,i=w.ext_auth,a=new URLSearchParams,s={faq:0,action:1,recommend:2,productcomparison:3,verdict:4,prediction:5,invalid:6};let o=s==null?void 0:s[(t=e==null?void 0:e.actionType)==null?void 0:t.toLowerCase()];a.append("feedbackId",String(e.feedbackId)),a.append("feedbackType",String(e.feedbackType)),a.append("actionType",String(o)),e.comment&&a.append("comment",e.comment);const l=`https://ext1.buyhatke.com/extension-apis/chat-feedback/submitFeedback?extId=${r}&extAuth=${i}`,c=fetch(l,{method:"POST",body:a,headers:{"Content-Type":"application/x-www-form-urlencoded"}});return c.ok?await c.json():{status:0,err:"Failed to send Feedback"}}catch(r){return console.log("error in sendChatFeedback",r),{status:0,err:"Failed to send Feedback"}}};async function cm(e,t,r,i,a,s,o){var l,c,d,f,p,u,I,k;try{e=Number(e);let y=1,b=!!(a!=null&&a.pid&&(a!=null&&a.prod));switch(e){case 81:{let h=a==null?void 0:a.position;if(t==0)if(h)h=await Dt(a.url||"");else return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please provide the website URL to check coupons",inputHint:{type:"productUrl"}};else if(t==1){if((i==null?void 0:i.toLowerCase())=="no")return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please provide the website URL to check coupons",inputHint:{type:"productUrl"}};if((i==null?void 0:i.toLowerCase())!="yes")return r<1?{queryId:e,actionId:1,msgType:"string",retryCount:1,systemResponse:"Please Answer in yes or no!",inputHint:{type:"yesno"}}:{queryId:e,actionId:0,msgType:"string",retryCount:0,systemResponse:"Oops! Cannot find Coupons. Try with another product page or url.."}}else if(t==2){const m=Nt(i);if(!m&&r<1)return{queryId:e,actionId:2,retryCount:(r||0)+1,msgType:"string",systemResponse:"Please provide a valid url.",inputHint:{type:"productUrl"}};if(!m)return{queryId:e,actionId:0,retryCount:(r||0)+1,msgType:"string",systemResponse:"Oops! Something went wrong. Please try again later."};h=await Dt(m||a.url||"")}if(!h)return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Cannot find Coupons. Try with another product page or url.."};try{const m=await sl({pos:h});return console.log("couponsList",m,h),{queryId:e,actionId:0,retryCount:0,msgType:"couponsList",systemResponse:m}}catch(m){console.log("error in getDealScore",m)}return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Cannot find Coupons. Try with another product page or url.."}}case 84:{const h=o&&typeof o=="object"?o:{},m=typeof h.aggregateType=="string"?h.aggregateType.toLowerCase():"",A=typeof h.timestamp=="string"?h.timestamp:typeof h.startTimestamp=="string"?h.startTimestamp:void 0,P=typeof h.endTimestamp=="string"?h.endTimestamp:void 0,S=T=>typeof T=="string"?T.replace(/\s/g,""):void 0,v=S(A),_=S(P);if(t==0)if(b)if(o!=null&&o.isProdSame)a=await xt(a.url||"");else return{queryId:e,actionId:1,retryCount:0,msgType:"string",systemResponse:`Do you want to see price history of ${(a==null?void 0:a.prod)??"current product"}?`,inputHint:{type:"yesno"}};else return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please Enter the product link to view its price history",inputHint:{type:"productUrl"}};else if(t==1){if((i==null?void 0:i.toLowerCase())=="no")return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please Enter the product link to view its price history",inputHint:{type:"productUrl"}};if((i==null?void 0:i.toLowerCase())!="yes")return r<1?{queryId:e,actionId:1,msgType:"string",retryCount:1,systemResponse:"Please Answer in yes or no!",inputHint:{type:"yesno"}}:{queryId:e,actionId:0,msgType:"string",retryCount:0,systemResponse:"Oops! Cannot find results. Try with another product page or url.."}}else if(t==2){const T=Nt(i);if(!T&&r<1)return{queryId:e,actionId:2,retryCount:(r||0)+1,msgType:"string",systemResponse:"Please provide a valid url.",inputHint:{type:"productUrl"}};if(!T)return{queryId:e,actionId:0,retryCount:(r||0)+1,msgType:"string",systemResponse:"Oops! Cannot find results. Try with another product page or url.."};a=await xt(T||"")}try{const T=await Ts(a.pid,a.position),E={productPrice:a.price,priceGraphData:(T==null?void 0:T.pointMap)??[],pos:a.position};if((l=T==null?void 0:T.pointMap)!=null&&l.length&&m){const g=v?Date.parse(v):void 0,O=_?Date.parse(_):void 0,$=T.pointMap.filter(F=>{const L=Date.parse(F==null?void 0:F.x);return!(Number.isNaN(L)||g!==void 0&&L<g||O!==void 0&&L>O)}),z=($.length>0?$:T.pointMap).map(F=>Number(F==null?void 0:F.y)).filter(F=>Number.isFinite(F));if(z.length>0){let F;switch(m){case"min":F=Math.min(...z);break;case"max":F=Math.max(...z);break;case"avg":case"average":F=z.reduce((L,D)=>L+D,0)/z.length;break;default:F=void 0}if(F!==void 0){const L={min:"lowest",max:"highest",avg:"average",average:"average"},D=q=>new Date(q).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"}),V=q=>{const re=[{label:"year",ms:31536e6},{label:"month",ms:2592e6},{label:"week",ms:6048e5},{label:"day",ms:864e5}],ue=Math.abs(q);for(const{label:Te,ms:se}of re){const Ee=Math.round(ue/se);if(Ee>=1)return`${Ee} ${Te}${Ee>1?"s":""}`}return"day"},te=((q,re)=>{if(q!==void 0&&re!==void 0)return`between ${D(q)} and ${D(re)}`;if(q!==void 0){const Te=(re??Date.now())-q;return Te>0?`in the last ${V(Te)}`:`after ${D(q)}`}return re!==void 0?`up to ${D(re)}`:"overall"})(g,O),ne=`The ${L[m]??m} price ${te} was ${Number(F.toFixed(2))}.`;return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:ne}}}}return{queryId:e,actionId:0,retryCount:0,msgType:"priceGraphResutl",systemResponse:E}}catch(T){console.log("error in getPriceGraphPoint",T)}return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Sorry, I couldn't understand your request."}}case 85:break;case 87:if(t==0)if(b)if(o!=null&&o.isProdSame)a=await xt(a.url||"");else return{queryId:e,actionId:1,retryCount:0,msgType:"string",systemResponse:`Do you want to remove alert for ${(a==null?void 0:a.prod)??"current product"}?`,inputHint:{type:"yesno"}};else return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter the product URL to remove its alert",inputHint:{type:"productUrl"}};else if(t==1){if((i==null?void 0:i.toLowerCase())=="no")return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter the product URL to remove its alert",inputHint:{type:"productUrl"}};if((i==null?void 0:i.toLowerCase())!="yes")return r<1?{queryId:e,actionId:1,msgType:"string",retryCount:r+1,systemResponse:"Please Answer in yes or no!",inputHint:{type:"yesno"}}:{queryId:e,actionId:0,msgType:"string",retryCount:0,systemResponse:"Oops! Cannot Remove Price Alert. Try with another product page or url.."}}else if(t==2){const h=Nt(i);if(!h&&r<1)return{queryId:e,actionId:2,retryCount:(r||0)+1,msgType:"string",systemResponse:"Please provide a valid url.",inputHint:{type:"productUrl"}};if(!h)return{queryId:e,actionId:0,retryCount:(r||0)+1,msgType:"string",systemResponse:"Oops! Cannot remove Price Alert. Try with another product page or url.."};a=await xt(h||"")}try{let h="";Ye.length==0&&await Ft();for(let m of Ye)if(m.pid==a.pid&&m.position==a.position){h=m.link_id;break}if(h&&a.pid&&a.position&&(await fetch(`https://api.buyhatke.com/paapi/removeAlert?extId=${w.ext_id}&extAuth=${w.ext_auth}`,{method:"POST",body:`ext_id=${w.ext_id}&auth_val=${w.ext_auth}&link_id=${h}`,headers:{"Content-Type":"application/x-www-form-urlencoded"}})).status==200)return await Ft(),{actionId:0,retryCount:0,msgType:"string",systemResponse:`Price Alert Removed successfully for ${a.prod}`}}catch(h){console.log("error in remove alert",h)}return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Remove Alert Failed. Try with another product page or url"};case 86:case 88:if(t==0)if(b)if(o!=null&&o.isProdSame){if(a=await xt(a.url||""),!(a!=null&&a.pid)||!(a!=null&&a.prod))return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Cannot set Price Alert. Try with another product page or url.."};const h=a.price,m={0:{text:`${Math.floor(h*.75)}`,value:Math.floor(h*.75)},1:{text:`${Math.floor(h*.8)}`,value:Math.floor(h*.8)},2:{text:`${Math.floor(h*.9)}`,value:Math.floor(h*.9)}};return{queryId:e,actionId:3,retryCount:0,msgType:"string",productDetails:a,systemResponse:"At what price you want to set/update alert?",inputHint:{type:"priceSuggestions",currentPrice:h,options:m}}}else return{queryId:e,actionId:1,retryCount:0,msgType:"string",systemResponse:`Do you want to set/update alert for ${(a==null?void 0:a.prod)??"current product"}?`,inputHint:{type:"yesno"}};else return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter product URL to set/update its alert",inputHint:{type:"productUrl"}};else if(t==1){if((i==null?void 0:i.toLowerCase())=="no")return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter product URL to set/update its alert",inputHint:{type:"productUrl"}};if((i==null?void 0:i.toLowerCase())=="yes"){const h=a.price,m={0:{text:`${Math.floor(h*.75)}`,value:Math.floor(h*.75)},1:{text:`${Math.floor(h*.8)}`,value:Math.floor(h*.8)},2:{text:`${Math.floor(h*.9)}`,value:Math.floor(h*.9)}};return{queryId:e,actionId:3,retryCount:0,msgType:"string",productDetails:a,systemResponse:"At what price you want to set/update alert?",inputHint:{type:"priceSuggestions",currentPrice:h,options:m}}}else return r<1?{queryId:e,actionId:1,msgType:"string",retryCount:r+1,systemResponse:"Please Answer in yes or no!",inputHint:{type:"yesno"}}:{queryId:e,actionId:0,msgType:"string",retryCount:0,systemResponse:"Oops! Cannot find Price Alert. Try with another product page or url.."}}else if(t==2){const h=Nt(i);if(!h&&r<1)return{queryId:e,actionId:2,retryCount:(r||0)+1,msgType:"string",systemResponse:"Please provide a valid url.",inputHint:{type:"productUrl"}};if(!h)return{queryId:e,actionId:0,retryCount:(r||0)+1,msgType:"string",systemResponse:"Oops! Cannot update Price Alert. Try with another product page or url.."};if(a=await xt(h||""),!(a!=null&&a.pid)||!(a!=null&&a.prod))return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Cannot update Price Alert. Try with another product page or url.."};const m=a.price,A={0:{text:`${Math.floor(m*.75)}`,value:Math.floor(m*.75)},1:{text:`${Math.floor(m*.8)}`,value:Math.floor(m*.8)},2:{text:`${Math.floor(m*.9)}`,value:Math.floor(m*.9)}};return{queryId:e,actionId:3,retryCount:0,msgType:"string",productDetails:a,systemResponse:"At what price you want to set/update alert?",inputHint:{type:"priceSuggestions",currentPrice:m,options:A}}}else if(t==3){let h=sm(i);if((!h||isNaN(h))&&r<y)return{queryId:e,actionId:3,retryCount:r+1,msgType:"string",productDetails:a,systemResponse:"Please provide a valid price"};if(!h||isNaN(h))return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Cannot update Price Alert. Try with another product page or url.."};let m="";Ye.length==0&&await Ft();for(let A of Ye)if(A.pid==a.pid&&A.position==a.position){m=A.link_id;break}if(m){if((await fetch(`https://api.buyhatke.com/paapi/updatePriceAlert?extId=${w.ext_id}&extAuth=${w.ext_auth}`,{method:"POST",body:`ext_id=${w.ext_id}&auth_val=${w.ext_auth}&link_id=${m}&platform=0&price_not=${h}`,headers:{"Content-Type":"application/x-www-form-urlencoded"}})).status==200)return await Ft(),{actionId:0,retryCount:0,msgType:"string",systemResponse:`Price Alert Updated Successfully! for ${a.prod}`}}else if((await bc(a,h||a.price)).status==1)return await Ft(),{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:`Price Alert set at ${h} for ${a.prod}`};return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Update Alert Failed. Try with another product page or url"}}break;case 89:return a.position?(Ye.length==0&&await Ft(),{queryId:e,actionId:0,retryCount:0,msgType:"priceAlertList",systemResponse:Ye}):{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Failed to show Alert. Try again"};case 90:if(t==0)if(b)if(o!=null&&o.isProdSame)a=await xt(a.url||"");else return{queryId:e,actionId:1,retryCount:0,msgType:"string",systemResponse:`Do you want to see LookAlike result for ${(a==null?void 0:a.prod)??"current product"}?`,inputHint:{type:"yesno"}};else return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter product URL to find lookalikes",inputHint:{type:"productUrl"}};else if(t==1){if((i==null?void 0:i.toLowerCase())=="no")return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter product URL to find lookalikes",inputHint:{type:"productUrl"}};if((i==null?void 0:i.toLowerCase())!="yes")return r<1?{queryId:e,actionId:1,msgType:"string",retryCount:(r||0)+1,systemResponse:"Please Answer in yes or no!",inputHint:{type:"yesno"}}:{queryId:e,actionId:0,msgType:"string",retryCount:0,systemResponse:"Oops! Cannot find LookALike results. Try with another product page or url.."}}else if(t==2){const h=Nt(i);if(!h&&r<1)return{queryId:e,actionId:2,retryCount:(r||0)+1,msgType:"string",systemResponse:"Please provide a valid url.",inputHint:{type:"productUrl"}};if(!h)return{queryId:e,actionId:0,retryCount:(r||0)+1,msgType:"string",systemResponse:"Oops! Cannot find LookALike results. Try with another product page or url.."};a=await xt(h||"")}if(!(a!=null&&a.pid)||!(a!=null&&a.prod))return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Cannot find LookALike results. Try with another product page or url.."};try{const h=((c=await Tn(a.pid,a.position,a.image,a.prod,a.price))==null?void 0:c.data)||[];return{queryId:e,actionId:0,retryCount:0,msgType:"dittoResult",systemResponse:h}}catch(h){console.log("error in getDittoSearchData",h)}return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Cannot find LookALike results. Try with another product page or url.."};case 91:if(t==0)if(b)if(o!=null&&o.isProdSame)a=await xt(a.url||"");else return{queryId:e,actionId:1,retryCount:0,msgType:"string",systemResponse:`Do you want to compare prices for ${(a==null?void 0:a.prod)??"current product"}?`,inputHint:{type:"yesno"}};else return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter the product link to compare its price across stores",inputHint:{type:"productUrl"}};else if(t==1){if((i==null?void 0:i.toLowerCase())=="no")return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter the product link to compare its price across stores",inputHint:{type:"productUrl"}};if((i==null?void 0:i.toLowerCase())!="yes")return r<1?{queryId:e,actionId:1,msgType:"string",retryCount:(r||0)+1,systemResponse:"Please Answer in yes or no!",inputHint:{type:"yesno"}}:{queryId:e,actionId:0,msgType:"string",retryCount:0,systemResponse:"Oops! Cannot find Comparison. Try with another product page or url.."}}else if(t==2){const h=Nt(i);if(!h&&r<1)return{queryId:e,actionId:2,retryCount:(r||0)+1,msgType:"string",systemResponse:"Please provide a valid url.",inputHint:{type:"productUrl"}};if(!h)return{queryId:e,actionId:0,retryCount:(r||0)+1,msgType:"string",systemResponse:"Oops! Cannot find Comparsion. Try with another product page or url.."};a=await xt(h||"")}if(!(a!=null&&a.pid)||!(a!=null&&a.prod))return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Cannot find Comparison results. Try with another product page or url.."};try{const h=await wc(a.position,a.pid);return{queryId:e,actionId:0,retryCount:0,msgType:"compareResults",systemResponse:h}}catch(h){console.log("error in getCompareList",h)}return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Cannot find Comparison results. Try with another product page or url.."};case 93:if(t==0)return{queryId:e,actionId:1,retryCount:0,msgType:"string",systemResponse:"Do you want to see result for current platform?",inputHint:{type:"yesno"}};if(t==1){if((i==null?void 0:i.toLowerCase())=="no")return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter the website link to check spend! (eg: https://www.flipkart.com/)",inputHint:{type:"productUrl"}};if((i==null?void 0:i.toLowerCase())!="yes")return r<1?{queryId:e,actionId:1,msgType:"string",retryCount:(r||0)+1,systemResponse:"Please Answer in yes or no!",inputHint:{type:"yesno"}}:{queryId:e,actionId:0,msgType:"string",retryCount:0,systemResponse:"Oops! No spend Found here. Try with another product page or url.."}}else if(t==2){const h=Nt(i);if(!h&&r<1)return{queryId:e,actionId:2,retryCount:(r||0)+1,msgType:"string",systemResponse:"Please provide a valid url.",inputHint:{type:"productUrl"}};if(!h)return{queryId:e,actionId:0,retryCount:(r||0)+1,msgType:"string",systemResponse:"Oops! No spend Found here. Try with another product page or url.."};a.position=await Dt(h||a.url||"")}try{const h=a.position;if(Ot||await Xa(h),!h||!((d=Ot.liveSites)!=null&&d[h]))return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Spend lens not Supported here. Try with another product page or url."};const m=await xr(),A=(m==null?void 0:m.spend_data)||{};let P={};return h>0&&(A!=null&&A[h])?(P.currentSiteSpendDetails=A[h],P.pos=h,{queryId:e,actionId:0,retryCount:0,msgType:"spendResult",systemResponse:P}):{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:`Please calculate your spend on ${(f=Hr[h])==null?void 0:f.website_name} to view your spend`}}catch(h){console.log("error in getActiveSite",h)}return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Sorry, I couldn't understand your request."};case 94:try{const h=a.position;if(Ot||await Xa(h),!h||!((p=Ot.liveSites)!=null&&p[h]))return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Spend lens not Supported here. Try with another product page or url."};const m=await xr(),A=(m==null?void 0:m.spend_data)||{};return{queryId:e,actionId:0,retryCount:0,msgType:"spendResultAll",systemResponse:A}}catch(h){console.log("error in getActiveSite",h)}return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Spend lens not Supported here. Try with another product page or url."};case 95:if(t==0)return{queryId:e,actionId:1,retryCount:0,msgType:"string",systemResponse:"Do you want to see last months spend for current platform?",inputHint:{type:"yesno"}};if(t==1){if((i==null?void 0:i.toLowerCase())=="no")return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please 3nter site URL to view its last months spend! (eg: https://www.flipkart.com/)",inputHint:{type:"productUrl"}};if((i==null?void 0:i.toLowerCase())!="yes")return r<1?{queryId:e,actionId:1,msgType:"string",retryCount:(r||0)+1,systemResponse:"Please Answer in yes or no!",inputHint:{type:"yesno"}}:{queryId:e,actionId:0,msgType:"string",retryCount:0,systemResponse:"Oops! No spend Found here. Try with another product page or url.."}}else if(t==2){const h=Nt(i);if(!h&&r<1)return{queryId:e,actionId:2,retryCount:(r||0)+1,msgType:"string",systemResponse:"Please provide a valid url.",inputHint:{type:"productUrl"}};if(!h)return{queryId:e,actionId:0,retryCount:(r||0)+1,msgType:"string",systemResponse:"Oops! No spend Found here. Try with another product page or url.."};a.position=await Dt(h||a.url||"")}try{const h=a.position;if(Ot||await Xa(h),!h||!((u=Ot.liveSites)!=null&&u[h]))return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Spend lens not Supported here. Try with another product page or url."};const m=await xr(),A=(m==null?void 0:m.spend_data)||{};return{queryId:e,actionId:0,retryCount:0,msgType:"spendMonthlySummary",systemResponse:await dn(A,h,-1)}}catch(h){console.log("error in getActiveSite",h)}return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Spend lens not Supported here. Try with another product page or url."};case 97:if(t==0)return{queryId:e,actionId:1,retryCount:0,msgType:"string",systemResponse:"Do you want to see your top spends of current platform?",inputHint:{type:"yesno"}};if(t==1){if((i==null?void 0:i.toLowerCase())=="no")return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please provide site url to view its top spend! (eg: https://www.flipkart.com/)",inputHint:{type:"productUrl"}};if((i==null?void 0:i.toLowerCase())!="yes")return r<1?{queryId:e,actionId:1,msgType:"string",retryCount:(r||0)+1,systemResponse:"Please Answer in yes or no!",inputHint:{type:"yesno"}}:{queryId:e,actionId:0,msgType:"string",retryCount:0,systemResponse:"Oops! No spend Found here. Try with another product page or url.."}}else if(t==2){const h=Nt(i);if(!h&&r<1)return{queryId:e,actionId:2,retryCount:(r||0)+1,msgType:"string",systemResponse:"Please provide a valid url.",inputHint:{type:"productUrl"}};if(!h)return{queryId:e,actionId:0,retryCount:(r||0)+1,msgType:"string",systemResponse:"Oops! No spend Found here. Try with another product page or url.."};a.position=await Dt(h||a.url||"")}try{const h=a.position;if(Ot||await Xa(h),!h||!((I=Ot.liveSites)!=null&&I[h]))return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Spend lens not Supported here. Try with another product page or url."};const m=await xr(),A=(m==null?void 0:m.spend_data)||{};let P=[];for(let S of A[h]){const _=((await om(S,h)).arr||[]).map(T=>({...T,pos:h,currency:S.currency}));P.push(..._)}return{queryId:e,actionId:0,retryCount:0,msgType:"spendTopResult",systemResponse:P.sort((S,v)=>v.price-S.price).slice(0,5)}}catch(h){console.log("error in getActiveSite",h)}return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Spend lens not Supported here. Try with another product page or url."};case 98:if(t==0)return{queryId:e,actionId:1,retryCount:0,msgType:"string",systemResponse:"Do you want to compare this months spend with last month for current platform?",inputHint:{type:"yesno"}};if(t==1){if((i==null?void 0:i.toLowerCase())=="no")return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter site URL to compare its last months spend! (eg: https://www.flipkart.com/)",inputHint:{type:"productUrl"}};if((i==null?void 0:i.toLowerCase())!="yes")return r<1?{queryId:e,actionId:1,msgType:"string",retryCount:(r||0)+1,systemResponse:"Please Answer in yes or no!",inputHint:{type:"yesno"}}:{queryId:e,actionId:0,msgType:"string",retryCount:0,systemResponse:"Oops! No spend Found here. Try with another product page or url.."}}else if(t==2){const h=Nt(i);if(!h&&r<1)return{queryId:e,actionId:2,retryCount:(r||0)+1,msgType:"string",systemResponse:"Please provide a valid url.",inputHint:{type:"productUrl"}};if(!h)return{queryId:e,actionId:0,retryCount:(r||0)+1,msgType:"string",systemResponse:"Oops! No spend Found here. Try with another product page or url.."};a.position=await Dt(h||a.url||"")}try{const h=a.position;if(Ot||await Xa(h),!h||!((k=Ot.liveSites)!=null&&k[h]))return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Spend lens not Supported here. Try with another product page or url."};const m=await xr(),A=(m==null?void 0:m.spend_data)||{},P=await dn(A,h,-1),S=await dn(A,h,0);return{queryId:e,actionId:0,retryCount:0,msgType:"spendCompareResult",systemResponse:{thisMonthSpend:S,lastMonthSpend:P}}}catch(h){console.log("error in getActiveSite",h)}return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Spend lens not Supported here. Try with another product page or url."};case 100:return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Sorry! Can't process that request now. Try another feature"};case 114:try{const{status:h,data:m,err:A}=await Th();return h&&m?{queryId:e,actionId:0,retryCount:0,msgType:"object",systemResponse:m}:{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:A+" For more details, visit the https://buyhatke.com/referral"}}catch(h){return console.log("error in getReferralInfo",h),{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Unable to fetch rewards info at the moment. Please try again later. For more details, visit the https://buyhatke.com/referral"}}case 115:try{const h=await ac();return h?{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:`Your referral code is ${h}. Share it with your friends and earn rewards!, For more details, visit the https://buyhatke.com/referral`}:{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Unable to fetch referral code at the moment. Please try again later. For more details, visit the https://buyhatke.com/referral"}}catch(h){return console.log("error in fetchReferralCode",h),{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Unable to fetch referral code at the moment. Please try again later. For more details, visit the https://buyhatke.com/referral"}}case 201:if(t==0||!t)if(b)if(o!=null&&o.isProdSame)a=await xt(a.url||"");else return{queryId:e,actionId:1,retryCount:0,msgType:"string",systemResponse:`Would you like insights on the best time to purchase ${(a==null?void 0:a.prod)??"current product"}?`,inputHint:{type:"yesno"}};else return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter the product link to see when it's the best time to purchase",inputHint:{type:"productUrl"}};else if(t==1){if((i==null?void 0:i.toLowerCase())=="no")return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter the product link to see when it's the best time to purchase",inputHint:{type:"productUrl"}};if((i==null?void 0:i.toLowerCase())!="yes")return r<1?{queryId:e,actionId:1,msgType:"string",retryCount:(r||0)+1,systemResponse:"Please Answer in yes or no!",inputHint:{type:"yesno"}}:{queryId:e,actionId:0,msgType:"string",retryCount:0,systemResponse:"Oops! Something went wrong. Please try again later."}}else if(t==2){const h=Nt(i);if(!h&&r<1)return{queryId:e,actionId:2,retryCount:(r||0)+1,msgType:"string",systemResponse:"Please provide a valid url.",inputHint:{type:"productUrl"}};if(!h)return{queryId:e,actionId:0,retryCount:(r||0)+1,msgType:"string",systemResponse:"Oops! Something went wrong. Please try again later."};a=await xt(h||"")}if(!(a!=null&&a.pid)||!(a!=null&&a.prod))return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Something went wrong. Please try again later."};try{const h=await ii([a.pid],a.position);return{queryId:e,actionId:0,retryCount:0,msgType:"dealsScore",systemResponse:{price:a.price,pid:a.pid,thunderObj:{...h==null?void 0:h[0],productData:{prod:a.prod,image:a.image,prodUrl:a.url}}}}}catch(h){console.log("error in getDealScore",h)}return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Something went wrong. Please try again later."};case 202:if(t==0)if(b)if(o!=null&&o.isProdSame)a=await xt(a.url||"");else return{queryId:e,actionId:1,retryCount:0,msgType:"string",systemResponse:`Do you want to know predictions of ${(a==null?void 0:a.prod)??"current product"}?`,inputHint:{type:"yesno"}};else return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter the product link to get price predictions",inputHint:{type:"productUrl"}};else if(t==1){if((i==null?void 0:i.toLowerCase())=="no")return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter the product link to get price predictions",inputHint:{type:"productUrl"}};if((i==null?void 0:i.toLowerCase())!="yes")return r<1?{queryId:e,actionId:1,msgType:"string",retryCount:(r||0)+1,systemResponse:"Please Answer in yes or no!",inputHint:{type:"yesno"}}:{queryId:e,actionId:0,msgType:"string",retryCount:0,systemResponse:"Oops! Something went wrong. Please try again later."}}else if(t==2){const h=Nt(i);if(!h&&r<1)return{queryId:e,actionId:2,retryCount:(r||0)+1,msgType:"string",systemResponse:"Please provide a valid url.",inputHint:{type:"productUrl"}};if(!h)return{queryId:e,actionId:0,retryCount:(r||0)+1,msgType:"string",systemResponse:"Oops! Cannot predict price drop. Try with another product page or url.."};a=await xt(h||"")}if(!(a!=null&&a.pid)||!(a!=null&&a.prod))return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Cannot predict price drop. Try with another product page or url.."};try{let h=await Ts(a.pid,a.position);return{queryId:e,actionId:0,retryCount:0,msgType:"priceDropPrediction",systemResponse:{explain:`Price is expected to drop by ${100-h.days}% in 2-3 days and ${100-h.weeks}% in a week and ${100-h.months}% in a month.`,priceGraphData:h}}}catch(h){console.log("error in getDealScore",h)}return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Cannot predict price drop. Try with another product page or url.."};case 205:{if(t==0)if(b)if(o!=null&&o.isProdSame)a=await xt(a.url||"");else return{queryId:e,actionId:1,retryCount:0,msgType:"string",systemResponse:`Do you want to see price stats of ${(a==null?void 0:a.prod)??"current product"}?`,inputHint:{type:"yesno"}};else return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter the product link to check price stats",inputHint:{type:"productUrl"}};else if(t==1){if((i==null?void 0:i.toLowerCase())=="no")return{queryId:e,actionId:2,retryCount:0,msgType:"string",systemResponse:"Please enter the product link to check price stats",inputHint:{type:"productUrl"}};if((i==null?void 0:i.toLowerCase())!="yes")return r<1?{queryId:e,actionId:1,msgType:"string",retryCount:1,systemResponse:"Please Answer in yes or no!",inputHint:{type:"yesno"}}:{queryId:e,actionId:0,msgType:"string",retryCount:0,systemResponse:"Oops! Cannot find results. Try with another product page or url.."}}else if(t==2){const h=Nt(i);if(!h&&r<1)return{queryId:e,actionId:2,retryCount:(r||0)+1,msgType:"string",systemResponse:"Please provide a valid url.",inputHint:{type:"productUrl"}};if(!h)return{queryId:e,actionId:0,retryCount:(r||0)+1,msgType:"string",systemResponse:"Oops! Cannot find results. Try with another product page or url.."};a=await xt(h||"")}try{const h=await Ts(a.pid,a.position),m={productPrice:a.price,priceGraphData:(h==null?void 0:h.pointMap)??[],pos:a.position};return{queryId:e,actionId:0,retryCount:0,msgType:"priceStatsResult",systemResponse:m}}catch(h){console.log("error in getPriceGraphPoint",h)}return{queryId:e,actionId:0,retryCount:0,msgType:"string",systemResponse:"Oops! Cannot find results. Try with another product page or url.."}}default:console.log("default hit!!");break}}catch(y){return console.log("error in generateAppResponse",y),{queryId:e,actionId:0,retryCount:r+1,msgType:"string",systemResponse:"Oops! Cannot find results. Try with another product page or url.."}}}const dr=async()=>{const e=await x.getItem("ext_id"),t=await x.getItem("ext_auth"),r=await x.getItem("ext_email");return{ext_id:e,ext_email:r,ext_auth:t}};async function um(e){try{const{ext_id:t,ext_email:r,ext_auth:i}=await dr(),s=`https://ext1.buyhatke.com/giftVoucher/vouchers/voucherChoices?${new URLSearchParams({extId:t,extAuth:i,siteId:e}).toString()}`,o=await fetch(s,{method:"GET",credentials:"omit",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Failed to fetch voucher choices: ${o.statusText}`);return await o.json()}catch{return{}}}async function dm(e,t,r){try{const{ext_email:i,ext_auth:a,ext_id:s}=await dr(),l=`https://ext1.buyhatke.com/giftVoucher/vouchers/voucherDenominationChoices?${new URLSearchParams({amount:t,siteId:e,voucherChoice:r,extId:s,extAuth:a}).toString()}`,c=await fetch(l,{credentials:"include",headers:{"Content-Type":"application/json"}});if(!c.ok)throw new Error(`Failed to fetch voucher choices: ${c.statusText}`);return await c.json()}catch{return{}}}async function pm(e){try{const{ext_email:t,ext_auth:r,ext_id:i}=await dr(),a=new URLSearchParams({...e}),o=`https://ext1.buyhatke.com/giftVoucher/orders/create?${new URLSearchParams({extId:i,extAuth:r}).toString()}`,l=await fetch(o,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,email:t,extId:i,extAuth:r})});if(!l.ok)throw new Error(`Failed to fetch voucher choices: ${l.statusText}`);return await l.json()}catch{return{}}}async function fm(e){try{const{ext_email:t,ext_auth:r,ext_id:i}=await dr(),a=new URLSearchParams({...e}),o=await fetch("https://ext1.buyhatke.com/giftVoucher/payments/create",{method:"POST",credentials:"include",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Failed to fetch voucher choices: ${o.statusText}`);return await o.json()}catch{return{}}}async function hm(e){try{const t=`https://ext1.buyhatke.com/giftVoucher/orders/status?orderId=${e}`;let r;try{r=await fetch(t,{credentials:"include",headers:{"Content-Type":"application/json"}})}catch(a){throw a.name==="AbortError"?new Error("Request was aborted"):new Error(`Network error while fetching voucher status: ${a.message}`)}if(!r.ok)throw new Error(`Failed to fetch voucher status: ${r.statusText}`);return await r.json()}catch{return{}}}async function ym(e){try{const t=`https://ext1.buyhatke.com/giftVoucher/vouchers/vouchers?orderId=${e}`;let r;try{r=await fetch(t,{credentials:"include",headers:{"Content-Type":"application/json"}})}catch(a){throw new Error(`Network error while fetching voucher status: ${a.message}`)}if(!r.ok)throw new Error(`Failed to fetch voucher status: ${r.statusText}`);return await r.json()}catch{return{}}}async function mm(e){try{const t="https://ext1.buyhatke.com/giftVoucher/orders/cancel";let r;try{r=await fetch(t,{method:"POST",credentials:"include",body:JSON.stringify({orderId:e}),headers:{"Content-Type":"application/json"}})}catch(a){throw new Error(`Network error while fetching voucher status: ${a.message}`)}if(!r.ok)throw new Error(`Failed to fetch voucher status: ${r.statusText}`);return await r.json()}catch{return{}}}async function wm(e){try{return await new Promise((t,r)=>{chrome.cookies.getAll({domain:e.domain,name:e.name},i=>{var s;if(chrome.runtime.lastError){r(chrome.runtime.lastError);return}const a=((s=i[0])==null?void 0:s.value)||null;t(a)})})}catch{return null}}async function bm(e){try{let t=await fetch(e.url,e.options);return t.status>=200&&t.status<400?e.responseType=="json"?t=await t.json():e.responseType=="html"&&(t=await t.text()):t=null,t}catch{return null}}async function Im(){try{const{ext_email:e,ext_auth:t,ext_id:r}=await dr(),i=new URLSearchParams({email:e,extId:r,extAuth:t}),a=await fetch("https://ext1.buyhatke.com/giftVoucher/login/isLoggedIn",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,extId:r,extAuth:t})});if(!a.ok)return{status:0,err:(a==null?void 0:a.statusText)||"Something went wrong."};const s=a.headers.get("set-cookie");if(s){const l=s.split(";").find(c=>c.trim().startsWith("connect.bh-giftvoucher.sid="));if(l){const c=l.split("=")[1];chrome.cookies.set({url:"https://ext1.buyhatke.com",name:"connect.bh-giftvoucher.sid",value:c,domain:".buyhatke.com",path:"/"})}}return await a.json()}catch{return{status:0,err:"Something went wrong."}}}async function gm({pos:e,providerId:t,amount:r}){try{const{ext_email:i,ext_auth:a,ext_id:s}=await dr(),o=await fetch(`https://ext1.buyhatke.com/giftVoucher/login/isAllowed?pos=${e}&providerId=${t}&amount=${r}&version=${chrome.runtime.getManifest().version}&extId=${s}`,{method:"GET"});return o.ok?await o.json():{status:0,err:(o==null?void 0:o.statusText)||"Something went wrong."}}catch{return{status:0,err:"Something went wrong."}}}
