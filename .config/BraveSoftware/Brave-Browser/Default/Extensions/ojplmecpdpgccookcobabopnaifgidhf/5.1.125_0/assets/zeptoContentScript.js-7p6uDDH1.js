const i=e=>new Promise(n=>setTimeout(n,e));async function c(e,n=3e3){const s=Date.now();for(;Date.now()-s<n;){const t=document.querySelector(e);if(t)return t;await i(200)}return null}async function d(){try{return!!(window.location.hostname.includes("zepto")||window.location.href.includes("zepto"))}catch{return!1}}async function l(e){try{if(!await d())return{success:!1,error:"Not on Zepto website"};await i(500);let s=document.querySelector('[data-testid="item-quantity-text"]'),t=document.querySelector('button[aria-label="Increase quantity by 1"]'),o=0;if(!t){const r=await c('div[aria-label="Add to Cart"]',8e3);if(!r)throw new Error("Add container not found");const a=r.querySelector("button");if(!a)throw new Error("Add button not found");if(a.click(),await i(500),e===1)return{success:!0,message:"Added 1 item"}}const u=t?e:e-1;for(let r=0;r<u;r++){const a=await c('button[aria-label="Increase quantity by 1"]',800);if(!a){console.warn(`Zepto CS: Could not find + button for click ${r+1}`);break}a.click(),await i(500)}return{success:!0,message:"Finished adding items"}}catch(n){return{success:!1,error:n.message}}}chrome.runtime.onMessage.addListener((e,n,s)=>{if(e.action==="ADD_ZEPTO_TO_CART")return(async()=>{const t=await l(e.quantity);try{await chrome.runtime.sendMessage({action:"ZEPTO_CART_ADD_RESULT",tabId:e.tabId,success:t.success,data:t})}catch{}})(),!1});
