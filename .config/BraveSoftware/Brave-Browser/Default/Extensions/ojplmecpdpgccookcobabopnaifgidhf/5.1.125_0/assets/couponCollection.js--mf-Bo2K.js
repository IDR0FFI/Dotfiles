import{t as b,g as C,c as x,q as A,v as N}from"./utility_all2-0mYDd1Oa.js";import{l as y,a as j}from"./autoCouponUI-BSRHB3pC.js";let h=[],m=[],d=0,w="",S="",u="",f="";function v(c,r){try{let o=r.descSelector;for(let i=0;i<o.length;i++)try{let l=c,t=c,e="",a="",n=o[i];for(let s=0;s<n.selector.length;s++)l=l.querySelector(n.selector[s]);if(n.hasOwnProperty("attribute"))e=l[n.attribute];else{let s=l.textContent;s==null||s==""||n.selector.length==0?e=l:e=s}if(n.hasOwnProperty("slice")){let s=n.slice[0];n.slice.length>1?end=n.slice[1]:end=e.length,e=e.slice(s,end)}if(n.hasOwnProperty("path")&&(e=accessPath(e,n.path)),n.hasOwnProperty("regex"))for(let s=0;s<n.regex.length;s++)try{let p=1;n.hasOwnProperty("match")&&(p=n.match);let g;if(n.hasOwnProperty("global")?g=e.match(new RegExp(n.regex[s],"g"))[p]:g=e.match(new RegExp(n.regex[s]))[p],g!=null&&g!=""){e=g;break}}catch{}if(e!=""&&e!=null)return e=e.replaceAll("&amp;","&"),e=e.replaceAll(`
`,""),e=e.replaceAll("❯",""),e.trim()}catch{}return""}catch{return""}}function E(){let c=N.url.split("//")[1];return c=c.split("/")[0],c}function I(c,r){try{let o=r.codeSelector;for(let i=0;i<o.length;i++)try{let l=c,t="",e=o[i];for(let a=0;a<e.selector.length;a++)l=l.querySelector(e.selector[a]);if(e.hasOwnProperty("attribute"))t=l[e.attribute];else{let a=l.textContent;a==null||a==""||e.selector.length==0?t=l:t=a}if(e.hasOwnProperty("path")&&(t=accessPath(t,e.path)),e.hasOwnProperty("regex")){let a=!1;for(let n=0;n<e.regex.length;n++)try{let s=1;e.hasOwnProperty("match")&&(s=e.match);let p;if(e.hasOwnProperty("global")?p=t.match(new RegExp(e.regex[n],"g"))[s]:p=t.match(new RegExp(e.regex[n]))[s],p!=null&&p!=""){a=!0,t=p;break}}catch{}a||(t="")}if(t!=""&&t!=null)return t=t.replaceAll("&amp;","&"),t=t.replaceAll(`
`,""),t=t.replaceAll("❯",""),t.trim()}catch{}return""}catch{return""}}function J(c,r){try{let o=r.expSelector;for(let i=0;i<o.length;i++)try{let l=c,t="",e=o[i];for(let a=0;a<e.selector.length;a++)l=l.querySelector(e.selector[a]);if(e.hasOwnProperty("attribute"))t=l[e.attribute];else{let a=l.textContent;a==null||a==""||e.selector.length==0?t=l:t=a}if(e.hasOwnProperty("slice")){let a=e.slice[0];e.slice.length>1?end=e.slice[1]:end=t.length,t=t.slice(a,end)}if(e.hasOwnProperty("path")&&(t=accessPath(t,e.path)),e.hasOwnProperty("regex"))for(let a=0;a<e.regex.length;a++)try{let n=1;e.hasOwnProperty("match")&&(n=e.match);let s;if(e.hasOwnProperty("global")?s=t.match(new RegExp(e.regex[a],"g"))[n]:s=t.match(new RegExp(e.regex[a]))[n],s!=null&&s!=""){t=s;break}}catch{}if(e.hasOwnProperty("format")&&(t=R(t)),t!=""&&t!=null)return t=t.replaceAll("&amp;","&"),t=t.replaceAll(`
`,""),t=t.replaceAll("❯",""),t.trim()}catch{}return""}catch{return""}}function O(c){try{return["January","February","March","April","May","June","July","August","September","October","November","December"].indexOf(c)}catch{}}function R(c){try{if(c.includes("th")){const r=/(\d{2}th \w+ \d{4})/g,o=c.match(r);if(o){const l=o[0].split(" "),t=parseInt(l[0].replace(/\D/g,"")).toString().padStart(2,"0"),e=(O(l[1].replace(/,/g,""))+1).toString().padStart(2,"0");return`${parseInt(l[2])}-${e}-${t} 00:00:00`}}else{const r=/(\d{2}st \w+ \d{4})/g,o=c.match(r);if(o){const l=o[0].split(" "),t=parseInt(l[0].replace(/\D/g,"")).toString().padStart(2,"0"),e=(O(l[1].replace(/,/g,""))+1).toString().padStart(2,"0");return`${parseInt(l[2])}-${e}-${t} 00:00:00`}}}catch{}}function k(c,r){return c.length!=r.length?!1:(c.sort((o,i)=>JSON.stringify(o)>JSON.stringify(i)?1:-1),r.sort((o,i)=>JSON.stringify(o)>JSON.stringify(i)?1:-1),JSON.stringify(c)==JSON.stringify(r))}async function q(){h=[];try{for(let r of u.prod){let o=r.classSelector;o=document.querySelectorAll(o);for(let l=0;l<o.length;l++){let t=o[l],e={code:I(t,r),url:E(t,r),desc:v(t,r),exp:J(t,r),pos:f};r.isCheckout&&(e.checkout=1),e.code&&e.code!=""&&!e.code.includes(" ")&&h.push(e)}}const c=new Map;if(h.forEach(r=>{c.has(r.code)||c.set(r.code,r)}),h=Array.from(c.values()),!k(h,m)&&h.length!=0){try{S=await A(),w=S.id,y.ONPAGE_CPNS=[];for(let r=0;r<h.length;r++)y.ONPAGE_CPNS.push({code:h[r].code,desc:h[r].desc});await j.setItem("CPNS"+w+f,JSON.stringify(y))}catch{}await x({type:"sendCouponScrap",data:h})}m=h}catch{}}async function $(){try{if(d==1)return;d=1,f==""&&(f=await b(),(f==""||f==null||f==null)&&(f=await C())),u==""&&(u=await x({type:"getCpnCollectionConfig",data:f}),(u==null||u==null||u=="")&&clearInterval(P)),await q(),d=0}catch{clearInterval(P)}}let P=setInterval($,500);
