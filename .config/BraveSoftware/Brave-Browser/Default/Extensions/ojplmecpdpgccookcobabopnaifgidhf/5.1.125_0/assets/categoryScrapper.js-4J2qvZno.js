import{g as Ge,a as B,c as k,u as E,b as Ze,d as De,e as J,f as W,h as et,s as M,i as Ee,j as tt,k as rt,m as lt,l as at,n as nt,o as ot,p as it}from"./utility_all2-0mYDd1Oa.js";let I=[],U=[],Ve=[],Re=[],ze=[],b="",N="";function ct(e){const a=/(\d+)\s*(?:\s*GB|\s*TB|\s*Gb|\s*Tb|\s*gb|\s*tb|\s*gB|\s*tB)/g;let i;const n=[];for(;(i=a.exec(e))!==null;)n.push(parseInt(i[1]));return n}const st=async(e,a)=>{var i,n,c,s,d,h,m,g,w,S,P,O,v,K,A,j,T,G,Z,D,ee,te,re,le,ae,ne,oe,ie,ce,se,ue,fe,me,de,ye,he,ge,Ce,be,we,Se,pe,ke,ve,xe,Ie,Pe,Oe,je,qe,Be,Ae,_e,Me,Ne,Le,Te;try{await new Promise(l=>setTimeout(l,1e3));let o=I;for(let l=0;l<o.length;l++)try{if((i=o[l])!=null&&i.onlyTable){let t=document.querySelectorAll((n=o[l])==null?void 0:n.onlyTable);if(t==null)continue;for(let r=0;r<t.length;r++){let f=t[r].querySelectorAll("tr");for(let u=0;u<f.length;u++){let y=((d=(s=(c=f[u])==null?void 0:c.querySelector("th"))==null?void 0:s.textContent)==null?void 0:d.trim())||"",C;if(y=="Best Sellers Rank"){let p=f[u].querySelectorAll("span");if(p==null||p==null)continue;let x=p.length;C=p[x-1].textContent.trim()}else C=((m=(h=f[u])==null?void 0:h.querySelector("td"))==null?void 0:m.textContent.trim())||"";y&&C&&(e[y]=C)}}}else if((g=o[l])!=null&&g.directCheckInUrl)window.location.href.includes(o[l].directCheckInUrl)&&(e.matchedCategory=o[l].assignCat);else if((w=o[l])!=null&&w.description){let t=(S=o[l])==null?void 0:S.description,r=document.querySelectorAll(t),f=(P=o[l])==null?void 0:P.ind;if(f?r=r[f]:r=document.querySelector(t),(O=o[l])!=null&&O.attribute){let u=o[l].attribute,y=(r==null?void 0:r[u])??(r==null?void 0:r.getAttribute(u));y&&(e.description=y)}}else if((v=o[l])!=null&&v.ai_review){let t=(K=o[l])==null?void 0:K.ai_review,r=document.querySelectorAll(t),f=(A=o[l])==null?void 0:A.ind;if(f?r=r[f]:r=document.querySelector(t),(j=o[l])!=null&&j.attribute){let u=o[l].attribute,y=(r==null?void 0:r[u])??(r==null?void 0:r.getAttribute(u));y&&(e.ai_review=y)}}else if((T=o[l])!=null&&T.value_in_key){let t=document.querySelectorAll((G=o[l])==null?void 0:G.classSelector);if(t==null)continue;for(let r=0;r<t.length;r++){let f=t[r].querySelectorAll((Z=o[l])==null?void 0:Z.key);for(let u=0,y=0;u<f.length;u++,y++){let p=f[u].textContent.trim().split(":",2);if(p.length==2){let x=p[0].trim(),Ye=p[1].trim();e[x]=Ye}}}}else if((D=o[l])!=null&&D.classSelector){let t=document.querySelectorAll((ee=o[l])==null?void 0:ee.classSelector);if(t==null)continue;for(let r=0;r<t.length;r++){let f=t[r].querySelectorAll((te=o[l])==null?void 0:te.key),u=t[r].querySelectorAll((re=o[l])==null?void 0:re.value);for(let y=0,C=0;y<f.length;y++,C++)if(f[y].textContent.trim()=="Customer Reviews"||f[y].textContent.trim()=="Best Sellers Rank"){C--;continue}else{let p=f[y].textContent.trim(),x=u[C].textContent.trim();e[p]=x}}}else if((le=o[l])!=null&&le.table){let t=document.querySelectorAll((ae=o[l])==null?void 0:ae.table);if(t==null)continue;for(let r=0;r<t.length;r++){let f=t[r].querySelectorAll((ne=o[l])==null?void 0:ne.key),u=t[r].querySelectorAll((oe=o[l])==null?void 0:oe.value);for(let y=0,C=0;y<f.length;y++,C++)if(f[y].textContent.trim()=="Customer Reviews"||f[y].textContent.trim()=="Best Sellers Rank"){C--;continue}else{let p=f[y].textContent.trim(),x=u[C].textContent.trim();e[p]=x}}}else if((ie=o[l])!=null&&ie.productName){let t=document.querySelector((ce=o[l])==null?void 0:ce.productName);if(t==null)continue;let r=t.textContent.trim();e.nameOfProduct=r}else if((se=o[l])!=null&&se.one_key){let t=((fe=document.querySelector((ue=o[l])==null?void 0:ue.one_key))==null?void 0:fe.textContent.trim())||null,r=((de=document.querySelector((me=o[l])==null?void 0:me.one_value))==null?void 0:de.textContent.trim())||null;if(t==null||t==null||r==null||r==null)continue;e[t]=r}else if((ye=o[l])!=null&&ye.firstClick){await document.querySelector((he=o[l])==null?void 0:he.firstClick).click(),await document.querySelector((ge=o[l])==null?void 0:ge.secondClick).click();let t=document.querySelectorAll((Ce=o[l])==null?void 0:Ce.classSelectorOfClick);if(t!=null)for(let r=0;r<t.length;r++){let f=t[r].querySelectorAll((be=o[l])==null?void 0:be.key),u=t[r].querySelectorAll((we=o[l])==null?void 0:we.value);for(let y=0,C=0;y<f.length;y++,C++)if(f[y].textContent.trim()=="Customer Reviews"||f[y].textContent.trim()=="Best Sellers Rank"){C--;continue}else{let p=f[y].textContent.trim(),x=u[C].textContent.trim();e[p]=x}}await document.querySelector((Se=o[l])==null?void 0:Se.closeClick).click()}else if((pe=o[l])!=null&&pe.highlight){let t=document.querySelectorAll((ke=o[l])==null?void 0:ke.highlight);if(t==null)continue;for(let r=0;r<t.length;r++){let u=t[r].textContent.trim().split(":");u.length==2&&(e[u[0]]=u[1])}}else if((ve=o[l])!=null&&ve.flipkartBreadcrumbClassSelector){let t=document.querySelectorAll((xe=o[l])==null?void 0:xe.flipkartBreadcrumbClassSelector);if(t==null)continue;let r="",f=t.length;for(let u=0;u<f-1;u++)r+=t[u].textContent.trim()+" ";e.breadcrumb=r}else if((Ie=o[l])!=null&&Ie.amazonBreadcrumbClassSelector){let t=document.querySelectorAll((Pe=o[l])==null?void 0:Pe.amazonBreadcrumbClassSelector);if(t==null)continue;let r="",f=t.length;for(let u=0;u<f;u++)r+=t[u].textContent.trim()+" ";e.breadcrumb=r}else if((Oe=o[l])!=null&&Oe.cromaBreadcrumbClassSelector){let t=document.querySelector((je=o[l])==null?void 0:je.cromaBreadcrumbClassSelector);if(t==null)continue;let r="",f=t.children.length;for(let u=0;u<f;u++)r+=t.children[u].textContent.trim()+" ";e.breadcrumb=r}else if((qe=o[l])!=null&&qe.relianceDigitalBreadcrumbClassSelector){let t=document.querySelector((Be=o[l])==null?void 0:Be.relianceDigitalBreadcrumbClassSelector);if(t==null)continue;let r="",f=t.children.length;for(let u=0;u<f-2;u++)r+=t.children[u].textContent.trim()+" ";e.breadcrumb=r}else if((Ae=o[l])!=null&&Ae.vijaySalesBreadcrumbIdSelector){let t=document.getElementById((_e=o[l])==null?void 0:_e.vijaySalesBreadcrumbIdSelector);if(t==null)continue;let r="",f=t.children.length;for(let u=0;u<f-1;u++)r+=t.children[u].textContent.trim()+" ";e.breadcrumb=r}else if((Me=o[l])!=null&&Me.singleKeyValue){let t=document.querySelectorAll((Ne=o[l])==null?void 0:Ne.singleKeyValue);if(t==null)continue;for(let r=0;r<t.length;r+=2)e[t[r].textContent.trim()]=t[r+1].textContent.trim()}else{let t=document.querySelectorAll((Le=o[l])==null?void 0:Le.key),r=document.querySelectorAll((Te=o[l])==null?void 0:Te.value);if(t==null||r==null)continue;for(let f=0,u=0;f<t.length;f++,u++)if((t[f].textContent.trim()=="Customer Reviews"||t[f].textContent.trim()=="Best Sellers Rank")&&a==2){u--;continue}else{let y=t[f].textContent.trim(),C=r[u].textContent.trim();e[y]=C}}}catch{}if(e.nameOfProduct){let l=ct(e.nameOfProduct);if(l.length>=2){let t=null,r=null;Math.min(l[0],l[1])<=4&&Math.max(l[0],l[1])<=32?(t=Math.max(l[0],l[1]),r=Math.min(l[0],l[1]),e["product ram"]=`${t} GB`,e["product rom"]=`${r} TB`):(t=Math.min(l[0],l[1]),r=Math.max(l[0],l[1]),e["product ram"]=`${t} GB`,e["product rom"]=`${r} GB`)}else if(l.length==1){let t=l[0];t>=50&&(e["product rom"]=`${t} GB`)}}$=0,await H(0)}catch{$=0,await H(0)}},ut=async e=>{try{let a=0,i="other",n=[];for(let c in U){let s=0,d=Object.keys(e),h,m=0;for(let g=0;g<U[c].length;g++){const{keys:w,values:S,isMust:P}=U[c][g];h=0;for(let O=0;O<w.length;O++){for(let v=0;v<d.length;v++){if((d[v]?d[v].toLowerCase():"").includes(w[O])){let A=e[d[v]]?e[d[v]].toLowerCase():"";for(let j=0;j<S.length;j++)if(A.includes(S[j])){let T=w[O],G=S[j];n.push({descriptionKey:T,lowerValue:A}),s++,h=1;break}}if(h==1)break}if(h==1)break}if(h==0&&P=="true"){m=1;break}}m!=1&&s>a&&s>=Ve[c]&&(a=s,i=c)}return e.hasOwnProperty("matchedCategory")&&(i=e.matchedCategory),{raw_data:e,refined_data:n,matchedCategory:i}}catch{}};let Ue=null,q=null;const X=async()=>{var a;var e=((a=I[0])==null?void 0:a.invisibleCSS)??"._8mqQwQ { display: none; } ._1TWLMK.icF5zO { opacity: 0.01; }";Ue=document.head||document.getElementsByTagName("head")[0],q=document.createElement("style"),Ue.appendChild(q),q.type="text/css",q.id="mytempCss",q.styleSheet?q.styleSheet.cssText=e:q.appendChild(document.createTextNode(e))};var $=0;const H=async e=>{$==0&&(document.getElementById("mytempCss")&&document.getElementById("mytempCss").remove(),e<10&&setTimeout(function(){H(e+1)},2e3))};X();const ft=e=>{try{const a=[];for(const[i,n]of Object.entries(e))n.forEach(c=>{a.push({...c,category:i})});return a}catch{}};function mt(e){try{let a=e.Master;a=ft(a);let i={};for(let n=0;n<a.length;n++)try{let c=a[n],s=c.key,d=c.value;s&&d&&(i[s]=d)}catch{}return i}catch{}}async function dt(e){try{let a=await fetch(e);return a=await a.json(),a}catch{}}let Je="";async function He(){try{let e=await k({type:"getElectronicProduct"});e&&Object.keys(e).length>0&&(Je=e)}catch{}}let F={};async function yt(){try{let e=await k({type:"getElectronicCategories"});e&&Object.keys(e).length>0&&(F=e)}catch{}}function Fe(e,a){try{const i=e.categoryObject.category?e.categoryObject.category.toLowerCase():"",n=e.categoryObject.subCategory?e.categoryObject.subCategory.toLowerCase():"",c=e.categoryObject.subSubCategory?e.categoryObject.subSubCategory.toLowerCase():"";for(const[s,d]of Object.entries(a)){const h=s.toLowerCase();if(i===h||n===h||c===h)return d}return null}catch{return null}}async function ht(){try{if(L||await We(),Object.keys(F).length==0&&await yt(),b==2){let c=ot().replace("Home*~","").split("*~").slice(0,3),s={categoryObject:{category:c[0]||"",subCategory:c[1]||"",subSubCategory:c[2]||""}};const d=Fe(s,F);return isNaN(parseInt(d))?"other":parseInt(d)}const e=Fe(N,F);return isNaN(parseInt(e))?"other":parseInt(e)}catch{return"other"}}const Qe=async()=>{try{if(b=await Ge(),b==""||b==null||b==null)throw new Error("Cannot get pos");I=await k({type:"getCategoryConfig",data:b});let e=!1,a={};b==6645&&(e=!0),(I==null||I==null||I.length==0)&&!e&&E(0),b==2&&await X();let i=await k({type:"getCategoryConfig",data:"rules"});if(i==null||i==null||i.length==0)throw new Error("Cannot get Rules");U=i[0].categoryRules,Ve=i[0].thresholdMatches,Re=i[0].categoryId,ze=i[0].minPrice;try{if(e){let g=await Ze();e=!0;let w=await dt(`https://mdm.vijaysales.com/web/api/prod-spec-content.json?sku=${g}`);a=mt(w)}e||(I[0].hasOwnProperty("scriptSelector")?await Ct(I,a,b):await st(a,b))}catch{}let{raw_data:n,refined_data:c,matchedCategory:s}=await ut(a),d=De();d=1-d;let h=await ht(),m={pid:B(),name:et(),image:W(),price:J(),oos:d,pos:b,raw_data:n,refined_data:c,cat_id:Re[s],cat_id_new:h};if(m.pid&&m.name&&m.price||M(!1),m.cat_id==18){let g=Ee();m={...m,...g}}else if(m.cat_id==37||m.cat_id==38||m.cat_id==39){s="other";let g=Ee();g.soldBy&&g.soldBy!=""&&(m={pid:B(),pos:b,soldBy:g.soldBy},await k({type:"sendCategoryCrawl",data:m}));return}s!="other"&&m.price!=0&&m.price<ze[s]&&(s="other"),s!="other"||h?(await k({type:"sendCategoryCrawl",data:m}),h!="other"?E(1):E(-1)):E(-1)}catch{}};function V(e,a){try{let i=e.split("."),n=a;if(i.length==1&&i[0]=="")return a;for(let c=0;c<i.length;c++)n=n[i[c]];return n}catch{return""}}async function gt(e,a){try{for(let i=0;i<a.length;i++){let n=a[i].attributes;for(let c=0;c<n.length;c++){let s=n[c];s.hasOwnProperty("name")&&s.hasOwnProperty("value")&&(key=s.name,val=s.value),e[key]=val}}}catch{}}async function Ct(e,a,i){try{i==8579&&await new Promise(h=>setTimeout(h,3e3));let n=document.querySelector(e[0].scriptSelector);n=JSON.parse(n.textContent);let c=V(e[0].brandSelector,n),s=V(e[0].modelSelector,n);c!=""&&(a[c]=c),s!=""&&(a[s]=s);let d=V(e[0].specifications,n);await gt(a,d)}catch{}}let L=!1;async function Y(){try{let e=B(),a=b;if(e&&b&&(L=!0),e&&b){let i={pid:e,pos:a},n;n=await k({type:"getProductCategory",data:i}),(n==null?void 0:n.status)==1&&(N=n)}}catch{}}let $e="";function bt(e=5e3,a=100){return new Promise(i=>{let n=0;const c=setInterval(()=>{const s=B(),d=W();s&&d&&(clearInterval(c),i(!0)),n+=a,n>=e&&(clearInterval(c),i(!1))},a)})}async function We(e=1e4,a=100){return new Promise((i,n)=>{let c=0;const s=setInterval(async()=>{try{await Y(),L&&(clearInterval(s),i(L)),c+=a,c>=e&&(clearInterval(s),i(null))}catch{clearInterval(s),i(null)}},a)})}async function wt(e){try{if(!e||e.length==0)return e;let a=[];e.forEach(c=>{const{pos:s,pid:d}=c;s>0&&d&&a.push([s,d])});const{status:i,data:n}=await k({type:"getPriceData",priceMap:a});if(i===1&&n){const c={};Object.keys(n).forEach(s=>{const d=s.split("~**~")[1],{price:h,oos:m}=JSON.parse(n[s]);c[d]={price:h,oos:m}}),e=e.map(s=>{var h,m;const{pid:d}=s;return c[d]&&((h=c[d])!=null&&h.price)&&(s.price=+(((m=c[d])==null?void 0:m.price)??0)),s})}return e}catch(a){return console.log(a),e}}async function Xe(){var e,a;if(it()!=1)try{if(!await bt())return;if(B()==""||W()==""){M(!1);return}$e=await tt();let n,c=99999999999,s=0,d,h=await k({type:"extID"});if(rt.hasOwnProperty(b)?n=await lt():n=await at(),n=await wt(n),n=n.map((m,g)=>{let w=m.prodUrl||"",S=m.pos??g,P=S?"https://t.buyhatke.com/Navigation/?pos="+S+"&source=extension&ext1=new-deals&ext2="+h+"&link="+encodeURIComponent(w):w;return{productName:m.prod||"",productImage:m.imageUrl||"",productLink:P,currentPrice:m.price||0,sitePosition:S,siteName:m.site_name||"",siteImage:m.site_logo||"",internalPid:m.internalPid||0}}),n&&n.length>0){nt(n),L||await We();const m=(e=N==null?void 0:N.categoryObject)==null?void 0:e.subCatId;m!=null&&Je.hasOwnProperty(String(m))?M(!1):M(!0)}else M(!1);if(n&&n.length>0){c=n.reduce((w,S)=>S.currentPrice<w?S.currentPrice:w,((a=n[0])==null?void 0:a.currentPrice)??1/0),s=J()-c,s>0&&(d=Math.round(s/J()*100));let g={hostName:window.location.hostname};chrome&&chrome.storage&&chrome.storage.sync&&chrome.storage.sync.get("noOfTimesDealsPromptShown",function(w){let S=+(w.noOfTimesDealsPromptShown||"0");if(S<3){let P=`Found similar products starting from ${$e}${c}`;chrome.storage.sync.set({noOfTimesDealsPromptShown:`${S+1}`})}})}else{let g={hostName:window.location.hostname};await k({type:"fireEvent",eventName:"DittoNoResult",params:g})}}catch{}}let R=0,_=0,Ke=location.href,Q=null,z=null;function St(){(document.readyState==="interactive"||document.readyState==="complete")&&(clearInterval(pt),kt())}const pt=setInterval(St,500);async function kt(){try{b=await Ge(),Q=B(),R||(R=1,await He(),await Y(),await Qe(),await Xe(),R=0),vt()}catch{R=0}}function vt(){new MutationObserver(()=>{const e=location.href;e!==Ke&&(Ke=e,z&&clearInterval(z),_=0,z=setInterval(async()=>{const a=B();a!==Q&&(Q=a,clearInterval(z),$=1,await X(),setTimeout(async()=>{try{_||(_=1,await He(),await Qe(),await Y(),await Xe(),_=0)}catch(i){console.error("Error inside interval flow:",i),_=0}},2e3))},500))}).observe(document,{subtree:!0,childList:!0})}
