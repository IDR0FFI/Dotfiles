import{g as S,q as A,c as x,r as v}from"./utility_all2-BNXd1yEL.js";import"./index-ljv-RBOm.js";let b=!1,C=setInterval(R,500);async function B(){var r;if(!b){b=!0;try{let l=await S(),f=await A(),p=await x({type:"getScrapConfig",pos:l}),u=(r=p==null?void 0:p.filter_config)==null?void 0:r.searchUrlRegex;if(u&&O(f.url,u))return;let h=v(p.filter_config.breadSelector,{skipPidCheck:!0});if(h==="")return;let i=await I(p.filter_config),a=i?i[Object.keys(i)[0]]:void 0;if(a===void 0||typeof a!="object"||a===null||Object.keys(a).length===0)return;await x({type:"filterData",data:{[h]:i},pos:l})}catch{}finally{b=!1}}}function O(r,l){if(!l||!r)return!1;try{return new RegExp(l,"i").test(r)}catch{return!1}}function w(r,{caseInsensitive:l=!0,collapseWhitespace:f=!0,trim:p=!0}={}){try{if(typeof r!="string")return r;let u=r;return p&&(u=u.trim()),f&&(u=u.replace(/\s+/g," ")),l&&(u=u.toLowerCase()),u}catch{}}function P(r,l){try{let{caseInsensitive:f=!0,dedupe:p=!0,dropEmptyGroups:u=!0}=l||{},h=Array.isArray(l==null?void 0:l.ignoreTitles)?l.ignoreTitles:[],i=new Set(h.map(n=>w(String(n),{caseInsensitive:f}))),a={};for(let[n,y]of Object.entries(r||{})){let o=w(n,{caseInsensitive:f});if(i.has(o))continue;let e=[],t=new Set;for(let s of y||[]){if(typeof s!="string")continue;let c=w(s,{caseInsensitive:f});if(p){if(t.has(c))continue;t.add(c)}let d=s.trim();d.length&&e.push(d)}(e.length||!u)&&(a[n]=e)}return a}catch{}}async function I(r){var h;let l={},f=r==null?void 0:r.scriptBased;if(f&&Array.isArray(f.scripts)){let{scripts:i}=f;for(let a of i)try{let n=null;if(a.strategy==="id"&&a.id){let o=document.getElementById(a.id);if(!o)continue;n=o.textContent||o.innerText}if(!n&&a.strategy==="regex"&&a.pattern){let o=new RegExp(a.pattern);for(let e of document.scripts)try{let t=e.textContent.match(o);if(t){n=t[1];break}}catch{}}if(!n)continue;n=n.replace(/undefined/g,"null");let y=await JSON.parse(n);for(let o of a.dataPaths){let e=y;for(let t of o.split(".").filter(Boolean))e=e==null?void 0:e[t];if(e)for(let t of Object.values(e)){l.hasOwnProperty(t[a.transform.titleField])||(l[t[a.transform.titleField]]=[]);for(let s of t[a.transform.valueIterator]||[])l[t[a.transform.titleField]].push(s[a.transform.valueField])}}}catch{continue}}let p=r==null?void 0:r.apiBased;if(p&&Array.isArray(p.scripts))try{let o=function(e,t,s){if(e)if(Array.isArray(e))for(let c of e)o(c,t,s);else typeof e=="object"&&e!==null&&(e[t]&&s.push(e[t]),e.values&&o(e.values,t,s))},{scripts:i}=p,n=await(await fetch(window.location.href,{credentials:"include"})).text(),y=new DOMParser().parseFromString(n,"text/html");for(let e of i)try{let t=null;if(e.strategy==="regex"&&e.pattern){let c=new RegExp(e.pattern);for(let d of y.scripts)try{let m=d.textContent.match(c);if(m&&m[1]){t=m[1];break}}catch{}}if(!t)continue;t=t.replace(/undefined/g,"null");let s=JSON.parse(t);for(let c of e.dataPaths){let d=s;for(let m of c.split(".").filter(Boolean))d=d==null?void 0:d[m];if(d)for(let m of Object.values(d)){let g=m==null?void 0:m[e.transform.titleField];g&&(l[g]||(l[g]=[]),o(m[e.transform.valueIterator],e.transform.valueField,l[g]))}}}catch{continue}}catch{}if(r!=null&&r.domBased)try{for(let i of r.domBased.filters||[]){let a=Array.from(document.querySelectorAll(i.id));for(let n of a){let y=null,o=n.querySelector(i.titleSelector);if(y=(h=o==null?void 0:o[i.attribute])==null?void 0:h.trim(),!y)continue;let e=n.querySelectorAll(i.itemSelector),t=Array.from(e).map(s=>{let c=i.itemAttribute?i.itemAttribute==="title"?s.getAttribute("title"):s[i.itemAttribute]:null;return c||(c=s.innerText||s.textContent),c==null?void 0:c.trim()}).filter(Boolean);t.length&&(l[y]=t)}}}catch{}return P(l,r)}function R(){if(document.readyState==="interactive"||document.readyState==="complete"){if(clearInterval(C),Math.floor(Math.random()*100)+1!==1)return;B()}}
